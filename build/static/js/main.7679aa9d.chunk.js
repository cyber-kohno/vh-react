(this["webpackJsonpvh-react-ts"]=this["webpackJsonpvh-react-ts"]||[]).push([[0],{25:function(e,t,a){},26:function(e,t,a){},27:function(e,t,a){},28:function(e,t,a){},29:function(e,t,a){},31:function(e,t,a){},32:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){},46:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){},51:function(e,t,a){"use strict";a.r(t);var n,s=a(4),c=a.n(s),i=a(15),r=a.n(i),l=(a(25),a(26),a(27),a(5)),d=(a(28),a(29),a(2)),o=function(e){var t=[];return t.push("tab-menu"),t.push(e.isActive?"active":""),t.push(e.isDisable?"disable":""),Object(d.jsx)("div",{className:t.join(" "),onClick:function(){return e.selectTab()},children:Object(d.jsx)("span",{children:e.name})})},b=function(e){return e.isActive?Object(d.jsx)("div",{className:"tab-cont",children:e.cont}):Object(d.jsx)(d.Fragment,{})},u=function(e){var t=Object(s.useState)(e.activeNo),a=Object(l.a)(t,2),n=a[0],c=a[1];Object(s.useEffect)((function(){c(e.activeNo)}),[e.activeNo]);var i=[],r=[];return e.tabElements.forEach((function(t,a){i.push(Object(d.jsx)(o,{name:t.name,isActive:a==n,isDisable:t.disable,selectTab:function(){return function(t){void 0!==e.selectTabIndex?e.selectTabIndex(t):c(t)}(a)}},a)),r.push(Object(d.jsx)(b,{cont:t.cont,isActive:a==n},a))})),Object(d.jsxs)("div",{id:e.groupName,children:[Object(d.jsx)("div",{className:"tab-list",children:i}),Object(d.jsx)("div",{className:"cont-list",children:r})]})},E=(a(31),a(32),["\u2160","b\u2161","\u2161","b\u2162","\u2162","\u2163","b\u2164","\u2164","b\u2165","\u2165","b\u2166","\u2166"]),j=["\u2160","#\u2160","\u2161","#\u2161","\u2162","\u2163","#\u2163","\u2164","#\u2164","\u2165","#\u2165","\u2166"],O=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],h=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],x=["\u2160","\u2160maj7","\u2161m","\u2161m7","\u2162m","\u2162m7","\u2163","\u2163maj7","\u2164","\u21647","\u2165m","\u2165m7","\u2166m(-5)","\u2166m7(-5)"];!function(e){e[e.MAJOR=0]="MAJOR",e[e.MINOR=1]="MINOR",e[e.SUS4=2]="SUS4",e[e.DIM=3]="DIM",e[e.AUG=4]="AUG",e[e.MAJ7=5]="MAJ7",e[e.SEVENTH=6]="SEVENTH",e[e.MIN7=7]="MIN7",e[e.MINOR_MAJ7=8]="MINOR_MAJ7",e[e.ADD9=9]="ADD9",e[e.MINOR_ADD9=10]="MINOR_ADD9",e[e.SIXTH_9TH=11]="SIXTH_9TH",e[e.MINOR_MINUS5=12]="MINOR_MINUS5"}(n||(n={}));var f,T=[{key:n.MAJOR,sortNo:1,parentNo:0,depth:1,name:"",struct:["p1","M3","p5"],fixed:["p1"],intervals:[0,4,7]},{key:n.MINOR,sortNo:2,parentNo:0,depth:1,name:"m",struct:["p1","m3","p5"],fixed:["p1"],intervals:[0,3,7]},{key:n.SUS4,sortNo:3,parentNo:0,depth:1,name:"sus4",struct:["p1","p4","p5"],fixed:["p1"],intervals:[0,5,7]},{key:n.DIM,sortNo:4,parentNo:0,depth:1,name:"dim",struct:["p1","m3","d5"],fixed:["p1"],intervals:[0,3,6]},{key:n.AUG,sortNo:5,parentNo:0,depth:1,name:"aug",struct:["p1","M3","a5"],fixed:["p1"],intervals:[0,4,8]},{key:n.MAJ7,sortNo:6,parentNo:0,depth:1,name:"maj7",struct:["p1","M3","p5","M7"],fixed:["p1"],intervals:[0,4,7,11]},{key:n.SEVENTH,sortNo:7,parentNo:0,depth:1,name:"7",struct:["p1","M3","p5","m7"],fixed:["p1"],intervals:[0,4,7,10]},{key:n.MIN7,sortNo:8,parentNo:0,depth:1,name:"m7",struct:["p1","m3","p5","m7"],fixed:["p1"],intervals:[0,3,7,10]},{key:n.MINOR_MAJ7,sortNo:9,parentNo:0,depth:1,name:"mmaj7",struct:["p1","m3","p5","M7"],fixed:["p1"],intervals:[0,3,7,11]},{key:n.ADD9,sortNo:10,parentNo:0,depth:1,name:"add9",struct:["p1","M2","M3","p5"],fixed:["p1"],intervals:[0,2,4,7]},{key:n.MINOR_ADD9,sortNo:11,parentNo:0,depth:1,name:"madd9",struct:["p1","M2","m3","p5"],fixed:["p1"],intervals:[0,2,3,7]},{key:n.SIXTH_9TH,sortNo:12,parentNo:0,depth:1,name:"6(9)",struct:["p1","M2","M3","p5","M6"],fixed:["p1"],intervals:[0,2,4,7,9]},{key:n.MINOR_MINUS5,sortNo:13,parentNo:0,depth:1,name:"m(-5)",struct:["p1","m3","d5"],fixed:["p1"],intervals:[0,3,6]}];!function(e){e[e.TRIAD=0]="TRIAD",e[e.TETRAD7TH=1]="TETRAD7TH",e[e.TETRAD9TH=2]="TETRAD9TH"}(f||(f={}));f.TRIAD,n.MAJOR,n.MINOR,n.SUS4,n.DIM,n.AUG,n.MINOR_MINUS5,f.TETRAD7TH,n.MAJ7,n.SEVENTH,n.MINOR_MAJ7,f.TETRAD9TH,n.ADD9,n.MINOR_ADD9;var N,S,v,p,m,L,I,A=[{degreeIndex:0,symbolKey:n.MAJOR},{degreeIndex:2,symbolKey:n.MINOR},{degreeIndex:4,symbolKey:n.MINOR},{degreeIndex:5,symbolKey:n.MAJOR},{degreeIndex:7,symbolKey:n.MAJOR},{degreeIndex:9,symbolKey:n.MINOR},{degreeIndex:11,symbolKey:n.MINOR_MINUS5}],C=a(20);!function(e){e.NONE="NONE",e.CONTEXT_MENU="CONTEXT_MENU",e.CHORD_PALETTE="CHORD_PALETTE",e.SECTION_PALETTE="SECTION_PALETTE",e.INIT_PALETTE="INIT_PALETTE",e.BACKING_PALETTE="BACKING_PALETTE"}(N||(N={})),function(e){e[e.Root=0]="Root",e[e.Symbol=1]="Symbol",e[e.Sustain=2]="Sustain"}(S||(S={})),function(e){e.LEFT="LEFT",e.RIGHT="RIGHT"}(v||(v={})),function(e){e.LEN16="LEN16",e.LEN8="LEN8",e.LEN4="LEN4",e.LEN2="LEN2",e.LEN1="LEN1"}(p||(p={})),function(e){e.SCALE="SCALE",e.DIRECT="DIRECT"}(m||(m={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.BACKING=1]="BACKING",e[e.PREVIEW=2]="PREVIEW"}(L||(L={})),function(e){e.Init="init",e.Section="section",e.Chord="chord",e.Modulation="modulation",e.Fixed="fixed"}(I||(I={}));var _={scoreTabIndex:0,noteData:{scoreName:"",chordMode:m.SCALE,dataList:[]},noteState:{focusIndex:-1,criteriaIndex:-1,editMode:L.NORMAL,selectedList:[],floatwndState:N.NONE,chordPaletteState:{isAddition:!1,selectedLine:S.Root,rootIndex:0,isFlat:!1,symbolKey:T[0].key,sustain:4},backingPaletteState:{useChannels:[],isUsePedal:!1,sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,layers:[]},backingThreads:[]},reffers:{},sampler:new C.a({E2:"https://dl.dropbox.com/s/0aghs80w9aggubw/KEPSREC040.mp3?dl=0",E3:"https://dl.dropbox.com/s/wxtf0u0ly03hu44/KEPSREC052.mp3?dl=0","A#3":"https://dl.dropbox.com/s/hbm9d1vo5tlxymk/KEPSREC058.mp3?dl=0",E4:"https://dl.dropbox.com/s/3qy88udfkzmzr13/KEPSREC064.mp3?dl=0",E5:"https://dl.dropbox.com/s/tdjp24r9pfoi2ff/KEPSREC076.mp3?dl=0",E6:"https://dl.dropbox.com/s/onp7h2vn2d6nhs7/KEPSREC088.mp3?dl=0"}).toDestination(),soundUseList:new Array(88)};var g,k=a(1);!function(e){e.SELECT_SCORETAB="SELECT_SCORETAB",e.ADD_SECTION="ADD_SECTION",e.SET_DEGREE_INDEX="SET_DEGREE_INDEX",e.SET_SYMBOL_KEY="SET_SYMBOL_KEY",e.DETAIL_PARAMS_SETTER="DETAIL_PARAMS_SETTER",e.GET_ELEMENT_REFFER="GET_ELEMENT_REFFER",e.INIT_DEFAULT_ELEMENTS="INIT_DEFAULT_ELEMENTS",e.SELECT_NOTE_ELEMENT="SELECT_NOTE_ELEMENT",e.GET_REFFER="GET_REFFER",e.GET_REFFER_CONTEXT="GET_REFFER_CONTEXT",e.GET_REFFER_CHORD_PALETTE="GET_REFFER_CHORD_PALETTE",e.GET_REFFER_SECTION_PALETTE="GET_REFFER_SECTION_PALETTE",e.GET_REFFER_BACKING_PALETTE="GET_REFFER_BACKING_PALETTE",e.FLOATWND_STATE="FLOATWND_STATE",e.CHORD_PALETTE_SETTER="CHORD_PALETTE_SETTER",e.SET_NOTE_DATA="SET_NOTE_DATA",e.SET_DATA_LIST="SET_DATA_LIST",e.SET_NOTE_STATE="SET_NOTE_STATE",e.INIT_BACKING_PALETTE="INIT_BACKING_PALETTE",e.SET_USE_CHANNELS="SET_USE_CHANNELS",e.BACKING_TOGGLE_MATRIX="BACKING_TOGGLE_MATRIX"}(g||(g={}));var y=function(e,t){var a=t.type,n=t.payload;switch(a){case g.SELECT_SCORETAB:return Object(k.a)(Object(k.a)({},e),{},{scoreTabIndex:n.index});case g.ADD_SECTION:var s=e.noteData.dataList.slice(),c={label:"Section"};return s.splice(n.index+1,0,{type:I.Section,detail:c}),Object(k.a)(Object(k.a)({},e),{},{noteData:Object(k.a)(Object(k.a)({},e.noteData),{},{dataList:s})});case g.SET_DEGREE_INDEX:return e.noteData.dataList[n.pos].detail.degreeIndex=n.degreeIndex,Object(k.a)(Object(k.a)({},e),{},{noteData:Object(k.a)(Object(k.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case g.SET_SYMBOL_KEY:return e.noteData.dataList[n.pos].detail.symbolKey=n.symbolKey,Object(k.a)(Object(k.a)({},e),{},{noteData:Object(k.a)(Object(k.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case g.INIT_DEFAULT_ELEMENTS:return Object(k.a)(Object(k.a)({},e),{},{noteData:Object(k.a)(Object(k.a)({},e.noteData),{},{dataList:[{type:I.Init,detail:{tempo:80,rythm:"4/4",key:0,scale:"major"}},{type:I.Fixed,detail:{label:"START"}},{type:I.Section,detail:{label:"Section"}},{type:I.Fixed,detail:{label:"END"}}]})});case g.SELECT_NOTE_ELEMENT:return Object(k.a)(Object(k.a)({},e),{},{noteState:Object(k.a)(Object(k.a)({},e.noteState),{},{focusIndex:n.index})});case g.GET_REFFER_CONTEXT:return Object(k.a)(Object(k.a)({},e),{},{reffers:Object(k.a)(Object(k.a)({},e.reffers),{},{contextMneu:n.reffer})});case g.GET_REFFER_CHORD_PALETTE:return Object(k.a)(Object(k.a)({},e),{},{reffers:Object(k.a)(Object(k.a)({},e.reffers),{},{chordPalette:n.reffer})});case g.GET_REFFER_SECTION_PALETTE:return Object(k.a)(Object(k.a)({},e),{},{reffers:Object(k.a)(Object(k.a)({},e.reffers),{},{sectionPalette:n.reffer})});case g.GET_REFFER_BACKING_PALETTE:return Object(k.a)(Object(k.a)({},e),{},{reffers:Object(k.a)(Object(k.a)({},e.reffers),{},{backingPalette:n.reffer})});case g.FLOATWND_STATE:return Object(k.a)(Object(k.a)({},e),{},{noteState:Object(k.a)(Object(k.a)({},e.noteState),{},{floatwndState:n.state})});case g.CHORD_PALETTE_SETTER:return Object(k.a)(Object(k.a)({},e),{},{noteState:Object(k.a)(Object(k.a)({},e.noteState),{},{chordPaletteState:n.params})});case g.DETAIL_PARAMS_SETTER:var i=e.noteData.dataList.slice();return i[n.pos].detail=n.params,Object(k.a)(Object(k.a)({},e),{},{noteData:Object(k.a)(Object(k.a)({},e.noteData),{},{dataList:i})});case g.GET_REFFER:return Object(k.a)(Object(k.a)({},e),{},{reffers:n.reffers});case g.SET_NOTE_DATA:return Object(k.a)(Object(k.a)({},e),{},{noteData:n.data});case g.SET_DATA_LIST:return Object(k.a)(Object(k.a)({},e),{},{noteData:Object(k.a)(Object(k.a)({},e.noteData),{},{dataList:n.dataList})});case g.SET_NOTE_STATE:return Object(k.a)(Object(k.a)({},e),{},{noteState:n.noteState});case g.GET_ELEMENT_REFFER:return e.noteData.dataList[n.pos].reffer=n.reffer,Object(k.a)(Object(k.a)({},e),{},{noteData:Object(k.a)(Object(k.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case g.INIT_BACKING_PALETTE:return Object(k.a)(Object(k.a)({},e),{},{noteState:Object(k.a)(Object(k.a)({},e.noteState),{},{backingPaletteState:n.backingPaletteState})});case g.SET_USE_CHANNELS:for(var r=e.noteState.backingPaletteState,l=r.layers,d=n.useChannels,o=new Array(2),b=0;b<2;b++){for(var u=r.useChannels.length,E=l[b].lens.length,j=l[b].table,O=new Array(u),h=0;h<u;h++)if(h<j.length)O[h]=j[h];else{O[h]=new Array(E);for(var x=0;x<E;x++)O[h][x]=new Array(1),O[h][x][0]=!1}o[b]=Object(k.a)(Object(k.a)({},l[b]),{},{table:O})}return Object(k.a)(Object(k.a)({},e),{},{noteState:Object(k.a)(Object(k.a)({},e.noteState),{},{backingPaletteState:Object(k.a)(Object(k.a)({},e.noteState.backingPaletteState),{},{useChannels:d,layers:o})})});case g.BACKING_TOGGLE_MATRIX:var f=n.sideIndex,T=n.lenIndex,N=n.channelIndex,S=n.divIndex,v=e.noteState.backingPaletteState.layers;return v[f].table[N][T][S]=n.isUse,Object(k.a)(Object(k.a)({},e),{},{noteState:Object(k.a)(Object(k.a)({},e.noteState),{},{backingPaletteState:Object(k.a)(Object(k.a)({},e.noteState.backingPaletteState),{},{layers:v})})})}},D=function(e){var t=Object(s.useContext)(re),a=t.state,n=(t.dispatch,t.dispatcher),c=a.noteData.chordMode;switch(e.noteElement.type){case I.Fixed:var i=e.noteElement.detail;return Object(d.jsx)("span",{children:i.label});case I.Init:var r=e.noteElement.detail,l=[];return l.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Tempo: "}),Object(d.jsx)("span",{children:r.tempo})]},l.length)),l.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Rythm: "}),Object(d.jsx)("span",{children:r.rythm})]},l.length)),c==m.SCALE&&a.noteData.chordMode==m.SCALE&&(l.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Key: "}),Object(d.jsx)("span",{children:"C"})]},l.length)),l.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Scale: "}),Object(d.jsx)("span",{children:r.scale})]},l.length))),Object(d.jsx)("div",{children:l});case I.Chord:for(var o=e.noteElement.detail,b=function(e){var t="blank";-1!=e&&(t=(o.isFlat?E:j)[e]);return t}(o.degreeIndex),u=function(e){var t="-";-1!=e&&(t=(o.isFlat?O:h)[e]);return t}(o.degreeIndex),f=function(e,t){var a="";return-1!=e&&T.forEach((function(e){e.key==t&&(a=e.name)})),a}(o.degreeIndex,o.symbolKey),N=x.includes(b+f),S=[],v=0;v<o.sustain;v++)S.push(Object(d.jsx)("span",{},v));var p=e.progress.barCount,L=e.progress.remaindBeat,A=Math.round(e.progress.headMSec/1e3*10)/10,C=n.backing.getNotesCount(o.backing);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"degree"+(-1==o.degreeIndex?" blank":"")+(N?" diatonic":"")+(a.noteData.chordMode==m.DIRECT?" visible":""),children:Object(d.jsxs)("span",{children:[b,f]})}),Object(d.jsx)("div",{className:a.noteData.chordMode==m.DIRECT?"degree":"chord",children:Object(d.jsxs)("span",{children:[u,f]})}),Object(d.jsx)("div",{className:"sustain",children:S}),Object(d.jsxs)("div",{className:"progress-sustain",children:[Object(d.jsx)("span",{className:"bar",children:-1!=p?p:""}),Object(d.jsx)("span",{className:"beat",children:-1!=L?L:""})]}),Object(d.jsx)("div",{className:"progress-time",children:Object(d.jsxs)("span",{children:[A,"s"]})}),Object(d.jsx)("div",{className:"backing-script"+(0==C?" hidden":""),children:Object(d.jsxs)("span",{children:["notes: ",C]})})]});case I.Section:var _=e.noteElement.detail;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"name",children:Object(d.jsx)("span",{children:_.label})}),Object(d.jsx)("div",{className:"border"})]});case I.Modulation:e.noteElement.detail;return Object(d.jsx)(d.Fragment,{})}},R=(a(42),function(e){var t=Object(s.useContext)(re),a=t.state,n=t.dispatch,c=t.dispatcher,i=e.noteElement.type,r=a.noteState.editMode,l=Object(s.useRef)({});Object(s.useEffect)((function(){n(g.GET_ELEMENT_REFFER,{pos:e.index,reffer:l.current})}),[a.noteData.dataList]);var o=a.noteState.focusIndex,b=o==e.index,u=a.noteState.criteriaIndex==e.index,E=function(){a.noteData.dataList[e.index].type!=I.Fixed&&n(g.SELECT_NOTE_ELEMENT,{index:e.index})},j=Object(d.jsx)(d.Fragment,{});return e.index==a.noteData.dataList.length-2&&(j=Object(d.jsx)("div",{className:"addition"+(r==L.NORMAL?"":" disable"),onClick:function(){n(g.SELECT_NOTE_ELEMENT,{index:e.index}),c.score.addChordElement(),n(g.SELECT_NOTE_ELEMENT,{index:e.index+1}),n(g.FLOATWND_STATE,{state:N.CHORD_PALETTE}),n(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},a.noteState.chordPaletteState),{},{isAddition:!0,rootIndex:0,isFlat:!1,symbolKey:T[0].key,sustain:4})})},children:Object(d.jsx)("span",{children:"+"})})),Object(d.jsxs)("div",{className:"box",children:[Object(d.jsxs)("div",{className:"info-base",children:[Object(d.jsx)("div",{className:"header",children:function(){var t=[];return[I.Chord,I.Section,I.Modulation].includes(i)&&(I.Chord==i&&t.push(Object(d.jsx)("div",{className:"chord-no",children:Object(d.jsx)("span",{children:e.progress.no})},t.length)),t.push(Object(d.jsx)("div",{className:"del"+(r==L.NORMAL?"":" hidden"),onClick:function(){c.score.deleteElement(e.index)},children:Object(d.jsx)("span",{children:"\xd7"})},t.length))),Object(d.jsx)(d.Fragment,{children:t})}()}),Object(d.jsx)("div",{className:["note-element",function(){switch(i){case I.Fixed:return"detail-fixed";case I.Init:return"detail-init";case I.Chord:return"detail-chord";case I.Section:return"detail-section";case I.Modulation:return"detail-modulation"}}(),b?"active":"",u?"criteria":"",[I.Init,I.Section,I.Chord].includes(i)?"selectable":"",function(){var t=a.noteData.dataList,n=[t.length],s=-1,c=-1;return t.forEach((function(e,t){e.type==I.Section&&s++,n[t]=s,o==t&&(c=s)})),n[e.index]==c&&i!=I.Fixed}()?"current":"",r!=L.BACKING?"":i==I.Chord&&-1!=e.noteElement.detail.degreeIndex?a.noteState.selectedList.includes(e.index)?"copy-selected":"copy-tgt":"copy-no-tgt"].join(" "),onClick:function(){r==L.NORMAL?(E(),n(g.FLOATWND_STATE,{state:N.NONE})):function(){var t=a.noteState.selectedList;t.includes(e.index)?t.some((function(a,n){a==e.index&&t.splice(n,1)})):t.push(e.index),c.score.setSelectedList(t)}()},onContextMenu:function(t){r==L.NORMAL&&(E(),a.noteData.dataList[e.index].type!=I.Fixed&&(a.reffers.contextMneu.style.left=t.clientX+"px",a.reffers.contextMneu.style.top=t.clientY+"px",n(g.FLOATWND_STATE,{state:N.CONTEXT_MENU})))},ref:l,children:Object(d.jsx)(D,{noteElement:e.noteElement,progress:e.progress})})]}),j]})}),M=function(e){var t=Object(s.useContext)(re),a=t.state;t.dispatch;return Object(d.jsx)("div",{className:function(){var t=a.noteData.dataList,n=a.noteState.focusIndex,s=-1,c=-1;return t.forEach((function(e,t){e.type==I.Section&&s++,n==t&&(c=s)})),c==e.index}()?"active":"",children:Object(d.jsx)("span",{children:e.label})})},P=(a(43),function(e){return Object(d.jsxs)("div",{className:e.disable?"disable":"",onClick:function(){e.executer()},children:[Object(d.jsx)("span",{className:e.menuType,children:e.label}),Object(d.jsx)("span",{className:"key",children:"<".concat(e.keyName," key>")})]})}),F=function(){var e=Object(s.useContext)(re),t=e.state,a=e.dispatch,n=e.dispatcher,c=function(){return a(g.FLOATWND_STATE,{state:N.NONE})},i=Object(s.useRef)({});Object(s.useEffect)((function(){a(g.GET_REFFER_CONTEXT,{reffer:i.current})}),[]);var r=[];if(t.noteState.floatwndState==N.CONTEXT_MENU){var l=t.noteData.dataList[t.noteState.focusIndex];switch(r.push({menuType:"order",label:"INSERT BLANK",keyName:"A",disable:!1,executer:function(){n.score.addChordElement(),c()}}),r.push({menuType:"call",label:"INSERT CHORD",keyName:"W",disable:!1,executer:function(){n.score.addChordElement(),a(g.SELECT_NOTE_ELEMENT,{index:t.noteState.focusIndex+1}),a(g.FLOATWND_STATE,{state:N.CHORD_PALETTE});var e=l.detail;a(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},t.noteState.chordPaletteState),{},{isAddition:!0,rootIndex:e.degreeIndex,isFlat:e.isFlat,symbolKey:e.symbolKey,sustain:e.sustain})})}}),r.push({menuType:"order",label:"INSERT SECTION",keyName:"S",disable:!1,executer:function(){n.score.addSectionElement(),c()}}),r.push({menuType:"order",label:"INSERT MODULATION",keyName:"M",disable:!1,executer:function(){}}),l.type){case I.Chord:var o=l.detail;r.push({menuType:"order",label:"BLANK CHORD",keyName:"D",disable:-1==o.degreeIndex,executer:function(){a(g.SET_DEGREE_INDEX,{pos:t.noteState.focusIndex,degreeIndex:-1}),c()}}),r.push({menuType:"call",label:"EDIT CHORD",keyName:"C",disable:!1,executer:function(){a(g.FLOATWND_STATE,{state:N.CHORD_PALETTE}),a(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},t.noteState.chordPaletteState),{},{rootIndex:o.degreeIndex,isFlat:o.isFlat,symbolKey:o.symbolKey,sustain:o.sustain})})}}),r.push({menuType:"call",label:"EDIT BACKING",keyName:"B",disable:!1,executer:function(){n.score.callBackingEditor()}});break;case I.Section:r.push({menuType:"call",label:"EDIT SECTION",keyName:"C",disable:!1,executer:function(){}})}r.push({menuType:"order",label:"REMOVE",keyName:"DEL",disable:!0,executer:function(){}})}var b=[];return r.forEach((function(e,t){b.push(Object(d.jsx)(P,{menuType:e.menuType,label:e.label,keyName:e.keyName,disable:e.disable,executer:e.executer},t))})),Object(d.jsx)("div",{ref:i,id:"note-contextmenu",className:"floatwnd"+(t.noteState.floatwndState==N.CONTEXT_MENU?" active":""),onClick:function(){},children:b})},B=(a(44),function(){var e=Object(s.useContext)(re),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)({});Object(s.useEffect)((function(){a(g.GET_REFFER_CHORD_PALETTE,{reffer:c.current})}),[]);var i=[],r=[],l=[],o=Object(d.jsx)(d.Fragment,{}),b=t.noteData.chordMode==m.DIRECT,x=t.noteState.chordPaletteState;if(t.noteState.floatwndState==N.CHORD_PALETTE){var f=t.noteState.focusIndex;t.noteData.dataList[f].detail;j.forEach((function(e,n){var s=(0+n)%12,c=E[n],r=h[s],l=O[s],o=[1,3,6,8,10].includes(n),b=x.rootIndex==n,u=function(a){return t.noteData.chordMode==m.SCALE?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{className:"degree",children:a?c:e}),Object(d.jsx)("span",{children:"\xa0("}),Object(d.jsx)("span",{className:"chord",children:a?l:r}),Object(d.jsx)("span",{children:")"})]}):Object(d.jsx)(d.Fragment,{children:Object(d.jsx)("span",{className:"degree",children:a?l:r})})};i.push(Object(d.jsx)("div",{children:o?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"half"+(b&&!x.isFlat?" active":""),onClick:function(){a(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},x),{},{selectedLine:S.Root,rootIndex:n,isFlat:!1})})},children:u(!1)}),Object(d.jsx)("div",{className:"half"+(b&&x.isFlat?" active":""),onClick:function(){a(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},x),{},{selectedLine:S.Root,rootIndex:n,isFlat:!0})})},children:u(!0)})]}):Object(d.jsx)("div",{className:b?"active":"",onClick:function(){a(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},x),{},{selectedLine:S.Root,rootIndex:n,isFlat:!1})})},children:u(!1)})},n))})),T.forEach((function(e,t){r.push(Object(d.jsx)("div",{className:e.key==x.symbolKey?"active":"",onClick:function(){a(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},x),{},{selectedLine:S.Symbol,symbolKey:e.key})})},children:Object(d.jsxs)("span",{children:["[",e.name,"]"]})},t))}));for(var v=function(e){l.push(Object(d.jsx)("div",{className:x.sustain>=e+1?"active":"",onClick:function(){a(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},x),{},{selectedLine:S.Sustain,sustain:e+1})})}},e))},p=0;p<8;p++)v(p);o=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(g.FLOATWND_STATE,{state:N.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){n.chord.setCurChordParam()},children:Object(d.jsx)("span",{children:"Enter"})})]})}return Object(d.jsxs)("div",{ref:c,id:"total-palette",className:"floatwnd"+(t.noteState.floatwndState==N.CHORD_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsx)(u,{groupName:"selector-tabs",tabElements:[{name:"Scale",disable:b,cont:Object(d.jsx)(d.Fragment,{})},{name:"Separate",disable:!1,cont:Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"chord-selector"+(x.selectedLine==S.Root?" active":""),children:i}),Object(d.jsx)("div",{className:"symbol-selector"+(x.selectedLine==S.Symbol?" active":""),children:r})]})},{name:"Fragment",disable:!1,cont:Object(d.jsx)(d.Fragment,{})}],activeNo:1}),Object(d.jsx)("div",{className:"beat-selector"+(x.selectedLine==S.Sustain?" active":""),children:l}),Object(d.jsx)("div",{className:"operation",children:o})]})});function G(e){var t=null;return T.forEach((function(a){a.key==e&&(t=a)})),t}a(45);var K=function(){var e=Object(s.useContext)(re),t=e.state,a=(e.dispatch,t.noteState.focusIndex);if(-1==a)return Object(d.jsx)(d.Fragment,{});var n=t.noteData.dataList[a],c=Object(d.jsx)(d.Fragment,{});switch(n.type){case I.Chord:var i=n.detail,r="-";if(-1!=i.degreeIndex){var l=j[i.degreeIndex],o=h[i.degreeIndex];r="".concat(l," (").concat(o,")")}var b,u="-";if(null!=i.symbolKey)u="[".concat(null===(b=G(i.symbolKey))||void 0===b?void 0:b.name,"]");var E=[];E.push({title:"Tempo",value:"80",disable:!1}),E.push({title:"Rythm",value:"4/4",disable:!1}),E.push({title:"Key",value:"C",disable:!1}),E.push({title:"Scale",value:"major",disable:!1}),E.push({title:"Root",value:r,disable:"-"==r}),E.push({title:"Symbol",value:u,disable:"-"==u}),E.push({title:"Sustain",value:i.sustain+"",disable:!1});var O=[];E.forEach((function(e,t){O.push(Object(d.jsxs)("div",{className:"record"+(e.disable?" disable":""),children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsxs)("span",{children:[e.title,":"]})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:e.value})})]},t))}));var x=[];if(null!=i.symbolKey)for(var f=G(i.symbolKey),T=null===f||void 0===f?void 0:f.intervals,N=null===T||void 0===T?void 0:T.length,S=0;S<7;S++)if(S<N){var v=null===f||void 0===f?void 0:f.intervals[S],p=null===f||void 0===f?void 0:f.struct[S],m=h[(i.degreeIndex+v)%12];x.push(Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"interval",children:Object(d.jsx)("span",{children:v})}),Object(d.jsx)("div",{className:"struct",children:Object(d.jsx)("span",{children:p})}),Object(d.jsx)("div",{className:"sound",children:Object(d.jsx)("span",{children:m})})]},S))}else x.push(Object(d.jsxs)("div",{className:"record disable",children:[Object(d.jsx)("div",{className:"interval"}),Object(d.jsx)("div",{className:"struct"}),Object(d.jsx)("div",{className:"sound"})]},S));c=Object(d.jsx)("div",{className:"chord",children:Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Current State"})}),Object(d.jsx)("div",{className:"current-state",children:O}),Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Chord Struct"})}),Object(d.jsx)("div",{className:"symbol-struct",children:x})]})});break;case I.Section:c=Object(d.jsx)("div",{className:"section"})}return Object(d.jsx)("div",{id:"current-detail",children:c})},H=(a(46),function(e){var t=e.dispatcher,a=e.paletteState,n=a.sideIndex,s=a.layers[n],c=a.selectedLenIndex,i=s.lens[c],r=s.vels[c],l=function(e){var s=a.layers;s[n].lens[c]=e,t.initBackingPalette(Object(k.a)(Object(k.a)({},a),{},{layers:s}))},o=function(e){i.len=e,i.isHalf=!1,i.isDiv3=!1,l(i)},b=function(e){var s=a.layers,i=s[n].vels[c];s[n].vels[c]=i+e,t.initBackingPalette(Object(k.a)(Object(k.a)({},a),{},{layers:s}))},u=i.len,E=[{label:"16",isActive:u==p.LEN16,isDisable:!1,callback:function(){o(p.LEN16)}},{label:"8",isActive:u==p.LEN8,isDisable:!1,callback:function(){o(p.LEN8)}},{label:"4",isActive:u==p.LEN4,isDisable:!1,callback:function(){o(p.LEN4)}},{label:"2",isActive:u==p.LEN2,isDisable:!1,callback:function(){o(p.LEN2)}},{label:"1",isActive:u==p.LEN1,isDisable:!1,callback:function(){o(p.LEN1)}},{label:".",isActive:i.isHalf,isDisable:!t.backing.isAcceptHalf(),callback:function(){i.isHalf=!i.isHalf,i.isDiv3=!1,l(i)}},{label:"/ 3",isActive:i.isDiv3,isDisable:!t.backing.isAcceptDiv3(),callback:function(){i.isDiv3=!i.isDiv3,i.isHalf=!1,l(i)}},{label:"Add",isActive:!1,isDisable:!1,callback:function(){t.backing.addLen()}},{label:"Del",isActive:!1,isDisable:s.lens.length<=1,callback:function(){t.backing.delLen()}},{label:"vel-",isActive:!1,isDisable:r<=1,callback:function(){b(-1)}},{label:"vel+",isActive:!1,isDisable:r>=10,callback:function(){b(1)}},{label:"all clear",isActive:!1,isDisable:!1,callback:function(){var e={useChannels:[],isUsePedal:!1,sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,layers:[{lens:[{len:p.LEN1,isDiv3:!1,isHalf:!1}],side:v.LEFT,table:[],vels:[5]},{lens:[{len:p.LEN1,isDiv3:!1,isHalf:!1}],side:v.RIGHT,table:[],vels:[5]}]};t.initBackingPalette(e)}}],j=[];return E.forEach((function(e,t){j.push(Object(d.jsx)("button",{className:(e.isActive?"active":"")+(e.isDisable?" disable":""),onClick:function(){return e.callback()},children:Object(d.jsx)("span",{children:e.label})},t))})),Object(d.jsx)(d.Fragment,{children:j})}),w=function(e,t,a,n,s){var c=e[0==t?0:1],i=e[1==t?0:1],r="";if(c.table[a][n][s]){r="active";var l=W(c.lens,n);i.lens.forEach((function(e,t){var n=U(l,W(i.lens,t)),s=U(W(i.lens,t),l);i.table[a][t][0]&&(n||s)&&(r="overlap")}))}return r},U=function(e,t){return e.head+e.width>t.head&&e.head+e.width<=t.head+t.width||e.head<t.head+t.width&&e.head>=t.head},W=function(e,t){for(var a=0,n=0;n<t;n++){var s=e[n];a+=X(s)}return{head:a,width:X(e[t])}},X=function(e){var t=0;switch(e.len){case p.LEN1:t=16;break;case p.LEN2:t=8;break;case p.LEN4:t=4;break;case p.LEN8:t=2;break;case p.LEN16:t=1}return e.isHalf&&(t*=1.5),t},J=function(e){for(var t=e.paletteState,a=e.channelList,n=e.dispatcher,s=[],c=function(e){for(var c=[],i=t.layers[e],r=t.sideIndex==e,l=function(a){var s=[];i.lens.forEach((function(c,i){var r="";switch(c.len){case p.LEN4:r+="len4","4";break;case p.LEN8:r+="len8","8";break;case p.LEN16:r+="len16","16";break;case p.LEN2:r+="len2","2";break;case p.LEN1:r+="len1","1"}c.isHalf&&(r+=" half");for(var l=[],o=c.isDiv3?3:1,b=function(s){l.push(Object(d.jsx)("div",{className:w(t.layers,e,a,i,s)+(c.isDiv3?" div3":""),onClick:function(){n.backing.toggleMatrix(a,i,s)}},s))},u=0;u<o;u++)b(u);s.push(Object(d.jsx)("div",{className:r,children:l},i))})),c.push(Object(d.jsx)("div",{className:"line",children:s},a))},o=a.length-1;o>=0;o--)l(o);s.push(Object(d.jsx)("div",{className:r?"cur":"back",children:c},e))},i=0;i<2;i++)c(i);return Object(d.jsx)("div",{className:"matrix",children:s})},V=function(e){var t=e.layer,a=[],n=1;t.lens.forEach((function(e,t){var a=0;switch(e.len){case p.LEN1:a=16;break;case p.LEN2:a=8;break;case p.LEN4:a=4;break;case p.LEN8:a=2;break;case p.LEN16:a=1}e.isHalf&&(a*=1.5),n+=a}));for(var s=function(e){var t=e==n-1;a.push(Object(d.jsx)("div",{className:(e%2==0?e%4==0?"mem4":"mem8":"mem16")+(t?" last":"")},e))},c=0;c<n;c++)s(c);return Object(d.jsx)("div",{className:"measure",children:a})},Y=function(e){var t=e.paletteState,a=t.sideIndex,n=t.layers[a],s=e.dispatcher,c=e.channelList,i=e.testPlaySound,r=[];c.forEach((function(e,t){r.push(Object(d.jsx)("div",{className:"channel",onClick:function(){return i(e.soundFullName)},children:Object(d.jsx)("span",{children:e.soundFullName})},t))}));var l=[],o=[];return n.lens.forEach((function(e,a){var c=t.selectedLenIndex==a?"active ":"",i="";switch(e.len){case p.LEN4:c+="len4",i="4";break;case p.LEN8:c+="len8",i="8";break;case p.LEN16:c+="len16",i="16";break;case p.LEN2:c+="len2",i="2";break;case p.LEN1:c+="len1",i="1"}e.isHalf&&(i+=" .",c+=" half"),e.isDiv3&&(i+=" /"),l.push(Object(d.jsx)("div",{className:c,onClick:function(){s.initBackingPalette(Object(k.a)(Object(k.a)({},t),{},{selectedLenIndex:a}))},children:Object(d.jsx)("span",{children:i})},a));var r=n.vels[a];o.push(Object(d.jsx)("div",{className:c,children:Object(d.jsx)("div",{style:{height:10*r+"%"}})},a))})),Object(d.jsxs)("div",{className:"backing-table",children:[Object(d.jsx)("div",{className:"switch",children:Object(d.jsx)(H,{dispatcher:s,paletteState:t})}),Object(d.jsxs)("div",{className:"fixed",children:[Object(d.jsxs)("div",{className:"layer",children:[Object(d.jsx)("button",{className:1==t.sideIndex?"active":"",onClick:function(){s.backing.setLayerIndex(1)},children:Object(d.jsx)("span",{children:"Right"})}),Object(d.jsx)("button",{className:0==t.sideIndex?"active":"",onClick:function(){s.backing.setLayerIndex(0)},children:Object(d.jsx)("span",{children:"Left"})})]}),Object(d.jsx)("div",{className:"matrix",children:r}),Object(d.jsx)("div",{className:"pedal",children:Object(d.jsx)("button",{className:t.isUsePedal?"active":"",onClick:function(){s.backing.setUsePedal(!t.isUsePedal)},children:Object(d.jsx)("span",{children:"Pedal"})})})]}),Object(d.jsxs)("div",{className:"main",children:[Object(d.jsx)("div",{className:"split",children:l}),Object(d.jsx)(V,{layer:n}),Object(d.jsx)(J,{paletteState:t,channelList:c,dispatcher:s}),Object(d.jsx)("div",{className:"volume",children:o})]})]})},z=function(e){for(var t=[],a=function(a){var n=a<e.symbol.intervals.length,s=[];if(n){var c=e.structs[a],i=e.symbol.intervals[a],r=e.symbol.struct[a];s.push(Object(d.jsx)("div",{className:"label",children:Object(d.jsxs)("span",{children:[r,"[",i,"]: ",c]})},0));for(var l=function(t){var n=e.degreeIndex+e.symbol.intervals[a]+12*t,c=Math.floor(n/12),i=e.structs[a]+c,r=n<9||n>=97,l=!1;e.paletteState.useChannels.forEach((function(e){e.octave==t&&e.structIndex==a&&(l=!0)}));var o=e.paletteState.useChannels.length>=12&&!l;s.push(Object(d.jsx)("div",{className:"col"+(r||o?" disable":"")+(l?" active":""),onClick:function(){var n=e.paletteState.useChannels;if(l){var s=-1;n.forEach((function(e,n){e.octave==t&&e.structIndex==a&&(s=n)})),n.splice(s,1)}else n.push({octave:t,structIndex:a});n.sort((function(e,t){return 8*e.octave+e.structIndex-(8*t.octave+t.structIndex)})),e.paletteState.useChannels=n,e.setUseChannels(e.paletteState.useChannels)},onContextMenu:function(){e.testPlaySound(i)},children:Object(d.jsx)("span",{children:r?"-":i})},t+1))},o=0;o<8;o++)l(o)}else{s.push(Object(d.jsx)("div",{className:"label"},0));for(var b=0;b<7;b++)s.push(Object(d.jsx)("div",{className:"col"},b+1))}t.push(Object(d.jsx)("div",{className:"record"+(n?"":" disable"),children:s},a))},n=0;n<7;n++)a(n);return Object(d.jsx)("div",{className:"struct-table",children:t})},q=function(e,t,a,n){for(var s=[],c=function(c){for(var i=function(i){var r=t+a.intervals[c]+12*i,l=!1;e.forEach((function(e){e.octave==i&&e.structIndex==c&&(l=!0)}));var d=Math.floor(r/12),o=n[c]+d;l&&s.push({soundIndex:r,soundFullName:o})},r=0;r<8;r++)i(r)},i=0;i<a.intervals.length;i++)c(i);return s.sort((function(e,t){return t.soundIndex-e.soundIndex})),s},Q=function(){var e=Object(s.useContext)(re),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)({});if(Object(s.useEffect)((function(){a(g.GET_REFFER_BACKING_PALETTE,{reffer:c.current})}),[]),t.noteState.floatwndState!=N.BACKING_PALETTE)return Object(d.jsx)(d.Fragment,{});var i=t.noteState.backingPaletteState,r=i.sideIndex,l=(i.layers[r],i.selectedLenIndex,t.noteData.dataList[t.noteState.focusIndex].detail),o=G(l.symbolKey),b=h[l.degreeIndex]+o.name,u=[];o.intervals.forEach((function(e){u.push(h[(l.degreeIndex+e)%12])}));var E=q(i.useChannels,l.degreeIndex,o,u),j=function(e){t.sampler.triggerAttack(e,"+0",.15),setTimeout((function(){t.sampler.triggerRelease(e)}),1e3)},O=d.Fragment;return O=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(g.FLOATWND_STATE,{state:N.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){n.backing.play(!1)},children:Object(d.jsx)("span",{children:"Play"})}),Object(d.jsx)("div",{onClick:function(){n.backing.setCurBackingScript()},children:Object(d.jsx)("span",{children:"Update"})})]}),Object(d.jsxs)("div",{ref:c,id:"backing-palette",className:"floatwnd"+(t.noteState.floatwndState==N.BACKING_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsxs)("div",{className:"base-info",children:[Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Chord:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:b})})]}),Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Struct:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:u.join(", ")})})]}),Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Sustain:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:l.sustain})})]})]}),Object(d.jsx)(z,{paletteState:i,structs:u,symbol:o,degreeIndex:l.degreeIndex,testPlaySound:j,setUseChannels:function(e){return n.setUseChannels(e)}}),Object(d.jsx)(Y,{channelList:E,paletteState:i,dispatcher:n,testPlaySound:j}),Object(d.jsx)("div",{className:"operation",children:O})]})},Z=a(16),$=function(){var e=Object(s.useContext)(re),t=e.state,a=(e.dispatch,t.noteState.editMode);return Object(d.jsxs)("div",{className:"mode",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:"MODE:"})}),Object(d.jsxs)("div",{className:"border",children:[Object(d.jsx)("button",{className:a==L.NORMAL?"active":"",children:Object(d.jsx)("span",{children:"NORMAL"})}),Object(d.jsx)("button",{className:a==L.BACKING?"active":"",children:Object(d.jsx)("span",{children:"CLONE"})}),Object(d.jsx)("button",{className:a==L.PREVIEW?"active":"",children:Object(d.jsx)("span",{children:"PREVIEW"})})]})]})},ee=function(){var e=Object(s.useContext)(re),t=e.state,a=e.dispatch,n=t.noteData.dataList,c=t.noteState.editMode,i=0,r=[],l=[],o=1,b=0,u=0,E=-1;n.forEach((function(e,t){var a=Math.floor(b/4)+1,n={};if(n.no=o,n.barCount=E!=a?a:-1,n.remaindBeat=b%4>0?b%4:-1,n.headMSec=u,r.push(Object(d.jsx)(R,{index:t,noteElement:e,progress:n},t)),e.type==I.Chord){E=a;var s=e.detail;b+=s.sustain;u+=750*s.sustain,o++}e.type==I.Section&&(l.push(Object(d.jsx)(M,{index:i,label:e.detail.label},t)),i++)}));var j=!(t.noteState.floatwndState==N.NONE||t.noteState.floatwndState==N.CONTEXT_MENU);return Object(d.jsxs)("div",{id:"scorecont-notetab-root",children:[Object(d.jsxs)("div",{className:"left-cont",children:[Object(d.jsxs)("div",{id:"score-note",children:[Object(d.jsxs)("div",{id:"operation-header",className:c==L.BACKING?"mode-selector":"",children:[Object(d.jsx)("button",{className:"disable",children:Object(d.jsx)("span",{children:"BACK"})}),Object(d.jsx)("button",{className:"disable",children:Object(d.jsx)("span",{children:"SAVE"})}),Object(d.jsx)("button",{className:"disable",children:Object(d.jsx)("span",{children:"RELOAD"})}),Object(d.jsx)("button",{className:"disable",children:Object(d.jsx)("span",{children:"OPTION"})}),Object(d.jsx)($,{})]}),Object(d.jsx)("div",{id:"section-list",className:c==L.BACKING?"mode-selector":"",children:l}),Object(d.jsx)("div",{id:"score-list-root",className:c==L.BACKING?"mode-selector":"",children:r}),Object(d.jsx)("div",{id:"modal-blind",className:j?"active":"",onClick:function(){a(g.FLOATWND_STATE,{state:N.NONE})}}),Object(d.jsx)(F,{}),Object(d.jsx)(B,{}),Object(d.jsx)(Q,{})]}),Object(d.jsx)("div",{id:"score-footer"})]}),Object(d.jsx)("div",{className:"right-cont",children:Object(d.jsx)(K,{})})]})},te=(Z.a.div({display:"inline-block",margin:"2px 15px 0 15px",color:"rgba(255, 0, 0, 0.5)",fontSize:"12px",fontWeight:600}),a(49),function(){var e=Object(s.useContext)(re),t=e.state,a=e.dispatch,n=e.dispatcher;return Object(d.jsxs)("div",{id:"scorecont-listtab-root",children:[Object(d.jsxs)("div",{className:"left-cont",children:[Object(d.jsx)("button",{onClick:function(){n.setNoteData(Object(k.a)(Object(k.a)({},t.noteData),{},{chordMode:m.SCALE})),a(g.INIT_DEFAULT_ELEMENTS,null),a(g.SELECT_NOTE_ELEMENT,{index:2}),a(g.SELECT_SCORETAB,{index:1})},children:Object(d.jsx)("span",{children:"SCALE"})}),Object(d.jsx)("button",{onClick:function(){n.setNoteData(Object(k.a)(Object(k.a)({},t.noteData),{},{chordMode:m.DIRECT})),a(g.INIT_DEFAULT_ELEMENTS,null),a(g.SELECT_NOTE_ELEMENT,{index:2}),a(g.SELECT_SCORETAB,{index:1})},children:Object(d.jsx)("span",{children:"DIRECT"})})]}),Object(d.jsx)("div",{className:"right-cont"})]})}),ae=(a(50),function(){var e=Object(s.useContext)(re);e.state,e.dispatch,e.dispatcher;return Object(d.jsx)(d.Fragment,{})}),ne=function(){var e=Object(s.useContext)(re),t=e.state,a=e.dispatch;return Object(d.jsx)("div",{id:"scoretab-root",children:Object(d.jsx)(u,{groupName:"score-tabs",tabElements:[{name:"LIBLARY",disable:!1,cont:Object(d.jsx)(te,{})},{name:"Note",disable:!1,cont:Object(d.jsx)(ee,{})},{name:"Source",disable:!1,cont:Object(d.jsx)("div",{})},{name:"Backing",disable:!0,cont:Object(d.jsx)(ae,{})},{name:"Sheet Music",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Preview",disable:!0,cont:Object(d.jsx)("div",{})}],activeNo:t.scoreTabIndex,selectTabIndex:function(e){return a(g.SELECT_SCORETAB,{index:e})}})})},se=a(6),ce=a(0),ie=function e(t,a){var n=this;Object(ce.a)(this,e),this.dispatchBase=void 0,this.dispatch=void 0,this.state=void 0,this.setNoteData=function(e){n.dispatchBase({type:g.SET_NOTE_DATA,payload:{data:e}})},this.initBackingPalette=function(e){n.dispatchBase({type:g.INIT_BACKING_PALETTE,payload:{backingPaletteState:e}})},this.setUseChannels=function(e){n.dispatchBase({type:g.SET_USE_CHANNELS,payload:{useChannels:e}})},this.score={apllyFlash:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].reffer;t.style.backgroundColor="#ff0",setTimeout((function(){t.style.backgroundColor=""}),350)},setNoteState:function(e){n.dispatch(g.SET_NOTE_STATE,{noteState:e})},setCriteria:function(){var e=n.state.noteState.focusIndex;n.score.setNoteState(Object(k.a)(Object(k.a)({},n.state.noteState),{},{criteriaIndex:e,editMode:L.BACKING}))},releaseCriteria:function(){n.score.setNoteState(Object(k.a)(Object(k.a)({},n.state.noteState),{},{criteriaIndex:-1,editMode:L.NORMAL,selectedList:[]}))},setNoteData:function(e){n.dispatch(g.SET_NOTE_DATA,{data:e})},getInitElement:function(){return n.state.noteData.dataList[0].detail},setEditMode:function(e){n.score.setNoteState(Object(k.a)(Object(k.a)({},n.state.noteState),{},{editMode:e}))},addSectionElement:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList.slice(),a={label:"Section"};t.splice(e+1,0,{type:I.Section,detail:a}),n.dispatch(g.SET_DATA_LIST,{dataList:t})},addChordElement:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList.slice();t.splice(e+1,0,{type:I.Chord,detail:{degreeIndex:-1,isFlat:!1,symbolKey:null,sustain:4,backing:{useChannels:[],layers:[{lens:[{len:p.LEN1,isDiv3:!1,isHalf:!1}],side:v.LEFT,table:[],vels:[5]},{lens:[{len:p.LEN1,isDiv3:!1,isHalf:!1}],side:v.RIGHT,table:[],vels:[5]}]}}}),n.dispatch(g.SET_DATA_LIST,{dataList:t})},deleteElement:function(e){var t=n.state.noteState.focusIndex;if(n.state.noteData.dataList[e].type==I.Chord){var a=n.state.noteData.dataList.slice();a.splice(e,1),n.dispatch(g.SET_DATA_LIST,{dataList:a}),e<=t&&(n.state.noteState.focusIndex--,n.dispatch(g.SET_NOTE_STATE,{noteState:n.state.noteState}))}},deleteCurElement:function(){var e=n.state.noteState.focusIndex;n.score.deleteElement(e)},focusPreviousElement:function(){var e=n.state.noteState.focusIndex;return n.state.noteData.dataList[e-1].type!=I.Fixed&&(n.state.noteState.focusIndex--,n.dispatch(g.SET_NOTE_STATE,{noteState:n.state.noteState}),!0)},focusNextElement:function(){var e=n.state.noteState.focusIndex;return n.state.noteData.dataList[e+1].type!=I.Fixed&&(n.state.noteState.focusIndex++,n.dispatch(g.SET_NOTE_STATE,{noteState:n.state.noteState}),!0)},focusPreviousSection:function(){var e=n.state.noteData.dataList,t=n.state.noteState.focusIndex;do{if(e[--t].type==I.Section){n.state.noteState.focusIndex=t,n.dispatch(g.SET_NOTE_STATE,{noteState:n.state.noteState});break}}while(t>0)},focusNextSection:function(){var e=n.state.noteData.dataList,t=n.state.noteState.focusIndex;do{if(e[++t].type==I.Section||t==e.length-2){n.state.noteState.focusIndex=t,n.dispatch(g.SET_NOTE_STATE,{noteState:n.state.noteState});break}}while(t<e.length-1)},focusInitElement:function(){n.state.noteState.focusIndex=0,n.dispatch(g.SET_NOTE_STATE,{noteState:n.state.noteState})},setSelectedList:function(e){n.dispatch(g.SET_NOTE_STATE,{noteState:Object(k.a)(Object(k.a)({},n.state.noteState),{},{selectedList:e})})},callChordSelector:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail;n.dispatch(g.FLOATWND_STATE,{state:N.CHORD_PALETTE}),n.dispatch(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},n.state.noteState.chordPaletteState),{},{rootIndex:t.degreeIndex,isFlat:t.isFlat,symbolKey:t.symbolKey,sustain:t.sustain})})},callBackingEditor:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail;n.dispatch(g.FLOATWND_STATE,{state:N.BACKING_PALETTE});var a=t.backing,s={useChannels:a.useChannels,isUsePedal:a.isUsePedal,sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,layers:a.layers};n.initBackingPalette(s)}},this.chord={setCurChordParam:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=n.state.noteState.chordPaletteState;n.dispatch(g.DETAIL_PARAMS_SETTER,{pos:e,params:Object(k.a)(Object(k.a)({},t),{},{degreeIndex:a.rootIndex,isFlat:a.isFlat,symbolKey:a.symbolKey,sustain:a.sustain})}),n.dispatch(g.FLOATWND_STATE,{state:N.NONE});var s=n.state.noteData.dataList[e].reffer;s.style.backgroundColor="#ff0",setTimeout((function(){s.style.backgroundColor=""}),350)}},this.backing={toggleMatrix:function(e,t,a){var s=n.state.noteState.backingPaletteState.sideIndex,c=!n.state.noteState.backingPaletteState.layers[s].table[e][t][a];n.dispatch(g.BACKING_TOGGLE_MATRIX,{sideIndex:s,channelIndex:e,lenIndex:t,divIndex:a,isUse:c})},addLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers,a=e.sideIndex,s=t[a],c=e.selectedLenIndex,i=s.table;s.lens=Object(se.a)(s.lens),s.lens.splice(c+1,0,{len:p.LEN4,isHalf:!1,isDiv3:!1}),i.forEach((function(e){e.splice(c+1,0,[!1])})),s.vels.splice(e.selectedLenIndex+1,0,5),t[a]=s,n.dispatchBase({type:g.INIT_BACKING_PALETTE,payload:{backingPaletteState:e}})},delLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers,a=e.sideIndex,s=t[a],c=e.selectedLenIndex,i=s.table;s.lens=Object(se.a)(s.lens),s.lens.splice(c,1),i.forEach((function(e){e.splice(c,1)})),s.vels.splice(c,1),t[a]=s,c>0&&e.selectedLenIndex--,n.dispatch(g.INIT_BACKING_PALETTE,{backingPaletteState:e})},updateLenIndex:function(e){var t=n.state.noteState.backingPaletteState;t.selectedLenIndex=e,n.initBackingPalette(t)},getCurLenIndex:function(){return n.state.noteState.backingPaletteState.selectedLenIndex},isFirstCurLen:function(){return 0==n.state.noteState.backingPaletteState.selectedLenIndex},isLastCurLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers[e.sideIndex];return e.selectedLenIndex==t.lens.length-1},getSideScript:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex]},getCurLenBean:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex].lens[e.selectedLenIndex]},setCurrentLenBean:function(e){var t=n.state.noteState.backingPaletteState,a=t.layers;a[t.sideIndex].lens[t.selectedLenIndex]=e,n.initBackingPalette(Object(k.a)(Object(k.a)({},t),{},{layers:a}))},setCurLen:function(e){var t=n.backing.getCurLenBean();t.len=e,t.isHalf=!1,t.isDiv3=!1,n.backing.setCurrentLenBean(t)},updateCurVolume:function(e){var t=n.state.noteState.backingPaletteState,a=t.layers;a[t.sideIndex].vels[t.selectedLenIndex]=e,n.initBackingPalette(Object(k.a)(Object(k.a)({},t),{},{layers:a}))},getCurVelocity:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex].vels[e.selectedLenIndex]},isAcceptHalf:function(){return[p.LEN2,p.LEN4,p.LEN8].includes(n.backing.getCurLenBean().len)},isAcceptDiv3:function(){return[p.LEN4,p.LEN8].includes(n.backing.getCurLenBean().len)},setLayerIndex:function(e){var t=n.state.noteState.backingPaletteState;t.sideIndex=e,t.selectedLenIndex=0,n.initBackingPalette(t)},setUsePedal:function(e){var t=n.state.noteState.backingPaletteState;t.isUsePedal=e,n.initBackingPalette(t)},changeLayerIndex:function(){var e=n.state.noteState.backingPaletteState;e.sideIndex=0==e.sideIndex?1:0,e.selectedLenIndex=0,n.initBackingPalette(e)},setUseChannels:function(e){for(var t=n.state.noteState.backingPaletteState,a=t.layers,s=new Array(2),c=0;c<2;c++){for(var i=t.useChannels.length,r=a[c].lens.length,l=a[c].table,d=new Array(i),o=0;o<i;o++)if(o<l.length)d[o]=l[o];else{d[o]=new Array(r);for(var b=0;b<r;b++)d[o][b]=new Array(1),d[o][b][0]=!1}s[c]=Object(k.a)(Object(k.a)({},a[c]),{},{table:d})}},setCurBackingScript:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=n.state.noteState.backingPaletteState,s={};s.useChannels=a.useChannels,s.layers=a.layers,s.isUsePedal=a.isUsePedal,n.dispatch(g.DETAIL_PARAMS_SETTER,{pos:e,params:Object(k.a)(Object(k.a)({},t),{},{backing:s})}),n.dispatch(g.FLOATWND_STATE,{state:N.NONE}),n.score.apllyFlash()},getNotesCount:function(e){var t=0;return e.layers.forEach((function(e){e.table.forEach((function(e){e.forEach((function(e){e[0]&&t++}))}))})),t},play:function(e){for(var t=n.state.noteState.backingThreads,a=Array(88),s=0;s<88;s++)a[s]=0;!function e(s){var c=n.state.noteState.focusIndex,i=n.state.noteData.dataList[c].detail,r=G(i.symbolKey),l=null===r||void 0===r?void 0:r.intervals,d=n.state.noteState.backingPaletteState,o=s?i.backing:{layers:d.layers,useChannels:d.useChannels,isUsePedal:d.isUsePedal},b=n.state.sampler,u=750*i.sustain;t.push(setTimeout((function(){var t=!0;s&&(n.score.focusNextElement()&&(t=!1,e(!0)));t&&n.score.setNoteState(Object(k.a)(Object(k.a)({},n.state.noteState),{},{editMode:L.NORMAL}))}),u));for(var E=function(e){var n=0,s=o.layers[e];s.lens.forEach((function(e,c){var r=3e3/Number(e.len.toString().replace("LEN",""));e.isHalf&&(r*=1.5),o.useChannels.forEach((function(e,d){s.table[d][c].forEach((function(d,E){if(d){var j=i.degreeIndex+l[e.structIndex]+12*e.octave,O=Math.floor(j/12),x=h[j%12]+O,f=.7*s.vels[c]/10,T=n+r/3*E,N=o.isUsePedal?u+93.75:T+r;t.push(setTimeout((function(){b.triggerAttack(x,"+0",f),a[j]++}),T)),t.push(setTimeout((function(){a[j]--,0==a[j]&&b.triggerRelease(x)}),N))}}))})),n+=r}))},j=0;j<2;j++)E(j);n.score.setNoteState(Object(k.a)(Object(k.a)({},n.state.noteState),{},{editMode:L.PREVIEW,backingThreads:t}))}(e)}},this.dispatchBase=a,this.state=t,this.dispatch=function(e,t){return a({type:e,payload:t})}},re=Object(s.createContext)({}),le=function(){var e=Object(s.useReducer)(y,_),t=Object(l.a)(e,2),a=t[0],n=t[1],c=function(e,t){return n({type:e,payload:t})},i=new ie(a,n),r={state:a,dispatch:c,dispatcher:i};return Object(d.jsx)("div",{id:"main-frame",tabIndex:999,onKeyDown:function(e){return function(e,t,a,n){var s=t.noteState.focusIndex,c=t.noteState.editMode,i=t.noteData.chordMode,r=t.noteData.dataList[s];switch(r.type){case I.Chord:var l=r.detail;switch(t.noteState.floatwndState){case N.NONE:if(c==L.NORMAL)switch(e.key){case"c":n.score.callChordSelector();break;case"b":n.score.callBackingEditor();break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":if(i==m.DIRECT)break;var d=A[Number(e.key)-1];a(g.SET_DEGREE_INDEX,{pos:s,degreeIndex:d.degreeIndex}),a(g.SET_SYMBOL_KEY,{pos:s,symbolKey:d.symbolKey});break;case"x":n.score.setCriteria();break;case"z":alert(JSON.stringify(l));break;case" ":n.backing.play(!0)}else switch(e.key){case"x":n.score.releaseCriteria();break;case"Enter":var o=t.noteData.dataList,b=o[t.noteState.criteriaIndex].detail.backing;t.noteState.selectedList.forEach((function(e){o[e].detail.backing=JSON.parse(JSON.stringify(b))})),n.score.setNoteData(Object(k.a)(Object(k.a)({},t.noteData),{},{dataList:o})),n.score.releaseCriteria()}break;case N.CHORD_PALETTE:switch(e.key){case"Escape":case"c":a(g.FLOATWND_STATE,{state:N.NONE});break;case"ArrowRight":a(g.SET_DEGREE_INDEX,{pos:s,degreeIndex:l.degreeIndex+1});break;case"ArrowLeft":case"1":a(g.SET_DEGREE_INDEX,{pos:s,degreeIndex:l.degreeIndex-1});break;case"Enter":n.chord.setCurChordParam()}break;case N.BACKING_PALETTE:switch(e.key){case"Escape":case"b":a(g.FLOATWND_STATE,{state:N.NONE});break;case"ArrowLeft":if(!n.backing.isFirstCurLen()){var u=n.backing.getCurLenIndex();n.backing.updateLenIndex(u-1)}break;case"ArrowRight":if(!n.backing.isLastCurLen()){var E=n.backing.getCurLenIndex();n.backing.updateLenIndex(E+1)}break;case"ArrowUp":var j=n.backing.getCurVelocity();j<10&&n.backing.updateCurVolume(j+1);break;case"ArrowDown":var O=n.backing.getCurVelocity();O>1&&n.backing.updateCurVolume(O-1);break;case"r":n.backing.changeLayerIndex();break;case"1":n.backing.setCurLen(p.LEN16);break;case"2":n.backing.setCurLen(p.LEN8);break;case"3":n.backing.setCurLen(p.LEN4);break;case"4":n.backing.setCurLen(p.LEN2);break;case"5":n.backing.setCurLen(p.LEN1);break;case".":if(n.backing.isAcceptHalf()){var h=n.backing.getCurLenBean();h.isHalf=!h.isHalf,h.isDiv3=!1,n.backing.setCurrentLenBean(h)}break;case"/":if(n.backing.isAcceptDiv3()){var x=n.backing.getCurLenBean();x.isDiv3=!x.isDiv3,x.isHalf=!1,n.backing.setCurrentLenBean(x)}break;case"a":n.backing.addLen();break;case"Delete":n.backing.getSideScript().lens.length>1&&n.backing.delLen();break;case" ":n.backing.play(!1);break;case"Enter":n.backing.setCurBackingScript()}}}if(t.noteState.floatwndState==N.NONE&&[I.Chord,I.Section].includes(r.type))if(c==L.NORMAL)switch(e.key){case"ArrowLeft":n.score.focusPreviousElement();break;case"ArrowRight":n.score.focusNextElement();break;case"ArrowUp":n.score.focusPreviousSection();break;case"ArrowDown":n.score.focusNextSection();break;case"Delete":n.score.deleteCurElement();break;case"i":n.score.focusInitElement();break;case"a":n.score.addChordElement();break;case"s":n.score.addSectionElement();break;case"w":var f=r.detail;a(g.FLOATWND_STATE,{state:N.CHORD_PALETTE}),a(g.CHORD_PALETTE_SETTER,{params:Object(k.a)(Object(k.a)({},t.noteState.chordPaletteState),{},{rootIndex:f.degreeIndex,isFlat:f.isFlat,symbolKey:f.symbolKey,sustain:f.sustain})})}else if(c==L.PREVIEW)switch(e.key){case" ":t.noteState.backingThreads.forEach((function(e){clearInterval(e)})),n.score.setNoteState(Object(k.a)(Object(k.a)({},t.noteState),{},{backingThreads:[],editMode:L.NORMAL})),t.sampler.releaseAll()}}(e,a,c,i)},children:Object(d.jsx)(re.Provider,{value:r,children:Object(d.jsx)(u,{groupName:"system-tabs",tabElements:[{name:"Account",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Palette",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Score",disable:!1,cont:Object(d.jsx)(ne,{})},{name:"Backing",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Symbol",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Sampler",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Setting",disable:!0,cont:Object(d.jsx)("div",{})}],activeNo:2})})})};var de=function(){return Object(s.useEffect)((function(){document.oncontextmenu=function(){return!1},window.addEventListener("keydown",(function(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}),!1)}),[]),Object(d.jsx)(le,{})},oe=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,52)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,c=t.getLCP,i=t.getTTFB;a(e),n(e),s(e),c(e),i(e)}))};r.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(de,{})}),document.getElementById("root")),oe()}},[[51,1,2]]]);
//# sourceMappingURL=main.7679aa9d.chunk.js.map