{"version":3,"sources":["contents/common/define.tsx","contents/common/TabbedPane.tsx","contents/common/utils.tsx","contents/redux/store.tsx","contents/redux/reducer.tsx","contents/systab/score/contTabs/note/element/detail/ScoreElementDetail.tsx","contents/systab/score/contTabs/note/element/ScoreElement.tsx","contents/systab/score/contTabs/note/OutlineSection.tsx","contents/systab/score/contTabs/note/floatwnd/context/NoteContextMenu.tsx","contents/systab/score/contTabs/note/floatwnd/chord/ChordSelector.tsx","contents/systab/score/contTabs/note/sideDetail/CurrentBlockDetailBar.tsx","contents/systab/score/contTabs/note/floatwnd/backing/BackingOperation.tsx","contents/systab/score/contTabs/note/floatwnd/backing/NotesMatrix.tsx","contents/systab/score/contTabs/note/floatwnd/backing/SplitMeasure.tsx","contents/systab/score/contTabs/note/floatwnd/backing/BackingTable.tsx","contents/common/Styles.tsx","contents/systab/score/contTabs/note/floatwnd/backing/StructMatrix.tsx","contents/systab/score/contTabs/note/floatwnd/backing/BackingEditor.tsx","contents/systab/score/contTabs/note/footer/timing/FooterTiming.tsx","contents/systab/score/contTabs/note/footer/ensemble/FooterEnsemble.tsx","contents/systab/score/contTabs/note/footer/NoteFooter.tsx","contents/systab/score/contTabs/note/floatwnd/init/InitEditor.tsx","contents/systab/score/contTabs/note/floatwnd/section/SectionEditor.tsx","contents/systab/score/contTabs/note/floatwnd/setting/SettingEditor.tsx","contents/systab/score/contTabs/note/floatwnd/change/ChangeEditor.tsx","contents/systab/score/contTabs/note/floatwnd/thema/ThemaLoader.tsx","contents/systab/dialog/SourceDialog.tsx","contents/systab/dialog/ConfirmDialog.tsx","contents/systab/score/contTabs/note/ScoreContNoteTab.tsx","contents/systab/score/contTabs/library/ScoreContLibraryTab.tsx","contents/systab/score/contTabs/thema/tabs/ThemaTabCommonUtil.tsx","contents/systab/score/contTabs/thema/tabs/ThemaTabRoot.tsx","contents/systab/score/contTabs/thema/tabs/ThemaTabSustain.tsx","contents/systab/score/contTabs/thema/tabs/ThemaTabVoicing.tsx","contents/systab/score/contTabs/thema/tabs/ThemaTabCondition.tsx","contents/systab/score/contTabs/thema/tabs/ThemaTabCategory.tsx","contents/systab/score/contTabs/thema/tabs/ThemaTabPattern.tsx","contents/systab/score/contTabs/thema/ScoreContThemaTab.tsx","contents/systab/score/contTabs/tune/SoundFontNames.tsx","contents/systab/score/contTabs/tune/ScoreContTuneTab.tsx","contents/systab/score/contTabs/preview/ScoreContPreviewTab.tsx","contents/systab/score/ScoreTab.tsx","contents/keyboad/KeyboardShortCutAction.tsx","contents/keyboad/KeyboadNoteTabOperation.tsx","contents/keyboad/KeyboadTuneTabOperation.tsx","contents/redux/dispatcher.tsx","contents/login/LoginFrame.tsx","contents/user/UserPlate.tsx","contents/systab/sampler/SamplerTab.tsx","contents/viewer/Viewer.tsx","contents/MainFrame.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["TimeSignatures","KeyScale","TabLabel","props","classValues","push","isActive","isDisable","className","join","onClick","selectTab","name","TabContents","cont","TabbedPane","useState","activeNo","setActiveNo","useEffect","id","groupName","tabElements","map","tab","index","disable","undefined","selectTabIndex","BEAT_WIDTH","DEGREE12_FLAT_LIST","DEGREE12_SHARP_LIST","KEY12_FLAT_LIST","KEY12_SHARP_LIST","KEY12_MAJOR_SCALE_LIST","KEY12_MINOR_SCALE_LIST","SCALE_LIST","RYTHM_LIST","SymbolKey","SymbolType","DIATONIC_MAJOR_SCALE_DEGREE_NAMES","DIATONIC_NATURAL_MINOR_SCALE_DEGREE_NAMES","SYMBOL_PARAMS_LIST","key","MAJOR","category","TRIAD","MINOR","SUS4","DIM","AUG","MAJ7","TETRAD7TH","SEVENTH","MIN7","MINOR_MAJ7","ADD9","ADD9TH","MINOR_ADD9","SIXTH_9TH","MINOR_MINUS5","MIN7_MINUS5","DIATONIC_MAJOR_SCALE_LIST","degreeIndex","symbolKey","isFlat","DIATONIC_MINOR_SCALE_LIST","getSymbolTypeName","symbolType","TETRAD6TH","SEVENTH_9TH","getSymbolParams","symbol","forEach","data","FloatWndState","ChordPaletteLine","BACKING_SIDE","BACKING_LEN_TYPE","CHORD_MODE","EditMode","ChangeType","ModulateRelation","TempoRelation","TypeNoteElement","getAdjustSusValue","value","ret","toString","getChordRoot","rootInfo","keyIndex","rootIndex","getSymbolName","sendQueryRequestToAPI","queryType","sql","fetch","API_DOMAIN","mode","method","headers","Accept","body","JSON","stringify","createQueryRequestInit","applyOnChord","molRootIndex","denRootIndex","denInterval","fixedIntervals","fixedStruct","isAdded","intervals","cur","i","length","struct","ActionType","initialState","login","isLogin","dialog","left","top","contents","scoreTabIndex","noteData","scoreName","chordMode","SCALE","soundFont","gain","dataList","columnList","noteState","cuScoreId","focusIndex","cacheList","criteriaIndex","editMode","NORMAL","selectedList","defaultSustain","floatwndState","NONE","chordPaletteState","isAddition","selectedLine","Root","molecule","denominator","sustain","headAdjust","tailAdjust","backingPaletteState","backingThreads","ensembleInfo","fileURL","audio","Audio","startPosition","volume","isLoad","cloneRange","cloneDataList","tuneState","usingLen","columnIndex","isDiv3","isEdit","isAutoScroll","isPreview","totalColumnWidth","tableRef","intervalRef","measureRef","BlocksRef","themaDataTree","themaName","sustains","themaState","focusRef","themaCacheList","form","root","src","beat","pattern","def","condition","tgtSymbols","minRootIndex","maxRootIndex","voicing","isCreate","reffers","sampler","Sampler","toDestination","instrument","soundUseList","Array","dinamicCache","formDispatcher","reducer","state","action","type","payload","SET_LOGIN","SET_DIALOG","SELECT_SCORETAB","ADD_SECTION","slice","detail","splice","Section","SET_DEGREE_INDEX","pos","SET_SYMBOL_KEY","INIT_DEFAULT_ELEMENTS","Init","tempo","rythm","scale","Fixed","label","labelName","SELECT_NOTE_ELEMENT","GET_REFFER_CONTEXT","contextMneu","reffer","GET_REFFER_CHORD_PALETTE","chordPalette","GET_REFFER_SECTION_PALETTE","sectionPalette","GET_REFFER_BACKING_PALETTE","backingPalette","FLOATWND_STATE","CHORD_PALETTE_SETTER","params","DETAIL_PARAMS_SETTER","GET_REFFER","SET_NOTE_DATA","SET_DATA_LIST","SET_NOTE_STATE","SET_TUNE_STATE","SET_THEMA_STATE","SET_THEMA_DATA","SET_SAMPLER","SET_INSTRUMENT","GET_ELEMENT_REFFER","INIT_BACKING_PALETTE","SET_USE_CHANNELS","editorState","useChannels","BACKING_TOGGLE_MATRIX","sideIndex","lenIndex","channelIndex","divIndex","script","layers","table","isUse","DINAMIC_CACHE","SET_FORM_DISPATCHER","getDegreeRoot","ScoreElementDetail","useContext","GlobalContext","dispatcher","cache","noteElement","paramLabels","Chord","degreeMolRoot","degreeDenRoot","chordMolRoot","init","chordDenRoot","symbolName","isDiatonic","degreeName","chordName","includes","sustainJsx","barCount","progress","remaindBeat","headMSec","Math","round","notesCount","backing","getNotesCount","DIRECT","Change","prevCache","changeInnerJsx","changeType","MODULATE","relation","modulateRelation","isValuable","DOMINANT","KEY","oldKeyIndex","oldIsMinor","newKeyIndex","newIsMinor","domminantValue","keyAdjust","RELATIVE","PARALLEL","oldKeyName","newKeyName","TEMPO","tempoRelation","oldTempo","newTempo","DIFF","tempoDiff","RATE","tempoRate","ABSOLUTE","tempoAbsolute","BEAT","ScoreElement","dispatch","isAccept","ref","useRef","current","isSelected","isCriteria","normalElementClickAction","additionBtn","score","addChordElement","CHORD_PALETTE","retJsxList","no","isMajor","rootKey","deleteElement","getHeaderElement","getStyleFromType","posList","secNo","curSecNo","el","isCurrentSection","TRANSPLANT","CLONE","isReverse","start","end","getCloneRangeStyle","some","setSelectedList","selectorElementClickAction","setCloneRange","onContextMenu","e","setDinamicCache","INIT_PALETTE","style","clientX","clientY","CONTEXT_MENU","OutlineSection","isCurrent","MenuRecord","executer","menuType","keyName","NoteContextMenu","close","menuPropsList","curElement","addSectionElement","addChangeElement","setNoteData","callChordSelector","callBackingEditor","callThemaAccessor","setCriteria","setCloneCriteria","callSectionEditor","callChangeEditor","deleteCurElement","menuList","ChordSelector","canvasRef","PREVIEW","canvas","width","height","updatePianoView","ctx","getContext","list","denIndex","fillStyle","fillRect","WIDTH","posX","keyboadList","color","isBlack","HEIGHT","keyboad","strokeRect","save","chordList","symbolList","beatList","operationJsx","isDirect","degS","degF","chdS","chdF","isHalf","isDenominator","buildLabelSrc","Symbol","Sustain","chord","setCurChordParam","getAdjustOprJsx","offset","cls","callback","scaleMatrixRowJsxList","getScaleMatrixRowJsx","titleLabel","chordInfoList","boxJsxList","info","degreeList","souondList","degreeRoot","soundRoot","BLANK","Adjuster","CurrentBlockDetailBar","curData","innerJsx","chordRoot","baseBlockJsx","buildInfoBlock","chordBlockJsx","String","structList","len","interval","sound","sectionBlockJsx","changeInfo","changeBlockJsx","dataRecordList","jsxList","BackingOperation","paletteState","curSideScript","selectedLenIndex","curLenBean","lens","curVolume","vels","setCurrentLenBean","lenBean","initBackingPalette","setCurrentLen","lenType","updateCurrentVolume","sub","nowVol","curLen","buttons","LEN16","LEN8","LEN4","LEN2","LEN1","isAcceptHalf","isAcceptDiv3","addLen","delLen","buttonList","button","channelRowSize","onChange","newValue","parseInt","target","diff","layer","record","j","abs","setPaletteState","val","isDisabled","getActiveState","curLayerIndex","lineIndex","back","curCellRange","getCellRange","backLenBean","k","backRange","isOverlapJudge","range1","range2","head","getLenSize","size","NotesMatrix","channelList","matrixLayersJsx","l","linesJsx","isCurLayer","cellList","classes","divList","divCnt","activeState","toggleMatrix","SplitMeasure","curLayer","sustainLength","measureInner","measureLength","cnt","isLimit","limitLeft","limitJsx","BackingTable","testPlaySound","channelJsxList","blankAdjust","curIndex","isExist","soundFullName","volumeList","isEditPattern","setLayerIndex","isUsePedal","setUsePedal","styled","div","backgroundColor","padding","margin","textAlign","defaultProps","opacity","_Text","span","fontSize","fontWeight","StructMatrix","isDispVoicing","structTable","sort","a","b","octave","structIndex","overVoicingList","structs","cols","soundName","soundIndex","floor","isNone","channel","isOverVoicing","setUseChannels","BackingContext","createContext","getChannelList","BackingEditor","BACKING_PALETTE","triggerAttack","setTimeout","triggerRelease","operation","isCorrect","preview","stop","play","setCurBackingScript","thema","applyBackingPattern","applyBackingVoicing","Provider","FIXED_BLANK","getAdjustCls","FooterTiming","dataCount","scrollRef","blockJsxList","setBlockJsxList","measureJsxList","setMeasureJsxList","total","setTotal","chordDetail","isCur","isNear","scrollTo","behavior","totalWidth","FooterEnsemble","isPlay","setPlay","setStartPosition","paused","setNoteState","files","objectURL","window","URL","createObjectURL","min","max","Number","onerror","currentTime","pause","NoteFooter","curType","activeTabIndex","setActiveTabIndex","InitEditor","setTempo","setRythm","setKey","setScale","initBean","setInitParam","getItemSelector","optionsJsx","display","item","SectionEditor","setLabelName","SECTION_PALETTE","sectionBean","section","setSectionParam","SettingEditor","SETTING_EDITOR","defsus","sustainJsxList","getItemSelectorJsx","getItemNumberRangeJsx","ChangeEditor","setChangeType","setModulateRelation","setDomminantValue","setKeyAdjust","setTempoRelation","setTempoRate","setTempoDiff","setTempoAbsolute","setBeat","isInputOK","setInputOK","CHANGE_PALETTE","bean","checkInput","itemsJsxList","concat","Object","values","filter","str","change","applyChangeParams","ThemaLoader","patterns","setPatterns","THEMA_ACCESSOR","sus","Soundfont","AudioContext","release","then","setInstruments","schedule","time","note","duration","itemJsxList","_Item","_Wrap","_WrapList","_WrapMatrix","SourceDialog","source","setSource","closeDialog","parse","ConfirmDialog","_MainFrame","_Message","message","_Button","EditModeBorder","ScoreContNoteTab","elementList","setElementList","sectionList","setSectionList","totalBeat","totalMsec","lastBar","bar","isModalBlind","callDialog","curScoreId","console","log","alert","ScoreContLiblaryTab","focus","setFocus","setMessage","recordList","setRecordList","titleList","setTitleList","setEdit","title","setTitle","setChordMode","setLoad","reload","initFocus","response","json","results","catch","error","chord_mode","createButton","createInfoRecored","isDisplayMsg","selectedRecord","result","data_cnt","soundfont","tune","createFixedForm","createTextForm","createSelectForm","optionJSXList","createButtonRecord","buttonJSXList","disabled","ThemaTabRoot","getFocusElement","setThemaState","setThemaeData","addChildSustain","ThemaTabSustain","validate","addChildPattern","ThemaTabVoicing","param","getList","callBackingVoicingEditor","ThemaTabCondition","parent","voicings","addChildVoicing","ThemaTabCategory","v","isNaN","addChildCondition","ThemaTabPattern","getChannel","notes","count","line","cell","getNotes","callBackingPatternEditor","tgtTypes","addChildCategory","ScoreContThemaTab","dataIndexies","treeItemJsxList","setTreeItemJsxList","buildIndex","activeRefList","depth","symbols","indentWidth","ChildCnt","isClose","createTreeItemJsx","FluidR3_GM","ScoreContTuneTab","columnJsxList","setColumnJsxList","setBoxJsxList","curColumn","totalColumnSize","len4","len8","len16","len4div3","len8div3","setColumnList","setState","baseKey","column","useMemo","barJsx","_Bar","_Scale","isHead","_Block","_Size","lineJsxList","scaleIndex","isNotes","_Line","playSoundFont","adjustScrollX","adjustScrollY","getSoundName","_Notes","isScale","_Box","intervalListJSX","num","_Interval","_Num","_SoundName","createSwitch","_LenSwitch","createLenSwitch","createExecuteButton","_ExecuteButton","_Header","_Editor","_Operation","soundFontName","_SoundFont","isEditable","setSoundFont","_Gain","step","getSoundFontSelectorJsx","addColumn","remooveCur","adjustWidth","stopPreview","playPreview","moveAll","_WrapInterval","_WrapTimeLine","_Measure","_BlockLine","_TableWrap","onScroll","scrollLeft","scrollTop","_Table","select","input","_ButtonBase","css","NOTES_HEIGHT","ScoreContPreviewTab","notesTable","setNotesTable","blocks","setBlocks","barPos","setBarPos","setCurIndex","bpm","setBpm","limit","setLimist","curPos","block","tabY","m","posAdjust","widthAdjust","reverse","blockListJsx","_Sus","_ChordName","boxListJsx","box","right","lineListJsx","notesListJsx","taskList","clearTimeout","thr","clearInterval","releaseAll","progressValue","_Current","ScoreTab","isScoreEdit","keyboardShortCutAction","selectedData","selectedCache","diatonicChord","apllyFlashCur","releaseCriteria","baseBacking","apllyFlashList","releaseCloneCriteria","isFirstCurLen","getCurLenIndex","updateLenIndex","isLastCurLen","getCurVelocity","updateCurVolume","changeLayerIndex","setCurLen","getCurLenBean","getSideScript","focusPreviousElement","focusNextElement","focusPreviousSection","focusNextSection","focusInitElement","insertCloneData","keyboadNoteTabOperation","curCache","applyState","applyColumn","newIndex","prevSoundIndex","keyboadTuneTabOperation","Dispatcher","dispatchBase","setLoginParams","arg","setFormDispatcher","setSampler","sample","loadSampler","apllyFlasah","cloneData","getInitElement","setEditMode","addNoteElement","side","LEFT","RIGHT","backingState","selectedChannelIndex","setChannelRowSize","sideScript","velocity","use","setCorrect","baseLayers","channelCount","lensSplitCount","baseTable","y","x","isScore","curTime","Date","getTime","threads","totalTime","pastTime","audioHead","adjust","limitIndex","next","editor","barMs","boxMs","adjustOverlap","headMs","lenValue","replace","curLenMs","tail","lag","playTune","patternDef","patternEl","sustainEl","VoicingDef","themaTree","rootBean","sustainBean","patternBean","categoryBean","conditions","conditionBean","voicingBean","isAdd","totalDiv3","subLen4","subLen8","this","LoginTypeSwitch","loginType","curLoginType","setLoginType","resetError","TextForm","stateSetter","strLen","stateValue","isHanEisu","isMask","match","LoginFrame","userName","setUserName","password","setPassword","passConfirm","setPassConfirm","isError","setError","isLoading","setLoading","enterDisable","UserPlate","SamplerTab","samples","setSamples","url","checked","createRecoredJsxList","samplesList","getSamplesList","Viewer","sclib","Router","useReducer","actionType","query","URLSearchParams","useLocation","search","userAgent","navigator","toLowerCase","tabIndex","onKeyDown","path","exact","get","MainFrame","basename","process","App","document","oncontextmenu","addEventListener","indexOf","keyCode","preventDefault","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"yoBA+BYA,EAaAC,E,iFCqCNC,EAAW,SAACC,GAMd,IAAMC,EAAc,GAIpB,OAHAA,EAAYC,KAAK,YACjBD,EAAYC,KAAKF,EAAMG,SAAW,SAAW,IAC7CF,EAAYC,KAAKF,EAAMI,UAAY,cAAgB,IAE/C,qBAAKC,UAAWJ,EAAYK,KAAK,KAAMC,QAAS,kBAAMP,EAAMQ,aAA5D,SACI,+BAAOR,EAAMS,UAKnBC,EAAc,SAACV,GASjB,OAAO,qBAAKK,UAAW,CACnB,WACCL,EAAMG,SAAsB,GAAX,UACpBG,KAAK,KAHA,SAGON,EAAMW,QAGTC,EAhGI,SAACZ,GAA4B,IAAD,EACXa,mBAASb,EAAMc,UADJ,mBACpCA,EADoC,KAC1BC,EAD0B,KAsC3C,OAJAC,qBAAU,WACND,EAAYf,EAAMc,YACnB,CAACd,EAAMc,WAGN,sBAAKG,GAAIjB,EAAMkB,UAAf,UACI,qBAAKb,UAAU,WAAf,SAGQL,EAAMmB,YAAYC,KAAI,SAACC,EAAKC,GACxB,OAAO,cAAC,EAAD,CACSb,KAAMY,EAAIZ,KAAMN,SAAUmB,GAASR,EAAUV,UAAWiB,EAAIE,QACxEf,UAAW,kBAvCZ,SAACc,QACSE,IAAzBxB,EAAMyB,eACNzB,EAAMyB,eAAeH,GAErBP,EAAYO,GAmCqBG,CAAeH,KAD3BA,QAMrB,qBAAKjB,UAAU,YAAf,SAGQL,EAAMmB,YAAYC,KAAI,SAACC,EAAKC,GACxB,OAAO,cAAC,EAAD,CAAyBX,KAAMU,EAAIV,KAAMR,SAAUmB,GAASR,GAA1CQ,Y,sDDtEpCI,G,MAAa,KAGbC,EAAqB,CAC9B,SAAK,UAAM,SAAK,UAAM,SAAK,SAAK,UAAM,SAAK,UAAM,SAAK,UAAM,UAEnDC,EAAsB,CAC/B,SAAK,UAAM,SAAK,UAAM,SAAK,SAAK,UAAM,SAAK,UAAM,SAAK,UAAM,UAGnDC,EAAkB,CAC3B,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,KAEnDC,EAAmB,CAC5B,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,KAEnDC,EAAyB,CAClC,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,KAEnDC,EAAyB,CAClC,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,MAE9DC,EAAa,CACtB,QAAS,SAEAC,EAAa,CACtB,MAAO,MAAO,MAAO,MAAO,S,SAGpBrC,K,gBAAAA,E,gBAAAA,E,gBAAAA,E,gBAAAA,E,mBAAAA,M,cAaAC,K,UAAAA,E,aAAAA,M,KAKL,IAmBKqC,EAiBAC,EApCCC,EAAoC,CAC7C,SAAK,aACL,UAAM,WACN,UAAM,WACN,SAAK,aACL,SAAK,UACL,UAAM,WACN,cAAU,gBAGDC,EAA4C,CACrD,UAAM,WACN,cAAU,eACV,UAAM,YACN,UAAM,WACN,UAAM,WACN,UAAM,YACN,UAAM,a,SAEEH,O,iBAAAA,I,iBAAAA,I,eAAAA,I,aAAAA,I,aAAAA,I,eAAAA,I,qBAAAA,I,eAAAA,I,2BAAAA,I,eAAAA,I,4BAAAA,I,0BAAAA,I,gCAAAA,I,+BAAAA,M,cAiBAC,O,iBAAAA,I,yBAAAA,I,yBAAAA,I,mBAAAA,I,6BAAAA,I,0BAAAA,M,KAiCL,IAAMG,EAAqC,CAC9C,CAAEC,IAAKL,EAAUM,MAAOC,SAAUN,EAAWO,MAAOlC,KAAM,GAAI,OAAU,CAAC,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,IAChH,CAAE+B,IAAKL,EAAUS,MAAOF,SAAUN,EAAWO,MAAOlC,KAAM,IAAK,OAAU,CAAC,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,IACjH,CAAE+B,IAAKL,EAAUU,KAAMH,SAAUN,EAAWO,MAAOlC,KAAM,OAAQ,OAAU,CAAC,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,IACnH,CAAE+B,IAAKL,EAAUW,IAAKJ,SAAUN,EAAWO,MAAOlC,KAAM,MAAO,OAAU,CAAC,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,IACjH,CAAE+B,IAAKL,EAAUY,IAAKL,SAAUN,EAAWO,MAAOlC,KAAM,MAAO,OAAU,CAAC,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,IACjH,CAAE+B,IAAKL,EAAUa,KAAMN,SAAUN,EAAWa,UAAWxC,KAAM,OAAQ,OAAU,CAAC,KAAM,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,EAAG,KAChI,CAAE+B,IAAKL,EAAUe,QAASR,SAAUN,EAAWa,UAAWxC,KAAM,IAAK,OAAU,CAAC,KAAM,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,EAAG,KAChI,CAAE+B,IAAKL,EAAUgB,KAAMT,SAAUN,EAAWa,UAAWxC,KAAM,KAAM,OAAU,CAAC,KAAM,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,EAAG,KAC9H,CAAE+B,IAAKL,EAAUiB,WAAYV,SAAUN,EAAWa,UAAWxC,KAAM,QAAS,OAAU,CAAC,KAAM,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,EAAG,KACvI,CAAE+B,IAAKL,EAAUkB,KAAMX,SAAUN,EAAWkB,OAAQ7C,KAAM,OAAQ,OAAU,CAAC,KAAM,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,EAAG,IAC7H,CAAE+B,IAAKL,EAAUoB,WAAYb,SAAUN,EAAWkB,OAAQ7C,KAAM,QAAS,OAAU,CAAC,KAAM,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,EAAG,IACpI,CAAE+B,IAAKL,EAAUqB,UAAWd,SAAUN,EAAWoB,UAAW/C,KAAM,OAAQ,OAAU,CAAC,KAAM,KAAM,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,EAAG,EAAG,IAC9I,CAAE+B,IAAKL,EAAUsB,aAAcf,SAAUN,EAAWO,MAAOlC,KAAM,QAAS,OAAU,CAAC,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,IAC5H,CAAE+B,IAAKL,EAAUuB,YAAahB,SAAUN,EAAWa,UAAWxC,KAAM,SAAU,OAAU,CAAC,KAAM,KAAM,KAAM,MAAO,UAAa,CAAC,EAAG,EAAG,EAAG,MAsChIkD,GA7BCvB,EAAWO,MACbR,EAAUM,MACVN,EAAUS,MACVT,EAAUU,KACVV,EAAUW,IACVX,EAAUY,IACVZ,EAAUsB,aAIRrB,EAAWa,UACbd,EAAUa,KACVb,EAAUe,QACVf,EAAUiB,WAIRhB,EAAWkB,OACbnB,EAAUkB,KACVlB,EAAUoB,WAUgC,CAClD,CAAEK,YAAa,EAAGC,UAAW1B,EAAUM,MAAOqB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUS,MAAOkB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUS,MAAOkB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUM,MAAOqB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUM,MAAOqB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUS,MAAOkB,QAAQ,GACtD,CAAEF,YAAa,GAAIC,UAAW1B,EAAUsB,aAAcK,QAAQ,KAGrDC,EAAyC,CAClD,CAAEH,YAAa,EAAGC,UAAW1B,EAAUS,MAAOkB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUsB,aAAcK,QAAQ,GAC7D,CAAEF,YAAa,EAAGC,UAAW1B,EAAUM,MAAOqB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUS,MAAOkB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUS,MAAOkB,QAAQ,GACtD,CAAEF,YAAa,EAAGC,UAAW1B,EAAUM,MAAOqB,QAAQ,GACtD,CAAEF,YAAa,GAAIC,UAAW1B,EAAUM,MAAOqB,QAAQ,I,QEtI9CE,EAAoB,SAACC,GAC9B,OAAQ,WACJ,OAAQA,GACJ,KAAK7B,EAAWO,MAAO,MAAO,QAC9B,KAAKP,EAAWa,UAAW,MAAO,MAClC,KAAKb,EAAW8B,UAAW,MAAO,MAClC,KAAK9B,EAAWkB,OAAQ,MAAO,SAC/B,KAAKlB,EAAWoB,UAAW,MAAO,UAClC,KAAKpB,EAAW+B,YAAa,MAAO,WAPpC,IAkBL,SAASC,EAAgB5B,GAC5B,IAAI6B,EAAS,KAMb,OALA9B,EAAmB+B,SAAQ,SAACC,GACpBA,EAAK/B,KAAOA,IACZ6B,EAASE,MAGVF,EAGJ,ICdKG,EAwBAC,EAmCAC,EAWAC,EAkCAC,EAmIAC,EAuDAC,EAWAC,EAgBAC,EAcAC,ED7TCC,EAAoB,SAACC,GAC9B,IAAIC,EAAM,GAKV,OAJa,GAATD,IACeC,EAAXD,EAAQ,EAAS,IAAMA,EAChBA,EAAME,YAEdD,GAIEE,EAAe,SAACC,EAA4BC,GACrD,IAAI/E,EAAO,KACK,MAAZ8E,IAEA9E,GADa8E,EAASzB,OAASjC,EAAkBC,IACpCyD,EAASE,UAAYD,GAAY,KAElD,OAAO/E,GAIEiF,EAAgB,SAAC7B,GAC1B,IAAIpD,EAAO,GAMX,OALA8B,EAAmB+B,SAAQ,SAACD,GACpBA,EAAO7B,KAAOqB,IACdpD,EAAO4D,EAAO5D,SAGfA,GAeEkF,EAAwB,SAACC,EAAgCC,GAClE,OAAOC,MAAMC,+BAAmBH,EAbE,SAACC,GACnC,MAAO,CACHG,KAAM,OACNC,OAAQ,OACRC,QAAS,CACLC,OAAQ,mBACR,eAAgB,oBAEpBC,KAAMC,KAAKC,UAAU,CAAET,SAMvBU,CAAuBV,KAIlBW,EAAe,SAACnC,EAAsBoC,EAAsBC,GAGrE,IAAIC,EAAcD,EAAeD,EAC7BE,EAAc,IACdA,GAAe,IAEnB,IAAMC,EAA2B,GAC3BC,EAAwB,GAC1BC,GAAU,EACdzC,EAAO0C,UAAUzC,SAAQ,SAAC0C,EAAKC,GACvBA,EAAI5C,EAAO0C,UAAUG,UAGhBJ,GAAWH,EAAcK,IAC1BJ,EAAe1G,KAAKyG,GACpBE,EAAY3G,KAAK,OACjB4G,GAAU,GAEVH,GAAeK,IACfJ,EAAe1G,KAAK8G,GACpBH,EAAY3G,KAAKmE,EAAO8C,OAAOF,SAItCH,IACDF,EAAe1G,KAAKyG,GACpBE,EAAY3G,KAAK,QAErBmE,EAAO0C,UAAYH,EACnBvC,EAAO8C,OAASN,I,SC5FRrC,O,eAAAA,I,+BAAAA,I,iCAAAA,I,qCAAAA,I,mCAAAA,I,+BAAAA,I,qCAAAA,I,mCAAAA,I,oCAAAA,M,cAwBAC,O,eAAAA,I,mBAAAA,I,qBAAAA,I,wBAAAA,M,cAmCAC,K,YAAAA,E,eAAAA,M,cAWAC,K,cAAAA,E,YAAAA,E,YAAAA,E,YAAAA,E,aAAAA,M,cAkCAC,K,cAAAA,E,iBAAAA,M,cAmIAC,O,mBAAAA,I,2BAAAA,I,iBAAAA,I,sBAAAA,M,cAuDAC,K,oBAAAA,E,cAAAA,E,aAAAA,M,cAWAC,K,qBAAAA,E,oBAAAA,E,oBAAAA,E,WAAAA,M,cAgBAC,K,YAAAA,E,YAAAA,E,qBAAAA,M,cAcAC,K,YAAAA,E,kBAAAA,E,cAAAA,E,gBAAAA,E,eAAAA,M,KAwBL,ICjaKmC,GDiaCC,GAAsB,CAC/BC,MAAO,CACHC,SAAS,EACTtG,IAAK,EACLR,KAAM,IAEV+G,OAAQ,CACJC,KAAM,EACNC,IAAK,EACLC,SAAU,MAEdC,cAAe,EACfC,SAAU,CACNC,UAAW,GACXC,UAAWnD,EAAWoD,MACtBC,UAAW,CACPxH,KAAM,GACNyH,KAAM,GAEVC,SAAU,GACVC,WAAY,IAEhBC,UAAW,CACPC,WAAY,EACZC,YAAa,EACbC,UAAW,GACXC,eAAgB,EAChBC,SAAU7D,EAAS8D,OACnBC,aAAc,GACdC,eAAgB,EAChBC,cAAetE,EAAcuE,KAC7BC,kBAAmB,CACfC,YAAY,EACZC,aAAczE,EAAiB0E,KAC/BC,SAAU,CAAE3D,UAAW,EAAG3B,QAAQ,GAClCuF,YAAa,KACbxF,UAAWtB,EAAmB,GAAGC,IACjC8G,QAAS,EACTC,WAAY,EACZC,WAAY,GAEhBC,oBAAqB,KACrBC,eAAgB,GAChBC,aAAc,CACVC,QAAS,GACTC,MAAO,IAAIC,MACXC,cAAe,EACfC,OAAQ,EACRC,QAAQ,GAEZC,WAAY,GACZC,cAAe,IAEnBC,UAAW,CACPC,SAAU,EACVC,YAAa,EACbC,QAAQ,EACRC,QAAQ,EACRC,cAAc,EACdC,WAAW,EACXC,iBAAkB,EAClBnC,UAAW,GACXoC,SAAU,GACVC,YAAa,GACbC,WAAY,GACZC,UAAW,IAEfC,cAAe,CACXC,UAAW,WACXC,SAAU,IAEdC,WAAY,CACR5C,WAAY,EACZ6C,SAAU,KACVC,eAAgB,GAChBC,KAAM,CACFC,KAAM,CACFN,UAAW,GACXO,IAAK,IAETlC,QAAS,CACLmC,KAAM,KACNlC,WAAY,EACZC,WAAY,GAEhBkC,QAAS,CACLjL,KAAM,GACNkL,IAAK,KACLH,IAAK,IAET9I,SAAU,CACNA,SAAUN,EAAWO,OAEzBiJ,UAAW,CACPC,WAAY,GACZC,aAAc,EACdC,aAAc,IAElBC,QAAS,CACLL,IAAK,KACLH,IAAK,KAGbS,UAAU,GAEdC,QAAS,GACTC,QD1eO,IAAIC,IAAQ,CACf,GAAM,+DACN,GAAM,+DACN,MAAO,+DACP,GAAM,+DACN,GAAM,+DACN,GAAM,iEACPC,gBCoeHC,WAAY,KACZC,aAAc,IAAIC,MAAM,IACxBC,aAAc,KACdC,eAAgB,K,SC/gBRtF,O,yBAAAA,I,2BAAAA,I,qCAAAA,I,6BAAAA,I,uCAAAA,I,mCAAAA,I,+CAAAA,I,2CAAAA,I,iDAAAA,I,6CAAAA,I,4BAAAA,I,4CAAAA,I,wDAAAA,I,4DAAAA,I,4DAAAA,I,oCAAAA,I,gDAAAA,I,kCAAAA,I,kCAAAA,I,oCAAAA,I,oCAAAA,I,oCAAAA,I,sCAAAA,I,8BAAAA,I,oCAAAA,I,gDAAAA,I,wCAAAA,I,kDAAAA,I,kCAAAA,I,+CAAAA,Q,KAiCL,I,SAAMuF,GAAU,SAACC,EAAcC,GAClC,IAAMC,EAAmBD,EAAOC,KAC1BC,EAAeF,EAAOE,QAC5B,OAAQD,GACJ,KAAK1F,GAAW4F,UACZ,OAAO,2BAAKJ,GAAZ,IAAmBtF,MAAOyF,EAAQzF,QACtC,KAAKF,GAAW6F,WACZ,OAAO,2BAAKL,GAAZ,IAAmBpF,OAAQuF,EAAQvF,SACvC,KAAKJ,GAAW8F,gBACZ,OAAO,2BAAKN,GAAZ,IAAmBhF,cAAemF,EAAQzL,QAC9C,KAAK8F,GAAW+F,YACZ,IAAMhF,EAAWyE,EAAM/E,SAASM,SAASiF,QACnCC,EAAS,CACfA,UAAmB,WAKnB,OAJAlF,EAASmF,OAAOP,EAAQzL,MAAQ,EAAG,EAAG,CAClCwL,KAAM7H,EAAgBsI,QACtBF,OAAQA,IAEL,2BACAT,GADP,IACc/E,SAAS,2BACZ+E,EAAM/E,UADK,IACKM,SAAUA,MAIzC,KAAKf,GAAWoG,iBACZ,IAAMH,EAAST,EAAM/E,SAASM,SAAS4E,EAAQU,KAAKJ,OAMpD,OALuB,MAAnBA,EAAOjE,SACPiE,EAAOjE,SAAW,CAAE3D,UAAWsH,EAAQnJ,YAAaE,QAAQ,GAE5DuJ,EAAOjE,SAAS3D,UAAYsH,EAAQnJ,YAEjC,2BACAgJ,GADP,IACc/E,SAAS,2BACZ+E,EAAM/E,UADK,IACKM,SAAUyE,EAAM/E,SAASM,aAIxD,KAAKf,GAAWsG,eAGZ,OAFed,EAAM/E,SAASM,SAAS4E,EAAQU,KAAKJ,OAC7CxJ,UAAYkJ,EAAQlJ,UACpB,2BACA+I,GADP,IACc/E,SAAS,2BACZ+E,EAAM/E,UADK,IACKM,SAAUyE,EAAM/E,SAASM,aAIxD,KAAKf,GAAWuG,sBAEZ,OAAO,2BACAf,GADP,IACc/E,SAAS,2BACZ+E,EAAM/E,UADK,IACKM,SAAU,CACzB,CACI2E,KAAM7H,EAAgB2I,KACtBP,OAAQ,CACJQ,MAAO,GACPC,MAAO,MACPtI,SAAU,EACVuI,MAAO,UAGf,CACIjB,KAAM7H,EAAgB+I,MACtBX,OAAQ,CACJY,MAAO,UAGf,CACInB,KAAM7H,EAAgBsI,QACtBF,OAAQ,CACJa,UAAW,YAGnB,CACIpB,KAAM7H,EAAgB+I,MACtBX,OAAQ,CACJY,MAAO,WAKvB5F,UAAU,2BACHuE,EAAMvE,WADJ,IACeG,UAAW,CAAC,GAAkB,GAAkB,GAAkB,QAIlG,KAAKpB,GAAW+G,oBACZ,OAAO,2BACAvB,GADP,IACcvE,UAAU,2BACbuE,EAAMvE,WADM,IACKE,WAAYwE,EAAQzL,UAIpD,KAAK8F,GAAWgH,mBACZ,OAAO,2BACAxB,GADP,IACcV,QAAQ,2BAAMU,EAAMV,SAAb,IAAsBmC,YAAatB,EAAQuB,WAGpE,KAAKlH,GAAWmH,yBACZ,OAAO,2BACA3B,GADP,IACcV,QAAQ,2BAAMU,EAAMV,SAAb,IAAsBsC,aAAczB,EAAQuB,WAGrE,KAAKlH,GAAWqH,2BACZ,OAAO,2BACA7B,GADP,IACcV,QAAQ,2BAAMU,EAAMV,SAAb,IAAsBwC,eAAgB3B,EAAQuB,WAGvE,KAAKlH,GAAWuH,2BACZ,OAAO,2BACA/B,GADP,IACcV,QAAQ,2BAAMU,EAAMV,SAAb,IAAsB0C,eAAgB7B,EAAQuB,WAGvE,KAAKlH,GAAWyH,eACZ,OAAO,2BACAjC,GADP,IACcvE,UAAU,2BACbuE,EAAMvE,WADM,IACKS,cAAeiE,EAAQH,UAIvD,KAAKxF,GAAW0H,qBACZ,OAAO,2BACAlC,GADP,IACcvE,UAAU,2BACbuE,EAAMvE,WADM,IACKW,kBAAmB+D,EAAQgC,WAI3D,KAAK3H,GAAW4H,qBACZ,IAAM7G,EAAWyE,EAAM/E,SAASM,SAASiF,QAGzC,OAFajF,EAAS4E,EAAQU,KACzBJ,OAASN,EAAQgC,OACf,2BACAnC,GADP,IACc/E,SAAS,2BACZ+E,EAAM/E,UADK,IACKM,SAAUA,MAIzC,KAAKf,GAAW6H,WACZ,OAAO,2BACArC,GADP,IACcV,QAASa,EAAQb,UAGnC,KAAK9E,GAAW8H,cACZ,OAAO,2BACAtC,GADP,IACc/E,SAAUkF,EAAQxI,OAGpC,KAAK6C,GAAW+H,cACZ,OAAO,2BACAvC,GADP,IACc/E,SAAS,2BAAM+E,EAAM/E,UAAb,IAAuBM,SAAU4E,EAAQ5E,aAGnE,KAAKf,GAAWgI,eACZ,OAAO,2BACAxC,GADP,IACcvE,UAAW0E,EAAQ1E,YAGrC,KAAKjB,GAAWiI,eACZ,OAAO,2BACAzC,GADP,IACcxC,UAAW2C,EAAQ3C,YAGrC,KAAKhD,GAAWkI,gBACZ,OAAO,2BACA1C,GADP,IACczB,WAAY4B,EAAQ5B,aAGtC,KAAK/D,GAAWmI,eACZ,OAAO,2BACA3C,GADP,IACc5B,cAAe+B,EAAQxI,OAGzC,KAAK6C,GAAWoI,YACZ,OAAO,2BACA5C,GADP,IACcT,QAASY,EAAQZ,UAGnC,KAAK/E,GAAWqI,eACZ,OAAO,2BACA7C,GADP,IACcN,WAAYS,EAAQT,aAGtC,KAAKlF,GAAWsI,mBAGZ,OAFc9C,EAAMvE,UAAUG,UAAUuE,EAAQU,KAC1Ca,OAASvB,EAAQuB,OAChB,2BACA1B,GADP,IACcvE,UAAU,2BACbuE,EAAMvE,WADM,IACKG,UAAWoE,EAAMvE,UAAUG,cAI3D,KAAKpB,GAAWuI,qBACZ,OAAO,2BACA/C,GADP,IACcvE,UAAU,2BACbuE,EAAMvE,WADM,IACKoB,oBAAqBsD,EAAQtD,wBAI7D,KAAKrC,GAAWwI,iBACZ,IAAMC,EAAcjD,EAAMvE,UAAUoB,oBAE9BqG,EAAc/C,EAAQ+C,YAwB5B,OAAO,2BACAlD,GADP,IACcvE,UAAU,2BACbuE,EAAMvE,WADM,IACKoB,oBAAoB,2BACjCoG,GADgC,IAEnCC,oBAMhB,KAAK1I,GAAW2I,sBACZ,IAAMF,EAAcjD,EAAMvE,UAAUoB,oBAC9BuG,EAAoBjD,EAAQiD,UAC5BC,EAAmBlD,EAAQkD,SAC3BC,EAAuBnD,EAAQmD,aAC/BC,EAAmBpD,EAAQoD,SAC3BC,EAASP,EAAYQ,OAG3B,OAFAD,EAAOJ,GAAWM,MAAMJ,GAAcD,GAAUE,GAAYpD,EAAQwD,MAE7D,2BACA3D,GADP,IACcvE,UAAU,2BACbuE,EAAMvE,WADM,IACKoB,oBAAoB,2BACjCoG,GADgC,IACnBQ,OAAQD,QAKxC,KAAKhJ,GAAWoJ,cACZ,OAAO,2BACA5D,GADP,IACcH,aAAcM,EAAQN,eAGxC,KAAKrF,GAAWqJ,oBACZ,OAAO,2BACA7D,GADP,IACcF,eAAgBK,EAAQL,mBCpD5CgE,GAAgB,SAACnL,GACnB,IAAI9E,EAAO,KACK,MAAZ8E,IAEA9E,GADa8E,EAASzB,OAASnC,EAAqBC,GACxC2D,EAASE,YAEzB,OAAOhF,GAGIkQ,GAnPY,SAAC3Q,GAAoC,IAAD,EAE7B4Q,qBAAWC,IAAjCjE,EAFmD,EAEnDA,MAAOkE,EAF4C,EAE5CA,WAET/I,EAAY6E,EAAM/E,SAASE,UAC3BgJ,EAAQnE,EAAMvE,UAAUG,UAAUxI,EAAMsB,OAE9C,OAAQtB,EAAMgR,YAAYlE,MACtB,KAAK7H,EAAgB+I,MACjB,IAAMX,EAASrN,EAAMgR,YAAY3D,OACjC,OACI,+BAAOA,EAAOY,QAGtB,KAAKhJ,EAAgB2I,KACjB,IAAMP,EAASrN,EAAMgR,YAAY3D,OAC3B4D,EAA6B,GAgCnC,OA/BAA,EAAY/Q,KACR,gCACI,2CACA,+BAAOmN,EAAOQ,UAFRoD,EAAY/J,SAK1B+J,EAAY/Q,KACR,gCACI,0CACA,+BAAOmN,EAAOS,UAFRmD,EAAY/J,SAKtBa,GAAanD,EAAWoD,QACxBiJ,EAAY/Q,KACR,gCACI,2CACA,+BAAOmN,EAAOU,UAFRkD,EAAY/J,SAK1B+J,EAAY/Q,KACR,gCACI,yCAEA,+BACImN,EAAOU,OAAS9L,EAAW,GACvBF,EAAuBsL,EAAO7H,UAC9BxD,EAAuBqL,EAAO7H,cANhCyL,EAAY/J,UAY1B,8BACK+J,IAIb,KAAKhM,EAAgBiM,MACjB,IAAM7D,EAASrN,EAAMgR,YAAY3D,OAE3B8D,EAAgBT,GAAcrD,EAAOjE,UACrCgI,EAAgBV,GAAcrD,EAAOhE,aACrCgI,EAAe/L,EAAa+H,EAAOjE,SAAU2H,EAAMO,KAAK9L,UACxD+L,EAAejM,EAAa+H,EAAOhE,YAAa0H,EAAMO,KAAK9L,UAC7DgM,EAAa,GACbC,GAAa,EACbC,EAAa,QACbC,EAAY,IAChB,GAAqB,MAAjBR,EACAK,EAAa9L,EAAc2H,EAAOxJ,WAElC4N,GAD8C,SAApBV,EAAMO,KAAKvD,MAAmB1L,EAAoCC,GAC7DsP,SAAST,EAAgBK,GACxDE,EAAU,UAAMP,GAAN,OAAsBK,GAAtB,OAAoD,MAAjBJ,EAAwB,GAAK,IAAMA,GAChFO,EAAS,UAAMN,GAAN,OAAqBG,GAArB,OAAkD,MAAhBD,EAAuB,GAAK,IAAMA,GAGjF,IADA,IAAMM,EAAa,GACV5K,EAAI,EAAGA,EAAIoG,EAAO/D,QAASrC,IAChC4K,EAAW3R,KAAK,wBAAW+G,IAE/B,IAAM6K,EAAWf,EAAMgB,SAASD,SAC1BE,EAAcjB,EAAMgB,SAASC,YAC7BC,EAAWC,KAAKC,MAAMpB,EAAMgB,SAASE,SAAW,IAAO,IAAM,GAE7DG,EAAatB,EAAWuB,QAAQC,cAAcjF,EAAOgF,SAC3D,OACI,qCACI,qBAAKhS,UACD,UACsB,MAAnBgN,EAAOjE,SAAmB,SAAW,KACrCqI,EAAa,YAAc,KAE3B7E,EAAM/E,SAASE,WAAanD,EAAW2N,OAAS,WAAa,IALpE,SAOI,+BAAOb,MAEX,qBAAKrR,UAAWuM,EAAM/E,SAASE,WAAanD,EAAW2N,OAAS,SAAW,QAA3E,SACI,+BAAOZ,MAEX,qBAAKtR,UAAU,UAAf,SACKwR,IAEL,sBAAKxR,UAAU,mBAAf,UACI,sBAAMA,UAAU,MAAhB,UAAoC,GAAbyR,EAAiBA,EAAW,KACnD,sBAAMzR,UAAU,OAAhB,UAAwC,GAAhB2R,EAAoBA,EAAc,QAE9D,qBAAK3R,UAAU,gBAAf,SACI,iCAAO4R,EAAP,SAEJ,qBACI5R,UACI,kBACe,GAAd+R,EAAkB,UAAY,IAHvC,SAMI,2CAAcA,UAK9B,KAAKnN,EAAgBsI,QACjB,IAAMF,EAASrN,EAAMgR,YAAY3D,OACjC,OACI,qCACI,qBAAKhN,UAAU,OAAf,SAAsB,+BAAOgN,EAAOa,cACpC,qBAAK7N,UAAU,cAI3B,KAAK4E,EAAgBuN,OACjB,IAAMnF,EAASrN,EAAMgR,YAAY3D,OAC3BoF,EAAY7F,EAAMvE,UAAUG,UAAUxI,EAAMsB,MAAQ,GACtDoR,EAAiB,6BACrB,OAAQrF,EAAOsF,YACX,KAAK,KACDD,EACI,qCACI,qBAAKrS,UAAU,QAAf,SACI,gDAEJ,sBAAKA,UAAU,SAAf,UACI,uCADJ,UAMR,MACJ,KAAKyE,EAAW8N,SACZ,IAAMC,EAAuC,OAA5BxF,EAAOyF,iBAA4B,OAASzF,EAAOyF,iBAAiBzN,WAC/E0N,EAAa1F,EAAOyF,mBAAqB/N,EAAiBiO,UAAY3F,EAAOyF,mBAAqB/N,EAAiBkO,IACrH9N,EAAQ,EACN+N,EAAcT,EAAUnB,KAAK9L,SAC7B2N,EAAqC,SAAxBV,EAAUnB,KAAKvD,MAC5BqF,EAAcrC,EAAMO,KAAK9L,SACzB6N,EAAiC,SAApBtC,EAAMO,KAAKvD,MAC9B,OAAQV,EAAOyF,kBACX,KAAK/N,EAAiBiO,SAClB7N,EAAQkI,EAAOiG,eAEf,MACJ,KAAKvO,EAAiBkO,IAClB9N,EAAQkI,EAAOkG,UAEf,MACJ,KAAKxO,EAAiByO,SACtB,KAAKzO,EAAiB0O,UAE1B,IAAMC,GAAeP,EAAsCnR,EAAzBD,GAAiDmR,GAC7ES,GAAeN,EAAsCrR,EAAzBD,GAAiDqR,GACnFV,EACI,qCACI,sBAAKrS,UAAU,QAAf,UACI,+BAAOwS,GAAYE,EAAa,KAAO,MACtCA,EAAc,+BAAO5N,IAAiB,gCAE3C,qBAAK9E,UAAU,SAAf,SACI,iCAAOqT,EAAP,WAAsBC,UAKlC,MACJ,KAAK7O,EAAW8O,MACZ,IAAMf,EAAoC,OAAzBxF,EAAOwG,cAAyB,OAASxG,EAAOwG,cAAcxO,WAC3EF,EAAQ,EACN2O,EAAWrB,EAAUnB,KAAKzD,MAC1BkG,GAAWhD,EAAMO,KAAKzD,MAC5B,OAAQR,EAAOwG,eACX,KAAK7O,EAAcgP,KACf7O,EAAQkI,EAAO4G,UAEf,MACJ,KAAKjP,EAAckP,KACf/O,EAAQkI,EAAO8G,UAEf,MACJ,KAAKnP,EAAcoP,SACfjP,EAAQkI,EAAOgH,cAIvB3B,EACI,qCACI,sBAAKrS,UAAU,QAAf,UACI,+BAAOwS,EAAW,OAClB,+BAAO1N,OAEX,qBAAK9E,UAAU,SAAf,SACI,yCAAUyT,EAAV,mBAAwBC,WAKpC,MACJ,KAAKjP,EAAWwP,KACZ5B,EACI,6BAQZ,OAFiB9N,EAAWoD,MAGxB,qCACI,qBAAK3H,UAAU,cAAf,SAEI,+BAA6B,OAAtBgN,EAAOsF,WAAsB,SAAWtF,EAAOsF,WAAWtN,eAEpEqN,OCmDN6B,I,MA7QM,SAACvU,GAA8B,IAAD,EACP4Q,qBAAWC,IAA3CjE,EADuC,EACvCA,MAAO4H,EADgC,EAChCA,SAAU1D,EADsB,EACtBA,WAEnB2D,EAAWzU,EAAMsB,MAAQsL,EAAM/E,SAASM,SAASjB,OAEjDwN,EAAMC,iBAAO,IAOnB,GANA3T,qBAAU,WACFyT,GACAD,EAASpN,GAAWsI,mBAAoB,CAAEjC,IAAKzN,EAAMsB,MAAOgN,OAAQoG,EAAIE,YAE7E,CAAChI,EAAM/E,SAASM,YAEdsM,EACD,OAAQ,6BAGZ,IAAM3H,EAAO9M,EAAMgR,YAAYlE,KACzBpE,EAAWkE,EAAMvE,UAAUK,SAC3BX,EAAY6E,EAAM/E,SAASE,UAE3BgJ,EAAQnE,EAAMvE,UAAUG,UAAUxI,EAAMsB,OAYxCiH,EAAaqE,EAAMvE,UAAUE,WAC7BsM,EAAatM,GAAcvI,EAAMsB,MACjCwT,EAAalI,EAAMvE,UAAUI,eAAiBzI,EAAMsB,MAmHpDyT,EAA2B,WACAnI,EAAM/E,SAASM,SAASnI,EAAMsB,OAC/CwL,MAAQ7H,EAAgB+I,OAChCwG,EAASpN,GAAW+G,oBAAqB,CAAE7M,MAAOtB,EAAMsB,SAmB5D0T,EAA2B,6BA6B/B,OA5BIhV,EAAMsB,OAASsL,EAAM/E,SAASM,SAASjB,OAAS,IAChD8N,EACI,qBACI3U,UACI,YACCqI,GAAY7D,EAAS8D,OAAS,GAAK,YAExCpI,QAAS,WACLiU,EAASpN,GAAW+G,oBAAqB,CAAE7M,MAAOtB,EAAMsB,QACxDwP,EAAWmE,MAAMC,kBACjBV,EAASpN,GAAW+G,oBAAqB,CAAE7M,MAAOtB,EAAMsB,MAAQ,IAChEkT,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAc2Q,gBAC3DX,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAnC,EAAMvE,UAAUW,mBADjB,IAEFC,YAAY,EACZxD,UAAW,EACX3B,QAAQ,EACRD,UAAWtB,EAAmB,GAAGC,IACjC8G,QAAS,OAjBzB,SAqBI,wCAMR,sBAAKjJ,UAAU,MAAf,UACI,sBAAKA,UAAU,YAAf,UACI,qBAAKA,UAAU,SAAf,SA5Ga,WACrB,IAAI+U,EAA4B,GAEhC,GAAI,CAACnQ,EAAgBiM,MAAOjM,EAAgBsI,QAAStI,EAAgBuN,QAAQZ,SAAS9E,GAAO,CAEzF,GAAI7H,EAAgBiM,OAASpE,EAAM,CAE/BsI,EAAWlV,KACP,qBAA6BG,UAAU,WAAvC,SACI,+BAAO0Q,EAAMgB,SAASsD,MADhBD,EAAWlO,SAIzB,IAAMoO,EAA8B,SAApBvE,EAAMO,KAAKvD,MAErBwH,GADYD,EAAUvT,EAAyBC,GAC3B+O,EAAMO,KAAK9L,UAEjCuC,IAAcnD,EAAWoD,OACzBoN,EAAWlV,KACP,qBACIG,UAAW,CACP,QACAiV,EAAU,MAAQ,OACpBhV,KAAK,KAJX,SAKI,qCAAQiV,EAAR,QALMH,EAAWlO,SAUjCkO,EAAWlV,KAIP,qBAEIG,UACI,OACCqI,GAAY7D,EAAS8D,OAAS,GAAK,WAExCpI,QAAS,WACLuQ,EAAWmE,MAAMO,cAAcxV,EAAMsB,QAP7C,SAUI,yCATK8T,EAAWlO,SAa5B,OAAQ,mCACHkO,IA8DQK,KAEL,qBACIpV,UAAW,CACP,eA1LK,WACrB,OAAQyM,GACJ,KAAK7H,EAAgB+I,MAAO,MAAO,eACnC,KAAK/I,EAAgB2I,KAAM,MAAO,cAClC,KAAK3I,EAAgBiM,MAAO,MAAO,eACnC,KAAKjM,EAAgBsI,QAAS,MAAO,iBACrC,KAAKtI,EAAgBuN,OAAQ,MAAO,iBAqLxBkD,GACAb,EAAa,SAAW,GACxBC,EAAa,WAAa,GAC1B,CACI7P,EAAgB2I,KAChB3I,EAAgBsI,QAChBtI,EAAgBiM,MAChBjM,EAAgBuN,QAClBZ,SAAS9E,GAAQ,aAAe,GAlL7B,WACrB,IAAM3E,EAAWyE,EAAM/E,SAASM,SAC1BwN,EAAoB,CAACxN,EAASjB,QAChC0O,GAAS,EACTC,GAAY,EAQhB,OAPA1N,EAAS7D,SAAQ,SAACwR,EAAI7O,GACd6O,EAAGhJ,MAAQ7H,EAAgBsI,SAASqI,IACxCD,EAAQ1O,GAAK2O,EACTrN,GAActB,IAAG4O,EAAWD,MAGfD,EAAQ3V,EAAMsB,QAAUuU,GAAY/I,GAAQ7H,EAAgB+I,MAwKjE+H,GAAqB,UAAY,GA/J7CrN,GAAY7D,EAASmR,WAAmB,GAExClJ,GAAQ7H,EAAgBiM,OAEoB,MAD7BlR,EAAMgR,YAAY3D,OACDjE,SAExBwD,EAAMvE,UAAUO,aAAagJ,SAAS5R,EAAMsB,OACrC,gBAEJ,WAKJ,cAIY,WACvB,GAAIoH,GAAY7D,EAASoR,MAAO,MAAO,GAEvC,GAAK,CAAChR,EAAgB+I,MAAO/I,EAAgB2I,MAAMgE,SAAS9E,GAWxD,MAAO,cAVP,IAAM5C,EAAa0C,EAAMvE,UAAU6B,WAC7BgM,EAAYhM,EAAW,GAAKA,EAAW,GACvCiM,EAAQjM,EAAWgM,EAAY,EAAI,GACnCE,EAAMlM,EAAWgM,EAAY,EAAI,GACvC,OAAIlW,EAAMsB,OAAS6U,GAASnW,EAAMsB,OAAS8U,EAChC,gBAEA,WAoICC,IACF/V,KAAK,KACPC,QAAS,WACDmI,GAAY7D,EAAS8D,QACrBoM,IACAP,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,QACpDL,GAAY7D,EAASmR,WApEjB,WAC/B,IAAMpN,EAAegE,EAAMvE,UAAUO,aAChCA,EAAagJ,SAAS5R,EAAMsB,OAG7BsH,EAAa0N,MAAK,SAAChV,EAAO2F,GAClB3F,GAAStB,EAAMsB,OAAOsH,EAAa0E,OAAOrG,EAAG,MAHrD2B,EAAa1I,KAAKF,EAAMsB,OAM5BwP,EAAWmE,MAAMsB,gBAAgB3N,GA4Db4N,GACO9N,GAAY7D,EAASoR,OAC5BnF,EAAWmE,MAAMwB,cAAczW,EAAMsB,QAG7CoV,cAAe,SAACC,GACZ,GAAIjO,GAAY7D,EAAS8D,OAGrB,OAFAoM,IAC6BnI,EAAM/E,SAASM,SAASnI,EAAMsB,OAC3CwL,MACZ,KAAK7H,EAAgB2I,KACjBkD,EAAW8F,gBAAgB5W,EAAMgR,YAAY3D,QAC7CmH,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcqS,eAE3D,MACJ,KAAK5R,EAAgBsI,QACrB,KAAKtI,EAAgBiM,MACrB,KAAKjM,EAAgBuN,OAEb5F,EAAMV,QAAQmC,YAAYyI,MAAMrP,KAAOkP,EAAEI,QAAU,KACnDnK,EAAMV,QAAQmC,YAAYyI,MAAMpP,IAAMiP,EAAEK,QAAU,KAClDxC,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcyS,iBAM/EvC,IAAKA,EAhDT,SAkDI,cAAC,GAAD,CACIpT,MAAOtB,EAAMsB,MACb0P,YAAahR,EAAMgR,mBAK9BgE,OC5PEkC,GArBQ,SAAClX,GAAgC,IAAD,EACvB4Q,qBAAWC,IAA/BjE,EAD2C,EAC3CA,MAD2C,EACpC4H,SAaf,OACI,qBAAKnU,UAZS,WACd,IAAM8H,EAAWyE,EAAM/E,SAASM,SAC1BI,EAAaqE,EAAMvE,UAAUE,WAC/BqN,GAAS,EACTC,GAAY,EAKhB,OAJA1N,EAAS7D,SAAQ,SAACwR,EAAI7O,GACd6O,EAAGhJ,MAAQ7H,EAAgBsI,SAASqI,IACpCrN,GAActB,IAAG4O,EAAWD,MAE7BC,GAAY7V,EAAMsB,MAGT6V,GAAc,SAAW,GAAzC,SACI,+BAAOnX,EAAMiO,WCwJnBmJ,I,MAAa,SAACpX,GAEhB,OACI,sBAAKK,UAAWL,EAAMuB,QAAU,UAAY,GACxChB,QAAS,WACLP,EAAMqX,YAFd,UAKI,sBAAMhX,UAAWL,EAAMsX,SAAvB,SAAkCtX,EAAMiO,QACxC,sBAAM5N,UAAU,MAAhB,oBAA2BL,EAAMuX,QAAjC,gBAKGC,GAvLS,WAAO,IAAD,EAEc5G,qBAAWC,IAA3CjE,EAFkB,EAElBA,MAAO4H,EAFW,EAEXA,SAAU1D,EAFC,EAEDA,WAGnB2G,EAAQ,kBAAMjD,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,QAGzE2L,EAAMC,iBAAO,IACnB3T,qBAAU,WAENwT,EAASpN,GAAWgH,mBAAoB,CAAEE,OAAQoG,EAAIE,YACvD,IAKH,IAAM8C,EAAmC,GACzC,GAAI9K,EAAMvE,UAAUS,eAAiBtE,EAAcyS,aAAc,CAC7D,IAAMU,EAAa/K,EAAM/E,SAASM,SAASyE,EAAMvE,UAAUE,YAyC3D,OAxCAmP,EAAcxX,KAAK,CACfoX,SAAU,QAASrJ,MAAO,eAAgBsJ,QAAS,IAAKhW,SAAS,EACjE8V,SAAU,WACNvG,EAAWmE,MAAMC,kBACjBuC,OAGRC,EAAcxX,KAAK,CACfoX,SAAU,OAAQrJ,MAAO,eAAgBsJ,QAAS,IAAKhW,SAAS,EAChE8V,SAAU,WACNvG,EAAWmE,MAAMC,kBACjBV,EAASpN,GAAW+G,oBAAqB,CAAE7M,MAAOsL,EAAMvE,UAAUE,WAAa,IAC/EiM,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAc2Q,gBAC5CwC,EAAWtK,OAC1BmH,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAnC,EAAMvE,UAAUW,mBADjB,IAEFC,YAAY,EACZG,SAAU,CAAE3D,UAAW,EAAG3B,QAAQ,GAClCuF,YAAa,KACbxF,UAAWtB,EAAmB,GAAGC,IACjC8G,QAASsD,EAAMvE,UAAUQ,sBAKzC6O,EAAcxX,KAAK,CACfoX,SAAU,QAASrJ,MAAO,iBAAkBsJ,QAAS,IAAKhW,SAAS,EACnE8V,SAAU,WACNvG,EAAWmE,MAAM2C,oBACjBH,OAGRC,EAAcxX,KAAK,CACfoX,SAAU,QAASrJ,MAAO,gBAAiBsJ,QAAS,IAAKhW,SAAS,EAClE8V,SAAU,WACNvG,EAAWmE,MAAM4C,mBACjBJ,OAGAE,EAAW7K,MACf,KAAK7H,EAAgBiM,MACjB,IAAM7D,EAASsK,EAAWtK,OAC1BqK,EAAcxX,KAAK,CACfoX,SAAU,QAASrJ,MAAO,YAAasJ,QAAS,IAAKhW,QAA4B,MAAnB8L,EAAOjE,SACrEiO,SAAU,WACN,IAAMxP,EAAW+E,EAAM/E,SACjBwF,EAASxF,EAASM,SAASyE,EAAMvE,UAAUE,YAAY8E,OAC7DA,EAAOjE,SAAW,KAClBiE,EAAOhE,YAAc,KACrByH,EAAWmE,MAAM6C,YAAYjQ,GAE7B4P,OAGRC,EAAcxX,KAAK,CACfoX,SAAU,OAAQrJ,MAAO,aAAcsJ,QAAS,IAAKhW,SAAS,EAC9D8V,SAAU,WACNvG,EAAWmE,MAAM8C,uBAGzBL,EAAcxX,KAAK,CACfoX,SAAU,OAAQrJ,MAAO,eAAgBsJ,QAAS,IAAKhW,QAA4B,MAAnB8L,EAAOjE,SACvEiO,SAAU,WACNvG,EAAWmE,MAAM+C,uBAGzBN,EAAcxX,KAAK,CACfoX,SAAU,OAAQrJ,MAAO,QAASsJ,QAAS,IAAKhW,SAAS,EACzD8V,SAAU,WACNvG,EAAWmE,MAAMgD,uBAGzBP,EAAcxX,KAAK,CACfoX,SAAU,QAASrJ,MAAO,eAAgBsJ,QAAS,IAAKhW,QAA4B,MAAnB8L,EAAOjE,SACxEiO,SAAU,WACNvG,EAAWmE,MAAMiD,cACjB1D,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,UAGnE2O,EAAcxX,KAAK,CACfoX,SAAU,QAASrJ,MAAO,cAAesJ,QAAS,IAAKhW,SAAS,EAChE8V,SAAU,WACNvG,EAAWmE,MAAMkD,mBACjB3D,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,UAInE,MACJ,KAAK9D,EAAgBsI,QACjBmK,EAAcxX,KAAK,CACfoX,SAAU,OAAQrJ,MAAO,eAAgBsJ,QAAS,IAAKhW,SAAS,EAChE8V,SAAU,WACNvG,EAAWmE,MAAMmD,uBAIzB,MACJ,KAAKnT,EAAgBuN,OACjBkF,EAAcxX,KAAK,CACfoX,SAAU,OAAQrJ,MAAO,cAAesJ,QAAS,IAAKhW,SAAS,EAC/D8V,SAAU,WACNvG,EAAWmE,MAAMoD,sBAMjCX,EAAcxX,KAAK,CACfoX,SAAU,QAASrJ,MAAO,SAAUsJ,QAAS,MAAOhW,SAAS,EAC7D8V,SAAU,WACNvG,EAAWmE,MAAMqD,mBACjB9D,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,UAIvE,IAAMwP,EAA0B,GAYhC,OAXAb,EAAcpT,SAAQ,SAACC,EAAM0C,GACzBsR,EAASrY,KAAK,cAAC,GAAD,CAEVoX,SAAU/S,EAAK+S,SACfrJ,MAAO1J,EAAK0J,MACZsJ,QAAShT,EAAKgT,QACdhW,QAASgD,EAAKhD,QACd8V,SAAU9S,EAAK8S,UALVpQ,OAUT,qBACIyN,IAAKA,EACLzT,GAAG,mBACHZ,UAAW,YAAcuM,EAAMvE,UAAUS,eAAiBtE,EAAcyS,aAAe,UAAY,IACnG1W,QAAS,aAJb,SAQKgY,KCgbEC,I,MA1kBO,WAAO,IAAD,EAEgB5H,qBAAWC,IAA3CjE,EAFgB,EAEhBA,MAAO4H,EAFS,EAETA,SAAU1D,EAFD,EAECA,WAQnB4D,EAAMC,iBAAuB,MAC7B8D,EAAY9D,iBAA0B,MAEtC9E,EAAcjD,EAAMvE,UAAUW,kBAC9BT,EAAaqE,EAAMvE,UAAUE,WAE7BwI,GADcnE,EAAM/E,SAASM,SAASI,GAAY8E,OAC1CT,EAAMvE,UAAUG,UAAUD,IACtBqE,EAAMvE,UAAUK,SAAa7D,EAAS6T,QACxD1X,qBAAU,WAGNwT,EAASpN,GAAWmH,yBAA0B,CAAED,OAAQoG,EAAIE,UAC5D,IAAM+D,EAAcF,EAAU7D,QAC9B+D,EAAOC,MAAQ,IACfD,EAAOE,OAAS,KAEjB,IAEH7X,qBAAU,WACF4L,EAAMvE,UAAUS,eAAiBtE,EAAc2Q,eAC/C2D,EACIjJ,EAAYzG,SAAS3D,UACM,MAA3BoK,EAAYxG,aAAuB,EAAIwG,EAAYxG,YAAY5D,UAC/DoK,EAAYhM,aAGrB,CAACgM,EAAajD,EAAMvE,UAAUS,gBAMjC,IAAMgQ,EAAkB,SAACrS,EAAsBC,EAAsB7C,GACjE,IAAMkV,EAAON,EAAU7D,QAA8BoE,WAAW,MAE1DxT,GAAYuL,EAAMO,KAAK9L,SAAWiB,GAAgB,GAElDwS,EADgB7U,EAAgBP,GAA4BkD,UACxC3F,KAAI,SAAC+D,GAAD,OAAWK,EAAWL,KAChD+T,GAAY,GACK,GAAjBxS,IACAwS,EAAWnI,EAAMO,KAAK9L,SAAWkB,GAErCqS,EAAII,UAAY,OAChBJ,EAAIK,SAAS,EAAG,EAAG,IAAK,IAexB,IAdA,IAAMC,EAAQ,GAMVC,EAAO,EACLC,EAMA,GACGtS,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,IAAIuS,EAAQ,OACRZ,EAAQS,EACRR,EAhBO,GAiBLY,EAAU,CAAC,EAAG,EAAG,EAAG,EAAG,IAAI7H,SAAS3K,EAAI,IAc9C,OAbIwS,IACAD,EAAQ,OACRZ,EAAQS,GACRR,EAASa,IAETT,EAAKrH,SAAS3K,KACduS,EAAQ,QAERN,GAAYjS,IACZuS,EAAQ,WAEZD,EAAYrZ,KAAK,CAAEoZ,KAAM,GAAKA,EAAMH,UAAWK,EAAOZ,QAAOC,SAAQY,YAE7DxS,EAAI,IACR,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,EAEjCqS,GAAQD,KACR,MACJ,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,GAEjCC,GAAQD,IACR,MACJ,QAEIC,GAAQD,IAGpBE,EAAYjV,SAAQ,SAACqV,GACZA,EAAQF,UACTV,EAAII,UAAYQ,EAAQR,UACxBJ,EAAIK,SAASO,EAAQL,KAAM,EAAGK,EAAQf,MAAOe,EAAQd,YAG7DU,EAAYjV,SAAQ,SAACqV,GACbA,EAAQF,UACRV,EAAII,UAAYQ,EAAQR,UACxBJ,EAAIK,SAASO,EAAQL,KAAM,EAAGK,EAAQf,MAAOe,EAAQd,QACrDE,EAAII,UAAY,OAChBJ,EAAIa,WAAWD,EAAQL,KAAM,EAAGK,EAAQf,MAAOe,EAAQd,YAG/DE,EAAIc,QAEFC,EAA2B,GAC3BC,EAA4B,GAC5BC,EAA0B,GAC5BC,EAA4B,6BAC1BC,EAAWtN,EAAM/E,SAASE,WAAanD,EAAW2N,OACxD,GAAI3F,EAAMvE,UAAUS,eAAiBtE,EAAc2Q,cAAe,CAE9DvT,EAAoB0C,SAAQ,SAAC6V,EAAMlT,GAC/B,IACMzB,GADUuL,EAAMO,KAAK9L,SACCyB,GAAK,GAC3BmT,EAAOzY,EAAmBsF,GAC1BoT,EAAOvY,EAAiB0D,GACxB8U,EAAOzY,EAAgB2D,GACvB+U,EAAS,CAAC,EAAG,EAAG,EAAG,EAAG,IAAI3I,SAAS3K,GACnC4N,EAAahF,EAAYzG,SAAS3D,WAAawB,EAC/CuT,GAA4C,MAA3B3K,EAAYxG,aAAuB,EAAIwG,EAAYxG,YAAY5D,YAAcwB,EAC9FwT,EAAgB,SAAC3W,GACnB,OACI8I,EAAM/E,SAASE,WAAanD,EAAWoD,MACnC,qCACI,sBAAM3H,UAAU,SAAhB,SAA0ByD,EAASsW,EAAOD,IAC1C,yCACA,sBAAM9Z,UAAU,QAAhB,SAAyByD,EAASwW,EAAOD,IACzC,wCAGJ,mCACI,sBAAMha,UAAU,SAAhB,SAA0ByD,EAASwW,EAAOD,OAI1DP,EAAU5Z,KACN,8BACKqa,EAwCG,qCACI,qBACIla,UAAW,CACP,OACCwU,IAAehF,EAAYzG,SAAStF,OAAS,UAAY,GACzD0W,GAA4C,MAA3B3K,EAAYxG,cAAwBwG,EAAYxG,YAAYvF,OAAS,eAAiB,IAC1GxD,KAAK,KACPC,QAAS,WAEL,IAAM8I,GAAgBmR,GAA4C,MAA3B3K,EAAYxG,aAAwBwG,EAAYxG,YAAYvF,OAC7F+L,EAAYxG,YAAc,KAChCmL,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IAEF3G,aAAczE,EAAiB0E,KAAMC,SAAU,CAAE3D,UAAWwB,EAAGnD,QAAQ,GAASuF,mBAS5FqN,cAAe,WACX,IAAI7B,GAAehF,EAAYzG,SAAStF,OAAxC,CACA,IAAMuF,GACAmR,GAA4C,MAA3B3K,EAAYxG,aAAwBwG,EAAYxG,YAAYvF,OACzE,CAAE2B,UAAWwB,EAAGnD,QAAQ,GAAU,KAC5C0Q,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IAEF3G,aAAczE,EAAiB0E,KAAME,oBA9BrD,SAwCKoR,GAAc,KAEnB,qBACIpa,UAAW,CACP,OACCwU,GAAchF,EAAYzG,SAAStF,OAAS,UAAY,GACxD0W,GAA4C,MAA3B3K,EAAYxG,aAAuBwG,EAAYxG,YAAYvF,OAAS,eAAiB,IACzGxD,KAAK,KACPC,QAAS,WAEL,IAAM8I,EAAgBmR,GAA4C,MAA3B3K,EAAYxG,aAAuBwG,EAAYxG,YAAYvF,OAClE,KAA1B+L,EAAYxG,YAClBmL,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IAEF3G,aAAczE,EAAiB0E,KAAMC,SAAU,CAAE3D,UAAWwB,EAAGnD,QAAQ,GAAQuF,mBAS3FqN,cAAe,WACX,IAAI7B,IAAchF,EAAYzG,SAAStF,OAAvC,CACA,IAAMuF,EACAmR,GAA4C,MAA3B3K,EAAYxG,aAAuBwG,EAAYxG,YAAYvF,OACvC,KAAjC,CAAE2B,UAAWwB,EAAGnD,QAAQ,GAClC0Q,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IAEF3G,aAAczE,EAAiB0E,KAAME,oBA9BrD,SAwCKoR,GAAc,QA1HvB,qBACIpa,UAAW,CACPwU,EAAa,SAAW,GACxB2F,EAAgB,cAAgB,IAClCla,KAAK,KACPC,QAAS,WAEL,IAAM8I,EAAemR,EAA0C,KAA1B3K,EAAYxG,YACjDmL,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IAEF3G,aAAczE,EAAiB0E,KAAMC,SAAU,CAAE3D,UAAWwB,EAAGnD,QAAQ,GAASuF,mBAS5FqN,cAAe,WACX,IAAI7B,EAAJ,CACA,IAAMxL,EAAgBmR,EAAkD,KAAlC,CAAE/U,UAAWwB,EAAGnD,QAAQ,GAC9D0Q,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IAEF3G,aAAczE,EAAiB0E,KAAME,oBA1BrD,SAoCKoR,GAAc,MAtCjBxT,OAmIlB1E,EAAmB+B,SAAQ,SAACD,EAAQ4C,GAEhC8S,EAAW7Z,KACP,qBAEIG,UAAWgE,EAAO7B,KAAOqN,EAAYhM,UAAY,SAAW,GAC5DtD,QAAS,WACLiU,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IAEF3G,aAAczE,EAAiBiW,OAAQ7W,UAAWQ,EAAO7B,SAPzE,SAiBI,qCAAQ6B,EAAO5D,KAAf,QAhBKwG,OAsBjB,IAxL8D,eAwLrDA,GACL+S,EAAS9Z,KACL,qBAEIG,UAAWwP,EAAYvG,SAAWrC,EAAI,EAAI,SAAW,GACrD1G,QAAS,WACLiU,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IACc3G,aAAczE,EAAiBkW,QAASrR,QAASrC,EAAI,QAL5EA,KAHRA,EAAI,EAAGA,EAAI,EAAGA,IAAM,EAApBA,GAgBTgT,EAAgB,qCACZ,qBACI1Z,QAAS,WACLiU,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,QAFnE,SAII,4CAeJ,qBACIxI,QAAS,WACLuQ,EAAW8J,MAAMC,oBAFzB,SAII,8CAIZ,IAAMC,EAAkB,SAAChO,EAAiBiO,GAAiC,IAAD,EACvB,KAARjO,EACnC,CAAC,IAAK,OAAQ+C,EAAYtG,YAAcwR,EACpC,kBAAMvG,EAASpN,GAAW0H,qBAAsB,CAC5CC,OAAO,2BACAc,GADD,IACctG,WAAYwR,QAGxC,CAAC,IAAK,OAAQlL,EAAYrG,YAAcuR,EACpC,kBAAMvG,EAASpN,GAAW0H,qBAAsB,CAC5CC,OAAO,2BACAc,GADD,IACcrG,WAAYuR,QAX0B,mBACjE9M,EADiE,KAC1D+M,EAD0D,KACrD7a,EADqD,KAC3C8a,EAD2C,KAiBtE,OAHIF,GAAU,IACV9M,GAAU8M,EAAS,EAAI,IAAM,QAG7B,qBACI1a,UAAW,CACP2a,EACA7a,EAAW,SAAW,IACxBG,KAAK,KACPC,QAAS0a,EALb,SAOI,+BAAOhN,EAAQ8M,OAKrBG,EAAuC,GACvCC,EAAuB,SACzBC,EACAC,GAMA,IAAMC,EAA4B,GA6ClC,OA5CAD,EAAc/W,SAAQ,SAACiX,EAAMtU,GACzB,IAAwB,IAApBsU,EAAK9V,UACL6V,EAAWpb,KACP,qBAAaG,UAAU,aAAb4G,QAEX,CACH,IAAMuU,EAAaD,EAAKzX,OAASnC,EAAqBC,EAChD6Z,EAAaF,EAAKzX,OAASjC,EAAkBC,EAC7C4Z,EAAaF,EAAWD,EAAK9V,WAC7BkW,EAAYF,EAAWF,EAAK9V,WAC5BpB,EAASD,EAAgBmX,EAAK1X,WAC9BgR,EACF0G,EAAK9V,YAAcoK,EAAYzG,SAAS3D,WACxC8V,EAAKzX,SAAW+L,EAAYzG,SAAStF,QACrCyX,EAAK1X,YAAcgM,EAAYhM,UAEnCyX,EAAWpb,KACP,sBAEIG,UAAW,CACP,MACAwU,EAAa,SAAW,IAC1BvU,KAAK,KACPC,QAAS,WACAsU,GACDL,EAASpN,GAAW0H,qBAAsB,CACtCC,OAAO,2BACAc,GADD,IAEFzG,SAAU,CAAE3D,UAAW8V,EAAK9V,UAAW3B,OAAQyX,EAAKzX,QACpDD,UAAW0X,EAAK1X,eAZpC,UAiBI,sBAAKxD,UAAU,SAAf,UACKqb,EAAYrX,EAAO5D,QAExB,sBAAKJ,UAAU,QAAf,UACKsb,EAAWtX,EAAO5D,UApBlBwG,QA2BjB,sBAAwC5G,UAAU,YAAlD,UACI,qBAAKA,UAAU,SAAf,SACI,+BAAO+a,MAEVE,IAJKJ,EAAsBhU,SAQlC0U,EAAQ,CAAEnW,WAAY,EAAG3B,QAAQ,EAAOD,UAAW,IAqFzD,OApFAqX,EAAsBhb,KAClBib,EACI,gDAAU,uBAAV,WACA,CACI,CAAE1V,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUM,OACpD,CAAEgD,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUS,OACpD,CAAE6C,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUS,OACpD,CAAE6C,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUM,OACpD,CAAEgD,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUM,OACpD,CAAEgD,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUS,OACpD,CAAE6C,UAAW,GAAI3B,QAAQ,EAAOD,UAAW1B,EAAUsB,iBAIjEyX,EAAsBhb,KAClBib,EACI,gDAAU,uBAAV,YACA,CACI,CAAE1V,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUa,MACpD,CAAEyC,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUgB,MACpD,CAAEsC,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUgB,MACpD,CAAEsC,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUa,MACpD,CAAEyC,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUe,SACpD,CAAEuC,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUgB,MACpD,CAAEsC,UAAW,GAAI3B,QAAQ,EAAOD,UAAW1B,EAAUuB,gBAIjEwX,EAAsBhb,KAClBib,EACI,4CACA,CACI,CAAE1V,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUU,MACpD+Y,EACAA,EACAA,EACA,CAAEnW,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUU,MACpD,CAAE4C,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUU,MACpD+Y,KAIZV,EAAsBhb,KAClBib,EACI,gDACA,CACI,CAAE1V,UAAW,EAAG3B,QAAQ,EAAMD,UAAW1B,EAAUS,OACnD,CAAE6C,UAAW,EAAG3B,QAAQ,EAAMD,UAAW1B,EAAUM,OACnD,CAAEgD,UAAW,EAAG3B,QAAQ,EAAMD,UAAW1B,EAAUM,OACnD,CAAEgD,UAAW,EAAG3B,QAAQ,EAAMD,UAAW1B,EAAUS,OACnD,CAAE6C,UAAW,EAAG3B,QAAQ,EAAMD,UAAW1B,EAAUS,OACnD,CAAE6C,UAAW,EAAG3B,QAAQ,EAAMD,UAAW1B,EAAUM,OACnD,CAAEgD,UAAW,GAAI3B,QAAQ,EAAMD,UAAW1B,EAAUM,UAIhEyY,EAAsBhb,KAClBib,EACI,iDAAW,uBAAX,cACA,CACIS,EACA,CAAEnW,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUe,SACpD,CAAEuC,UAAW,GAAI3B,QAAQ,EAAOD,UAAW1B,EAAUe,SACrD,CAAEuC,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUe,SACpD,CAAEuC,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUe,SACpD,CAAEuC,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUe,SACpD0Y,KAIZV,EAAsBhb,KAClBib,EACI,iDAAW,uBAAX,cACA,CACIS,EACA,CAAEnW,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUW,KACpD,CAAE2C,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUW,KACpD,CAAE2C,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUW,KACpD,CAAE2C,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUW,KACpD,CAAE2C,UAAW,EAAG3B,QAAQ,EAAOD,UAAW1B,EAAUW,KACpD8Y,KAKR,sBACIlH,IAAKA,EACLzT,GAAG,gBACHZ,UAAW,YAAcuM,EAAMvE,UAAUS,eAAiBtE,EAAc2Q,cAAgB,UAAY,IACpG5U,QAAS,aAJb,UAOI,cAAC,EAAD,CAAYW,UAAU,gBAClBC,YAAa,CACT,CACIV,KAAM,QAASc,QAAS2Y,EAAUvZ,KAC9B,mCACI,qBAAKN,UAAW,eAAhB,SACK6a,OAKjB,CACIza,KAAM,SAAUc,SAAS,EAAOZ,KAC5B,qCACI,qBAAKN,UAAW,kBAAoBwP,EAAY3G,cAAgBzE,EAAiB0E,KAAO,UAAY,IAApG,SACK2Q,IAEL,qBAAKzZ,UAAW,mBAAqBwP,EAAY3G,cAAgBzE,EAAiBiW,OAAS,UAAY,IAAvG,SACKX,SAMrBjZ,SAAU,IAEd,qBAAKT,UAAW,aAAhB,SACI,wBAAQqU,IAAK+D,MAEjB,qBAAKpY,UAAW,iBAAmBwP,EAAY3G,cAAgBzE,EAAiBkW,QAAU,UAAY,IAAtG,SACKX,IAEL,sBAAK3Z,UAAW,YAAcwP,EAAY3G,cAAgBzE,EAAiBoX,SAAW,UAAY,IAAlG,UACKf,EAAgB,KAAM,IACtBA,EAAgB,KAAM,KACtBA,EAAgB,IAAK,GACrBA,EAAgB,IAAK,KACrBA,EAAgB,IAAK,IACrBA,EAAgB,KAAM,IACtBA,EAAgB,KAAM,KACtBA,EAAgB,IAAK,GACrBA,EAAgB,IAAK,KACrBA,EAAgB,IAAK,OAE1B,qBAAKza,UAAU,YAAf,SACK4Z,SCtYF6B,I,MAlMe,WAAO,IAAD,EAEJlL,qBAAWC,IAA/BjE,EAFwB,EAExBA,MACFrE,GAH0B,EAEjBiM,SACI5H,EAAMvE,UAAUE,YAEnC,IAAmB,GAAfA,EAAkB,OAAQ,6BAE9B,IAAMwT,EAAUnP,EAAM/E,SAASM,SAASI,GAClCwI,EAAQnE,EAAMvE,UAAUG,UAAUD,GAEpCyT,EAAwB,6BAC5B,OAAQD,EAAQjP,MAEZ,KAAK7H,EAAgBiM,MACjB,IAAM7D,EAAS0O,EAAQ1O,OACnB9B,EAAO,IACX,GAAuB,MAAnB8B,EAAOjE,SAAkB,CACzB,IAAM3D,EAAY4H,EAAOjE,SAAS3D,UAC5BiW,EAAa9Z,EAAoB6D,GACjCwW,EAAYna,EAAiB2D,GACnC8F,EAAI,UAAMmQ,EAAN,aAAqBO,EAArB,KAER,IAC6B,EADzBzK,EAAa,IACjB,GAAuB,MAAnBnE,EAAOjE,SACPoI,EAAU,qBAAOpN,EAAgBiJ,EAAOxJ,kBAA9B,aAAO,EAAmCpD,KAA1C,KAGd,IAAMyb,EAAeC,GAAe,OAAQ,CACxC,CAAEjO,UAAW,QAAS/I,MAAO,GAAK4L,EAAMO,KAAKzD,MAAOtM,SAAS,GAC7D,CAAE2M,UAAW,OAAQ/I,MAAO4L,EAAMO,KAAKxD,MAAOvM,SAAS,GACvD,CAAE2M,UAAW,MAAO/I,MAAOrD,EAAiBiP,EAAMO,KAAK9L,UAAWjE,SAAS,GAC3E,CAAE2M,UAAW,QAAS/I,MAAO4L,EAAMO,KAAKvD,MAAOxM,SAAS,KAGtD6a,EAAgBD,GAAe,QAAS,CAC1C,CAAEjO,UAAW,OAAQ/I,MAAOoG,EAAMhK,QAAiB,KAARgK,GAC3C,CAAE2C,UAAW,SAAU/I,MAAOqM,EAAYjQ,QAAuB,KAAdiQ,GACnD,CAAEtD,UAAW,WAAY/I,MAAO,IAAK5D,SAAS,GAC9C,CAAE2M,UAAW,UAAW/I,MAAOkX,OAAOhP,EAAO/D,SAAU/H,SAAS,GAChE,CAAE2M,UAAW,WAAY/I,MAAOD,EAAkBmI,EAAO9D,YAAahI,QAA8B,GAArB8L,EAAO9D,YACtF,CAAE2E,UAAW,WAAY/I,MAAOD,EAAkBmI,EAAO7D,YAAajI,QAA8B,GAArB8L,EAAO7D,cAG1FwS,EACI,qBACI3b,UACI,QAFR,SAKI,gCACK6b,EACAE,EACC,WAEE,GAAuB,MAAnB/O,EAAOjE,SAAkB,CAKzB,IAJA,IAAMkT,EAA4B,GAC5BjY,EAASD,EAAgBiJ,EAAOxJ,WAChCoV,EAAI,OAAG5U,QAAH,IAAGA,OAAH,EAAGA,EAAQ0C,UACfwV,EAAG,OAAGtD,QAAH,IAAGA,OAAH,EAAGA,EAAM/R,OACTD,EAAI,EAAGA,EAAI,EAAGA,IACnB,GAAIA,EAAIsV,EAAK,CACT,IAAMC,EAAQ,OAAGnY,QAAH,IAAGA,OAAH,EAAGA,EAAQ0C,UAAUE,GAC7BE,EAAM,OAAG9C,QAAH,IAAGA,OAAH,EAAGA,EAAQ8C,OAAOF,GACxBwV,EAAQ3a,GAAkBuL,EAAOjE,SAAS3D,UAAY+W,GAAY,IACxEF,EAAWpc,KACP,sBAAaG,UAAU,SAAvB,UACI,qBAAKA,UAAU,WAAf,SAA0B,+BAAOmc,MACjC,qBAAKnc,UAAU,SAAf,SAAwB,+BAAO8G,MAC/B,qBAAK9G,UAAU,QAAf,SAAuB,+BAAOoc,QAHxBxV,SAOdqV,EAAWpc,KACP,sBAAaG,UAAU,iBAAvB,UACI,qBAAKA,UAAU,aACf,qBAAKA,UAAU,WACf,qBAAKA,UAAU,YAHT4G,IAQtB,OAAQ,qCACJ,qBAAK5G,UAAU,QAAf,SACI,4CAEJ,qBAAKA,UAAU,gBAAf,SACKic,OAIb,OAAQ,6BAtCV,QA4Cd,MAEJ,KAAKrX,EAAgBsI,QACjB,IAAMF,EAAS0O,EAAQ1O,OAEjBqP,EAAkBP,GAAe,UAAW,CAC9C,CAAEjO,UAAW,QAAS/I,MAAOkI,EAAOa,UAAW3M,SAAS,GACxD,CAAE2M,UAAW,YAAa/I,MAAO,IAAK5D,SAAS,GAC/C,CAAE2M,UAAW,YAAa/I,MAAO,IAAK5D,SAAS,GAC/C,CAAE2M,UAAW,aAAc/I,MAAO,IAAK5D,SAAS,KAEpDya,EACI,qBACI3b,UACI,QAFR,SAKI,8BACKqc,MAKb,MAGJ,KAAKzX,EAAgBuN,OACjB,IAAMnF,EAAS0O,EAAQ1O,OACnBsP,EAAa,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,KAE1B,MAArBtP,EAAOsF,aACNgK,EAAW,GAAKN,OAAOhP,EAAOsF,aAGJ,MAA3BtF,EAAOyF,mBACN6J,EAAW,GAAKN,OAAOhP,EAAOyF,mBAGN,GAAzBzF,EAAOiG,iBACNqJ,EAAW,GAAKN,OAAOhP,EAAOiG,iBAGX,GAApBjG,EAAOkG,YACNoJ,EAAW,GAAKN,OAAOhP,EAAOkG,YAGP,MAAxBlG,EAAOwG,gBACN8I,EAAW,GAAKN,OAAOhP,EAAOwG,gBAGX,GAApBxG,EAAO4G,YACN0I,EAAW,GAAKN,OAAOhP,EAAO4G,YAGX,GAApB5G,EAAO8G,YACNwI,EAAW,GAAKN,OAAOhP,EAAO8G,YAGP,GAAxB9G,EAAOgH,gBACNsI,EAAW,GAAKN,OAAOhP,EAAOgH,gBAGhB,MAAfhH,EAAO5B,OACNkR,EAAW,GAAKN,OAAOhP,EAAO5B,OAGlC,IAAMmR,EAAiBT,GAAe,SAAU,CAC5C,CAAEjO,UAAW,OAAQ/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,IAC/D,CAAEzO,UAAW,WAAY/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,IACnE,CAAEzO,UAAW,OAAQ/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,IAC/D,CAAEzO,UAAW,MAAO/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,IAC9D,CAAEzO,UAAW,QAAS/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,IAChE,CAAEzO,UAAW,OAAQ/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,IAC/D,CAAEzO,UAAW,OAAQ/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,IAC/D,CAAEzO,UAAW,WAAY/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,IACnE,CAAEzO,UAAW,OAAQ/I,MAAOwX,EAAW,GAAIpb,QAA0B,KAAjBob,EAAW,MAEnEX,EACI,qBACI3b,UACI,QAFR,SAKI,8BACKuc,MAOrB,OACI,qBAAK3b,GAAG,iBAAR,SACK+a,MA0BPG,GAAiB,SAACf,EAAoByB,GACxC,IAAMC,EAAyB,GAc/B,OAbAD,EAAevY,SAAQ,SAACsI,EAAO3F,GAC3B6V,EAAQ5c,KACJ,sBAEIG,UACI,UACCuM,EAAMrL,QAAU,WAAa,IAJtC,UAMI,qBAAKlB,UAAU,QAAf,SAAuB,iCAAOuM,EAAMsB,UAAb,SACvB,qBAAK7N,UAAU,QAAf,SAAuB,+BAAOuM,EAAMzH,YAN/B8B,OAUT,qCACJ,qBAAK5G,UAAU,QAAf,SACI,+BAAO+a,MAEX,qBAAK/a,UAAU,gBAAf,SACKyc,QCLEC,I,MA7NU,SAAC/c,GAEtB,IAAM8Q,EAAa9Q,EAAM8Q,WACnBkM,EAAehd,EAAMgd,aACrBhN,EAAYgN,EAAahN,UACzBiN,EAAgBD,EAAa3M,OAAOL,GACpCkN,EAAmBF,EAAaE,iBAChCC,EAAaF,EAAcG,KAAKF,GAChCG,EAAYJ,EAAcK,KAAKJ,GAE/BK,EAAoB,SAACC,GACvB,IAAMpN,EAAS4M,EAAa3M,OAC5BD,EAAOJ,GAAWoN,KAAKF,GAAoBM,EAC3C1M,EAAW2M,mBAAX,2BACOT,GADP,IAEI3M,OAAQD,MAGVsN,EAAgB,SAACC,GACnBR,EAAWZ,IAAMoB,EACjBR,EAAW5C,QAAS,EACpB4C,EAAW5S,QAAS,EACpBgT,EAAkBJ,IAEhBS,EAAsB,SAACC,GACzB,IAAMzN,EAAS4M,EAAa3M,OACtByN,EAAS1N,EAAOJ,GAAWsN,KAAKJ,GACtC9M,EAAOJ,GAAWsN,KAAKJ,GAAoBY,EAASD,EACpD/M,EAAW2M,mBAAX,2BACOT,GADP,IAEI3M,OAAQD,MAIV2N,EAASZ,EAAWZ,IACpByB,EAAwB,CAC1B,CACI/P,MAAO,KACP9N,SAAU4d,GAAUpZ,EAAiBsZ,MACrC7d,WAAW,EACX6a,SAAU,WAAQyC,EAAc/Y,EAAiBsZ,SAErD,CACIhQ,MAAO,IACP9N,SAAU4d,GAAUpZ,EAAiBuZ,KACrC9d,WAAW,EACX6a,SAAU,WAAQyC,EAAc/Y,EAAiBuZ,QAErD,CACIjQ,MAAO,IACP9N,SAAU4d,GAAUpZ,EAAiBwZ,KACrC/d,WAAW,EACX6a,SAAU,WAAQyC,EAAc/Y,EAAiBwZ,QAErD,CACIlQ,MAAO,IACP9N,SAAU4d,GAAUpZ,EAAiByZ,KACrChe,WAAW,EACX6a,SAAU,WAAQyC,EAAc/Y,EAAiByZ,QAErD,CACInQ,MAAO,IACP9N,SAAU4d,GAAUpZ,EAAiB0Z,KACrCje,WAAW,EACX6a,SAAU,WAAQyC,EAAc/Y,EAAiB0Z,QAErD,CACIpQ,MAAO,IACP9N,SAAUgd,EAAW5C,OACrBna,WAAY0Q,EAAWuB,QAAQiM,eAC/BrD,SAAU,WACNkC,EAAW5C,QAAU4C,EAAW5C,OAChC4C,EAAW5S,QAAS,EACpBgT,EAAkBJ,KAG1B,CACIlP,MAAO,MACP9N,SAAUgd,EAAW5S,OACrBnK,WAAY0Q,EAAWuB,QAAQkM,eAC/BtD,SAAU,WACNkC,EAAW5S,QAAU4S,EAAW5S,OAChC4S,EAAW5C,QAAS,EACpBgD,EAAkBJ,KAG1B,CACIlP,MAAO,MACP9N,UAAU,EACVC,WAAW,EACX6a,SAAU,WACNnK,EAAWuB,QAAQmM,WAG3B,CACIvQ,MAAO,MACP9N,UAAU,EACVC,UAAW6c,EAAcG,KAAKlW,QAAU,EACxC+T,SAAU,WACNnK,EAAWuB,QAAQoM,WAG3B,CACIxQ,MAAO,OACP9N,UAAU,EACVC,UAAWid,GAAa,EACxBpC,SAAU,WACN2C,GAAqB,KAG7B,CACI3P,MAAO,OACP9N,UAAU,EACVC,UAAWid,GAAa,GACxBpC,SAAU,WACN2C,EAAoB,MA0C1Bc,EAA4B,GAgBlC,OAfAV,EAAQ1Z,SAAQ,SAACqa,EAAQ1X,GACrByX,EAAWxe,KACP,wBAEIG,WACKse,EAAOxe,SAAW,SAAW,KAC7Bwe,EAAOve,UAAY,WAAa,IAErCG,QAAS,kBAAMoe,EAAO1D,YAN1B,SAQI,+BAAO0D,EAAO1Q,SAPThH,OAYT,qCACJ,wBACI9B,MAAO6X,EAAa4B,eACpBC,SAAU,SAAClI,GACP,IAAMtE,EAAUrS,EAAMgd,aAChB8B,EAAWC,SAASpI,EAAEqI,OAAO7Z,OAC7B8Z,EAAOH,EAAWzM,EAAQuM,eAC1BvO,EAASgC,EAAQhC,OACnB4O,EAAO,EACP5O,EAAO/L,SAAQ,SAAC4a,GACZ,IAAK,IAAIjY,EAAI,EAAGA,EAAIgY,EAAMhY,IAAK,CAE3B,IADA,IAAMkY,EAAsB,GACnBC,EAAI,EAAGA,EAAIF,EAAM9B,KAAKlW,OAAQkY,IACnCD,EAAOjf,KAAK,EAAC,IAEjBgf,EAAM5O,MAAMhD,OAAO+E,EAAQuM,eAAgB,EAAGO,OAG/CF,EAAO,GACd5O,EAAO/L,SAAQ,SAAC4a,GACZA,EAAM5O,MAAMhD,OAAOwR,EAAU5M,KAAKmN,IAAIJ,OAG9C5M,EAAQuM,eAAiBE,EACzBhO,EAAWuB,QAAQiN,gBAAgBtf,EAAMgd,eAvBjD,SAyBM,WAEE,IADA,IAAM/D,EAAsB,GACnBhS,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,IAAMsY,EAAMtY,EAAI,EACVuY,EAAaD,EAAMvC,EAAa4B,eACtC3F,EAAK/Y,KACD,wBAEIiF,MAAOoa,EACPlf,UAAWmf,EAAa,MAAQ,GAHpC,SAKKD,GAJItY,IAQjB,OAAOgS,EAfT,KAkBLyF,OC7HHe,GAAiB,SAACpP,EAAwBqP,EAAuBC,EAAmB1P,EAAkBE,GACxG,IAAMnJ,EAAMqJ,EAAwB,GAAjBqP,EAAqB,EAAI,GACtCE,EAAOvP,EAAwB,GAAjBqP,EAAqB,EAAI,GACzCrf,EAAY,GAEhB,GAAI2G,EAAIsJ,MAAMqP,GAAW1P,GAAUE,GAAW,CAC1C9P,EAAY,SACZ,IAAMwf,EAAeC,GAAa9Y,EAAIoW,KAAMnN,EAAUE,GACtDyP,EAAKxC,KAAK9Y,SAAQ,SAACyb,EAAaX,GAC5B,IAAK,IAAIY,EAAI,EAAGA,GAAKD,EAAYxV,OAAS,EAAI,GAAIyV,IAAK,CACnD,IAAMC,EAAYH,GAAaF,EAAKxC,KAAMgC,EAAGY,GACzCJ,EAAKtP,MAAMqP,GAAWP,GAAGY,KAExBE,GAAeL,EAAcI,IAAcC,GAAeD,EAAWJ,MAEtExf,EAAY,eAK5B,OAAOA,GASL6f,GAAiB,SAACC,EAAmBC,GACvC,OAAQD,EAAOE,KAAOF,EAAOvH,MAAQwH,EAAOC,MAAQF,EAAOE,KAAOF,EAAOvH,OAASwH,EAAOC,KAAOD,EAAOxH,OAC/FuH,EAAOE,KAAOD,EAAOC,KAAOD,EAAOxH,OAASuH,EAAOE,MAAQD,EAAOC,MAUxEP,GAAe,SAAC1C,EAAoBnN,EAAkBE,GAExD,IADA,IAAIkQ,EAAO,EACFpZ,EAAI,EAAGA,EAAIgJ,EAAUhJ,IAAK,CAC/B,IAAMuW,EAAUJ,EAAKnW,GACrBoZ,GAAQC,GAAW9C,GAEvB,IAAMO,EAASX,EAAKnN,GAChB2I,EAAQ0H,GAAWvC,GAMvB,OAJIA,EAAOxT,SACP8V,GAAQzH,EAAQ,EAAIzI,EACpByI,GAAgB,GAEb,CAAEyH,OAAMzH,UAgBb0H,GAAa,SAAC9C,GAChB,IAAI+C,EAAO,EACX,OAAQ/C,EAAQjB,KACZ,KAAK5X,EAAiB0Z,KAAMkC,EAAO,GAAI,MACvC,KAAK5b,EAAiByZ,KAAMmC,EAAO,EAAG,MACtC,KAAK5b,EAAiBwZ,KAAMoC,EAAO,EAAG,MACtC,KAAK5b,EAAiBuZ,KAAMqC,EAAO,EAAG,MACtC,KAAK5b,EAAiBsZ,MAAOsC,EAAO,EAKxC,OAHI/C,EAAQjD,SACRgG,GAAQ,KAELA,GAGIC,GArLK,SAACxgB,GAWjB,IAPA,IAAMgd,EAAehd,EAAMgd,aAErBlM,GADc9Q,EAAMygB,YACPzgB,EAAM8Q,YAEnB4P,EAAiC,GARM,WAWpCC,GAKL,IAJA,IAAMC,EAA0B,GAC1B1B,EAAQlC,EAAa3M,OAAOsQ,GAC5BE,EAAa7D,EAAahN,WAAa2Q,EAdJ,WAgBhC1Z,GACL,IAAM6Z,EAA0B,GAChC5B,EAAM9B,KAAK9Y,SAAQ,SAACkZ,EAAS4B,GACzB,IAAI2B,EAAU,GAEd,OAAQvD,EAAQjB,KACZ,KAAK5X,EAAiBwZ,KAAM4C,GAAW,OAAgB,IAAK,MAC5D,KAAKpc,EAAiBuZ,KAAM6C,GAAW,OAAgB,IAAK,MAC5D,KAAKpc,EAAiBsZ,MAAO8C,GAAW,QAAiB,KAAM,MAC/D,KAAKpc,EAAiByZ,KAAM2C,GAAW,OAAgB,IAAK,MAC5D,KAAKpc,EAAiB0Z,KAAM0C,GAAW,OAAgB,IAEvDvD,EAAQjD,SACRwG,GAAW,SAKf,IAFA,IAAMC,EAAyB,GACzBC,EAASzD,EAAQjT,OAAS,EAAI,EAfL,WAgBtByV,GACL,IAAMkB,EAAczB,GAAezC,EAAa3M,OAAQsQ,EAAG1Z,EAAGmY,EAAGY,GAC/C,WAAfkB,IACY,EAEfF,EAAQ9gB,KACJ,qBAEIG,UAAW,CACP6gB,EACC1D,EAAQjT,OAAS,OAAS,IAC7BjK,KAAK,KACPC,QAAS,WACLuQ,EAAWuB,QAAQ8O,aAAala,EAAGmY,EAAGY,KANrCA,KAPRA,EAAI,EAAGA,EAAIiB,EAAQjB,IAAM,EAAzBA,GAkBTc,EAAS5gB,KACL,qBAEIG,UAAW0gB,EAFf,SAIKC,GAHI5B,OAOjBwB,EAAS1gB,KACL,qBAAaG,UAAU,OAAvB,SACKygB,GADK7Z,KA9CTA,EAAI+V,EAAa4B,eAAiB,EAAG3X,GAAK,EAAGA,IAAM,EAAnDA,GAmDTyZ,EAAgBxgB,KACZ,qBAEIG,UACIwgB,EAAa,MAAQ,OAH7B,SAMKD,GALID,KA1DRA,EAAI,EAAGA,EAAI,EAAGA,IAAM,EAApBA,GAqET,OACI,qBAAKtgB,UAAU,SAAf,SACKqgB,KCvBEU,GA9DM,SAACphB,GAElB,IAAMqhB,EAAWrhB,EAAMkf,MACjBlC,EAAehd,EAAMgd,aACrBsE,EAA6F,GAA5EtE,EAAa1T,QAAU0T,EAAazT,WAAayT,EAAaxT,YAG/E+X,EAA8B,GAChCC,EAAgB,EACpBH,EAASjE,KAAK9Y,SAAQ,SAACkZ,EAASvW,GAC5B,IAAIwa,EAAM,EACV,OAAQjE,EAAQjB,KACZ,KAAK5X,EAAiB0Z,KAAMoD,EAAM,GAAI,MACtC,KAAK9c,EAAiByZ,KAAMqD,EAAM,EAAG,MACrC,KAAK9c,EAAiBwZ,KAAMsD,EAAM,EAAG,MACrC,KAAK9c,EAAiBuZ,KAAMuD,EAAM,EAAG,MACrC,KAAK9c,EAAiBsZ,MAAOwD,EAAM,EAEnCjE,EAAQjD,SACRkH,GAAO,KAEXD,GAAiBC,KAGrB,IAAMC,EAAUF,EAAgBF,EAChCE,EAAkBE,EAA0BF,EAAhBF,EAC5B,IA1B+C,eA0BtCra,GACL,IAAMwG,EAAMxG,EAA+B,EAA1B+V,EAAazT,WAa9BgY,EAAarhB,KAAK,qBAAaG,UAXvBoN,EAAM,GAAK,EACPA,EAAM,GAAK,EACJ,OAEA,OAGJ,SAIaxG,KAdvBA,EAAI,EAAGA,EAAIua,EAAeva,IAAM,EAAhCA,GAiBT,IAAM0a,EAA4B,GAAhBL,EACZM,EAAYF,EAMb,qBAAK5K,MAAO,CACTrP,KAAK,GAAD,OAAKka,EAAL,MACJ/I,MAAM,GAAD,OAAuC,IAAjC4I,EAAgBF,GAAtB,OACNjhB,UAAU,SARZ,qBAAKyW,MAAO,CACTrP,KAAK,GAAD,OAAKka,EAAL,MACJ/I,MAAO,OACRvY,UAAU,SAMjB,OACI,sBAAKA,UAAU,UAAf,UACKkhB,EACAK,MCuJEC,GArMM,SAAC7hB,GAalB,IAXA,IAAMgd,EAAehd,EAAMgd,aACrBhN,EAAYgN,EAAahN,UACzBqR,EAAWrE,EAAa3M,OAAOL,GAC/Bc,EAAa9Q,EAAM8Q,WACnB2P,EAAczgB,EAAMygB,YACpBqB,EAAgB9hB,EAAM8hB,cAGtBC,EAAgC,GAEhCC,EAAchF,EAAa4B,eAAiB6B,EAAYvZ,OAZf,WAatCD,GAEL,IAAMgb,EAAWhb,EAAI+a,EAEfE,EAAUD,GAAY,EACxBE,EAAgB,IAChBD,IACAC,EAAgB1B,EAAYwB,GAAUE,eAE1CJ,EAAe7hB,KACX,gCACI,qBACIG,UAAW,CACP,UACC6hB,EAAoB,GAAV,SACb5hB,KAAK,KACPC,QAAS,WACD2hB,GACAJ,EAAcK,IAP1B,SAWI,+BAAOA,MAEX,qBACI9hB,UAAW,CACP,MACqC,GAArCL,EAAMgd,aAAa4B,eAAsB,UAAY,IACvDte,KAAK,KACPC,QAAS,WACL,IAAM8R,EAAUrS,EAAMgd,aAChB3M,EAASgC,EAAQhC,OACjB/O,EAAQ+Q,EAAQuM,gBAAkB3X,EAAI,GAC5CoJ,EAAO/L,SAAQ,SAAC4a,GACZA,EAAM5O,MAAMhD,OAAOhM,EAAO,MAE9B+Q,EAAQuM,eAAiBvM,EAAQuM,eAAiB,EAClD9N,EAAWuB,QAAQiN,gBAAgBtf,EAAMgd,eAbjD,SAgBI,uCAEJ,qBACI3c,UAAW,CACP,MACqC,IAArCL,EAAMgd,aAAa4B,eAAuB,UAAY,IACxDte,KAAK,KACPC,QAAS,WACL,IAAM8R,EAAUrS,EAAMgd,aAChB3M,EAASgC,EAAQhC,OACjB/O,EAAQ+Q,EAAQuM,gBAAkB3X,EAAI,GAC5CoJ,EAAO/L,SAAQ,SAAC4a,GAEZ,IADA,IAAMC,EAAsB,GACnBC,EAAI,EAAGA,EAAIF,EAAM9B,KAAKlW,OAAQkY,IACnCD,EAAOjf,KAAK,EAAC,IAEjBgf,EAAM5O,MAAMhD,OAAOhM,EAAO,EAAG6d,MAEjC9M,EAAQuM,eAAiBvM,EAAQuM,eAAiB,EAClD9N,EAAWuB,QAAQiN,gBAAgBtf,EAAMgd,eAjBjD,SAoBI,yCApDE/V,KAVTA,EAAI,EAAGA,EAAI+V,EAAa4B,eAAgB3X,IAAM,EAA9CA,GAqET,IAAMmW,EAAsB,GACtBgF,EAA4B,GA2ClC,OA1CAf,EAASjE,KAAK9Y,SAAQ,SAACkZ,EAASvW,GAC5B,IACI8Z,EADe/D,EAAaE,kBAAoBjW,EACzB,UAAY,GACnCgH,EAAQ,GACZ,OAAQuP,EAAQjB,KACZ,KAAK5X,EAAiBwZ,KAAM4C,GAAW,OAAQ9S,EAAQ,IAAK,MAC5D,KAAKtJ,EAAiBuZ,KAAM6C,GAAW,OAAQ9S,EAAQ,IAAK,MAC5D,KAAKtJ,EAAiBsZ,MAAO8C,GAAW,QAAS9S,EAAQ,KAAM,MAC/D,KAAKtJ,EAAiByZ,KAAM2C,GAAW,OAAQ9S,EAAQ,IAAK,MAC5D,KAAKtJ,EAAiB0Z,KAAM0C,GAAW,OAAQ9S,EAAQ,IAEvDuP,EAAQjD,SACRtM,GAAS,KACT8S,GAAW,SAEXvD,EAAQjT,SACR0D,GAAS,MAEbmP,EAAKld,KACD,qBAEIG,UAAW0gB,EACXxgB,QAAS,WACLuQ,EAAW2M,mBAAX,2BACOT,GADP,IAEIE,iBAAkBjW,MAN9B,SASI,+BAAOgH,KARFhH,IAWb,IAAM+C,EAASqX,EAAS/D,KAAKrW,GAC7Bmb,EAAWliB,KACP,qBAEIG,UAAW0gB,EAFf,SAII,qBAAKjK,MAAO,CAAE+B,OAAkB,GAAT7O,EAAe,QAHjC/C,OASb,sBAAK5G,UAAW,CACZ,gBACA2c,EAAaqF,cAAgB,GAAK,WACpC/hB,KAAK,KAHP,UAII,qBAAKD,UAAU,SAAf,SACI,cAAC,GAAD,CACIyQ,WAAYA,EACZkM,aAAcA,MAGtB,sBAAK3c,UAAU,QAAf,UACI,sBAAKA,UAAU,QAAf,UACI,wBACIA,UAC8B,GAA1B2c,EAAahN,UAAiB,SAAW,GAE7CzP,QAAS,WACLuQ,EAAWuB,QAAQiQ,cAAc,IALzC,SAQI,6CAEJ,wBACIjiB,UAC8B,GAA1B2c,EAAahN,UAAiB,SAAW,GAE7CzP,QAAS,WACLuQ,EAAWuB,QAAQiQ,cAAc,IALzC,SAQI,gDAGR,qBAAKjiB,UAAU,SAAf,SACK0hB,IAEL,qBAAK1hB,UAAU,QAAf,SACI,wBACIA,UACI2c,EAAauF,WAAa,SAAW,GAEzChiB,QAAS,WACLuQ,EAAWuB,QAAQmQ,aAAaxF,EAAauF,aALrD,SAQI,gDAIZ,sBAAKliB,UAAU,OAAf,UACI,qBAAKA,UAAU,QAAf,SACK+c,IAEL,cAAC,GAAD,CACIJ,aAAcA,EACdkC,MAAOmC,IAEX,cAAC,GAAD,CACIrE,aAAcA,EACdyD,YAAaA,EACb3P,WAAYA,IAEhB,qBAAKzQ,UAAU,SAAf,SACK+hB,W,gBC/MEK,KAAOC,IAAV,iMAOI,SAAC1iB,GAAD,OAAWA,EAAM2iB,mBAE1B,SAAC3iB,GAAD,OAAWA,EAAM4iB,WAClB,SAAC5iB,GAAD,OAAWA,EAAM6iB,UACb,SAAC7iB,GAAD,OAAWA,EAAM8iB,aAG3BC,aAAe,CACnBJ,gBAAiB,UACjBG,UAAW,UACXF,QAAS,IACTC,OAAQ,KAGSJ,KAAOC,IAAV,iDACH,SAAC1iB,GAAD,OAAgCA,EAAMgjB,WAD9C,IAIMC,GAAQR,KAAOS,KAAV,4FAKD,SAACljB,GAAD,OAAUA,EAAMmjB,YACpB,SAACnjB,GAAD,OAAUA,EAAMwZ,SACV,SAACxZ,GAAD,OAAUA,EAAMojB,cAEnCH,GAAMF,aAAe,CACjBI,SAAU,UACV3J,MAAO,UACP4J,WAAY,WCpCT,I,wKA0IQC,GA1Ia,SAACrjB,GAQzB,IAAIA,EAAMgd,aAAasG,cACnB,OAAO,6BAEX,IAAMxT,EAAc9P,EAAMgd,aAAalN,YAEjCyT,EAA6B,GAKnCzT,EAAY0T,MAAK,SAACC,EAAGC,GACjB,OAAmB,GAAXD,EAAEE,OAAcF,EAAEG,aAA2B,GAAXF,EAAEC,OAAcD,EAAEE,gBAGhE,IADA,IAAMC,EAAkB/T,EAAY1C,MAAMpN,EAAMgd,aAAa4B,gBAd3D,WAeO3X,GAEL,IAAMsJ,EAAQtJ,EAAIjH,EAAM8jB,QAAQ5c,OAC1B6c,EAAsB,GAC5B,GAAIxT,EAAO,CACP,IAAMyT,EAAYhkB,EAAM8jB,QAAQ7c,GAE1B3F,EADStB,EAAM8jB,QAAQ5c,OAASlH,EAAMqE,OAAO0C,UAAUG,QAAU,EAChDD,EAAI,EAAIA,EACzBuV,GAAqB,GAAVlb,GAAe,EAAItB,EAAMqE,OAAO0C,UAAUzF,GACrDuR,GAAqB,GAAVvR,EAAc,MAAQtB,EAAMqE,OAAO8C,OAAO7F,GAE3DyiB,EAAK7jB,KACD,qBAAaG,UAAU,QAAvB,SACI,iCAAOwS,EAAP,IAAkB2J,EAAlB,MAA8B,cAACyG,GAAD,CAAOzJ,MAAM,OAAb,SAAqBwK,QAD7C,IAKd,IAbO,eAaE5E,GAEL,IAAM6E,EAAajkB,EAAM4D,YAAc4Y,EAAe,GAAJ4C,EAC5CuE,EAASzR,KAAKgS,MAAMD,EAAa,IACjC9B,EAAgB6B,EAAYL,EAC5BQ,EAASF,EAAa,GAAKA,GAAc,GAC3CpP,GAAa,EACjB/E,EAAYxL,SAAQ,SAAC8f,GACbA,EAAQT,QAAUvE,GAAKgF,EAAQR,aAAe3c,IAC9C4N,GAAa,MAKrB,IAAM6M,EAAU5R,EAAY5I,QAAU,KAAO2N,EASzCwP,GAAgB,EACpBR,EAAgBvf,SAAQ,SAAC8f,GACjBA,EAAQT,QAAUvE,GAAKgF,EAAQR,aAAe3c,IAC9Cod,GAAgB,MAIxBN,EAAK7jB,KACD,qBAEIG,UAAW,CACP,MACC8jB,GAAUzC,EAAU,UAAY,GAChC7M,EAAa,SAAW,GACxBwP,EAAgB,OAAS,IAC5B/jB,KAAK,KACPC,QAAS,WACL,IAAM0Y,EAAOjZ,EAAMgd,aAAalN,YAChC,GAAK+E,EAEE,CACH,IAAIpH,GAAO,EACXwL,EAAK3U,SAAQ,SAAC8f,EAAS9iB,GACf8iB,EAAQT,QAAUvE,GAAKgF,EAAQR,aAAe3c,IAC9CwG,EAAMnM,MAGd2X,EAAK3L,OAAOG,EAAK,QARjBwL,EAAK/Y,KAAK,CAAEyjB,OAAQvE,EAAGwE,YAAa3c,IAUxCgS,EAAKuK,MAAK,SAACC,EAAGC,GAGV,OAFwB,EAAXD,EAAEE,OAAaF,EAAEG,aACN,EAAXF,EAAEC,OAAaD,EAAEE,gBAGlC5jB,EAAMgd,aAAalN,YAAcmJ,EACjCjZ,EAAMskB,eAAetkB,EAAMgd,aAAalN,cAE5C4G,cAAe,WACX1W,EAAM8hB,cAAcK,IA9B5B,SAiCI,+BAAQgC,EAAyB,IAAhBhC,KAhCZ/C,EAAI,KAhCZA,EAAI,EAAGA,EAxBN,EAwBqBA,IAAM,EAA5BA,OAoEN,CAEH2E,EAAK7jB,KACD,qBAAaG,UAAU,SAAb,IAEd,IAAK,IAAI+e,EAAI,EAAGA,EAjGN,EAiGqBA,IAC3B2E,EAAK7jB,KACD,qBAAiBG,UAAU,OAAjB+e,EAAI,IAI1BmE,EAAYrjB,KACR,qBAEIG,UACI,UACEkQ,EAAqB,GAAb,YAJlB,SAOKwT,GANI9c,KAlGRA,EAAI,EAAGA,EARO,EAQaA,IAAM,EAAjCA,GA6GT,OACI,qBAAK5G,UAAU,eAAf,SACKkjB,KCvHAgB,GAAiBC,wBAAc,IAuLtCC,GAAiB,SAAC3U,EAA6BlM,EAAqBS,EAAsByf,GAK5F,IAHA,IAAMrD,EAA6B,GAF8F,WAKxHxZ,GAEL,IAP6H,eAOpHmY,GAEL,IAAM6E,EAAargB,EAAcS,EAAO0C,UAAUE,GAAS,GAAJmY,EACnDvK,GAAa,EACjB/E,EAAYxL,SAAQ,SAAC8f,GACbA,EAAQT,QAAUvE,GAAKgF,EAAQR,aAAe3c,IAC9C4N,GAAa,MAGrB,IAAM8O,EAASzR,KAAKgS,MAAMD,EAAa,IACjC9B,EAAgB2B,EAAQ7c,GAAK0c,EAC/B9O,GACA4L,EAAYvgB,KAAK,CAAE+jB,aAAY9B,mBAZ9B/C,EAAI,EAAGA,EAHF,EAGiBA,IAAM,EAA5BA,IAFJnY,EAAI,EAAGA,EAAI5C,EAAO0C,UAAUG,OAAQD,IAAM,EAA1CA,GAsBT,OAHAwZ,EAAY+C,MAAK,SAACC,EAAGC,GACjB,OAAOA,EAAEO,WAAaR,EAAEQ,cAErBxD,GAGIiE,GAnNO,WAAO,IAAD,EAEgB9T,qBAAWC,IAA3CjE,EAFgB,EAEhBA,MAAO4H,EAFS,EAETA,SAAU1D,EAFD,EAECA,WAKnB4D,EAAMC,iBAAO,IAanB,GAZA3T,qBAAU,WAENwT,EAASpN,GAAWuH,2BAA4B,CAAEL,OAAQoG,EAAIE,YAC/D,IASChI,EAAMvE,UAAUS,eAAiBtE,EAAcmgB,gBAC/C,OAAQ,6BAEZ,IAAMja,EAAYkC,EAAMvE,UAAUK,WAAa7D,EAAS6T,QAClDsE,EAAepQ,EAAMvE,UAAUoB,oBAS/BL,EAAW4T,EAAa5T,SACxBC,EAAc2T,EAAa3T,YAC3BhF,EAAoB,eAASD,EAAgB4Y,EAAanZ,YAC1DyF,EAAU0T,EAAa1T,QACvBC,EAAayT,EAAazT,WAC1BC,EAAawT,EAAaxT,WAG5BmI,EADS7P,EAAiBsH,EAAS3D,WAChBpB,EAAO5D,KACxBqjB,EAAoB,GAEP,MAAfza,IAGAsI,GAAS,WAAQrM,EAAa+D,EAAa,IAG3C7C,EAAanC,EAAQ+E,EAAS3D,UAAW4D,EAAY5D,YAEzDpB,EAAO0C,UAAUzC,SAAQ,SAACa,GAEtB2e,EAAQ5jB,KAAK4B,GAAkBsH,EAAS3D,UAAYN,GAAS,QAGjE,IAAMsb,EAAcgE,GAAezH,EAAalN,YAAa1G,EAAS3D,UAAWpB,EAAQyf,GAEnFhC,EAAgB,SAACK,GACnBvV,EAAMT,QAAQyY,cAAczC,EAAe,KAAM,KACjD0C,YAAW,WACPjY,EAAMT,QAAQ2Y,eAAe3C,KAC9B,MAGH4C,EAAyB,WA8C7B,OA7CAA,EAAa,qCACT,qBAAK1kB,UAAW,CACZqK,EAAY,UAAY,IAC1BpK,KAAK,KACHC,QAAS,WACLiU,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,QAJnE,SAMI,4CAEJ,qBACI1I,UAAW,CACN2c,EAAagI,UAAwB,GAAZ,WAC5B1kB,KAAK,KACPC,QAAS,WACAmK,EAGDoG,EAAWmU,QAAQC,OAFnBpU,EAAWuB,QAAQ8S,MAAK,IANpC,SAWI,+BAAQza,EAAqB,OAAT,WAExB,qBACIrK,UAAW,CACPqK,IAAcsS,EAAagI,UAAY,UAAY,IACrD1kB,KAAK,KACPC,QAAS,WACL,OAAQyc,EAAagC,QACjB,IAAK,OACDlO,EAAWuB,QAAQ+S,sBAEnB,MACJ,IAAK,gBACDtU,EAAWuU,MAAMC,sBAEjB,MACJ,IAAK,gBACDxU,EAAWuU,MAAME,wBAfjC,SAoBI,+CAIJ,cAAChB,GAAeiB,SAAhB,CAAyBrgB,MAAO,CAC5B0K,YAAamN,GADjB,SAKI,sBACItI,IAAKA,EAELrU,UAAW,CACP,kBACA,WACAuM,EAAMvE,UAAUS,eAAiBtE,EAAcmgB,gBAAkB,UAAY,IAC/ErkB,KAAK,KAGPC,QAAS,aAVb,UAaI,sBAAKF,UAAU,YAAf,UACI,sBAAKA,UAAW,CACZ,SACA2c,EAAasG,cAAgB,GAAK,UACpChjB,KAAK,KAHP,UAII,qBAAKD,UAAU,QAAf,SAAuB,4CACvB,qBAAKA,UAAU,QAAf,SAAuB,+BAAOsR,SAElC,sBAAKtR,UAAW,CACZ,SACA2c,EAAasG,cAAgB,GAAK,UACpChjB,KAAK,KAHP,UAII,qBAAKD,UAAU,QAAf,SAAuB,+CACvB,qBAAKA,UAAU,QAAf,SAAuB,+BAAO2D,EAAkBK,EAAO3B,iBAE3D,sBAAKrC,UAAW,CACZ,SACA2c,EAAasG,cAAgB,GAAK,UACpChjB,KAAK,KAHP,UAII,qBAAKD,UAAU,QAAf,SAAuB,6CACvB,qBAAKA,UAAU,QAAf,SAAuB,+BAAOyjB,EAAQxjB,KAAK,aAE/C,sBAAKD,UAAU,SAAf,UACI,qBAAKA,UAAU,QAAf,SAAuB,8CACvB,qBAAKA,UAAU,QAAf,SAAuB,+BAAOiJ,EAAUC,EAAaC,YAG7D,cAAC,GAAD,CACIwT,aAAcA,EACd8G,QAASA,EACTzf,OAAQA,EACRT,YAAawF,EAAS3D,UACtBqc,cAAeA,EACfwC,eAAgB,SAACxU,GAAD,OAAiCgB,EAAWwT,eAAexU,MAE/E,cAAC,GAAD,CACI2Q,YAAaA,EACbzD,aAAcA,EACdlM,WAAYA,EACZgR,cAAeA,IAGnB,qBAAKzhB,UAAU,YAAf,SACK0kB,UCxLfU,I,MAAc,KAoIdC,IAlIYjD,KAAOC,IAAV,qFAkIM,SAACvd,GAClB,IAAIC,EAAM,GAKV,OAJa,GAATD,IACeC,EAAXD,EAAQ,EAAS,MACV,OAERC,IAGIugB,GApIW,WAAO,IAAD,EAEE/U,qBAAWC,IAAjCjE,EAFoB,EAEpBA,MACFzE,GAHsB,EAEb2I,WACElE,EAAM/E,SAASM,UAC1BI,EAAaqE,EAAMvE,UAAUE,WAC7Bqd,EAAYhZ,EAAM/E,SAASM,SAASjB,OAGpC2e,EAAYlR,iBAAO,IARG,EAUY9T,mBAAS,IAVrB,mBAUrBilB,EAVqB,KAUPC,EAVO,OAWgBllB,mBAAS,IAXzB,mBAWrBmlB,EAXqB,KAWLC,EAXK,OAYFplB,mBAAS,GAZP,mBAYrBqlB,EAZqB,KAYdC,EAZc,KActBC,EAAcje,EAASI,GAAYuE,MAAQ7H,EAAgBiM,MAC5D/I,EAASI,GAAY8E,OAAyB,KAC7C/D,EAAyB,MAAf8c,EAAsB,EAAIA,EAAY9c,QAChDC,EAA4B,MAAf6c,EAAsB,EAAIA,EAAY7c,WACnDC,EAA4B,MAAf4c,EAAsB,EAAIA,EAAY5c,WAsFzD,GArFAxI,qBAAU,WACN,IAAIklB,EAAQ,EACNJ,EAA8B,GAC9BE,EAAgC,GACrBpZ,EAAM/E,SAASM,SAEvB7D,SAAQ,SAACC,EAAM0C,GAYpB,GAVI1C,EAAKuI,MAAQ7H,EAAgB2I,MAC7BkY,EAAa5lB,KACT,qBAEIG,UAAW,GACTC,KAAK,KACPwW,MAAO,CAAE8B,MAAM,GAAD,OAAK6M,GAAL,QAHTK,EAAa5e,SAO1B3C,EAAKuI,MAAQ7H,EAAgBiM,MAAO,CACpC,IAAM7D,EAAS9I,EAAK8I,OACdkP,EAAMlP,EAAO/D,QAAU+D,EAAO9D,WAAa8D,EAAO7D,WAClDoP,EAlDJ,GAkDY2D,EAAkB,EAC1B8J,EAAQ9d,GAActB,EACtBqf,EAAS/d,GAActB,EAAI,GAAKsB,GAActB,EAAI,EACxD6e,EAAa5lB,KACT,sBAEIG,UAAW,CACPgmB,EAAQ,SAAW,GACnBC,EAAS,OAAS,IACpBhmB,KAAK,KACPwW,MAAO,CAAE8B,MAAM,GAAD,OAAKA,EAAQ,EAAb,OANlB,UAQI,qBAAKvY,UAAU,MAAf,SACI,+BAAOgN,EAAO/D,YAElB,sBAAKjJ,UAAU,SAAf,UACI,sBAAMA,UAAWqlB,GAAarY,EAAO9D,YAArC,SACKrE,EAAkBmI,EAAO9D,cAE9B,sBAAMlJ,UAAWqlB,GAAarY,EAAO7D,YAArC,SACKtE,EAAkBmI,EAAO7D,mBAf7Bsc,EAAa5e,SAoBtBmf,GACAR,EAAUjR,QAAQ2R,SAAS,CAAE9e,KA5E/B,GA4EqCye,EAAoBT,GAAae,SAAU,WAElFN,GAAe,EAAN3J,MAOjB,IAAK,IAAItV,EAAI,EAAGA,EAAIif,EAAOjf,IAAK,CAC5B,IAAIxG,EAAO,GAGLqR,EAAW,EAAK7K,EAAI,GAC1B,GAHcA,EAAI,IAAM,EAIpBxG,EAAO,eAEP,OAAQwG,EAAI,GACR,KAAK,EAAGxG,EAAO,OAAQ,MACvB,KAAK,EAAGA,EAAO,OAAQ,MACvB,QAASA,EAAO,QAGxBulB,EAAe9lB,KACX,qBAAiCG,UAAWI,EAAMqW,MAAO,CAAErP,KAAK,GAAD,OAAKge,GApGlE,GAoGgFxe,EAAnB,OAA/D,SACIA,EAAI,IAAM,EACN,qBAAK5G,UAAU,MAAMyW,MAAO,CAAErP,KAAK,GAAD,QAAM,GAAN,MAAcC,IAAK,QAArD,SAAgEoK,IAEhE,8BAJEkU,EAAe9e,SASjC6e,EAAgBD,GAChBG,EAAkBD,GAClBG,EAASD,KACV,CAACN,EAAWrd,EAAYe,EAASC,EAAYC,IAE7B,MAAf4c,EACA,OAAQ,6BAGZ,IAAMK,EAAahB,IAtHL,GAsHuBS,EACrC,OACI,qBAAKjlB,GAAG,gBAAgBZ,UAAU,eAAlC,SACI,sBAAKA,UAAU,SAASqU,IAAKmR,EAA7B,UACI,qBAAKxlB,UAAU,SAASyW,MAAO,CAAE8B,MAAM,GAAD,OAAK6N,EAAL,OAAtC,SACKX,IAEL,qBAAKzlB,UAAU,UAAUyW,MAAO,CAAE8B,MAAM,GAAD,OAAK6N,EAAL,OAAvC,SACKT,UCONU,I,MAvIa,WAAO,IAAD,EAEA9V,qBAAWC,IAAjCjE,EAFsB,EAEtBA,MAAOkE,EAFe,EAEfA,WAFe,EAIJjQ,oBAAkB,GAJd,mBAIvB8lB,EAJuB,KAIfC,EAJe,OAKY/lB,mBAAiB,KAL7B,mBAKvBkJ,EALuB,KAKR8c,EALQ,KAUxBtL,GAHW3O,EAAM/E,SAASM,SACbyE,EAAMvE,UAAUE,WACjBqE,EAAM/E,SAASM,SAASjB,OAC7B0F,EAAMvE,UAAUsB,cAiB7B,OAfA3I,qBAAU,WACN4lB,GAASrL,EAAK1R,MAAMid,UACrB,CAACvL,EAAK1R,MAAMid,SAcX,sBAAK7lB,GAAG,kBAAkBZ,UAAU,eAApC,UACI,sBAAKA,UAAW,CACZ,cACAkb,EAAKtR,OAAS,UAAY,IAC5B3J,KAAK,KAHP,UAII,uBAAOwM,KAAK,OAAO3H,MAAOoW,EAAK3R,QAASiV,SAAU,SAAClI,GAC/C4E,EAAK3R,QAAU+M,EAAEqI,OAAO7Z,MACxB2L,EAAWmE,MAAM8R,aAAjB,2BACOna,EAAMvE,WADb,IACwBsB,aAAc4R,QAG1C,uBAAOzO,KAAK,OAAO+R,SAAU,SAAClI,GAC1B,GAAsB,MAAlBA,EAAEqI,OAAOgI,OAAsC,MAArBrQ,EAAEqI,OAAOgI,MAAM,GAAY,CACrD,IAAMC,EAAYC,OAAOC,IAAIC,gBAAgBzQ,EAAEqI,OAAOgI,MAAM,IAC5DzL,EAAK3R,QAAUqd,EACfnW,EAAWmE,MAAM8R,aAAjB,2BACOna,EAAMvE,WADb,IACwBsB,aAAc4R,YAKlD,sBAAKlb,UAAW,CACZ,gBACAkb,EAAKtR,OAAS,UAAY,IAC5B3J,KAAK,KAHP,UAII,uBAAOwM,KAAK,OAAO3H,MAAO4E,EAAe8U,SAAU,SAAClI,GAChDkQ,EAAiBlQ,EAAEqI,OAAO7Z,UAE9B,uBAAO2H,KAAK,QAAQua,IAAK,EAAGC,IAAK,IAAKniB,MAAOoW,EAAKvR,OAAQ6U,SAAU,SAAClI,GACjE4E,EAAKvR,OAASud,OAAO5Q,EAAEqI,OAAO7Z,OAC9B2L,EAAWmE,MAAM8R,aAAjB,2BACOna,EAAMvE,WADb,IACwBsB,aAAc4R,QAG1C,wBACIlb,UAAW,CACPsmB,EAAS,UAAY,IACvBrmB,KAAK,KACPC,QAAS,WACL,GAAqB,KAAlBwJ,EACH,IACIwR,EAAKxR,cAAgBwd,OAAOxd,GAC5BwR,EAAKtR,QAAS,EACd,IAAMJ,EAAQ,IAAIC,MAClBD,EAAM2d,QAAU,WACZjM,EAAKtR,QAAS,EACd6G,EAAWmE,MAAM8R,aAAjB,2BACOna,EAAMvE,WADb,IACwBsB,aAAc4R,MAG1C1R,EAAM2B,IAAM+P,EAAK3R,QACjBC,EAAM4d,YAAmC,KAArBlM,EAAKxR,cACzBF,EAAMG,OAAuB,IAAduR,EAAKvR,OACpBuR,EAAK1R,MAAQA,EACbiH,EAAWmE,MAAM8R,aAAjB,2BACOna,EAAMvE,WADb,IACwBsB,aAAc4R,KAExC,MAAO5E,GACL4E,EAAKtR,QAAS,EACd6G,EAAWmE,MAAM8R,aAAjB,2BACOna,EAAMvE,WADb,IACwBsB,aAAc4R,OA1BlD,sBA+BJ,sBAAKlb,UAAW,CACZ,SACCkb,EAAKtR,OAAqB,GAAZ,WACjB3J,KAAK,KAHP,UAII,wBACID,UAAW,CACPsmB,EAAS,UAAY,IACvBrmB,KAAK,KACPC,QAAS,WACLgb,EAAK1R,MAAQ,IAAIC,MACjByR,EAAKtR,QAAS,EACd6G,EAAWmE,MAAM8R,aAAjB,2BACOna,EAAMvE,WADb,IACwBsB,aAAc4R,MAR9C,oBAWA,wBACIlb,UAAW,CACPsmB,EAAS,UAAY,IACvBrmB,KAAK,KACPC,QAAS,WACLgb,EAAK1R,MAAMsb,OACXyB,GAAQ,IANhB,kBAQA,wBACIvmB,UAAW,CACNsmB,EAAqB,GAAZ,WACZrmB,KAAK,KACPC,QAAS,WACLgb,EAAK1R,MAAM6d,QACXd,GAAQ,IANhB,kBAQA,wBACIvmB,UAAW,GACTC,KAAK,KACPC,QAAS,WACLgb,EAAK1R,MAAM4d,YAAmC,KAArBlM,EAAKxR,eAJtC,2BC/FD4d,GA3BI,WAAO,IAAD,EAES/W,qBAAWC,IAAjCjE,EAFa,EAEbA,MACFgb,GAHe,EAEN9W,WACClE,EAAM/E,SAASM,SAASyE,EAAMvE,UAAUE,YAAYuE,MAH/C,EAKuBjM,mBAAiB,GALxC,mBAKdgnB,EALc,KAKEC,EALF,KAYrB,OALA9mB,qBAAU,WACH4mB,GACCE,EAAkBF,IAAY3iB,EAAgB2I,KAAO,EAAI,KAE9D,CAAChB,EAAMvE,UAAUE,aAEhB,qBAAKtH,GAAG,eAAR,SACI,cAAC,EAAD,CAAYC,UAAU,aAClBC,YAAa,CACT,CAAEV,KAAM,WAAYc,SAAS,EAAMZ,KAAM,cAAC,GAAD,KACzC,CAAEF,KAAM,SAAUc,SAAS,EAAMZ,KAAM,yBACvC,CAAEF,KAAM,WAAYc,SAAS,EAAMZ,KAAM,cAAC,GAAD,MAE7CG,SAAU+mB,OCmHXE,I,MAvII,WAAO,IAAD,EAEmBnX,qBAAWC,IAA3CjE,EAFa,EAEbA,MAAO4H,EAFM,EAENA,SAAU1D,EAFJ,EAEIA,WAFJ,EAIKjQ,mBAAS,IAJd,mBAIdgN,EAJc,KAIPma,EAJO,OAKKnnB,mBAAS,OALd,mBAKdiN,EALc,KAKPma,EALO,OAMMpnB,mBAAS,GANf,mBAMd2E,EANc,KAMJ0iB,EANI,OAOKrnB,mBAAS,SAPd,mBAOdkN,EAPc,KAOPoa,EAPO,KASfzT,EAAMC,iBAAO,IACnB3T,qBAAU,WAENwT,EAASpN,GAAWmH,yBAA0B,CAAED,OAAQoG,EAAIE,YAC7D,IAEH5T,qBAAU,WACN,GAAG4L,EAAMvE,UAAUS,gBAAkBtE,EAAcqS,aAAc,CAC7D,IAAMuR,EAAWxb,EAAMH,aACvBqE,EAAW8F,gBAAgB,MAC3BoR,EAASI,EAASva,OAClBoa,EAASG,EAASta,OAClBoa,EAAOE,EAAS5iB,UAChB2iB,EAASC,EAASra,UAEvB,CAACnB,EAAMvE,UAAUS,gBAMpB,IAAIic,EAAyB,WAC7BA,EAAa,qCACT,qBACIxkB,QAAS,WACLiU,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,QAFnE,SAII,4CAEJ,qBACIxI,QAAS,WACLuQ,EAAWQ,KAAK+W,aAAaxa,EAAOC,EAAOtI,EAAUuI,IAF7D,SAII,8CAMR,IAAuBE,EAwBjBqa,EAAkB,SAACra,EAAe9I,EAAe8V,EACnDhC,GACA,IAAMsP,EAA4B,GAMlC,OALAtP,EAAK3U,SAAQ,SAACC,GACVgkB,EAAWroB,KACP,wBAAgCiF,MAAOZ,EAAKY,MAA5C,SAAoDZ,EAAKikB,SAA5CD,EAAWrhB,YAI5B,sBAAK7G,UAAU,OAAf,UACI,qBAAKA,UAAU,QAAf,SACI,+BAAO4N,MAEX,qBAAK5N,UAAU,QAAf,SACI,wBACI8E,MAAOA,EACP0Z,SAAU,SAAClI,GACPsE,EAAStE,EAAEqI,OAAO7Z,QAH1B,SAMKojB,UAMfrO,EAAWtN,EAAM/E,SAASE,WAAanD,EAAW2N,OACxD,OACI,sBACItR,GAAG,cACHZ,UAAW,YAAcuM,EAAMvE,UAAUS,eAAiBtE,EAAcqS,aAAe,UAAY,IACnGtW,QAAS,aAHb,UAMI,sBAAKF,UAAU,QAAf,WA1De4N,EA2DI,QAzDnB,sBAAK5N,UAAU,OAAf,UACI,qBAAKA,UAAU,QAAf,SACI,+BAAO4N,MAEX,sBAAK5N,UAAU,QAAf,UAEI,uBACIyM,KAAK,SAAS3H,MAAO0I,EAAOwZ,IAAI,KAAKC,IAAI,MACzCzI,SAAU,SAAClI,GACPqR,EAAST,OAAO5Q,EAAEqI,OAAO7Z,WAGjC,uBACI2H,KAAK,QAAQrM,KAAK,QAAQ4mB,IAAI,KAAKC,IAAI,MAAMniB,MAAO0I,EACpDgR,SAAU,SAAClI,GACPqR,EAAST,OAAO5Q,EAAEqI,OAAO7Z,kBA2CpCmjB,EAAgB,OAAQxa,GAAO,SAAC3I,GAAoB8iB,EAAS9iB,KAC1DjD,EAAWd,KAAI,SAAAqnB,GAAU,MAAO,CAAEtjB,MAAOsjB,EAAMD,QAASC,OAE3DvO,EAAW,6BACRoO,EAAgB,QAASva,GAAO,SAAC5I,GAAoBgjB,EAAShjB,KAC1DlD,EAAWb,KAAI,SAAAqnB,GAAU,MAAO,CAAEtjB,MAAOsjB,EAAMD,QAASC,OAG/DvO,EAAW,6BACRoO,EAAgB,MAAOjM,OAAO7W,IAAW,SAACL,GAAoB+iB,EAAOX,OAAOpiB,MACvE4I,GAAS9L,EAAW,GAEjBF,EAAuBX,KAAI,SAACqnB,EAAMxhB,GAAQ,MAAO,CAAE9B,MAAO8B,EAAE5B,WAAYmjB,QAASC,MAGjFzmB,EAAuBZ,KAAI,SAACqnB,EAAMxhB,GAAQ,MAAO,CAAE9B,MAAO8B,EAAE5B,WAAYmjB,QAASC,UAKjG,qBAAKpoB,UAAU,YAAf,SACK0kB,SCxDF2D,I,MA3EO,WAAO,IAAD,EAEgB9X,qBAAWC,IAA3CjE,EAFgB,EAEhBA,MAAO4H,EAFS,EAETA,SAAU1D,EAFD,EAECA,WAEnB4D,EAAMC,iBAAO,IACnB3T,qBAAU,WAENwT,EAASpN,GAAWqH,2BAA4B,CAAEH,OAAQoG,EAAIE,YAC/D,IARqB,MASU/T,mBAAS,WATnB,mBASjBqN,EATiB,KASNya,EATM,KAWxB3nB,qBAAU,WACN,GAAG4L,EAAMvE,UAAUS,gBAAkBtE,EAAcokB,gBAAiB,CAChE,IAAMC,EAAcjc,EAAMH,aAC1Bkc,EAAaE,EAAY3a,cAE9B,CAACtB,EAAMvE,UAAUS,gBAMpB,IAAIic,EAAyB,WAC7BA,EAAa,qCACT,qBACIxkB,QAAS,WACLiU,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,QAFnE,SAII,4CAEJ,qBACIxI,QAAS,WACLuQ,EAAWgY,QAAQC,gBAAgB7a,IAF3C,SAII,8CAIR,IAAqBD,EAAe9I,EAAe8V,EAmBnD,OAEI,sBACIha,GAAG,iBACHZ,UAAW,YAAcuM,EAAMvE,UAAUS,eAAiBtE,EAAcokB,gBAAkB,UAAY,IACtGroB,QAAS,aAHb,UAMI,qBAAKF,UAAU,QAAf,UA3Ba4N,EA4BI,OA5BW9I,EA4BH+I,EA5BkB+M,EA4BP,SAAC9V,GAAoBwjB,EAAaxjB,IA1BtE,sBAAK9E,UAAU,OAAf,UACI,qBAAKA,UAAU,QAAf,SACI,+BAAO4N,MAEX,qBAAK5N,UAAU,QAAf,SACI,uBACIyM,KAAK,OACL3H,MAAOA,EACP0Z,SAAU,SAAClI,GACPsE,EAAStE,EAAEqI,OAAO7Z,kBAmBlC,qBAAK9E,UAAU,YAAf,SACK0kB,SCxCFiE,I,MA/BO,WAAO,IAAD,EAEgBpY,qBAAWC,IAA3CjE,EAFgB,EAEhBA,MAAiBkE,GAFD,EAET0D,SAFS,EAEC1D,YAGzB,GAAIlE,EAAMvE,UAAUS,eAAiBtE,EAAcykB,eAC/C,OAAQ,6BAIZ,IAFA,IAAMC,EAAStc,EAAMvE,UAAUQ,eACzBsgB,EAAgC,GATd,WAUfliB,GACLkiB,EAAejpB,KACX,qBAEIG,UAAW,CACP4G,EAAI,GAAKiiB,EAAS,SAAW,IAC/B5oB,KAAK,KACPC,QAAS,WACLuQ,EAAWmE,MAAM8R,aAAjB,2BAAkCna,EAAMvE,WAAxC,IAAmDQ,eAAgB5B,EAAI,OALtEkiB,EAAejiB,UAHvBD,EAAI,EAAGA,EAAI,EAAGA,IAAM,EAApBA,GAaT,OACI,qBAAKhG,GAAG,iBACJZ,UAAU,kBADd,SAEI,qBAAKA,UAAU,UAAf,SAA0B8oB,QCsQhCC,I,MAAqB,SAAC5mB,EAAayL,EAAe9I,EACpD8V,EACAhC,EAA4C7Y,GAE5C,IAAMmoB,EAA4B,GAMlC,OALAtP,EAAK3U,SAAQ,SAACC,GACVgkB,EAAWroB,KACP,wBAAgCiF,MAAOZ,EAAKY,MAA5C,SAAoDZ,EAAKikB,SAA5CD,EAAWrhB,YAI5B,sBAEI7G,UAAW,CACP,SACAD,EAAY,UAAY,IAC1BE,KAAK,KALX,UAOI,qBAAKD,UAAU,QAAf,SAAwB4N,IACxB,qBAAK5N,UAAU,QAAf,SACI,wBACIA,UACKD,GAAuB,KAAV+E,EAAyB,GAAV,QAEjCA,MAAOA,EACP0Z,SAAU,SAAClI,GACPsE,EAAStE,EAAEqI,OAAO7Z,QAN1B,SASKojB,QAjBJ/lB,KAwBX6mB,GAAwB,SAAC7mB,EAAayL,EAAe9I,EACvDkiB,EAAaC,EAAarM,EAAmC7a,GAE7D,OACI,sBAEIC,UAAW,CACP,SACAD,EAAY,UAAY,IAC1BE,KAAK,KALX,UAOI,qBAAKD,UAAU,QAAf,SAAwB4N,IACxB,qBAAK5N,UAAU,QAAf,SACI,uBAAOyM,KAAK,SACRzM,UACKD,GAAwB,KAAV+E,GAAkBA,GAASkiB,GAAOliB,GAASmiB,EAAkB,GAAV,QAEtEniB,MAAOA,EAAOkiB,IAAKA,EAAKC,IAAKA,EAC7BzI,SAAU,SAAClI,GACPsE,EAAStE,EAAEqI,OAAO7Z,cAdzB3C,IAsBF8mB,GA5VM,WAAO,IAAD,EAEiB1Y,qBAAWC,IAA3CjE,EAFe,EAEfA,MAAO4H,EAFQ,EAERA,SAAU1D,EAFF,EAEEA,WAGb6D,iBAAO,IACnB3T,qBAAU,cAGP,IAToB,MAWaH,mBAAiB,IAX9B,mBAWhB8R,EAXgB,KAWJ4W,EAXI,OAYyB1oB,mBAAiB,IAZ1C,mBAYhBiS,EAZgB,KAYE0W,EAZF,OAaqB3oB,mBAAsB,IAb3C,mBAahByS,EAbgB,KAaAmW,EAbA,OAcW5oB,mBAAsB,IAdjC,mBAchB0S,EAdgB,KAcLmW,EAdK,OAemB7oB,mBAAiB,IAfpC,mBAehBgT,EAfgB,KAeD8V,EAfC,OAgBW9oB,mBAAsB,IAhBjC,mBAgBhBsT,EAhBgB,KAgBLyV,EAhBK,OAiBW/oB,mBAAsB,IAjBjC,mBAiBhBoT,EAjBgB,KAiBL4V,EAjBK,OAkBmBhpB,mBAAsB,IAlBzC,mBAkBhBwT,EAlBgB,KAkBDyV,EAlBC,OAmBCjpB,mBAAiB,IAnBlB,mBAmBhB4K,EAnBgB,KAmBVse,EAnBU,OAqBSlpB,oBAAkB,GArB3B,mBAqBhBmpB,EArBgB,KAqBLC,EArBK,KAuBjBliB,EAAY6E,EAAM/E,SAASE,UAiDjC/G,qBAAU,WACN,GAAI4L,EAAMvE,UAAUS,gBAAkBtE,EAAc0lB,eAAgB,CAAC,IAAD,EAC1DC,EAAOvd,EAAMH,aACnB8c,EAAiC,MAAnBY,EAAKxX,WAAqB,GAAKwX,EAAKxX,YAClD6W,EAA6C,MAAzBW,EAAKrX,iBAA2B,GAAKqX,EAAKrX,kBAC9D2W,EAAkBU,EAAK7W,gBACvBoW,EAAaS,EAAK5W,WAClBoW,EAAuC,MAAtBQ,EAAKtW,cAAwB,GAA7B,UAAkCsW,EAAKtW,qBAAvC,aAAkC,EAAoBxO,YACvEukB,EAAaO,EAAKhW,WAClB0V,EAAaM,EAAKlW,WAClB6V,EAAiBK,EAAK9V,eACtB0V,EAAqB,MAAbI,EAAK1e,KAAe,GAAK0e,EAAK1e,SAE3C,CAACmB,EAAMvE,UAAUS,gBAEpB9H,qBAAU,YA9DS,WAEf,OADAipB,GAAW,GACHtX,GACJ,KAAK7N,EAAW8N,SACZ,OAAQE,GACJ,KAAK/N,EAAiBiO,SACK,KAAnBM,GAAuB2W,GAAW,GAEtC,MACJ,KAAKllB,EAAiBkO,IACA,KAAdM,GAAkB0W,GAAW,GAEjC,MACJ,KAAKllB,EAAiByO,SAItB,KAAKzO,EAAiB0O,SAClBwW,GAAW,GAKnB,MACJ,KAAKnlB,EAAW8O,MACZ,OAAQC,GACJ,KAAK7O,EAAcgP,KACG,KAAdC,GAAkBgW,GAAW,GAEjC,MACJ,KAAKjlB,EAAckP,KACG,KAAdC,GAAkB8V,GAAW,GAEjC,MACJ,KAAKjlB,EAAcoP,SACO,KAAlBC,GAAsB4V,GAAW,GAK7C,MACJ,KAAKnlB,EAAWwP,KACC,KAAT7I,GAAawe,GAAW,IAqBpCG,KACD,CAACzX,EAAYG,EAAkBQ,EAAgBC,EAC9CM,EAAeI,EAAWE,EAAWE,EAAe5I,IAOxD,IACI4e,GAA8B,GAClCA,GAAanqB,KACTkpB,GAAmBiB,GAAanjB,OAAQ,cAAeyL,GACnD,SAACxN,GACGokB,EAAcpkB,GACVA,IAAUL,EAAW8N,WACrB4W,EAAoB,IACpBC,EAAkB,IAClBC,EAAa,KAEbvkB,IAAUL,EAAW8O,QACrB+V,EAAiB,IACjBC,EAAa,IACbC,EAAa,IACbC,EAAiB,KAEjB3kB,IAAUL,EAAWwP,MACrByV,EAAQ,MAIhB,CAAC,CAAE5kB,MAAO,GAAIqjB,QAAS,KAAM8B,OACzBC,OAAOC,OAAO1lB,GAAY2lB,QAvBb,SAAC3d,GAAD,QAAwB/E,IAAcnD,EAAW2N,QAAUzF,IAAShI,EAAW8N,aAuBzCxR,KAAI,SAACqnB,GACpD,MAAO,CAAEtjB,MAAOsjB,EAAKpjB,WAAYmjB,QAASC,EAAKpjB,iBAGvD,IAKJ0C,IAAcnD,EAAWoD,QACzBqiB,GAAanqB,KACTkpB,GAAmBiB,GAAanjB,OAAQ,oBAAqB4L,GACzD,SAAC3N,GACGqkB,EAAoBrkB,GAEhBA,IAAUJ,EAAiBkO,KAC3ByW,EAAa,IAEbvkB,IAAUJ,EAAiBiO,UAC3ByW,EAAkB,MAI1B,CAAC,CAAEtkB,MAAO,GAAIqjB,QAAS,KAAM8B,OACzBC,OAAOC,OAAOzlB,GAAkB3D,KAAI,SAACqnB,GACjC,IAAMiC,EAAMjC,EAAKpjB,WACjB,MAAO,CAAEF,MAAOulB,EAAKlC,QAASkC,OAGtC/X,IAAe7N,EAAW8N,SAASvN,aAG3CglB,GAAanqB,KACTmpB,GAAsBgB,GAAanjB,OAAQ,kBAAmBoM,GAAiB,EAAG,GAC9E,SAACnO,GACGskB,EAAkBtkB,KAEtB2N,IAAqB/N,EAAiBiO,SAAS3N,aAGvDglB,GAAanqB,KACTmpB,GAAsBgB,GAAanjB,OAAQ,aAAcqM,GAAY,EAAG,GACpE,SAACpO,GACGukB,EAAavkB,KAEjB2N,IAAqB/N,EAAiBkO,IAAI5N,cAItDglB,GAAanqB,KACTkpB,GAAmBiB,GAAanjB,OAAQ,iBAAkB2M,GACtD,SAAC1O,GACGwkB,EAAiBxkB,GAEbA,IAAUH,EAAckP,MACxB0V,EAAa,IAEbzkB,IAAUH,EAAcgP,MACxB6V,EAAa,IAEb1kB,IAAUH,EAAcoP,UACxB0V,EAAiB,MAIzB,CAAC,CAAE3kB,MAAO,GAAIqjB,QAAS,KAAM8B,OACzBC,OAAOC,OAAOxlB,GAAe5D,KAAI,SAACqnB,GAC9B,IAAMiC,EAAMjC,EAAKpjB,WACjB,MAAO,CAAEF,MAAOulB,EAAKlC,QAASkC,OAGtC/X,IAAe7N,EAAW8O,MAAMvO,aAGxCglB,GAAanqB,KACTmpB,GAAsBgB,GAAanjB,OAAQ,aAAc+M,GAAY,IAAK,KACtE,SAAC9O,GACG0kB,EAAa1kB,KAEjB0O,IAAkB7O,EAAcgP,KAAK3O,aAG7CglB,GAAanqB,KACTmpB,GAAsBgB,GAAanjB,OAAQ,aAAciN,EAAW,GAAI,KACpE,SAAChP,GACGykB,EAAazkB,KAEjB0O,IAAkB7O,EAAckP,KAAK7O,aAG7CglB,GAAanqB,KACTmpB,GAAsBgB,GAAanjB,OAAQ,iBAAkBmN,EAAe,GAAI,KAC5E,SAAClP,GACG2kB,EAAiB3kB,KAErB0O,IAAkB7O,EAAcoP,SAAS/O,aAGjDglB,GAAanqB,KACTkpB,GAAmBiB,GAAanjB,OAAQ,OAAQuE,GAC5C,SAACtG,GACG4kB,EAAQ5kB,KAGZ,CAAC,CAAEA,MAAO,GAAIqjB,QAAS,KAAM8B,OACzBC,OAAOC,OAAO3qB,GAAgBuB,KAAI,SAACqnB,GAC/B,IAAMjmB,EAAMimB,EAAKpjB,WACjB,MAAO,CAAEF,MAAO3C,EAAKgmB,QAAShmB,OAGtCmQ,IAAe7N,EAAWwP,KAAKjP,aAIvC,IAAI0f,GAAyB,WA8B7B,OA7BAA,GAAa,qCACT,qBACIxkB,QAAS,WACLiU,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,QAFnE,SAII,4CAEJ,qBACI1I,UAAW,CACP2pB,EAAY,GAAK,WACnB1pB,KAAK,IACPC,QAAS,WACLuQ,EAAW6Z,OAAOC,kBACdjY,EACqB,KAArBG,EAA0B,KAAOA,EACd,KAAnBQ,EAAwB,EAAIA,EACd,KAAdC,EAAmB,EAAIA,EACL,KAAlBM,EAAuB,KAAOA,EAChB,KAAdI,EAAmB,EAAIA,EACT,KAAdE,EAAmB,EAAIA,EACL,KAAlBE,EAAuB,EAAIA,EAClB,KAAT5I,EAAc,KAAOA,IAdjC,SAiBI,8CAOJ,sBACIxK,GAAG,gBACHZ,UAAW,CACP,WACAuM,EAAMvE,UAAUS,eAAiBtE,EAAc0lB,eAAiB,UAAY,IAC9E5pB,KAAK,KACPC,QAAS,aANb,UASI,qBAAKF,UAAU,QAAf,SACKgqB,KAEL,qBAAKhqB,UAAU,YAAf,SACK0kB,S,6BCpLF8F,I,MA7FK,WAAO,IAAD,EAEkBja,qBAAWC,IAA3CjE,EAFc,EAEdA,MAAO4H,EAFO,EAEPA,SAAU1D,EAFH,EAEGA,WAFH,EAIUjQ,mBAAwB,IAJlC,mBAIfiqB,EAJe,KAILC,EAJK,KAWtB/pB,qBAAU,WACN,IAAM8pB,EAA0B,GAEhC,GAAIle,EAAMvE,UAAUS,gBAAkBtE,EAAcwmB,eAAgB,CAChE,IADgE,EAC1Db,EAAOvd,EAAMH,aAD6C,eAGhDG,EAAM5B,cAAcE,UAH4B,IAGhE,2BAA8C,CAAC,IAAtC+f,EAAqC,QAE1C,GADuBA,EAAIxf,OAAS0e,EAAK7gB,SAAW2hB,EAAI1hB,aAAe4gB,EAAK5gB,YAAc0hB,EAAIzhB,aAAe2gB,EAAK3gB,WAC9F,CAEhByhB,EAAIH,SAASxmB,SAAQ,SAACoH,GAClBof,EAAS5qB,KAAK,CACVO,KAAMiL,EAAQjL,UAGtB,QAZwD,8BAehEsqB,EAAYD,GACZI,KAAU5e,WAAW,IAAI6e,aAAgB,SAAU,CAACjjB,KAAM,EAAGkjB,QAAS,KAAMC,MAAK,SAAC/e,GAC9EwE,EAAWwa,eAAehf,SAGnC,CAACM,EAAMvE,UAAUS,gBAEpB,IAAMwD,EAAaM,EAAMN,WAErByY,EAAyB,WAC7BA,EAAa,qCACT,qBACIxkB,QAAS,WACLiU,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,OAC3DuD,EAAW4Y,QAHnB,SAKI,4CAEJ,qBACI3kB,QAAS,WAML+L,EAAWif,SAAS,EAAG,CACnB,CAAEC,KAAM,EAAGC,KAAM,GAAIC,SAAU,GAC/B,CAAEF,KAAM,IAAKC,KAAM,GAAIC,SAAU,MAT7C,SAaI,8CAIR,IAAMC,EAA6B,GAMnC,OALAb,EAASxmB,SAAQ,SAACoH,EAASzE,GACvB0kB,EAAYzrB,KACR,cAAC0rB,GAAD,UAAgBlgB,EAAQjL,MAAZwG,OAKhB,sBACIhG,GAAG,iBACHZ,UAAW,YAAcuM,EAAMvE,UAAUS,eAAiBtE,EAAcwmB,eAAiB,UAAY,IACrGzqB,QAAS,aAHb,UAMI,eAACsrB,GAAD,WACI,cAACC,GAAD,UACKH,IAEL,cAACI,GAAD,OAIJ,qBAAK1rB,UAAU,YAAf,SACK0kB,SASX8G,GAAQpJ,KAAOC,IAAV,+EAKLoJ,GAAYrJ,KAAOC,IAAV,kLAQTkJ,GAAQnJ,KAAOC,IAAV,yUAeLqJ,GAActJ,KAAOC,IAAV,kLC/FFsJ,I,MAtCM,SAAChsB,GAA4C,IAAD,EACrB4Q,qBAAWC,IAA3CjE,EADqD,EACrDA,MAAiBkE,GADoC,EAC9C0D,SAD8C,EACpC1D,YADoC,EAGjCjQ,mBAAiBwF,KAAKC,UAAUsG,EAAM/E,WAHL,mBAGtDokB,EAHsD,KAG9CC,EAH8C,KAI7D,OAEI,sBAAK7rB,UAAU,gBAAf,UACI,0BAAU8E,MAAO8mB,EAAQpN,SAAU,SAAClI,GAChCuV,EAAUvV,EAAEqI,OAAO7Z,UAEvB,wBACI5E,QAAS,WACLuQ,EAAWqb,eAFnB,oBAOA,wBACI5rB,QAAS,WACL,OAAOP,EAAMgf,QACT,IAAK,QAIL,IAAK,UACDlO,EAAWmE,MAAM6C,YAAYzR,KAAK+lB,MAAMH,IAIhDnb,EAAWqb,eAZnB,wBCWGE,GA5BO,SAACrsB,GAGhB,IAAD,EACsC4Q,qBAAWC,IAA1BC,GADvB,EACMlE,MADN,EACa4H,SADb,EACuB1D,YAEzB,OAEI,eAACwb,GAAD,WACI,cAACC,GAAD,UAAWvsB,EAAMwsB,UACjB,cAACC,GAAD,CACIlsB,QAAS,WACLuQ,EAAWqb,eAFnB,gBAOA,cAACM,GAAD,CACIlsB,QAAS,WACLP,EAAMib,YAFd,qBAaNqR,GAAa7J,KAAOC,IAAV,6KAQV6J,GAAW9J,KAAOC,IAAV,+PAYR+J,GAAUhK,KAAOC,IAAV,8aC+LPgK,GAAiB,WAAO,IAAD,EACG9b,qBAAWC,IAA/BjE,EADiB,EACjBA,MAEFlE,GAHmB,EACV8L,SAEE5H,EAAMvE,UAAUK,UAKjC,OACI,sBAAKrI,UAAU,OAAf,UACI,qBAAKA,UAAU,QAAf,SAAuB,2CACvB,sBAAKA,UAAU,SAAf,UACI,wBACIA,UAAWqI,GAAY7D,EAAS8D,OAAS,SAAW,GADxD,SAII,4CAEJ,wBACItI,UAAWqI,GAAY7D,EAASmR,WAAa,SAAW,GAD5D,SAII,gDAEJ,wBACI3V,UAAWqI,GAAY7D,EAASoR,MAAQ,SAAW,GADvD,SAII,2CAEJ,wBACI5V,UAAWqI,GAAY7D,EAAS6T,QAAU,SAAW,GADzD,SAII,oDAOLiU,GAtQU,WAAO,IAAD,EACa/b,qBAAWC,IAA3CjE,EADmB,EACnBA,MAAO4H,EADY,EACZA,SAAU1D,EADE,EACFA,WADE,EAIWjQ,mBAAS,IAJpB,mBAIpB+rB,EAJoB,KAIPC,EAJO,OAMWhsB,mBAAS,IANpB,mBAMpBisB,EANoB,KAMPC,EANO,KAQ3B/rB,qBAAU,WAEN,IAAMmH,EAAWyE,EAAM/E,SAASM,SAE5B7G,EAAQ,EACNsrB,EAA6B,GAC7BE,EAA6B,GAI7BtkB,EAAYoE,EAAMvE,UAAUG,UAE5BuI,EAAQ,GAEVsE,EAAK,EACL2X,EAAY,EACZC,EAAY,EACZC,GAAW,EACf/kB,EAAS7D,SAAQ,SAACC,EAAM0C,GAEpB,GAAI1C,EAAKuI,MAAQ7H,EAAgB2I,KAAM,CACnC,IAAM0D,EAAO/M,EAAK8I,OAClB0D,EAAMO,KAAN,eAAkBA,GAGtB,IAAM6b,EAAMjb,KAAKgS,MAAM8I,EAAY,GAAK,EAClCjb,EAAW,GAYjB,GAXAA,EAASsD,GAAKA,EACdtD,EAASD,SAAWob,GAAWC,EAAMA,GAAO,EAC5Cpb,EAASC,YAAcgb,EAAY,EAAI,EAAIA,EAAY,GAAK,EAC5Djb,EAASE,SAAWgb,EACpBL,EAAY1sB,KACR,cAAC,GAAD,CAEIoB,MAAO2F,EACP+J,YAAazM,GAFR0C,IAKT1C,EAAKuI,MAAQ7H,EAAgBiM,MAAO,CACpCgc,EAAUC,EACV,IAAM9f,EAAS9I,EAAK8I,OAEdQ,EAAQkD,EAAMO,KAAKzD,MACnBvE,EAAU+D,EAAO/D,QAAU+D,EAAO9D,WAAa8D,EAAO7D,WAC5DwjB,GAAa1jB,EAEb2jB,GADoB,IAAQpf,EAAQ,EACT,EAAIvE,EAC/B+L,SACG,GAAI9Q,EAAKuI,MAAQ7H,EAAgBuN,OAAQ,CAC5C,IAAMnF,EAAS9I,EAAK8I,OACpB,OAAQA,EAAOsF,YACX,KAAK7N,EAAW8N,SACZ,IAAIQ,EAAcrC,EAAMO,KAAK9L,SACzB6N,EAAiC,SAApBtC,EAAMO,KAAKvD,MAC5B,OAAQV,EAAOyF,kBACX,KAAK/N,EAAiBiO,SAClBI,GAAe,GAAKA,EAAsC,EAAxB/F,EAAOiG,gBAAsB,GAE/D,MACJ,KAAKvO,EAAiBkO,IAElBG,GAAe,GAAKA,EADFmU,OAAOla,EAAOkG,YACe,GAE/C,MACJ,KAAKxO,EAAiByO,SAIdJ,EAHCC,GAGc,GAAKD,EAAc,GAAK,IAFxB,GAAKA,EAAc,GAAK,GAI3CC,GAAcA,EAEd,MACJ,KAAKtO,EAAiB0O,SAClBJ,GAAcA,EAKtBtC,EAAMO,KAAK9L,SAAW4N,EACtBrC,EAAMO,KAAKvD,MAAQsF,EAAa,QAAU,QAE1C,MACJ,KAAKvO,EAAW8O,MACZ,IAAIG,EAAmBhD,EAAMO,KAAKzD,MAClC,OAAQR,EAAOwG,eACX,KAAK7O,EAAcgP,KACfD,GAAYwT,OAAOla,EAAO4G,WAE1B,MACJ,KAAKjP,EAAckP,KACfH,EAAW7B,KAAKgS,MAAMnQ,EAAW1G,EAAO8G,UAAY,KAEpD,MACJ,KAAKnP,EAAcoP,SACfL,EAAW1G,EAAOgH,cAI1BtD,EAAMO,KAAKzD,MAAQkG,GAM/BvL,EAAUvB,GAAV,2BAAoBuB,EAAUvB,IAA9B,IAAkCqK,KAAK,eAAMP,EAAMO,MAAQS,aAGvDxN,EAAKuI,MAAQ7H,EAAgBsI,UAC7Buf,EAAY5sB,KACR,cAAC,GAAD,CAAwBoB,MAAOA,EAAO2M,MAAQ1J,EAAK8I,OAAyBa,WAAvDjH,IAEzB3F,QAGRurB,EAAeD,GACfG,EAAeD,GACfhc,EAAWmE,MAAM8R,aAAjB,2BAAmCna,EAAMvE,WAAzC,IAAoDG,iBAErD,CAACoE,EAAM/E,SAASM,SAAUyE,EAAM/E,SAASM,SAASjB,SAErD,IAAMwB,EAAWkE,EAAMvE,UAAUK,SAC3B0kB,IAAiBxgB,EAAMvE,UAAUS,eAAiBtE,EAAcuE,MAAQ6D,EAAMvE,UAAUS,eAAiBtE,EAAcyS,cAC7H,OACI,sBAAKhW,GAAG,yBAAR,UACI,sBAAKZ,UAAU,YAAf,UACI,sBAAKY,GAAG,aAAR,UACI,sBACIA,GAAG,mBACHZ,UAAW,CACP,CAACwE,EAASmR,WAAYnR,EAASoR,OAAOrE,SAASlJ,GAAY,gBAAkB,GAC7E,CAAC7D,EAAS6T,SAAS9G,SAASlJ,GAAY,eAAiB,IAC3DpI,KAAK,KALX,UAUI,wBAAQD,UAAU,GAAGE,QAAS,WAE1BuQ,EAAWuc,WAAW,GAAI,GAAI,cAAC,GAAD,CAAeb,QAAQ,0BAA0BvR,SAAU,WACrF,sBAAC,8BAAAwI,EAAA,6DACS6J,EAAa1gB,EAAMvE,UAAUC,UACnCilB,QAAQC,IAAI,iBACNhD,EAAmB,GACzB5d,EAAM/E,SAASM,SAAS7D,SAAQ,SAACC,EAAM0C,GACnCujB,EAAOtqB,KAAP,WAAgBotB,EAAhB,aAA+BrmB,EAA/B,cAAsCZ,KAAKC,UAAU/B,GAArD,UALP,SAOSoB,EAAsB,SAAD,6CAAiD2nB,IAP/E,uBAQS3nB,EAAsB,SAAD,qCAAyC6kB,EAAOlqB,KAAK,OARnF,OASGitB,QAAQC,IAAI,eACZC,MAAM,oCACN3c,EAAWqb,cAXd,2CAAD,QAHR,SAiBG,0CACH,wBAAQ9rB,UAAU,GAAGE,QAAS,WAC1BuQ,EAAWuc,WAAW,GAAI,GAAI,cAAC,GAAD,CAAcrO,OAAO,YADvD,SAEG,4CACH,yBAAQ3e,UAAU,GAAGE,QAAS,WAC1BiU,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcykB,kBAD/D,cAEI,8CACJ,wBAAQ5oB,UAAU,UAAlB,SAA4B,0CAC5B,cAAC,GAAD,OAEJ,qBACIY,GAAG,eACHZ,UAAW,CACP,CAACwE,EAASmR,WAAYnR,EAASoR,OAAOrE,SAASlJ,GAAY,gBAAkB,GAC7E,CAAC7D,EAAS6T,SAAS9G,SAASlJ,GAAY,eAAiB,IAC3DpI,KAAK,KALX,SAOKwsB,IAEL,qBACI7rB,GAAG,kBACHZ,UAAW,CACP,CAACwE,EAASmR,WAAYnR,EAASoR,OAAOrE,SAASlJ,GAAY,gBAAkB,GAC7E,CAAC7D,EAAS6T,SAAS9G,SAASlJ,GAAY,eAAiB,IAC3DpI,KAAK,KALX,SAOKssB,IAGL,qBAAK3rB,GAAG,cACJZ,UAAW+sB,EAAe,SAAW,GACrC7sB,QAAS,WACDqM,EAAMvE,UAAUK,WAAa7D,EAAS6T,SACtClE,EAASpN,GAAWyH,eAAgB,CAAEjC,MAAOpI,EAAcuE,UAKvE,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,OAEJ,cAAC,GAAD,OAGJ,qBAAK1I,UAAU,aAAf,SACI,cAAC,GAAD,UCwCDqtB,I,MA1Qa,WAAO,IAAD,EACU9c,qBAAWC,IAA3CjE,EADsB,EACtBA,MAAO4H,EADe,EACfA,SAAU1D,EADK,EACLA,WADK,EAGJjQ,oBAAkB,GAHd,mBAGvB8sB,EAHuB,KAGhBC,EAHgB,OAIA/sB,mBAAiB,IAJjB,mBAIvB2rB,EAJuB,KAIdqB,EAJc,OAKMhtB,mBAAwB,IAL9B,mBAKvBitB,EALuB,KAKXC,EALW,OAMIltB,mBAAwB,IAN5B,mBAMvBmtB,EANuB,KAMZC,EANY,OAOJptB,oBAAkB,GAPd,mBAOvB2J,EAPuB,KAOf0jB,EAPe,OAQJrtB,mBAAiB,IARb,mBAQvBstB,EARuB,KAQhBC,EARgB,OASIvtB,mBAA0B,IAT9B,mBASvBkH,EATuB,KASZsmB,EATY,OAUJxtB,oBAAkB,GAVd,mBAUvBoJ,EAVuB,KAUfqkB,EAVe,KAY9BttB,qBAAU,WACNusB,QAAQC,IAAI,gCACb,IAGH,IAAMe,EAAS,SAACC,GAEZF,GAAQ,GACRT,EAAW,yBACXloB,EAAsB,SAAD,kHAAsHiH,EAAMtF,MAAMrG,KAClJoqB,MAAK,SAAAoD,GACF,OAAOA,EAASC,UAEnBrD,MAAK,SAAAsD,GACFpB,QAAQC,IAAImB,GACZpB,QAAQC,IAAI,WAAI5gB,EAAMtF,MAAMrG,GAAhB,kBAAqC0tB,EAAQznB,QACzCynB,EAAQznB,OAAS,GAE7B6mB,EAAcY,GACdd,EAAW,KAEXA,EAAW,6CAEfS,GAAQ,MAEXM,OAAM,SAAAC,GACHtB,QAAQC,IAAIqB,EAAQ,wCACpBP,GAAQ,OAIpBttB,qBAAU,WACN,IAAMiY,EAAsB,GAC5B6U,EAAWxpB,SAAQ,SAAC6a,EAAQlY,GACxBgS,EAAK/Y,KACD,sBAEIG,UAAW,CACP,SACAstB,GAAS1mB,EAAI,QAAU,IACzB3G,KAAK,KACPC,QAAS,WACLqtB,EAAS3mB,IAPjB,UAUI,iCAAOkY,EAAOle,GAAd,OACA,sBAAMZ,UAAU,QAAhB,SAAyB8e,EAAOgP,QAChC,qCACA,sBAAM9tB,UAAU,OAAhB,SAAwB8e,EAAO2P,aAC/B,uCAbK7nB,OAiBjBgnB,EAAahV,KACd,CAAC6U,EAAYH,IAEhB3sB,qBAAU,WACDwJ,GACD+jB,MAGL,CAAC/jB,IAEJ,IAAMukB,EAAe,SAAC9gB,EAAe7N,EAAoB6a,GAAkE,IAA5C9a,EAA2C,wDACtH,OACI,wBAAQE,UAAW,CACfD,EAAY,UAAY,GACxBD,EAAW,SAAW,IACxBG,KAAK,KACHC,QAAS0a,EAJb,SAMI,+BAAOhN,OAKb+gB,EAAoB,SAAC/gB,EAAe+N,GACtC,OACI,sBACI3b,UAAU,cADd,UAGI,+BAAO4N,IACP,+BAAO,OACN+N,MAKPiT,EAA0B,IAAXzC,EACf0C,EAAiBpB,EAAWH,GAClC,OACI,sBAAK1sB,GAAG,yBAAR,UACI,sBAAKZ,UAAU,YAAf,UACI,sBAAKA,UAAU,MAAf,UACK0uB,EAAa,SAAUvkB,GAAUP,GAAQ,WACtC4jB,EAAW,aACXloB,EAAsB,SAAD,+DAAmEiH,EAAMtF,MAAMrG,GAA/E,uBAChBoqB,MAAK,SAAC8D,GAEH,OADAZ,EAAOT,EAAW5mB,QACXioB,QAGlBJ,EAAa,UAAoB,GAAVpB,GAAe1jB,GAAQ,WACtCO,IACD0jB,GAAQ,GACRE,EAASc,EAAef,OACxBE,EAAaa,EAAeJ,eAEjCtkB,GACFukB,EAAa,UAAoB,GAAVpB,GAAenjB,GAAUP,GAAQ,WACrD,sBAAC,sBAAAwZ,EAAA,6DACGoK,EAAW,aACXN,QAAQC,IAAI,iBAFf,SAGS7nB,EAAsB,SAAD,6CAAiDmoB,EAAWH,GAAO1sB,KAHjG,uBAIS0E,EAAsB,SAAD,0CAA8CmoB,EAAWH,GAAO1sB,KAJ9F,OAKGstB,IACAX,GAAU,GACVL,QAAQC,IAAI,eAPf,0CAAD,SAWR,sBAAKntB,UAAW,CACZ,MACAmK,EAAS,UAAY,IACvBlK,KAAK,KAHP,UAII,qBAAKD,UAAW,CACZ,UACC4uB,EAA0B,GAAX,UAClB3uB,KAAK,KAHP,SAII,+BAAOksB,MAEX,qBAAKnsB,UAAW,CACZ,OACA4uB,EAAe,SAAW,IAC5B3uB,KAAK,KAHP,SAIK0tB,UAIb,sBAAK3tB,UAAU,aAAf,UACI,sBAAKA,UAAU,MAAf,UACK0uB,EAAa,UAAWvkB,GAAUP,GAAQ,WACvC6G,EAAWmE,MAAM6C,YAAjB,2BAAkClL,EAAM/E,UAAxC,IAAkDM,SAAU,MAC5D+lB,GAAQ,GACRpd,EAAWwa,eAAe,SAE7ByD,EAAa,QAASvkB,GAAwB,KAAdzC,GAAoBkC,GAAQ,WACzDqkB,GAAQ,GACR,sBAAC,4BAAA7K,EAAA,6DACG8J,QAAQC,IAAI,iBACNhD,EAAmB,GAF5B,SAGS7kB,EAAsB,SAAD,0GAEZwoB,EAFY,6DAGPpmB,EAHO,4DAIR6E,EAAM/E,SAASI,UAAUxH,KAJjB,sDAKdmM,EAAM/E,SAASI,UAAUC,KALX,sDAMb7B,KAAKC,UAAUsG,EAAM/E,SAASO,YANjB,yDAOV8mB,EAAejuB,GAPL,mCAH9B,YAYO2L,EAAM/E,SAASM,SAASjB,OAAS,GAZxC,wBAaO0F,EAAM/E,SAASM,SAAS7D,SAAQ,SAACC,EAAM0C,GACnCujB,EAAOtqB,KAAP,WAAgBgvB,EAAejuB,GAA/B,aAAsCgG,EAAtC,cAA6CZ,KAAKC,UAAU/B,GAA5D,UAdX,SAgBaoB,EAAsB,SAAD,6CAAiDupB,EAAejuB,KAhBlG,wBAiBa0E,EAAsB,SAAD,qCAAyC6kB,EAAOlqB,KAAK,OAjBvF,QAmBGitB,QAAQC,IAAI,eACZC,MAAM,oCAENa,GAAQ,GAtBX,2CAAD,MAyBHS,EAAa,QAASvkB,GAAwB,KAAdzC,GAAoBkC,GAAQ,WACzDqkB,GAAQ,GACR,sBACI,kCAAA7K,EAAA,0DACU5b,EAAW+E,EAAM/E,UACdE,UAAYA,EACU,GAA3BmnB,EAAeE,SAHvB,gBAKQvnB,EAASM,S3BtMlC,CACH,CACI2E,KAAM7H,EAAgB2I,KACtBP,OAAQ,CACJQ,MAAO,GACPC,MAAO,MACPtI,SAAU,EACVuI,MAAO,UAGf,CACIjB,KAAM7H,EAAgB+I,MACtBX,OAAQ,CACJY,MAAO,UAGf,CACInB,KAAM7H,EAAgBsI,QACtBF,OAAQ,CACJa,UAAW,YAGnB,CACIpB,KAAM7H,EAAgB+I,MACtBX,OAAQ,CACJY,MAAO,S2BwKK,8BAOc9F,EAA0B,GAPxC,SAQ+BxC,EAAsB,SAAD,kDAAsDupB,EAAejuB,GAArE,kBARpD,cAQcwtB,EARd,iBAS8BA,EAASC,OATvC,eAWgBpqB,SAAQ,SAAC6qB,GACbhnB,EAASjI,KAAKmG,KAAK+lB,MAAM+C,EAAOT,UAEpC7mB,EAASM,SAAWA,EAd5B,QAgBIyE,EAAMvE,UAAUC,UAAY4mB,EAAejuB,IACrCgH,EAAY2E,EAAM/E,SAASI,WACvBxH,KAAmC,MAA5ByuB,EAAeG,UAAoB,GAAKH,EAAeG,UACxEpnB,EAAUC,KAA8B,MAAvBgnB,EAAehnB,KAAe,EAAIgnB,EAAehnB,KAClE0E,EAAM/E,SAASO,WAAoC,MAAvB8mB,EAAeI,KAAe,GAAKjpB,KAAK+lB,MAAM8C,EAAeI,MACzFxe,EAAWmE,MAAM8R,aAAjB,eAAmCna,EAAMvE,YACzCyI,EAAWmE,MAAM6C,YAAYjQ,GAC7B2M,EAASpN,GAAW+G,oBAAqB,CAAE7M,MAAO,IAClDkT,EAASpN,GAAW8F,gBAAiB,CAAE5L,MAAO,IAC9CgtB,GAAQ,GAzBZ,2CADJ,SA+BH9jB,EACG,sBAAKnK,UAAU,OAAf,UACK2uB,EAAkB,KACf,sBAAM3uB,UAAU,QAAhB,SAAyB6uB,EAAejuB,MAE3C+tB,EAAkB,QACf,uBACIliB,KAAK,OACL+R,SAAU,SAAClI,GAGPyX,EAASzX,EAAEqI,OAAO7Z,QAEtBA,MAAOgpB,KAGda,EAAkB,OAEf,yBAAQ3uB,UAAW,CACf,QACA6uB,EAAeE,SAAW,EAAI,UAAY,IAC5C9uB,KAAK,KACH6E,MAAO4C,EACP8W,SAAU,SAAClI,GACP0X,EAAa1X,EAAEqI,OAAO7Z,QAN9B,UAQI,wBAAQA,MAAM,KACd,wBAAQA,MAAOP,EAAWoD,MAA1B,SAAkCpD,EAAWoD,QAC7C,wBAAQ7C,MAAOP,EAAW2N,OAA1B,SAAmC3N,EAAW2N,aAGrDyc,EAAkB,OACf,sBAAM3uB,UAAU,QAAhB,SAAyB,aAE5B2uB,EAAkB,OACf,sBAAM3uB,UAAU,QAAhB,SAAyB6uB,EAAeE,YAE3CJ,EAAkB,MACf,sBAAM3uB,UAAU,MAAhB,mB7BtEA,0C6BsEA,sBAAwD6uB,EAAejuB,UAtCzE,qCCrOjBsuB,I,MAAkB,SAACthB,EAAe9I,GAC3C,OACI,sBAAK9E,UAAU,SAAf,UACI,qBAAKA,UAAU,QAAf,SAAwB4N,IACxB,qBAAK5N,UAAU,QAAf,SAAwB8E,SAKvBqqB,GAAiB,SAC1BvhB,EAAe9I,EACf8V,GACA,OACI,sBAAK5a,UAAU,SAAf,UACI,qBAAKA,UAAU,QAAf,SAAwB4N,IACxB,uBAAOnB,KAAK,OAAO3H,MAAOA,EAAO0Z,SAAU,SAAClI,GAAD,OAAOsE,EAAStE,UAK1D8Y,GAAmB,SAC5BxhB,EAAe9I,EACf8T,EACAgC,GAEA,IAAMyU,EAA+B,GAMrC,OALAzW,EAAK3U,SAAQ,SAACmkB,EAAMxhB,GAChByoB,EAAcxvB,KACV,wBAAgBiF,MAAOsjB,EAAKtjB,MAA5B,SAAoCsjB,EAAKD,SAA5BvhB,OAIjB,sBAAK5G,UAAU,SAAf,UACI,qBAAKA,UAAU,QAAf,SAAwB4N,IACxB,wBAAQ9I,MAAOA,EAAO0Z,SAAU,SAAClI,GAAD,OAAOsE,EAAStE,IAAhD,SACK+Y,QAMJC,GAAqB,SAAC1W,GAE/B,IAAM2W,EAA+B,GAUrC,OATA3W,EAAK3U,SAAQ,SAACmkB,EAAMxhB,GAChB2oB,EAAc1vB,KACV,wBAEIG,UAAW,CAACooB,EAAKoH,SAAW,UAAY,IAAIvvB,KAAK,KACjDC,QAAS,kBAAMkoB,EAAKxN,YAHxB,SAIEwN,EAAKxa,OAHEhH,OAOb,qBAAK5G,UAAU,SAAf,SAAyBuvB,KCsClBE,GAvFM,WAAO,IAAD,EACOlf,qBAAWC,IAAjCjE,EADe,EACfA,MAAOkE,EADQ,EACRA,WAETuU,EAAQzY,EAAM5B,cACdM,EAAOsB,EAAMzB,WAAWG,KAAKC,KAGnC,GAAiB,SAFLuF,EAAWuU,MAAM0K,kBAErBjjB,KACJ,OAAO,6BAEX,IAAMvI,EAAOuM,EAAWuU,MAAM0K,kBAAkBzhB,OAEhD,OACI,sBAAKjO,UAAU,kBAAf,UACKmvB,GACG,OACAlkB,EAAKL,WACL,SAAC0L,GACGrL,EAAKL,UAAY0L,EAAEqI,OAAO7Z,MAC1B2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,eAG5CokB,GACG,WACAlT,OAAO9X,EAAK2G,SAAShE,SAIrByoB,GAAmB,CACf,CACI1hB,MAAO,SACP4hB,UAAU,EACV5U,SAAU,WACN3P,EAAKL,UAAY1G,EAAK0G,UACtB6F,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,cAG7C,CACI8C,MAAO,SACP4hB,UAAU,EACV5U,SAAU,WACN1W,EAAK0G,UAAYK,EAAKL,UACtB6F,EAAWuU,MAAM4K,cAAc5K,KAGvC,CACIpX,MAAO,SACP4hB,UAAU,EACV5U,SAAU,gBAOlB0U,GAAmB,CACf,CACI1hB,MAAO,cACP4hB,UAAU,EACV5U,SAAU,WACNnK,EAAWuU,MAAM6K,sBAMjC,qBAAK7vB,UAAU,MAAf,SACI,0BAAU8E,MAAOmG,EAAKE,IAAKqT,SAAU,SAAClI,GAClCrL,EAAKE,IAAMmL,EAAEqI,OAAO7Z,MACpB2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,iBAIzCwkB,GAAmB,CACf,CACI1hB,MAAO,OACP4hB,UAAU,EACV5U,SAAU,WACNnK,EAAWuU,MAAM4K,cAAc5pB,KAAK+lB,MAAM9gB,EAAKE,cCkC5D2kB,GAjHS,WAAO,IAAD,EACIvf,qBAAWC,IAAjCjE,EADkB,EAClBA,MAAOkE,EADW,EACXA,WAETuU,EAAQzY,EAAM5B,cACdM,EAAOsB,EAAMzB,WAAWG,KAAKhC,QAC7BtC,EAAM8J,EAAWuU,MAAM0K,kBAE7B,GAAiB,YAAb/oB,EAAI8F,KACJ,OAAO,6BAEX,IAAMvI,EAAOuM,EAAWuU,MAAM0K,kBAAkBzhB,OAC5ChF,EAAU,IACG,MAAbgC,EAAKG,OACLnC,EAAU+S,OAAO/Q,EAAKG,KAAOH,EAAK/B,WAAa+B,EAAK9B,aAExD,IAAM4mB,EAAwB,MAAb9kB,EAAKG,KACtB,OACI,sBAAKpL,UAAU,kBAAf,UACKovB,GACG,OACAnkB,EAAKG,KAAO4Q,OAAO/Q,EAAKG,MAAQ,GAChC,CACI,CAAEtG,MAAO,GAAIqjB,QAAS,IACtB,CAAErjB,MAAOkX,OAAO,GAAImM,QAASnM,OAAO,IACpC,CAAElX,MAAOkX,OAAO,GAAImM,QAASnM,OAAO,IACpC,CAAElX,MAAOkX,OAAO,GAAImM,QAASnM,OAAO,IACpC,CAAElX,MAAOkX,OAAO,GAAImM,QAASnM,OAAO,MAExC,SAAC1F,GACGrL,EAAKG,KAAO8b,OAAO5Q,EAAEqI,OAAO7Z,OAC5B2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,eAG5CskB,GACG,OACApT,OAAO/Q,EAAK/B,YACZ,CACI,CAAEpE,MAAOkX,QAAQ,IAAMmM,QAASnM,QAAQ,KACxC,CAAElX,MAAOkX,QAAQ,KAAOmM,QAASnM,QAAQ,MACzC,CAAElX,MAAOkX,OAAO,GAAImM,QAASnM,OAAO,IACpC,CAAElX,MAAOkX,OAAO,KAAOmM,QAASnM,OAAO,MACvC,CAAElX,MAAOkX,OAAO,IAAMmM,QAASnM,OAAO,OAE1C,SAAC1F,GACGrL,EAAK/B,WAAage,OAAO5Q,EAAEqI,OAAO7Z,OAClC2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,eAG5CskB,GACG,OACApT,OAAO/Q,EAAK9B,YACZ,CACI,CAAErE,MAAOkX,QAAQ,IAAMmM,QAASnM,QAAQ,KACxC,CAAElX,MAAOkX,QAAQ,KAAOmM,QAASnM,QAAQ,MACzC,CAAElX,MAAOkX,OAAO,GAAImM,QAASnM,OAAO,IACpC,CAAElX,MAAOkX,OAAO,KAAOmM,QAASnM,OAAO,MACvC,CAAElX,MAAOkX,OAAO,IAAMmM,QAASnM,OAAO,OAE1C,SAAC1F,GACGrL,EAAK9B,WAAa+d,OAAO5Q,EAAEqI,OAAO7Z,OAClC2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,eAG5CokB,GAAgB,UAAWjmB,GAC3BimB,GACG,WACAlT,OAAO9X,EAAKumB,SAAS5jB,SAGrByoB,GAAmB,CACf,CACI1hB,MAAO,SACP4hB,SAAUjjB,EAAMzB,WAAWc,SAC3BgP,SAAU,cAId,CACIhN,MAAO,SACP4hB,UAAWO,EACXnV,SAAU,WACN1W,EAAKkH,KAAOH,EAAKG,KACjBlH,EAAKgF,WAAa+B,EAAK/B,WACvBhF,EAAKiF,WAAa8B,EAAK9B,WACvBsH,EAAWuU,MAAM4K,cAAc5K,GAC/BzY,EAAMzB,WAAWc,UAAW,EAC5B6E,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,cAG7C,CACI8C,MAAO,SACP4hB,UAAU,EACV5U,SAAU,gBAOlB0U,GAAmB,CACf,CACI1hB,MAAO,cACP4hB,UAAU,EACV5U,SAAU,WACNnK,EAAWuU,MAAMgL,gBAAgBrpB,WCrB9CspB,GAnFS,WAAO,IAAD,EAEI1f,qBAAWC,IAAjCjE,EAFkB,EAElBA,MAAOkE,EAFW,EAEXA,WAETuU,EAAQzY,EAAM5B,cACdM,EAAOsB,EAAMzB,WAAWG,KAAKU,QAC7BhF,EAAM8J,EAAWuU,MAAM0K,kBAU7B,GARA/uB,qBAAU,WACN,IACIsK,EAAKK,IAAMtF,KAAK+lB,MAAM9gB,EAAKE,KAC7B,MAAOmL,GACLrL,EAAKK,IAAM,QAEjB,CAACL,EAAKE,MAES,YAAbxE,EAAI8F,KACJ,OAAO,6BAEX,IAAMvI,EAAOuM,EAAWuU,MAAM0K,kBAAkBzhB,OAYhD,OACI,sBAAKjO,UAAU,kBAAf,UACCkvB,GAAgB,UAZL,WACZ,IAAMtW,EAAgB,GAMtB,OALe,MAAZ3N,EAAKK,KACJL,EAAKK,IAAImE,YAAYxL,SAAQ,SAAAisB,GACzBtX,EAAK/Y,KAAL,UAAaqwB,EAAM5M,OAAnB,YAA6B4M,EAAM3M,iBAGpC3K,EAAK3Y,KAAK,KAKWkwB,IAC5B,qBAAKnwB,UAAU,MAAf,SACI,0BAAU8E,MAAOmG,EAAKE,IAAKqT,SAAU,SAAClI,GAClCrL,EAAKE,IAAMmL,EAAEqI,OAAO7Z,MACpB2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,iBAIzCwkB,GAAmB,CACf,CACI1hB,MAAO,OACP4hB,UAAU,EACV5U,SAAU,WACNnK,EAAWuU,MAAMoL,+BAM7Bd,GAAmB,CACf,CACI1hB,MAAO,SACP4hB,SAAUjjB,EAAMzB,WAAWc,SAC3BgP,SAAU,cAId,CACIhN,MAAO,SACP4hB,UAAU,EACV5U,SAAU,WACN1W,EAAKoH,IAAMtF,KAAK+lB,MAAM9gB,EAAKE,KAC3BsF,EAAWuU,MAAM4K,cAAc5K,GAC/BzY,EAAMzB,WAAWc,UAAW,EAC5B6E,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,cAG7C,CACI8C,MAAO,SACP4hB,UAAU,EACV5U,SAAU,oBC4DfyV,GAnIW,WAAO,IAAD,IAEE9f,qBAAWC,IAAjCjE,EAFoB,EAEpBA,MAAOkE,EAFa,EAEbA,WAETuU,EAAQzY,EAAM5B,cACdM,EAAOsB,EAAMzB,WAAWG,KAAKM,UAC7B5E,EAAM8J,EAAWuU,MAAM0K,kBAE7B,GAAiB,cAAb/oB,EAAI8F,KACJ,OAAO,6BAEX,IAAMvI,EAAOyC,EAAIsH,OACXqiB,EAAM,UAAG3pB,EAAI2pB,cAAP,aAAG,EAAYriB,OAC3B,OACI,sBAAKjO,UAAU,kBAAf,UACCkvB,GACG,WACAvrB,EAAkB2sB,EAAO1sB,aAExBwrB,GACG,WACAnkB,EAAKQ,aAAazG,WACjB,WAEG,IADA,IAAM4T,EAA6C,GAC1ChS,EAAI,EAAGA,EAAI,GAAIA,IACpBgS,EAAK/Y,KAAK,CACNiF,MAAOkX,OAAOpV,GACduhB,QAAS1mB,EAAiBmF,KAGlC,OAAOgS,EARV,IAUD,SAACtC,GACGrL,EAAKQ,aAAeyb,OAAO5Q,EAAEqI,OAAO7Z,OACpC2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,eAG5CskB,GACG,WACAnkB,EAAKS,aAAa1G,WACjB,WAEG,IADA,IAAM4T,EAA6C,GAC1ChS,EAAI,EAAGA,EAAI,GAAIA,IACpBgS,EAAK/Y,KAAK,CACNiF,MAAOkX,OAAOpV,GACduhB,QAAS1mB,EAAiBmF,KAGlC,OAAOgS,EARV,IAUD,SAACtC,GACGrL,EAAKS,aAAewb,OAAO5Q,EAAEqI,OAAO7Z,OACpC2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,eAO7C,qBAAK9K,UAAW,CAAC,YAAYC,KAAK,KAAlC,SACM,WAAO,IAAD,EhCDkB2D,EgCEhBvB,GAAuB,UAACsE,EAAI2pB,cAAL,aAAC,EAAYriB,QAA6BrK,WACvE,OhCHsBA,EgCGWvB,EhCF1CH,EAAmBkoB,QAAO,SAACpmB,GAC9B,OAAOJ,IAAeI,EAAO3B,YAC9BtB,KAAI,SAACiD,GAAD,OAAYA,EAAO7B,QgCCNpB,KAAI,SAACiD,EAAQ4C,GACT,OACI,sBAAa5G,UAAW,CACpB,OACAiL,EAAKO,WAAW+F,SAASvN,GAAU,SAAW,IAChD/D,KAAK,KACHC,QAAS,WACA+K,EAAKO,WAAW+F,SAASvN,GAG1BiH,EAAKO,WAAaP,EAAKO,WAAW4e,QAAO,SAAChC,GAAD,OAAUA,IAASpkB,KAF5DiH,EAAKO,WAAW3L,KAAKmE,GAIzByM,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,aAV7C,cAYGzF,EAAcrB,GAZjB,MAAU4C,MALxB,KAsBLsoB,GACG,WACAlT,OAAO9X,EAAKqsB,SAAS1pB,SAGrByoB,GAAmB,CACf,CACI1hB,MAAO,SACP4hB,SAAUjjB,EAAMzB,WAAWc,SAC3BgP,SAAU,cAId,CACIhN,MAAO,SACP4hB,UAAU,EACV5U,SAAU,WACN1W,EAAKuH,aAAeR,EAAKQ,aACzBvH,EAAKwH,aAAeT,EAAKS,aACzBxH,EAAKsH,WAAaP,EAAKO,WACvBiF,EAAWuU,MAAM4K,cAAc5K,GAC/BzY,EAAMzB,WAAWc,UAAW,EAC5B6E,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,cAG7C,CACI8C,MAAO,SACP4hB,UAAU,EACV5U,SAAU,gBAOlB0U,GAAmB,CACf,CACI1hB,MAAO,cACP4hB,UAAU,EACV5U,SAAU,WACNnK,EAAWuU,MAAMwL,gBAAgB7pB,WC7C9C8pB,GA7EU,WAAO,IAAD,EAEGlgB,qBAAWC,IAAjCjE,EAFmB,EAEnBA,MAAOkE,EAFY,EAEZA,WAETuU,EAAQzY,EAAM5B,cACdM,EAAOsB,EAAMzB,WAAWG,KAAK5I,SAC7BsE,EAAM8J,EAAWuU,MAAM0K,kBAE7B,GAAiB,aAAb/oB,EAAI8F,KACJ,OAAO,6BAEX,IAAMvI,EAAOuM,EAAWuU,MAAM0K,kBAAkBzhB,OAEhD,OACI,sBAAKjO,UAAU,kBAAf,UACKovB,GACG,WACiB,MAAjBnkB,EAAK5I,SAAmB,GAAK4I,EAAK5I,SAAS2C,WAC1C,WACG,IAAM4T,EAA6C,GAQnD,OAPAA,EAAK/Y,KAAK,CAAEiF,MAAO,GAAIqjB,QAAS,KAChC+B,OAAOC,OAAOpoB,GAAYqoB,QAAO,SAAAsG,GAAC,OAAKC,MAAMzJ,OAAOwJ,OAAKzsB,SAAQ,SAACmkB,EAAMxhB,GACpEgS,EAAK/Y,KAAK,CACNiF,MAAOkX,OAAOoM,GACdD,QAASxkB,EAAkBujB,OAAOkB,SAGnCxP,EATV,IAWD,SAACtC,GACGrL,EAAK5I,SAAW6kB,OAAO5Q,EAAEqI,OAAO7Z,OAChC2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,eAIzCwkB,GAAmB,CACf,CACI1hB,MAAO,SACP4hB,SAAUjjB,EAAMzB,WAAWc,SAC3BgP,SAAU,cAId,CACIhN,MAAO,SACP4hB,UAAU,EACV5U,SAAU,WACN1W,EAAKN,WAAaqH,EAAK5I,SACvBoO,EAAWuU,MAAM4K,cAAc5K,GAC/BzY,EAAMzB,WAAWc,UAAW,EAC5B6E,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,cAG7C,CACI8C,MAAO,SACP4hB,UAAU,EACV5U,SAAU,gBAOlB0U,GAAmB,CACf,CACI1hB,MAAO,gBACP4hB,UAAU,EACV5U,SAAU,WACNnK,EAAWuU,MAAM4L,kBAAkBjqB,WCiEhDkqB,GAvIS,WAAO,IAAD,IAEItgB,qBAAWC,IAAjCjE,EAFkB,EAElBA,MAAOkE,EAFW,EAEXA,WAETuU,EAAQzY,EAAM5B,cACdM,EAAOsB,EAAMzB,WAAWG,KAAKI,QAC7B1E,EAAM8J,EAAWuU,MAAM0K,kBAU7B,GARA/uB,qBAAU,WACN,IACIsK,EAAKK,IAAMtF,KAAK+lB,MAAM9gB,EAAKE,KAC7B,MAAOmL,GACLrL,EAAKK,IAAM,QAEjB,CAACL,EAAKE,MAES,YAAbxE,EAAI8F,KACJ,OAAO,6BAEX,IAAMvI,EAAOyC,EAAIsH,OAEXqiB,EAAM,UAAG3pB,EAAI2pB,cAAP,aAAG,EAAYriB,OAiC3B,OACI,sBAAKjO,UAAU,kBAAf,UACKkvB,GAAgB,OAAQlT,OAAOsU,EAAOllB,OACtC8jB,GAAgB,OAAQlT,OAAOsU,EAAOpnB,aACtCgmB,GAAgB,OAAQlT,OAAOsU,EAAOnnB,aACtC+lB,GAAgB,UAAWlT,OAAOsU,EAAOllB,KAAOklB,EAAOpnB,WAAaonB,EAAOnnB,aAC3EgmB,GACG,OACAlkB,EAAK7K,MACL,SAACkW,GACGrL,EAAK7K,KAAOkW,EAAEqI,OAAO7Z,MACrB2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,eAG5CokB,GAAgB,UA5CN,WACf,IAAInL,EAAU,IAId,OAHe,MAAZ9Y,EAAKK,MACJyY,EAAU/H,OAAO/Q,EAAKK,IAAI0E,OAAO,GAAGC,MAAMpJ,SAEvCkd,EAuCyB+M,IAC3B5B,GAAgB,QArCR,WACb,IAAI6B,EAAQ,IACZ,GAAe,MAAZ9lB,EAAKK,IAAc,CAClB,IAAMA,EAAsBtF,KAAK+lB,MAAM9gB,EAAKE,KACxC6lB,EAAQ,EACZ1lB,EAAI0E,OAAO/L,SAAQ,SAAA4a,GACfA,EAAM5O,MAAMhM,SAAQ,SAAAgtB,GAChBA,EAAKhtB,SAAQ,SAAAitB,GACTA,EAAKjtB,SAAQ,SAAAiM,GACLA,GAAO8gB,gBAK3BD,EAAQ/U,OAAOgV,GAEnB,OAAOD,EAqBuBI,IAC1B,qBAAKnxB,UAAU,MAAf,SACI,0BAAU8E,MAAOmG,EAAKE,IAAKqT,SAAU,SAAClI,GAClCrL,EAAKE,IAAMmL,EAAEqI,OAAO7Z,MACpB2L,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,iBAIzCwkB,GAAmB,CACf,CACI1hB,MAAO,OACP4hB,UAAU,EACV5U,SAAU,WACNnK,EAAWuU,MAAMoM,+BAKhClC,GACG,WACAlT,OAAO9X,EAAKmtB,SAASxqB,SAGrByoB,GAAmB,CACf,CACI1hB,MAAO,SACP4hB,SAAUjjB,EAAMzB,WAAWc,SAC3BgP,SAAU,cAId,CACIhN,MAAO,SACP4hB,WAlDI,IAAbvkB,EAAK7K,MAA0B,MAAZ6K,EAAKK,KAmDfsP,SAAU,WACN1W,EAAK9D,KAAO6K,EAAK7K,KACjB8D,EAAKoH,IAAMtF,KAAK+lB,MAAM9gB,EAAKE,KAC3BsF,EAAWuU,MAAM4K,cAAc5K,GAC/BzY,EAAMzB,WAAWc,UAAW,EAC5B6E,EAAWuU,MAAM2K,cAAcpjB,EAAMzB,cAG7C,CACI8C,MAAO,SACP4hB,UAAU,EACV5U,SAAU,gBAOlB0U,GAAmB,CACf,CACI1hB,MAAO,eACP4hB,UAAU,EACV5U,SAAU,WACNnK,EAAWuU,MAAMsM,iBAAiB3qB,WCqK/C4qB,GAxRW,WAAO,IAAD,EACEhhB,qBAAWC,IAAjCjE,EADoB,EACpBA,MAAOkE,EADa,EACbA,WAETuU,EAAQzY,EAAM5B,cACdG,EAAayB,EAAMzB,WACnB0mB,EAAe1mB,EAAWE,eALJ,EAOkBxK,mBAAwB,IAP1C,mBAOrBixB,EAPqB,KAOJC,EAPI,KAkO5B,GAxNA/wB,qBAAU,WACN8P,EAAWuU,MAAM2M,eAClB,CAAC3M,IAGJrkB,qBAAU,WAiMN,IAhMA,IAAM8wB,EAAiC,GA8LjCG,EAAuC,GACzCvd,EAAkCmd,EAAa1mB,EAAW5C,YAChD,MAAPmM,GACHud,EAAc/xB,KAAKwU,GACnBA,EAAMA,EAAIic,OAMdkB,EAAavtB,SAAQ,SAACC,GAClButB,EAAgB5xB,KAvMM,SAACqE,EAA2BpE,GAClD,IAAMqC,EAAMsvB,EAAgB5qB,OACtBgrB,EAAS,WACX,OAAQ3tB,EAAKuI,MACT,IAAK,OAAQ,OAAO,EACpB,IAAK,UAAW,OAAO,EACvB,IAAK,UAAW,OAAO,EACvB,IAAK,WAAY,OAAO,EACxB,IAAK,YAAa,OAAO,EACzB,IAAK,UAAW,OAAO,GAPhB,GAWTmB,EAAqB9C,EAAWc,UAAYzJ,IAAQ2I,EAAW5C,WAChE,sBAAMlI,UAAU,SAAhB,yBACE,WACC,OAAQkE,EAAKuI,MACT,IAAK,OACD,IAAMwB,EAAS/J,EAAK+J,OACpB,OACI,sBAAMjO,UAAU,QAAhB,SAAyBiO,EAAOrD,YAGxC,IAAK,UACD,IAAMqD,EAAS/J,EAAK+J,OACpB,OAAQ,qCACJ,0CACA,sBAAMjO,UAAU,QAAhB,SAAyBiO,EAAO7C,OAChC,2CACA,sBAAMpL,UAAU,QAAhB,SAAyBiO,EAAO/E,aAChC,4CACA,sBAAMlJ,UAAU,QAAhB,SAAyBiO,EAAO9E,aAChC,wCAGR,IAAK,UACD,IAAM8E,EAAS/J,EAAK+J,OACpB,OAAQ,qCACJ,sBAAMjO,UAAU,QAAhB,SAAyBiO,EAAO7N,OAChC,+CACA,sBAAMJ,UAAU,QAAhB,eACA,6CACA,sBAAMA,UAAU,QAAhB,eACA,wCAGR,IAAK,WACD,IAAMiO,EAAS/J,EAAK+J,OACpB,OAAQ,mCACJ,sBAAMjO,UAAU,QAAhB,SAAyB2D,EAAkBsK,EAAOrK,gBAG1D,IAAK,YACD,IAAMqK,EAAS/J,EAAK+J,OACd+Y,EAAMvlB,EAAiBwM,EAAOxC,cAC9Bwb,EAAMxlB,EAAiBwM,EAAOvC,cAC9BomB,EAAU7jB,EAAOzC,WAAWzK,KAAI,SAACiD,GAAD,iBAAgBqB,EAAcrB,GAA9B,QAA0C/D,KAAK,MACrF,OAAQ,qCACJ,sBAAMD,UAAU,QAAhB,SAAyBgnB,IACzB,0CACA,sBAAMhnB,UAAU,QAAhB,SAAyBinB,IACzB,qCAAQ,OACR,sBAAMjnB,UAAU,QAAhB,SAAyB8xB,IACzB,+BAAO,SAGf,IAAK,UACD,IAAM7jB,EAAS/J,EAAK+J,OAChB9C,EAAM,GAQV,OAPmB,OAAf8C,EAAO3C,MAKPH,EAJa8C,EAAO3C,IAAImE,YACL1O,KAAI,SAACqnB,GACpB,MAAM,GAAN,OAAUA,EAAK9E,OAAf,YAAyB8E,EAAK7E,gBAEtBtjB,KAAK,OAEb,qCACJ,qCACA,sBAAMD,UAAU,QAAhB,SAAyBmL,IACzB,yCAhEb,GAsEDyP,EAAsB,WACxB,OAAQ1W,EAAKuI,MACT,IAAK,OAAQ,OAAO,kBAAMgE,EAAWuU,MAAM6K,mBAC3C,IAAK,UAAW,OAAO,kBAAMpf,EAAWuU,MAAMgL,gBAAgB9rB,IAC9D,IAAK,UAAW,OAAO,kBAAMuM,EAAWuU,MAAMsM,iBAAiBptB,IAC/D,IAAK,WAAY,OAAO,kBAAMuM,EAAWuU,MAAM4L,kBAAkB1sB,IACjE,IAAK,YAAa,OAAO,kBAAMuM,EAAWuU,MAAMwL,gBAAgBtsB,IAEpE,OAAO,aARiB,GAUtB6tB,EAAc,GAAa,GAARF,EACzB,OACI,sBAEI7xB,UAAW,CACP,OACAF,EAAW,SAAW,GACtBgL,EAAWc,UAAYd,EAAW5C,aAAe/F,EAAM,OAAS,IAClElC,KAAK,KANX,UAQI,qBAAKD,UAAU,SAASyW,MAAO,CAAE8B,MAAOwZ,EAAc,QACtD,qBAAK/xB,UAAW,CACZ,SACiB,GAAjBkE,EAAK8tB,SAAgB,SAAW,IAClC/xB,KAAK,KAAMC,QAAS,WAClBgE,EAAK+tB,SAAW/tB,EAAK+tB,QACrBnnB,EAAWE,eAAiBwmB,EAAazkB,QACzC0D,EAAWuU,MAAM2K,cAAc7kB,IANnC,SAQI,+BAAO5G,EAAK+tB,QAAU,SAAM,aAE9B,WACE,OAAQ/tB,EAAKuI,MACT,IAAK,OAAQ,OAAQ,qBAAKzM,UAAU,YAAf,SAA2B,0CAChD,IAAK,UAAW,OAAQ,qBAAKA,UAAU,eAAf,SAA8B,6CACtD,IAAK,UAAW,OAAQ,qBAAKA,UAAU,eAAf,SAA8B,6CACtD,IAAK,WAAY,OAAQ,qBAAKA,UAAU,gBAAf,SAA+B,8CACxD,IAAK,YAAa,OAAQ,qBAAKA,UAAU,iBAAf,SAAgC,+CAC1D,IAAK,UAAW,OAAQ,qBAAKA,UAAU,eAAf,SAA8B,8CAP5D,GAUF,qBACIA,UAAW,CACP,QACA8K,EAAW5C,aAAe/F,EAAM,SAAW,IAC7ClC,KAAK,KACPC,QAAS,WACL4K,EAAW5C,WAAa/F,EACxB,IAAMwE,EAAMmE,EAAWE,eAAeF,EAAW5C,YACjD,OAAQvB,EAAI8F,MACR,IAAK,OACD,IAAMvI,EAAOyC,EAAIsH,OACXhD,EAAOH,EAAWG,KAAKC,KAC7BD,EAAKL,UAAY1G,EAAK0G,UACtBK,EAAKE,IAAMnF,KAAKC,UAAU+e,GAE1B,MACJ,IAAK,UACD,IAAM9gB,EAAOyC,EAAIsH,OACXhD,EAAOH,EAAWG,KAAKhC,QAC7BgC,EAAKG,KAAOlH,EAAKkH,KACjBH,EAAK/B,WAAahF,EAAKgF,WACvB+B,EAAK9B,WAAajF,EAAKiF,WAEvB,MACJ,IAAK,UACD,IAAMjF,EAAOyC,EAAIsH,OACXhD,EAAOH,EAAWG,KAAKI,QAC7BJ,EAAK7K,KAAO8D,EAAK9D,KACjB6K,EAAKK,IAAM,KACXL,EAAKE,IAAMnF,KAAKC,UAAU/B,EAAKoH,KAE/B,MACJ,IAAK,WACD,IAAMpH,EAAOyC,EAAIsH,OACJnD,EAAWG,KAAK5I,SACxBA,SAAW6B,EAAKN,WAErB,MACJ,IAAK,YACD,IAAMM,EAAOyC,EAAIsH,OACXhD,EAAOH,EAAWG,KAAKM,UAC7BN,EAAKO,WAAatH,EAAKsH,WACvBP,EAAKQ,aAAevH,EAAKuH,aACzBR,EAAKS,aAAexH,EAAKwH,aAEzB,MACJ,IAAK,UACD,IAAMxH,EAAOyC,EAAIsH,OACXhD,EAAOH,EAAWG,KAAKU,QAC7BV,EAAKK,IAAM,KACXL,EAAKE,IAAMnF,KAAKC,UAAU/B,EAAKoH,KAIvCmF,EAAWuU,MAAM2K,cAAc7kB,IAEnCuL,cAAe,kBAAMuE,KAxDzB,SAyDEhN,MArFGzL,GAsGT+vB,CAAkBhuB,EAAM0tB,EAAcrgB,SAASrN,QAIvDwtB,EAAmBD,KACpB,CAACD,EAAc1mB,EAAW5C,aAGD,IAAxBspB,EAAa3qB,OACb,OAAQ,6BAEZ,IAAMF,EAAM6qB,EAAa1mB,EAAW5C,YAEpC,OACI,sBAAKtH,GAAG,0BAAR,UACI,cAAC,GAAD,IACA,sBAAKZ,UAAU,YAAf,UACI,qBAAKA,UAAU,WAGf,qBAAKA,UAAW,CACZ,OACA8K,EAAWc,SAAW,OAAS,IACjC3L,KAAK,KAHP,SAIKwxB,IAEL,qBAAKzxB,UAAU,iBAInB,qBAAKA,UAAU,aAAf,SAEI,qBAAKY,GAAG,oBAAR,SACI,cAAC,EAAD,CAAYC,UAAU,iBAClBC,YAAa,CACT,CAAEV,KAAM,OAAQc,SAAS,EAAMZ,KAAM,cAAC,GAAD,KACrC,CAAEF,KAAM,UAAWc,SAAS,EAAMZ,KAAM,cAAC,GAAD,KACxC,CAAEF,KAAM,UAAWc,SAAS,EAAMZ,KAAM,cAAC,GAAD,KACxC,CAAEF,KAAM,OAAQc,SAAS,EAAMZ,KAAM,cAAC,GAAD,KACrC,CAAEF,KAAM,YAAac,SAAS,EAAMZ,KAAM,cAAC,GAAD,KAC1C,CAAEF,KAAM,UAAWc,SAAS,EAAMZ,KAAM,cAAC,GAAD,MAE5CG,SACI,WACI,OAAQkG,EAAI8F,MACR,IAAK,OAAQ,OAAO,EACpB,IAAK,UAAW,OAAO,EACvB,IAAK,UAAW,OAAO,EACvB,IAAK,WAAY,OAAO,EACxB,IAAK,YAAa,OAAO,EACzB,IAAK,UAAW,OAAO,GAP/B,aCrRf0lB,GAAa,CACtB,GACA,YACA,gBACA,uBACA,wBACA,wBACA,QACA,WACA,WACA,UACA,QACA,eACA,UACA,aACA,eACA,gBACA,eACA,wBACA,UACA,QACA,aACA,eACA,WACA,WACA,aACA,oBACA,gBACA,WACA,uBACA,qBACA,uBACA,wBACA,uBACA,wBACA,mBACA,mBACA,eACA,SACA,QACA,cACA,gBACA,YACA,kBACA,eACA,kBACA,kBACA,eACA,cACA,aACA,eACA,oBACA,mBACA,UACA,YACA,cACA,aACA,kBACA,UACA,OACA,gBACA,kBACA,kBACA,eACA,iBACA,eACA,gBACA,oBACA,UACA,cACA,YACA,gBACA,OACA,UACA,gBACA,kBACA,oBACA,gBACA,aACA,kBACA,cACA,cACA,iBACA,aACA,cACA,YACA,mBACA,aACA,UACA,oBACA,WACA,aACA,iBACA,aACA,WACA,aACA,WACA,SACA,QACA,cACA,cACA,cACA,cACA,oBACA,oBACA,eACA,eACA,gBACA,gBACA,cACA,aACA,kBACA,kBACA,aACA,kBACA,iBACA,YACA,UACA,cACA,kBACA,WACA,UACA,OACA,gBACA,aACA,QACA,SACA,aACA,UACA,YACA,aC6MWC,GArUU,WAAO,IAAD,EACG7hB,qBAAWC,IAAjCjE,EADmB,EACnBA,MAAOkE,EADY,EACZA,WADY,EASDjQ,oBAAkB,GATjB,mBASpBoJ,EAToB,KASZqkB,EATY,OAWeztB,mBAAwB,IAXvC,mBAWpB6xB,EAXoB,KAWLC,EAXK,OAYS9xB,mBAAwB,IAZjC,mBAYpBya,EAZoB,KAYRsX,EAZQ,KAcrBhoB,EAAW+J,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","file":"static/js/main.b22cfa66.chunk.js","sourcesContent":["import { ChangeType } from \"contents/redux/store\";\r\n\r\nexport const BEAT_WIDTH = 160;\r\nexport const NOTES_HEIGHT = 22;\r\n\r\nexport const DEGREE12_FLAT_LIST = [\r\n    'Ⅰ', 'bⅡ', 'Ⅱ', 'bⅢ', 'Ⅲ', 'Ⅳ', 'bⅤ', 'Ⅴ', 'bⅥ', 'Ⅵ', 'bⅦ', 'Ⅶ'\r\n];\r\nexport const DEGREE12_SHARP_LIST = [\r\n    'Ⅰ', '#Ⅰ', 'Ⅱ', '#Ⅱ', 'Ⅲ', 'Ⅳ', '#Ⅳ', 'Ⅴ', '#Ⅴ', 'Ⅵ', '#Ⅵ', 'Ⅶ'\r\n];\r\n\r\nexport const KEY12_FLAT_LIST = [\r\n    'C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'\r\n];\r\nexport const KEY12_SHARP_LIST = [\r\n    'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'\r\n];\r\nexport const KEY12_MAJOR_SCALE_LIST = [\r\n    'C', 'Db', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'Ab', 'A', 'Bb', 'B'\r\n];\r\nexport const KEY12_MINOR_SCALE_LIST = [\r\n    'Cm', 'C#m', 'Dm', 'D#m', 'Em', 'Fm', 'F#m', 'Gm', 'G#m', 'Am', 'Bbm', 'Bm'\r\n];\r\nexport const SCALE_LIST = [\r\n    'major', 'minor'\r\n];\r\nexport const RYTHM_LIST = [\r\n    '4/4', '2/4', '3/4', '6/8', '12/8'\r\n];\r\n\r\nexport enum TimeSignatures {\r\n    BEAT_4ON4 = '4/4',\r\n    BEAT_2ON4 = '2/4',\r\n    BEAT_3ON4 = '3/4',\r\n    BEAT_6ON8 = '6/8',\r\n    BEAT_12ON8 = '12/8',\r\n}\r\n\r\nexport type KeyScaleParams = {\r\n    keyIndex: number;\r\n    signature: number;\r\n}\r\n\r\nexport enum KeyScale {\r\n    C_DUR = '0',\r\n    DES_DUR = '1',\r\n};\r\n\r\nexport const DIATONIC_MAJOR_SCALE_DEGREE_NAMES = [\r\n    'Ⅰ', 'Ⅰmaj7',\r\n    'Ⅱm', 'Ⅱm7',\r\n    'Ⅲm', 'Ⅲm7',\r\n    'Ⅳ', 'Ⅳmaj7',\r\n    'Ⅴ', 'Ⅴ7',\r\n    'Ⅵm', 'Ⅵm7',\r\n    'Ⅶm(-5)', 'Ⅶm7(-5)'\r\n]\r\n\r\nexport const DIATONIC_NATURAL_MINOR_SCALE_DEGREE_NAMES = [\r\n    'Ⅰm', 'Ⅰm7',\r\n    'Ⅱm(-5)', 'Ⅱm7(-5)',\r\n    'bⅢ', 'bⅢM7',\r\n    'Ⅳm', 'Ⅳm7',\r\n    'Ⅴm', 'Ⅴm7',\r\n    'bⅥ', 'bⅥM7',\r\n    'bⅦ', 'bⅦ7'\r\n]\r\nexport enum SymbolKey {\r\n    MAJOR,\r\n    MINOR,\r\n    SUS4,\r\n    DIM,\r\n    AUG,\r\n    MAJ7,\r\n    SEVENTH,\r\n    MIN7,\r\n    MINOR_MAJ7,\r\n    ADD9,\r\n    MINOR_ADD9,\r\n    SIXTH_9TH,\r\n    MINOR_MINUS5,\r\n    MIN7_MINUS5,\r\n}\r\n\r\nexport enum SymbolType {\r\n    TRIAD,\r\n    TETRAD7TH,\r\n    TETRAD6TH,\r\n    ADD9TH,\r\n    SEVENTH_9TH,\r\n    SIXTH_9TH\r\n}\r\n\r\nexport type SymbolParams = {\r\n    key: SymbolKey;\r\n    category: SymbolType;\r\n    name: string;\r\n    struct: string[];\r\n    intervals: number[];\r\n}\r\n\r\n// export const SYMBOL_PARAMS_LIST: SymbolParams[] = [\r\n//     { key: SymbolKey.MAJOR, category: SymbolType.TRIAD, sortNo: 1, \"parentNo\": 0, \"depth\": 1, \"name\": \"\", \"struct\": ['p1', 'M3', 'p5'], \"fixed\": ['p1'], \"intervals\": [0, 4, 7] },\r\n//     { key: SymbolKey.MINOR, category: SymbolType.TRIAD, sortNo: 2, \"parentNo\": 0, \"depth\": 1, \"name\": \"m\", \"struct\": ['p1', 'm3', 'p5'], \"fixed\": [\"p1\"], \"intervals\": [0, 3, 7] },\r\n//     { key: SymbolKey.SUS4, category: SymbolType.TRIAD, sortNo: 3, \"parentNo\": 0, \"depth\": 1, \"name\": \"sus4\", \"struct\": ['p1', 'p4', 'p5'], \"fixed\": [\"p1\"], \"intervals\": [0, 5, 7] },\r\n//     { key: SymbolKey.DIM, category: SymbolType.TRIAD, sortNo: 4, \"parentNo\": 0, \"depth\": 1, \"name\": \"dim\", \"struct\": ['p1', 'm3', 'd5'], \"fixed\": [\"p1\"], \"intervals\": [0, 3, 6] },\r\n//     { key: SymbolKey.AUG, category: SymbolType.TRIAD, sortNo: 5, \"parentNo\": 0, \"depth\": 1, \"name\": \"aug\", \"struct\": ['p1', 'M3', 'a5'], \"fixed\": [\"p1\"], \"intervals\": [0, 4, 8] },\r\n//     { key: SymbolKey.MAJ7, category: SymbolType.TETRAD7TH, sortNo: 6, \"parentNo\": 0, \"depth\": 1, \"name\": \"maj7\", \"struct\": ['p1', 'M3', 'p5', 'M7'], \"fixed\": [\"p1\"], \"intervals\": [0, 4, 7, 11] },\r\n//     { key: SymbolKey.SEVENTH, category: SymbolType.TETRAD7TH, sortNo: 7, \"parentNo\": 0, \"depth\": 1, \"name\": \"7\", \"struct\": ['p1', 'M3', 'p5', 'm7'], \"fixed\": [\"p1\"], \"intervals\": [0, 4, 7, 10] },\r\n//     { key: SymbolKey.MIN7, category: SymbolType.TETRAD7TH, sortNo: 8, \"parentNo\": 0, \"depth\": 1, \"name\": \"m7\", \"struct\": ['p1', 'm3', 'p5', 'm7'], \"fixed\": [\"p1\"], \"intervals\": [0, 3, 7, 10] },\r\n//     { key: SymbolKey.MINOR_MAJ7, category: SymbolType.TETRAD7TH, sortNo: 9, \"parentNo\": 0, \"depth\": 1, \"name\": \"mmaj7\", \"struct\": ['p1', 'm3', 'p5', 'M7'], \"fixed\": [\"p1\"], \"intervals\": [0, 3, 7, 11] },\r\n//     { key: SymbolKey.ADD9, category: SymbolType.TETRAD9TH, sortNo: 10, \"parentNo\": 0, \"depth\": 1, \"name\": \"add9\", \"struct\": ['p1', 'M2', 'M3', 'p5'], \"fixed\": [\"p1\"], \"intervals\": [0, 2, 4, 7] },\r\n//     { key: SymbolKey.MINOR_ADD9, category: SymbolType.TETRAD9TH, sortNo: 11, \"parentNo\": 0, \"depth\": 1, \"name\": \"madd9\", \"struct\": ['p1', 'M2', 'm3', 'p5'], \"fixed\": [\"p1\"], \"intervals\": [0, 2, 3, 7] },\r\n//     { key: SymbolKey.SIXTH_9TH, category: SymbolType.OTHER, sortNo: 12, \"parentNo\": 0, \"depth\": 1, \"name\": \"6(9)\", \"struct\": ['p1', 'M2', 'M3', 'p5', 'M6'], \"fixed\": [\"p1\"], \"intervals\": [0, 2, 4, 7, 9] },\r\n//     { key: SymbolKey.MINOR_MINUS5, category: SymbolType.TRIAD, sortNo: 13, \"parentNo\": 0, \"depth\": 1, \"name\": \"m(-5)\", \"struct\": ['p1', 'm3', 'd5'], \"fixed\": [\"p1\"], \"intervals\": [0, 3, 6] },\r\n// ];\r\n\r\nexport const SYMBOL_PARAMS_LIST: SymbolParams[] = [\r\n    { key: SymbolKey.MAJOR, category: SymbolType.TRIAD, name: \"\", \"struct\": ['p1', 'M3', 'p5'], \"intervals\": [0, 4, 7] },\r\n    { key: SymbolKey.MINOR, category: SymbolType.TRIAD, name: \"m\", \"struct\": ['p1', 'm3', 'p5'], \"intervals\": [0, 3, 7] },\r\n    { key: SymbolKey.SUS4, category: SymbolType.TRIAD, name: \"sus4\", \"struct\": ['p1', 'p4', 'p5'], \"intervals\": [0, 5, 7] },\r\n    { key: SymbolKey.DIM, category: SymbolType.TRIAD, name: \"dim\", \"struct\": ['p1', 'm3', 'd5'], \"intervals\": [0, 3, 6] },\r\n    { key: SymbolKey.AUG, category: SymbolType.TRIAD, name: \"aug\", \"struct\": ['p1', 'M3', 'a5'], \"intervals\": [0, 4, 8] },\r\n    { key: SymbolKey.MAJ7, category: SymbolType.TETRAD7TH, name: \"maj7\", \"struct\": ['p1', 'M3', 'p5', 'M7'], \"intervals\": [0, 4, 7, 11] },\r\n    { key: SymbolKey.SEVENTH, category: SymbolType.TETRAD7TH, name: \"7\", \"struct\": ['p1', 'M3', 'p5', 'm7'], \"intervals\": [0, 4, 7, 10] },\r\n    { key: SymbolKey.MIN7, category: SymbolType.TETRAD7TH, name: \"m7\", \"struct\": ['p1', 'm3', 'p5', 'm7'], \"intervals\": [0, 3, 7, 10] },\r\n    { key: SymbolKey.MINOR_MAJ7, category: SymbolType.TETRAD7TH, name: \"mmaj7\", \"struct\": ['p1', 'm3', 'p5', 'M7'], \"intervals\": [0, 3, 7, 11] },\r\n    { key: SymbolKey.ADD9, category: SymbolType.ADD9TH, name: \"add9\", \"struct\": ['p1', 'M2', 'M3', 'p5'], \"intervals\": [0, 2, 4, 7] },\r\n    { key: SymbolKey.MINOR_ADD9, category: SymbolType.ADD9TH, name: \"madd9\", \"struct\": ['p1', 'M2', 'm3', 'p5'], \"intervals\": [0, 2, 3, 7] },\r\n    { key: SymbolKey.SIXTH_9TH, category: SymbolType.SIXTH_9TH, name: \"6(9)\", \"struct\": ['p1', 'M2', 'M3', 'p5', 'M6'], \"intervals\": [0, 2, 4, 7, 9] },\r\n    { key: SymbolKey.MINOR_MINUS5, category: SymbolType.TRIAD, name: \"m(-5)\", \"struct\": ['p1', 'm3', 'd5'], \"intervals\": [0, 3, 6] },\r\n    { key: SymbolKey.MIN7_MINUS5, category: SymbolType.TETRAD7TH, name: \"m7(-5)\", \"struct\": ['p1', 'm3', 'd5', 'm7'], \"intervals\": [0, 3, 6, 10] },\r\n];\r\n\r\nexport type SymbolTypeParams = {\r\n    type: SymbolType;\r\n    list: SymbolKey[];\r\n}\r\nexport const SYMBOL_TYPE_LIST: SymbolTypeParams[] = [\r\n    {\r\n        type: SymbolType.TRIAD, list: [\r\n            SymbolKey.MAJOR,\r\n            SymbolKey.MINOR,\r\n            SymbolKey.SUS4,\r\n            SymbolKey.DIM,\r\n            SymbolKey.AUG,\r\n            SymbolKey.MINOR_MINUS5\r\n        ]\r\n    },\r\n    {\r\n        type: SymbolType.TETRAD7TH, list: [\r\n            SymbolKey.MAJ7,\r\n            SymbolKey.SEVENTH,\r\n            SymbolKey.MINOR_MAJ7,\r\n        ]\r\n    },\r\n    {\r\n        type: SymbolType.ADD9TH, list: [\r\n            SymbolKey.ADD9,\r\n            SymbolKey.MINOR_ADD9,\r\n        ]\r\n    },\r\n];\r\n\r\nexport type ChordPair = {\r\n    degreeIndex: number;\r\n    symbolKey: SymbolKey;\r\n    isFlat: boolean;\r\n}\r\nexport const DIATONIC_MAJOR_SCALE_LIST: ChordPair[] = [\r\n    { degreeIndex: 0, symbolKey: SymbolKey.MAJOR, isFlat: false},\r\n    { degreeIndex: 2, symbolKey: SymbolKey.MINOR, isFlat: false },\r\n    { degreeIndex: 4, symbolKey: SymbolKey.MINOR, isFlat: false },\r\n    { degreeIndex: 5, symbolKey: SymbolKey.MAJOR, isFlat: false },\r\n    { degreeIndex: 7, symbolKey: SymbolKey.MAJOR, isFlat: false },\r\n    { degreeIndex: 9, symbolKey: SymbolKey.MINOR, isFlat: false },\r\n    { degreeIndex: 11, symbolKey: SymbolKey.MINOR_MINUS5, isFlat: false },\r\n];\r\n\r\nexport const DIATONIC_MINOR_SCALE_LIST: ChordPair[] = [\r\n    { degreeIndex: 0, symbolKey: SymbolKey.MINOR, isFlat: false },\r\n    { degreeIndex: 2, symbolKey: SymbolKey.MINOR_MINUS5, isFlat: false },\r\n    { degreeIndex: 3, symbolKey: SymbolKey.MAJOR, isFlat: true },\r\n    { degreeIndex: 5, symbolKey: SymbolKey.MINOR, isFlat: false },\r\n    { degreeIndex: 7, symbolKey: SymbolKey.MINOR, isFlat: false },\r\n    { degreeIndex: 8, symbolKey: SymbolKey.MAJOR, isFlat: true },\r\n    { degreeIndex: 10, symbolKey: SymbolKey.MAJOR, isFlat: true },\r\n];\r\n\r\nexport const getChangeTypeLabel = (changeType: ChangeType) => {\r\n    switch(changeType) {\r\n        case ChangeType.MODULATE: return 'MODULATE';\r\n        case ChangeType.TEMPO: return 'TEMPO';\r\n        case ChangeType.BEAT: return 'BEAT';\r\n    }\r\n}\r\n\r\nexport const HOSTING_URL_ROOT = 'https://cyber-kohno.github.io/vh-react/';\r\nexport const API_DOMAIN = 'https://vh-sqlite.glitch.me';\r\n// export const API_DOMAIN = 'http://localhost:5000';","import { useState, useEffect } from 'react';\r\n\r\nimport './TabbedPane.css';\r\n\r\ntype TabbedPaneProps = {\r\n    groupName: string;\r\n    activeNo: number;\r\n    tabElements: TabElements[];\r\n    selectTabIndex?: Function;\r\n}\r\n\r\ntype TabElements = {\r\n    name: string;\r\n    disable: boolean;\r\n    cont: JSX.Element;\r\n}\r\n\r\nconst TabbedPane = (props: TabbedPaneProps) => {\r\n    const [activeNo, setActiveNo] = useState(props.activeNo);\r\n\r\n    // const [tabList, setTabList] = useState<JSX.Element[]>([]);\r\n    // const [contList, setContList] = useState<JSX.Element[]>([]);\r\n\r\n    // タブ押下時の処理\r\n    const selectTabIndex = (index: number) => {\r\n        if (props.selectTabIndex !== undefined) {\r\n            props.selectTabIndex(index);\r\n        } else {\r\n            setActiveNo(index);\r\n        }\r\n    };\r\n\r\n    // useEffect(() => {\r\n    //     const tabList: JSX.Element[] = [];\r\n    //     const contList: JSX.Element[] = [];\r\n    //     props.tabElements.forEach((tab, index) => {\r\n    //         tabList.push(\r\n    //             <TabLabel\r\n    //                 key={index} name={tab.name} isActive={index == activeNo} isDisable={tab.disable}\r\n    //                 selectTab={() => selectTabIndex(index)}\r\n    //             />)\r\n    //             ;\r\n    //         contList.push(\r\n    //             <TabContents key={index} cont={tab.cont} isActive={index == activeNo} />\r\n    //         );\r\n    //     });\r\n    //     setTabList(tabList);\r\n    //     setContList(contList);\r\n    //     console.log('create TabbedPane');\r\n    // }, [activeNo]);\r\n\r\n    useEffect(() => {\r\n        setActiveNo(props.activeNo);\r\n    }, [props.activeNo]);\r\n\r\n    return (\r\n        <div id={props.groupName}>\r\n            <div className=\"tab-list\">\r\n                {/* {tabList} */}\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <TabLabel\r\n                            key={index} name={tab.name} isActive={index == activeNo} isDisable={tab.disable}\r\n                            selectTab={() => selectTabIndex(index)}\r\n                        />\r\n                    })\r\n                }\r\n            </div>\r\n            <div className=\"cont-list\">\r\n                {/* {contList} */}\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <TabContents key={index} cont={tab.cont} isActive={index == activeNo} />\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nconst TabLabel = (props: {\r\n    name: string;\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n    selectTab: Function;\r\n}) => {\r\n    const classValues = [];\r\n    classValues.push('tab-menu');\r\n    classValues.push(props.isActive ? 'active' : '');\r\n    classValues.push(props.isDisable ? 'tab-disable' : '');\r\n    return (\r\n        <div className={classValues.join(' ')} onClick={() => props.selectTab()}>\r\n            <span>{props.name}</span>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst TabContents = (props: {\r\n    isActive: boolean;\r\n    cont: JSX.Element;\r\n}) => {\r\n    // return props.isActive ?\r\n    //     <div className=\"tab-cont\">{props.cont}</div>\r\n    //     :\r\n    //     <></>\r\n    //     ;\r\n    return <div className={[\r\n        'tab-cont',\r\n        !props.isActive ? 'hidden' : ''\r\n    ].join(' ')}>{props.cont}</div>;\r\n}\r\n\r\nexport default TabbedPane;","import { Key12Info, TypeNoteElement } from \"contents/redux/store\";\r\nimport { Sampler } from \"tone\";\r\nimport { API_DOMAIN, KEY12_FLAT_LIST, KEY12_SHARP_LIST, SymbolKey, SymbolParams, SymbolType, SYMBOL_PARAMS_LIST } from \"./define\";\r\n\r\n\r\n\r\nexport const getDefaultNoteData = () => {\r\n    return [\r\n        {\r\n            type: TypeNoteElement.Init,\r\n            detail: {\r\n                tempo: 80,\r\n                rythm: '4/4',\r\n                keyIndex: 0,\r\n                scale: 'major'\r\n            }\r\n        },\r\n        {\r\n            type: TypeNoteElement.Fixed,\r\n            detail: {\r\n                label: 'START'\r\n            }\r\n        },\r\n        {\r\n            type: TypeNoteElement.Section,\r\n            detail: {\r\n                labelName: 'Section'\r\n            }\r\n        },\r\n        {\r\n            type: TypeNoteElement.Fixed,\r\n            detail: {\r\n                label: 'END'\r\n            }\r\n        },\r\n    ]\r\n}\r\n\r\nexport const initDefaultSampler = () => {\r\n    return new Sampler({\r\n        \"E2\": \"https://dl.dropbox.com/s/0aghs80w9aggubw/KEPSREC040.mp3?dl=0\",\r\n        \"E3\": \"https://dl.dropbox.com/s/wxtf0u0ly03hu44/KEPSREC052.mp3?dl=0\",\r\n        \"A#3\": \"https://dl.dropbox.com/s/hbm9d1vo5tlxymk/KEPSREC058.mp3?dl=0\",\r\n        \"E4\": \"https://dl.dropbox.com/s/3qy88udfkzmzr13/KEPSREC064.mp3?dl=0\",\r\n        \"E5\": \"https://dl.dropbox.com/s/tdjp24r9pfoi2ff/KEPSREC076.mp3?dl=0\",\r\n        \"E6\": \"https://dl.dropbox.com/s/onp7h2vn2d6nhs7/KEPSREC088.mp3?dl=0\",\r\n    }).toDestination();\r\n}\r\n\r\nexport const loadSampler = (sample: Object) => {\r\n    return new Sampler(sample).toDestination();\r\n}\r\n\r\nexport const getSymbolTypeName = (symbolType: SymbolType): string => {\r\n    return ((): string => {\r\n        switch (symbolType) {\r\n            case SymbolType.TRIAD: return 'Triad'\r\n            case SymbolType.TETRAD7TH: return '7th'\r\n            case SymbolType.TETRAD6TH: return '6th'\r\n            case SymbolType.ADD9TH: return 'Add9th'\r\n            case SymbolType.SIXTH_9TH: return '6th-9th'\r\n            case SymbolType.SEVENTH_9TH: return '7th-9th'\r\n        }\r\n    })();\r\n}\r\n\r\nexport const getSymbolsIncludeCategory = (symbolType: SymbolType): SymbolKey[] => {\r\n    return SYMBOL_PARAMS_LIST.filter((symbol) => {\r\n        return symbolType === symbol.category;\r\n    }).map((symbol) => symbol.key);\r\n}\r\n\r\nexport function getSymbolParams(key: SymbolKey): SymbolParams | null {\r\n    let symbol = null;\r\n    SYMBOL_PARAMS_LIST.forEach((data) => {\r\n        if (data.key == key) {\r\n            symbol = data;\r\n        }\r\n    });\r\n    return symbol;\r\n}\r\n\r\nexport const getAdjustSusValue = (value: number): string => {\r\n    let ret = '';\r\n    if (value != 0) {\r\n        if (value > 0) ret = '+' + value;\r\n        else ret = value.toString();\r\n    }\r\n    return ret;\r\n}\r\n\r\n/**　コードネームを返す */\r\nexport const getChordRoot = (rootInfo: Key12Info | null, keyIndex: number): string | null => {\r\n    let name = null;\r\n    if (rootInfo != null) {\r\n        const list = rootInfo.isFlat ? KEY12_FLAT_LIST : KEY12_SHARP_LIST;\r\n        name = list[(rootInfo.rootIndex + keyIndex) % 12];\r\n    }\r\n    return name;\r\n}\r\n\r\n/**　シンボルを返す */\r\nexport const getSymbolName = (symbolKey: SymbolKey): string => {\r\n    let name = '';\r\n    SYMBOL_PARAMS_LIST.forEach((symbol) => {\r\n        if (symbol.key == symbolKey) {\r\n            name = symbol.name;\r\n        }\r\n    });\r\n    return name;\r\n}\r\n\r\nexport const createQueryRequestInit = (sql: string): RequestInit => {\r\n    return {\r\n        mode: 'cors',\r\n        method: 'POST',\r\n        headers: {\r\n            Accept: 'application/json',\r\n            'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ sql })\r\n    }\r\n}\r\n\r\nexport const sendQueryRequestToAPI = (queryType: 'select' | 'update', sql: string): Promise<Response> => {\r\n    return fetch(API_DOMAIN + '/' + queryType,\r\n        createQueryRequestInit(sql)\r\n    );\r\n}\r\n\r\nexport const applyOnChord = (symbol: SymbolParams, molRootIndex: number, denRootIndex: number) => {\r\n\r\n    // 分母とコードルートの差分を算出\r\n    let denInterval = denRootIndex - molRootIndex;\r\n    if (denInterval < 0) {\r\n        denInterval += 12;\r\n    }\r\n    const fixedIntervals: number[] = [];\r\n    const fixedStruct: string[] = [];\r\n    let isAdded = false;\r\n    symbol.intervals.forEach((cur, i) => {\r\n        if (i < symbol.intervals.length) {\r\n            // const next = symbol.intervals[i + 1];\r\n            // if(cur <= denInterval && denInterval < next) {\r\n            if (!isAdded && denInterval < cur) {\r\n                fixedIntervals.push(denInterval);\r\n                fixedStruct.push('den');\r\n                isAdded = true;\r\n            }\r\n            if (denInterval != cur) {\r\n                fixedIntervals.push(cur);\r\n                fixedStruct.push(symbol.struct[i]);\r\n            }\r\n        }\r\n    });\r\n    if (!isAdded) {\r\n        fixedIntervals.push(denInterval);\r\n        fixedStruct.push('den');\r\n    }\r\n    symbol.intervals = fixedIntervals;\r\n    symbol.struct = fixedStruct;\r\n\r\n}","import { SymbolKey, SymbolType, SYMBOL_PARAMS_LIST, TimeSignatures } from 'contents/common/define'\r\nimport { initDefaultSampler } from 'contents/common/utils'\r\nimport { Sampler } from 'tone'\r\nimport Soundfont from 'soundfont-player';\r\nimport { Instrument } from 'tone/build/esm/instrument/Instrument'\r\nimport { ActionType } from './reducer'\r\nimport { FormDispatcher } from './store/FormDispatcher';\r\nimport { TuneState } from './store/TuneState';\r\n\r\nexport type Store = {\r\n    login: LoginParams;\r\n    dialog: Dialog;\r\n    scoreTabIndex: number;\r\n    noteData: NoteData;\r\n    noteState: NoteState;\r\n    tuneState: TuneState;\r\n    themaDataTree: ThemaDataTree;\r\n    themaState: ThemaState;\r\n    reffers: Reffers;\r\n    sampler: Sampler;\r\n    instrument: null | Soundfont.Player;\r\n    soundUseList: number[];\r\n    dinamicCache: null | object;\r\n    formDispatcher: FormDispatcher;\r\n}\r\n\r\nexport type LoginParams = {\r\n    isLogin: boolean,\r\n    id: number,\r\n    name: string\r\n}\r\n\r\nexport type Dialog = {\r\n    left: number;\r\n    top: number;\r\n    arg?: object;\r\n    contents: null | JSX.Element;\r\n}\r\n\r\nexport type ScoreCache = {\r\n    reffer?: HTMLDivElement;\r\n    init: DetailInit;\r\n    progress: ScoreProgress;\r\n}\r\n\r\n/**\r\n * 譜面の進捗情報を管理するタイプ。\r\n */\r\nexport type ScoreProgress = {\r\n    /** 連番 */\r\n    no: number;\r\n    /** 小節の合計 */\r\n    barCount: number;\r\n    /** 余りの拍 */\r\n    remaindBeat: number;\r\n    /** 小節頭が訪れる時間（ミリ秒） */\r\n    headMSec: number;\r\n}\r\n\r\nexport type Reffers = {\r\n    contextMneu: HTMLDivElement;\r\n    chordPalette: HTMLDivElement;\r\n    sectionPalette: HTMLDivElement;\r\n    changePalette: HTMLDivElement;\r\n    initPalette: HTMLDivElement;\r\n    backingPalette: HTMLDivElement;\r\n}\r\n\r\nexport enum FloatWndState {\r\n    NONE,\r\n    CONTEXT_MENU,\r\n    CHORD_PALETTE,\r\n    SECTION_PALETTE,\r\n    CHANGE_PALETTE,\r\n    INIT_PALETTE,\r\n    BACKING_PALETTE,\r\n    SETTING_EDITOR,\r\n    THEMA_ACCESSOR,\r\n}\r\n\r\nexport type ChordPaletteState = {\r\n    isAddition: boolean;\r\n    selectedLine: ChordPaletteLine,\r\n    // rootIndex: number;\r\n    // isFlat: false;\r\n    molecule: Key12Info;\r\n    denominator: Key12Info | null;\r\n    symbolKey: SymbolKey;\r\n    sustain: number;\r\n    headAdjust: number;\r\n    tailAdjust: number;\r\n}\r\nexport enum ChordPaletteLine {\r\n    Root, Symbol, Sustain, Adjuster\r\n}\r\n\r\nexport type BackingEditorState = {\r\n    target: BackingEditTarget;\r\n    isDispVoicing: boolean;\r\n    isEditPattern: boolean;\r\n    molecule: Key12Info;\r\n    denominator: Key12Info | null;\r\n    symbolKey: SymbolKey;\r\n    sustain: number;\r\n    headAdjust: number;\r\n    tailAdjust: number;\r\n    channelRowSize: number;\r\n    useChannels: ChannelParam[];\r\n    layers: BackingLayer[];\r\n    isUsePedal: boolean;\r\n    selectedLenIndex: number;\r\n    sideIndex: number;\r\n    selectedChannelIndex: number;\r\n    isCorrect: boolean;\r\n}\r\nexport type BackingEditTarget = 'note' | 'thema-pattern' | 'thema-voicing';\r\n\r\nexport type ChannelParam = {\r\n    octave: number;\r\n    structIndex: number;\r\n}\r\nexport type BackingLayer = {\r\n    side: BACKING_SIDE;\r\n    lens: BackingLen[];\r\n    table: boolean[][][];\r\n    vels: number[];\r\n}\r\nexport enum BACKING_SIDE {\r\n    LEFT = 'LEFT',\r\n    RIGHT = 'RIGHT'\r\n}\r\n\r\nexport type BackingLen = {\r\n    len: BACKING_LEN_TYPE;\r\n    isHalf: boolean;\r\n    isDiv3: boolean;\r\n}\r\n\r\nexport enum BACKING_LEN_TYPE {\r\n    LEN16 = 'LEN16',\r\n    LEN8 = 'LEN8',\r\n    LEN4 = 'LEN4',\r\n    LEN2 = 'LEN2',\r\n    LEN1 = 'LEN1',\r\n}\r\n\r\n\r\nexport type NoteData = {\r\n    scoreName: string;\r\n    chordMode: CHORD_MODE;\r\n    soundFont: SoundFontProp;\r\n    dataList: NoteElement[];\r\n    columnList: Column[];\r\n}\r\n\r\nexport type SoundFontProp = {\r\n    name: '' | Soundfont.InstrumentName;\r\n    gain: number;\r\n}\r\n\r\nexport type Column = {\r\n    len4: number;\r\n    len8: number;\r\n    len16: number;\r\n    len4div3: number;\r\n    len8div3: number;\r\n    soundIndex: number;\r\n}\r\n\r\n/**\r\n * 譜面の入力モードを定義\r\n */\r\nexport enum CHORD_MODE {\r\n    /** 音階コード入力 */\r\n    SCALE = 'SCALE',\r\n    /** 直接コード入力 */\r\n    DIRECT = 'DIRECT'\r\n}\r\n\r\nexport type NoteState = {\r\n    cuScoreId: number;\r\n    focusIndex: number;\r\n    cacheList: ScoreCache[];\r\n    criteriaIndex: number;\r\n    editMode: EditMode;\r\n    selectedList: number[];\r\n    defaultSustain: number;\r\n    floatwndState: FloatWndState;\r\n    chordPaletteState: ChordPaletteState;\r\n    backingPaletteState: null | BackingEditorState;\r\n    backingThreads: NodeJS.Timeout[];\r\n    ensembleInfo: EnsembleInfo;\r\n    cloneRange: number[];\r\n    cloneDataList: NoteElement[];\r\n}\r\n\r\nexport type ThemaState = {\r\n    focusIndex: number;\r\n    focusRef: null | ThemaReffer;\r\n    themaCacheList: ThemaIndexedElement[];\r\n    form: ThemaForm;\r\n    isCreate: boolean;\r\n}\r\n\r\nexport type ThemaForm = {\r\n    root: ThemaFormRoot;\r\n    sustain: ThemaFormSustain;\r\n    pattern: ThemaFormPattern;\r\n    category: ThemaFormCategory;\r\n    condition: ThemaFormCondition;\r\n    voicing: ThemaFormVoicing;\r\n}\r\n\r\nexport interface ThemaFormRoot {\r\n    themaName: string;\r\n    src: string;\r\n}\r\nexport interface ThemaFormSustain {\r\n    beat: null | number;\r\n    headAdjust: number;\r\n    tailAdjust: number;\r\n}\r\nexport interface ThemaFormPattern {\r\n    name: string;\r\n    def: null | BackingPattern;\r\n    src: string;\r\n}\r\nexport interface ThemaFormCategory {\r\n    category: null | SymbolType;\r\n}\r\nexport interface ThemaFormCondition {\r\n    tgtSymbols: SymbolKey[];\r\n    minRootIndex: number;\r\n    maxRootIndex: number;\r\n}\r\nexport interface ThemaFormVoicing {\r\n    def: null | BackingVoicing;\r\n    src: string;\r\n}\r\n\r\nexport type ThemaIndexedElement = {\r\n    isClose: boolean;\r\n    ChildCnt: number;\r\n    type: ThemaElementType;\r\n    reffer: ThemaReffer;\r\n    parent: null | ThemaIndexedElement;\r\n}\r\n\r\nexport type ThemaReffer = ThemaDataTree | BTSustain | BTPattern | VoicingTargetType | VoicingTargetCondition | BTVoicing;\r\n\r\nexport type ThemaElementType = 'root' | 'sustain' | 'pattern' | 'category' | 'condition' | 'voicing';\r\n\r\nexport type ThemaDataTree = {\r\n    themaName: string;\r\n    sustains: BTSustain[];\r\n}\r\n\r\nexport type BTSustain = {\r\n    beat: number;\r\n    headAdjust: number;\r\n    tailAdjust: number;\r\n    patterns: BTPattern[];\r\n}\r\n\r\nexport type BTPattern = {\r\n    name: string;\r\n    def: null | BackingPattern;\r\n    tgtTypes: VoicingTargetType[];\r\n}\r\n\r\nexport type BackingPattern = {\r\n    layers: BackingLayer[];\r\n    isUsePedal: boolean;\r\n}\r\n\r\nexport type VoicingTargetType = {\r\n    symbolType: SymbolType;\r\n    conditions: VoicingTargetCondition[];\r\n}\r\n\r\nexport type VoicingTargetCondition = {\r\n    tgtSymbols: SymbolKey[];\r\n    minRootIndex: number;\r\n    maxRootIndex: number;\r\n    voicings: BTVoicing[];\r\n}\r\n\r\nexport type BTVoicing = {\r\n    def: null | BackingVoicing;\r\n}\r\n\r\nexport type BackingVoicing = {\r\n    useChannels: ChannelParam[];\r\n}\r\n\r\ntype EnsembleInfo = {\r\n    fileURL: string;\r\n    audio: HTMLAudioElement;\r\n    startPosition: number;\r\n    volume: number;\r\n    isLoad: boolean;\r\n}\r\n\r\nexport enum EditMode {\r\n    NORMAL,\r\n    TRANSPLANT,\r\n    CLONE,\r\n    PREVIEW,\r\n}\r\n\r\nexport type DetailInit = {\r\n    tempo: number;\r\n    rythm: string;\r\n    keyIndex: number;\r\n    scale: string;\r\n}\r\n\r\nexport type DetailSection = {\r\n    labelName: string;\r\n}\r\n\r\nexport type DetailChord = {\r\n    molecule: Key12Info | null;\r\n    denominator: Key12Info | null;\r\n    symbolKey: SymbolKey;\r\n    sustain: number;\r\n    headAdjust: number;\r\n    tailAdjust: number;\r\n    backing: BackingScript;\r\n}\r\n\r\nexport type Key12Info = {\r\n    rootIndex: number;\r\n    isFlat: boolean;\r\n}\r\n\r\nexport type BackingScript = {\r\n    useChannels: ChannelParam[];\r\n    layers: BackingLayer[];\r\n    isUsePedal: boolean;\r\n}\r\n\r\nexport type DetailFixed = {\r\n    label: string;\r\n}\r\n\r\nexport type DetailChange = {\r\n    changeType: null | ChangeType;\r\n    modulateRelation: null | ModulateRelation;\r\n    domminantValue: number;\r\n    keyAdjust: number;\r\n    tempoRelation: null | TempoRelation;\r\n    tempoDiff: number;\r\n    tempoRate: number;\r\n    tempoAbsolute: number;\r\n    beat: null | TimeSignatures;\r\n}\r\n\r\nexport enum ChangeType {\r\n    MODULATE = 'Modulate',\r\n    TEMPO = 'Tempo',\r\n    BEAT = 'Beat'\r\n}\r\n\r\n// export type ChangeModulation = {\r\n//     relation: ModulateRelation;\r\n//     value: number;\r\n// }\r\n\r\nexport enum ModulateRelation {\r\n    DOMINANT = 'Domminant',\r\n    PARALLEL = 'Parallel',\r\n    RELATIVE = 'Relative',\r\n    KEY = 'Key',\r\n}\r\n\r\n// export type ChangeBeat = {\r\n//     value: number;\r\n// }\r\n\r\n// export type ChangeTempo = {\r\n//     relation: TempoRelation;\r\n//     value: number;\r\n// }\r\n\r\nexport enum TempoRelation {\r\n    DIFF = 'Diff',\r\n    RATE = 'Rate',\r\n    ABSOLUTE = 'Absolute'\r\n}\r\n\r\nexport type NoteElement = {\r\n    type: TypeNoteElement;\r\n    detail: DetailInit | DetailSection | DetailChord | DetailChange | DetailFixed;\r\n}\r\n\r\n/**\r\n * ノート要素の種類を定義します。\r\n */\r\nexport enum TypeNoteElement {\r\n    /** 初期値 */\r\n    Init = 'init',\r\n    /** セクション */\r\n    Section = 'section',\r\n    /** コード */\r\n    Chord = 'chord',\r\n    /** 転調 */\r\n    Change = 'Change',\r\n    /** 固定要素 */\r\n    Fixed = 'fixed'\r\n}\r\n\r\n/**\r\n * ディスパッチメソッドに指定するオブジェクトを定義します。\r\n */\r\nexport type Action = {\r\n    type: ActionType;\r\n    payload: any;\r\n}\r\n\r\n/**\r\n * ステートの初期値\r\n */\r\nexport const initialState: Store = {\r\n    login: {\r\n        isLogin: false,\r\n        id: -1,\r\n        name: ''\r\n    },\r\n    dialog: {\r\n        left: 0,\r\n        top: 0,\r\n        contents: null\r\n    },\r\n    scoreTabIndex: 0,\r\n    noteData: {\r\n        scoreName: '',\r\n        chordMode: CHORD_MODE.SCALE,\r\n        soundFont: {\r\n            name: '',\r\n            gain: 1\r\n        },\r\n        dataList: [],\r\n        columnList: []\r\n    },\r\n    noteState: {\r\n        cuScoreId: -1,\r\n        focusIndex: -1,\r\n        cacheList: [],\r\n        criteriaIndex: -1,\r\n        editMode: EditMode.NORMAL,\r\n        selectedList: [],\r\n        defaultSustain: 2,\r\n        floatwndState: FloatWndState.NONE,\r\n        chordPaletteState: {\r\n            isAddition: false,\r\n            selectedLine: ChordPaletteLine.Root,\r\n            molecule: { rootIndex: 0, isFlat: false },\r\n            denominator: null,\r\n            symbolKey: SYMBOL_PARAMS_LIST[0].key,\r\n            sustain: 4,\r\n            headAdjust: 0,\r\n            tailAdjust: 0\r\n        },\r\n        backingPaletteState: null,\r\n        backingThreads: [],\r\n        ensembleInfo: {\r\n            fileURL: '',\r\n            audio: new Audio(),\r\n            startPosition: 0,\r\n            volume: 3,\r\n            isLoad: false\r\n        },\r\n        cloneRange: [],\r\n        cloneDataList: []\r\n    },\r\n    tuneState: {\r\n        usingLen: 4,\r\n        columnIndex: 0,\r\n        isDiv3: false,\r\n        isEdit: false,\r\n        isAutoScroll: false,\r\n        isPreview: false,\r\n        totalColumnWidth: 0,\r\n        cacheList: [],\r\n        tableRef: {} as React.MutableRefObject<HTMLDivElement>,\r\n        intervalRef: {} as React.MutableRefObject<HTMLDivElement>,\r\n        measureRef: {} as React.MutableRefObject<HTMLDivElement>,\r\n        BlocksRef: {} as React.MutableRefObject<HTMLDivElement>\r\n    },\r\n    themaDataTree: {\r\n        themaName: 'thema001',\r\n        sustains: []\r\n    },\r\n    themaState: {\r\n        focusIndex: 0,\r\n        focusRef: null,\r\n        themaCacheList: [],\r\n        form: {\r\n            root: {\r\n                themaName: '',\r\n                src: ''\r\n            },\r\n            sustain: {\r\n                beat: null,\r\n                headAdjust: 0,\r\n                tailAdjust: 0\r\n            },\r\n            pattern: {\r\n                name: '',\r\n                def: null,\r\n                src: ''\r\n            },\r\n            category: {\r\n                category: SymbolType.TRIAD\r\n            },\r\n            condition: {\r\n                tgtSymbols: [],\r\n                minRootIndex: 0,\r\n                maxRootIndex: 11\r\n            },\r\n            voicing: {\r\n                def: null,\r\n                src: ''\r\n            }\r\n        },\r\n        isCreate: false\r\n    },\r\n    reffers: {} as Reffers,\r\n    sampler: initDefaultSampler(),\r\n    instrument: null,\r\n    soundUseList: new Array(88),\r\n    dinamicCache: null,\r\n    formDispatcher: {}\r\n};","\r\nimport { Store, Action, TypeNoteElement, DetailChord, DetailSection, BackingLayer, BACKING_SIDE, ChannelParam, BACKING_LEN_TYPE, ScoreCache, BackingEditorState } from './store'\r\n\r\n/**\r\n * ディスパッチメソッドの処理種別を定義します。\r\n */\r\nexport enum ActionType {\r\n    SET_LOGIN,\r\n    SET_DIALOG,\r\n    SELECT_SCORETAB,\r\n    ADD_SECTION,\r\n    SET_DEGREE_INDEX,\r\n    SET_SYMBOL_KEY,\r\n    DETAIL_PARAMS_SETTER,\r\n    GET_ELEMENT_REFFER,\r\n    INIT_DEFAULT_ELEMENTS,\r\n    SELECT_NOTE_ELEMENT,\r\n    GET_REFFER,\r\n    GET_REFFER_CONTEXT,\r\n    GET_REFFER_CHORD_PALETTE,\r\n    GET_REFFER_SECTION_PALETTE,\r\n    GET_REFFER_BACKING_PALETTE,\r\n    FLOATWND_STATE,\r\n    CHORD_PALETTE_SETTER,\r\n    SET_NOTE_DATA,\r\n    SET_DATA_LIST,\r\n    SET_NOTE_STATE,\r\n    SET_TUNE_STATE,\r\n    SET_THEMA_DATA,\r\n    SET_THEMA_STATE,\r\n    SET_SAMPLER,\r\n    SET_INSTRUMENT,\r\n    INIT_BACKING_PALETTE,\r\n    SET_USE_CHANNELS,\r\n    BACKING_TOGGLE_MATRIX,\r\n    DINAMIC_CACHE,\r\n    SET_FORM_DISPATCHER\r\n}\r\n\r\nexport const reducer = (state: Store, action: Action): Store => {\r\n    const type: ActionType = action.type;\r\n    const payload: any = action.payload;\r\n    switch (type) {\r\n        case ActionType.SET_LOGIN:\r\n            return { ...state, login: payload.login };\r\n        case ActionType.SET_DIALOG:\r\n            return { ...state, dialog: payload.dialog };\r\n        case ActionType.SELECT_SCORETAB:\r\n            return { ...state, scoreTabIndex: payload.index };\r\n        case ActionType.ADD_SECTION: {\r\n            const dataList = state.noteData.dataList.slice();\r\n            const detail = {} as DetailSection;\r\n            detail.labelName = 'Section';\r\n            dataList.splice(payload.index + 1, 0, {\r\n                type: TypeNoteElement.Section,\r\n                detail: detail\r\n            });\r\n            return {\r\n                ...state, noteData: {\r\n                    ...state.noteData, dataList: dataList\r\n                }\r\n            };\r\n        }\r\n        case ActionType.SET_DEGREE_INDEX: {\r\n            const detail = state.noteData.dataList[payload.pos].detail as DetailChord;\r\n            if (detail.molecule == null) {\r\n                detail.molecule = { rootIndex: payload.degreeIndex, isFlat: false };\r\n            } else {\r\n                detail.molecule.rootIndex = payload.degreeIndex;\r\n            }\r\n            return {\r\n                ...state, noteData: {\r\n                    ...state.noteData, dataList: state.noteData.dataList\r\n                }\r\n            };\r\n        }\r\n        case ActionType.SET_SYMBOL_KEY: {\r\n            const detail = state.noteData.dataList[payload.pos].detail as DetailChord;\r\n            detail.symbolKey = payload.symbolKey;\r\n            return {\r\n                ...state, noteData: {\r\n                    ...state.noteData, dataList: state.noteData.dataList\r\n                }\r\n            };\r\n        }\r\n        case ActionType.INIT_DEFAULT_ELEMENTS: {\r\n            // const dataList = state.noteData.dataList;\r\n            return {\r\n                ...state, noteData: {\r\n                    ...state.noteData, dataList: [\r\n                        {\r\n                            type: TypeNoteElement.Init,\r\n                            detail: {\r\n                                tempo: 80,\r\n                                rythm: '4/4',\r\n                                keyIndex: 0,\r\n                                scale: 'major'\r\n                            }\r\n                        },\r\n                        {\r\n                            type: TypeNoteElement.Fixed,\r\n                            detail: {\r\n                                label: 'START'\r\n                            }\r\n                        },\r\n                        {\r\n                            type: TypeNoteElement.Section,\r\n                            detail: {\r\n                                labelName: 'Section'\r\n                            }\r\n                        },\r\n                        {\r\n                            type: TypeNoteElement.Fixed,\r\n                            detail: {\r\n                                label: 'END'\r\n                            }\r\n                        },\r\n                    ]\r\n                },\r\n                noteState: {\r\n                    ...state.noteState, cacheList: [{} as ScoreCache, {} as ScoreCache, {} as ScoreCache, {} as ScoreCache]\r\n                }\r\n            };\r\n        }\r\n        case ActionType.SELECT_NOTE_ELEMENT: {\r\n            return {\r\n                ...state, noteState: {\r\n                    ...state.noteState, focusIndex: payload.index\r\n                }\r\n            };\r\n        }\r\n        case ActionType.GET_REFFER_CONTEXT: {\r\n            return {\r\n                ...state, reffers: { ...state.reffers, contextMneu: payload.reffer }\r\n            };\r\n        }\r\n        case ActionType.GET_REFFER_CHORD_PALETTE: {\r\n            return {\r\n                ...state, reffers: { ...state.reffers, chordPalette: payload.reffer }\r\n            };\r\n        }\r\n        case ActionType.GET_REFFER_SECTION_PALETTE: {\r\n            return {\r\n                ...state, reffers: { ...state.reffers, sectionPalette: payload.reffer }\r\n            };\r\n        }\r\n        case ActionType.GET_REFFER_BACKING_PALETTE: {\r\n            return {\r\n                ...state, reffers: { ...state.reffers, backingPalette: payload.reffer }\r\n            };\r\n        }\r\n        case ActionType.FLOATWND_STATE: {\r\n            return {\r\n                ...state, noteState: {\r\n                    ...state.noteState, floatwndState: payload.state\r\n                }\r\n            };\r\n        }\r\n        case ActionType.CHORD_PALETTE_SETTER: {\r\n            return {\r\n                ...state, noteState: {\r\n                    ...state.noteState, chordPaletteState: payload.params\r\n                }\r\n            };\r\n        }\r\n        case ActionType.DETAIL_PARAMS_SETTER: {\r\n            const dataList = state.noteData.dataList.slice();\r\n            const data = dataList[payload.pos];\r\n            data.detail = payload.params;\r\n            return {\r\n                ...state, noteData: {\r\n                    ...state.noteData, dataList: dataList\r\n                }\r\n            };\r\n        }\r\n        case ActionType.GET_REFFER: {\r\n            return {\r\n                ...state, reffers: payload.reffers\r\n            };\r\n        }\r\n        case ActionType.SET_NOTE_DATA: {\r\n            return {\r\n                ...state, noteData: payload.data\r\n            };\r\n        }\r\n        case ActionType.SET_DATA_LIST: {\r\n            return {\r\n                ...state, noteData: { ...state.noteData, dataList: payload.dataList }\r\n            };\r\n        }\r\n        case ActionType.SET_NOTE_STATE: {\r\n            return {\r\n                ...state, noteState: payload.noteState\r\n            };\r\n        }\r\n        case ActionType.SET_TUNE_STATE: {\r\n            return {\r\n                ...state, tuneState: payload.tuneState\r\n            };\r\n        }\r\n        case ActionType.SET_THEMA_STATE: {\r\n            return {\r\n                ...state, themaState: payload.themaState\r\n            };\r\n        }\r\n        case ActionType.SET_THEMA_DATA: {\r\n            return {\r\n                ...state, themaDataTree: payload.data\r\n            };\r\n        }\r\n        case ActionType.SET_SAMPLER: {\r\n            return {\r\n                ...state, sampler: payload.sampler\r\n            };\r\n        }\r\n        case ActionType.SET_INSTRUMENT: {\r\n            return {\r\n                ...state, instrument: payload.instrument\r\n            };\r\n        }\r\n        case ActionType.GET_ELEMENT_REFFER: {\r\n            const cache = state.noteState.cacheList[payload.pos];\r\n            cache.reffer = payload.reffer;\r\n            return {\r\n                ...state, noteState: {\r\n                    ...state.noteState, cacheList: state.noteState.cacheList\r\n                }\r\n            };\r\n        }\r\n        case ActionType.INIT_BACKING_PALETTE: {\r\n            return {\r\n                ...state, noteState: {\r\n                    ...state.noteState, backingPaletteState: payload.backingPaletteState\r\n                }\r\n            };\r\n        }\r\n        case ActionType.SET_USE_CHANNELS: {\r\n            const editorState = state.noteState.backingPaletteState as BackingEditorState;\r\n            // const baseScript = backingPaletteState.layers;\r\n            const useChannels = payload.useChannels as ChannelParam[];\r\n            // const script: BackingLayer[] = new Array(2);\r\n            // for (let i = 0; i < 2; i++) {\r\n            //     const channelCount = backingPaletteState.useChannels.length;\r\n            //     const lensSplitCount = baseScript[i].lens.length;\r\n            //     const baseTable = baseScript[i].table;\r\n            //     const table: boolean[][][] = new Array(channelCount);\r\n\r\n            //     for (let y = 0; y < channelCount; y++) {\r\n            //         if (y < baseTable.length) {\r\n            //             table[y] = baseTable[y];\r\n            //         } else {\r\n            //             table[y] = new Array(lensSplitCount);\r\n            //             for (let x = 0; x < lensSplitCount; x++) {\r\n            //                 table[y][x] = new Array(1);\r\n            //                 table[y][x][0] = false;\r\n            //             }\r\n            //         }\r\n            //     }\r\n            //     script[i] = {\r\n            //         ...baseScript[i],\r\n            //         table,\r\n            //     };\r\n            // }\r\n            return {\r\n                ...state, noteState: {\r\n                    ...state.noteState, backingPaletteState: {\r\n                        ...editorState,\r\n                        useChannels,\r\n                        // layers: script\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        case ActionType.BACKING_TOGGLE_MATRIX: {\r\n            const editorState = state.noteState.backingPaletteState as BackingEditorState;\r\n            const sideIndex: number = payload.sideIndex;\r\n            const lenIndex: number = payload.lenIndex;\r\n            const channelIndex: number = payload.channelIndex;\r\n            const divIndex: number = payload.divIndex;\r\n            const script = editorState.layers;\r\n            script[sideIndex].table[channelIndex][lenIndex][divIndex] = payload.isUse;\r\n            // script[sideIndex].table[channelIndex] = line;\r\n            return {\r\n                ...state, noteState: {\r\n                    ...state.noteState, backingPaletteState: {\r\n                        ...editorState, layers: script\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        case ActionType.DINAMIC_CACHE: {\r\n            return {\r\n                ...state, dinamicCache: payload.dinamicCache\r\n            };\r\n        }\r\n        case ActionType.SET_FORM_DISPATCHER: {\r\n            return {\r\n                ...state, formDispatcher: payload.formDispatcher\r\n            };\r\n        }\r\n    }\r\n}\r\n","import { DEGREE12_FLAT_LIST, DEGREE12_SHARP_LIST, DIATONIC_MAJOR_SCALE_DEGREE_NAMES, DIATONIC_MINOR_SCALE_LIST, DIATONIC_NATURAL_MINOR_SCALE_DEGREE_NAMES, getChangeTypeLabel, KEY12_FLAT_LIST, KEY12_MAJOR_SCALE_LIST, KEY12_MINOR_SCALE_LIST, KEY12_SHARP_LIST, SCALE_LIST, SymbolKey, SYMBOL_PARAMS_LIST } from \"contents/common/define\";\r\nimport { getChordRoot, getSymbolName } from \"contents/common/utils\";\r\nimport { GlobalContext } from \"contents/MainFrame\";\r\nimport { DetailChord, DetailFixed, DetailInit, DetailChange, DetailSection, CHORD_MODE, NoteElement, TypeNoteElement, ScoreProgress, Key12Info, ChangeType, ModulateRelation, TempoRelation } from \"contents/redux/store\";\r\nimport { useContext } from \"react\";\r\n\r\ntype ScoreElementDetailProps = {\r\n    index: number;\r\n    noteElement: NoteElement;\r\n}\r\n\r\nconst ScoreElementDetail = (props: ScoreElementDetailProps) => {\r\n\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const chordMode = state.noteData.chordMode;\r\n    const cache = state.noteState.cacheList[props.index];\r\n\r\n    switch (props.noteElement.type) {\r\n        case TypeNoteElement.Fixed: {\r\n            const detail = props.noteElement.detail as DetailFixed;\r\n            return (\r\n                <span>{detail.label}</span>\r\n            );\r\n        }\r\n        case TypeNoteElement.Init: {\r\n            const detail = props.noteElement.detail as DetailInit;\r\n            const paramLabels: JSX.Element[] = [];\r\n            paramLabels.push(\r\n                <div key={paramLabels.length}>\r\n                    <span>Tempo: </span>\r\n                    <span>{detail.tempo}</span>\r\n                </div>\r\n            );\r\n            paramLabels.push(\r\n                <div key={paramLabels.length}>\r\n                    <span>Beat: </span>\r\n                    <span>{detail.rythm}</span>\r\n                </div>\r\n            );\r\n            if (chordMode == CHORD_MODE.SCALE) {\r\n                paramLabels.push(\r\n                    <div key={paramLabels.length}>\r\n                        <span>Scale: </span>\r\n                        <span>{detail.scale}</span>\r\n                    </div>\r\n                );\r\n                paramLabels.push(\r\n                    <div key={paramLabels.length}>\r\n                        <span>Key: </span>\r\n                        {/* <span>{detail.key}</span> */}\r\n                        <span>{\r\n                            detail.scale == SCALE_LIST[0] ?\r\n                                KEY12_MAJOR_SCALE_LIST[detail.keyIndex] :\r\n                                KEY12_MINOR_SCALE_LIST[detail.keyIndex]\r\n                        }</span>\r\n                    </div>\r\n                );\r\n            }\r\n            return (\r\n                <div>\r\n                    {paramLabels}\r\n                </div>\r\n            );\r\n        }\r\n        case TypeNoteElement.Chord: {\r\n            const detail = props.noteElement.detail as DetailChord;\r\n\r\n            const degreeMolRoot = getDegreeRoot(detail.molecule);\r\n            const degreeDenRoot = getDegreeRoot(detail.denominator);\r\n            const chordMolRoot = getChordRoot(detail.molecule, cache.init.keyIndex);\r\n            const chordDenRoot = getChordRoot(detail.denominator, cache.init.keyIndex);\r\n            let symbolName = '';\r\n            let isDiatonic = false;\r\n            let degreeName = 'blank';\r\n            let chordName = '-';\r\n            if (degreeMolRoot != null) {\r\n                symbolName = getSymbolName(detail.symbolKey);\r\n                const diatonitChordList = cache.init.scale == 'major' ? DIATONIC_MAJOR_SCALE_DEGREE_NAMES : DIATONIC_NATURAL_MINOR_SCALE_DEGREE_NAMES;\r\n                isDiatonic = diatonitChordList.includes(degreeMolRoot + symbolName);\r\n                degreeName = `${degreeMolRoot}${symbolName}${degreeDenRoot == null ? '' : '/' + degreeDenRoot}`;\r\n                chordName = `${chordMolRoot}${symbolName}${chordDenRoot == null ? '' : '/' + chordDenRoot}`;\r\n            }\r\n            const sustainJsx = [];\r\n            for (let i = 0; i < detail.sustain; i++) {\r\n                sustainJsx.push(<span key={i}></span>);\r\n            }\r\n            const barCount = cache.progress.barCount;\r\n            const remaindBeat = cache.progress.remaindBeat;\r\n            const headMSec = Math.round(cache.progress.headMSec / 1000 * 10) / 10;\r\n            // alert(detail.degreeIndex);\r\n            const notesCount = dispatcher.backing.getNotesCount(detail.backing);\r\n            return (\r\n                <>\r\n                    <div className={\r\n                        'degree'\r\n                        + (detail.molecule == null ? ' blank' : '')\r\n                        + (isDiatonic ? ' diatonic' : '')\r\n                        // ダイレクトモード時は非表示\r\n                        + (state.noteData.chordMode == CHORD_MODE.DIRECT ? ' visible' : '')}\r\n                    >\r\n                        <span>{degreeName}</span>\r\n                    </div>\r\n                    <div className={state.noteData.chordMode == CHORD_MODE.DIRECT ? 'degree' : 'chord'}>\r\n                        <span>{chordName}</span>\r\n                    </div>\r\n                    <div className=\"sustain\">\r\n                        {sustainJsx}\r\n                    </div>\r\n                    <div className=\"progress-sustain\">\r\n                        <span className=\"bar\">{barCount != -1 ? barCount : ''}</span>\r\n                        <span className=\"beat\">{remaindBeat != -1 ? remaindBeat : ''}</span>\r\n                    </div>\r\n                    <div className=\"progress-time\">\r\n                        <span>{headMSec}s</span>\r\n                    </div>\r\n                    <div\r\n                        className={\r\n                            'backing-script' +\r\n                            (notesCount == 0 ? ' hidden' : '')\r\n                        }\r\n                    >\r\n                        <span>notes: {notesCount}</span>\r\n                    </div>\r\n                </>\r\n            );\r\n        }\r\n        case TypeNoteElement.Section: {\r\n            const detail = props.noteElement.detail as DetailSection;\r\n            return (\r\n                <>\r\n                    <div className=\"name\"><span>{detail.labelName}</span></div>\r\n                    <div className=\"border\"></div>\r\n                </>\r\n            );\r\n        }\r\n        case TypeNoteElement.Change: {\r\n            const detail = props.noteElement.detail as DetailChange;\r\n            const prevCache = state.noteState.cacheList[props.index - 1];\r\n            let changeInnerJsx = <></>;\r\n            switch (detail.changeType) {\r\n                case null: {\r\n                    changeInnerJsx = (\r\n                        <>\r\n                            <div className=\"value\">\r\n                                <span>No setting</span>\r\n                            </div>\r\n                            <div className=\"result\">\r\n                                <span>***</span>]\r\n                            </div>\r\n                        </>\r\n                    );\r\n                }\r\n                    break;\r\n                case ChangeType.MODULATE: {\r\n                    const relation = detail.modulateRelation === null ? 'None' : detail.modulateRelation.toString();\r\n                    const isValuable = detail.modulateRelation === ModulateRelation.DOMINANT || detail.modulateRelation === ModulateRelation.KEY;\r\n                    let value = 0;\r\n                    const oldKeyIndex = prevCache.init.keyIndex;\r\n                    const oldIsMinor = prevCache.init.scale == 'minor';\r\n                    const newKeyIndex = cache.init.keyIndex;\r\n                    const newIsMinor = cache.init.scale == 'minor';\r\n                    switch (detail.modulateRelation) {\r\n                        case ModulateRelation.DOMINANT: {\r\n                            value = detail.domminantValue;\r\n                        }\r\n                            break;\r\n                        case ModulateRelation.KEY: {\r\n                            value = detail.keyAdjust;\r\n                        }\r\n                            break;\r\n                        case ModulateRelation.RELATIVE: { } break;\r\n                        case ModulateRelation.PARALLEL: { } break;\r\n                    }\r\n                    const oldKeyName = (!oldIsMinor ? KEY12_MAJOR_SCALE_LIST : KEY12_MINOR_SCALE_LIST)[oldKeyIndex];\r\n                    const newKeyName = (!newIsMinor ? KEY12_MAJOR_SCALE_LIST : KEY12_MINOR_SCALE_LIST)[newKeyIndex];\r\n                    changeInnerJsx = (\r\n                        <>\r\n                            <div className=\"value\">\r\n                                <span>{relation + (isValuable ? ': ' : '')}</span>\r\n                                {isValuable ? (<span>{value}</span>) : <></>}\r\n                            </div>\r\n                            <div className=\"result\">\r\n                                <span>{oldKeyName} → {newKeyName}</span>\r\n                            </div>\r\n                        </>\r\n                    );\r\n                }\r\n                    break;\r\n                case ChangeType.TEMPO: {\r\n                    const relation = detail.tempoRelation === null ? 'None' : detail.tempoRelation.toString();\r\n                    let value = 0;\r\n                    const oldTempo = prevCache.init.tempo;\r\n                    const newTempo = cache.init.tempo;\r\n                    switch (detail.tempoRelation) {\r\n                        case TempoRelation.DIFF: {\r\n                            value = detail.tempoDiff;\r\n                        }\r\n                            break;\r\n                        case TempoRelation.RATE: {\r\n                            value = detail.tempoRate;\r\n                        }\r\n                            break;\r\n                        case TempoRelation.ABSOLUTE: {\r\n                            value = detail.tempoAbsolute;\r\n                        }\r\n                            break;\r\n                    }\r\n                    changeInnerJsx = (\r\n                        <>\r\n                            <div className=\"value\">\r\n                                <span>{relation + ': '}</span>\r\n                                <span>{value}</span>\r\n                            </div>\r\n                            <div className=\"result\">\r\n                                <span>{`${oldTempo} → ${newTempo}`}</span>\r\n                            </div>\r\n                        </>\r\n                    );\r\n                }\r\n                    break;\r\n                case ChangeType.BEAT: {\r\n                    changeInnerJsx = (\r\n                        <>\r\n                        </>\r\n                    );\r\n                }\r\n                    break;\r\n            }\r\n            if (chordMode == CHORD_MODE.SCALE) {\r\n            }\r\n            return (\r\n                <>\r\n                    <div className=\"change-type\">\r\n                        {/* <span>{detail.changeType === null ? '' : getChangeTypeLabel(detail.changeType)}</span> */}\r\n                        <span>{detail.changeType === null ? 'Change' : detail.changeType.toString()}</span>\r\n                    </div>\r\n                    {changeInnerJsx}\r\n                </>\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\n/**　ディグリーネームを返す */\r\nconst getDegreeRoot = (rootInfo: Key12Info | null): string | null => {\r\n    let name = null;\r\n    if (rootInfo != null) {\r\n        const list = rootInfo.isFlat ? DEGREE12_FLAT_LIST : DEGREE12_SHARP_LIST;\r\n        name = list[rootInfo.rootIndex];\r\n    }\r\n    return name;\r\n}\r\n\r\nexport default ScoreElementDetail;","import { DEGREE12_FLAT_LIST, DEGREE12_SHARP_LIST, DIATONIC_MAJOR_SCALE_DEGREE_NAMES, KEY12_FLAT_LIST, KEY12_MAJOR_SCALE_LIST, KEY12_MINOR_SCALE_LIST, KEY12_SHARP_LIST, SYMBOL_PARAMS_LIST } from 'contents/common/define';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport { TypeNoteElement, DetailFixed, DetailSection, DetailInit, DetailChord, DetailChange, NoteElement, FloatWndState, Store, CHORD_MODE, EditMode } from 'contents/redux/store';\r\nimport React, { useContext, useEffect, useState, KeyboardEvent, useRef, MouseEvent } from 'react';\r\nimport CurrentElementInfo from '../sideDetail/CurrentElementInfo';\r\nimport ScoreElementDetail from './detail/ScoreElementDetail';\r\nimport './ScoreElement.css';\r\n\r\ntype ScoreElementProps = {\r\n    index: number;\r\n    noteElement: NoteElement;\r\n}\r\n\r\n// type ScoreElementProps = {\r\n//     index: number;\r\n//     type: TypeNoteElement;\r\n//     progress: ProgressInfo;\r\n// }\r\nconst ScoreElement = (props: ScoreElementProps) => {\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    const isAccept = props.index < state.noteData.dataList.length;\r\n\r\n    const ref = useRef({} as HTMLDivElement);\r\n    useEffect(() => {\r\n        if (isAccept) {\r\n            dispatch(ActionType.GET_ELEMENT_REFFER, { pos: props.index, reffer: ref.current });\r\n        }\r\n    }, [state.noteData.dataList]);\r\n\r\n    if (!isAccept) {\r\n        return (<></>);\r\n    }\r\n\r\n    const type = props.noteElement.type;\r\n    const editMode = state.noteState.editMode;\r\n    const chordMode = state.noteData.chordMode;\r\n    // const isNormalMode = state.noteState.editMode == EditMode.NORMAL;\r\n    const cache = state.noteState.cacheList[props.index];\r\n\r\n    const getStyleFromType = (): string => {\r\n        switch (type) {\r\n            case TypeNoteElement.Fixed: return 'detail-fixed';\r\n            case TypeNoteElement.Init: return 'detail-init';\r\n            case TypeNoteElement.Chord: return 'detail-chord';\r\n            case TypeNoteElement.Section: return 'detail-section';\r\n            case TypeNoteElement.Change: return 'detail-change';\r\n        }\r\n    };\r\n\r\n    const focusIndex = state.noteState.focusIndex;\r\n    const isSelected = focusIndex == props.index;\r\n    const isCriteria = state.noteState.criteriaIndex == props.index;\r\n    /**\r\n     * 要素が選択中のセクション内かどうかを返す\r\n     * @returns 判定結果\r\n     */\r\n    const isCurrentSection = (): boolean => {\r\n        const dataList = state.noteData.dataList;\r\n        const posList: number[] = [dataList.length];\r\n        let secNo = -1;\r\n        let curSecNo = -1;\r\n        dataList.forEach((el, i) => {\r\n            if (el.type == TypeNoteElement.Section) secNo++;\r\n            posList[i] = secNo;\r\n            if (focusIndex == i) curSecNo = secNo;\r\n        });\r\n        // const isChordEl = dataList[props.index].type == TypeNoteElement.Chord;\r\n        const isCurrentSec = posList[props.index] == curSecNo && type != TypeNoteElement.Fixed;\r\n        return isCurrentSec;\r\n    }\r\n\r\n    /**\r\n * コピー対象スタイルを返す\r\n * @returns コピー対象スタイル\r\n */\r\n    const getCopyTargetStyle = (): string => {\r\n        if (editMode != EditMode.TRANSPLANT) return '';\r\n\r\n        if (type == TypeNoteElement.Chord) {\r\n            const detail = props.noteElement.detail as DetailChord;\r\n            const isSameStructType = detail.molecule != null;\r\n            if (isSameStructType) {\r\n                if (state.noteState.selectedList.includes(props.index)) {\r\n                    return 'copy-selected';\r\n                }\r\n                return 'copy-tgt';\r\n            } else {\r\n                return 'copy-no-tgt';\r\n            }\r\n        } else {\r\n            return 'copy-no-tgt';\r\n        }\r\n    }\r\n\r\n    const getCloneRangeStyle = (): string => {\r\n        if (editMode != EditMode.CLONE) return '';\r\n\r\n        if (![TypeNoteElement.Fixed, TypeNoteElement.Init].includes(type)) {\r\n            const cloneRange = state.noteState.cloneRange;\r\n            const isReverse = cloneRange[0] > cloneRange[1];\r\n            const start = cloneRange[isReverse ? 1 : 0];\r\n            const end = cloneRange[isReverse ? 0 : 1];\r\n            if (props.index >= start && props.index <= end) {\r\n                return 'copy-selected';\r\n            } else {\r\n                return 'copy-tgt';\r\n            }\r\n        } else {\r\n            return 'copy-no-tgt';\r\n        }\r\n    }\r\n\r\n    const getHeaderElement = (): JSX.Element => {\r\n        let retJsxList: JSX.Element[] = [];\r\n\r\n        if ([TypeNoteElement.Chord, TypeNoteElement.Section, TypeNoteElement.Change].includes(type)) {\r\n\r\n            if (TypeNoteElement.Chord == type) {\r\n\r\n                retJsxList.push(\r\n                    <div key={retJsxList.length} className=\"chord-no\">\r\n                        <span>{cache.progress.no}</span>\r\n                    </div>\r\n                );\r\n                const isMajor = cache.init.scale == 'major';\r\n                const scaleList = isMajor ? KEY12_MAJOR_SCALE_LIST : KEY12_MINOR_SCALE_LIST;\r\n                const rootKey = scaleList[cache.init.keyIndex];\r\n                // スケールモード時のみ調性を表示\r\n                if (chordMode === CHORD_MODE.SCALE) {\r\n                    retJsxList.push(\r\n                        <div key={retJsxList.length}\r\n                            className={[\r\n                                'scale',\r\n                                isMajor ? 'maj' : 'min'\r\n                            ].join(' ')}>\r\n                            <span>[{rootKey}]</span>\r\n                        </div>\r\n                    );\r\n                }\r\n            }\r\n            retJsxList.push(\r\n                //  <div className=\"edit\">\r\n                //         <span>E</span>\r\n                //     </div> \r\n                <div\r\n                    key={retJsxList.length}\r\n                    className={\r\n                        'del' +\r\n                        (editMode == EditMode.NORMAL ? '' : ' hidden')\r\n                    }\r\n                    onClick={() => {\r\n                        dispatcher.score.deleteElement(props.index);\r\n                    }}\r\n                >\r\n                    <span>×</span>\r\n                </div >\r\n            );\r\n        }\r\n        return (<>\r\n            {retJsxList}\r\n        </>);\r\n    }\r\n\r\n    /**\r\n     * 通常モード時、要素をクリックした際のイベント\r\n     */\r\n    const normalElementClickAction = () => {\r\n        const element: NoteElement = state.noteData.dataList[props.index];\r\n        if (element.type != TypeNoteElement.Fixed) {\r\n            dispatch(ActionType.SELECT_NOTE_ELEMENT, { index: props.index });\r\n        }\r\n    }\r\n    /**\r\n     * セレクタモード時、要素をクリックした際のイベント\r\n     */\r\n    const selectorElementClickAction = () => {\r\n        const selectedList = state.noteState.selectedList;\r\n        if (!selectedList.includes(props.index)) {\r\n            selectedList.push(props.index);\r\n        } else {\r\n            selectedList.some((index, i) => {\r\n                if (index == props.index) selectedList.splice(i, 1);\r\n            });\r\n        }\r\n        dispatcher.score.setSelectedList(selectedList);\r\n    }\r\n\r\n    // 追加「＋」ボタン\r\n    let additionBtn: JSX.Element = <></>;\r\n    if (props.index == state.noteData.dataList.length - 2) {\r\n        additionBtn = (\r\n            <div\r\n                className={\r\n                    'addition' +\r\n                    (editMode == EditMode.NORMAL ? '' : ' disable')\r\n                }\r\n                onClick={() => {\r\n                    dispatch(ActionType.SELECT_NOTE_ELEMENT, { index: props.index });\r\n                    dispatcher.score.addChordElement();\r\n                    dispatch(ActionType.SELECT_NOTE_ELEMENT, { index: props.index + 1 });\r\n                    dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.CHORD_PALETTE });\r\n                    dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                        params: {\r\n                            ...state.noteState.chordPaletteState,\r\n                            isAddition: true,\r\n                            rootIndex: 0,\r\n                            isFlat: false,\r\n                            symbolKey: SYMBOL_PARAMS_LIST[0].key,\r\n                            sustain: 4,\r\n                        }\r\n                    });\r\n                }}>\r\n                <span>+</span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"box\">\r\n            <div className=\"info-base\">\r\n                <div className=\"header\">\r\n                    {getHeaderElement()}\r\n                </div>\r\n                <div\r\n                    className={[\r\n                        'note-element',\r\n                        getStyleFromType(),\r\n                        isSelected ? 'active' : '',\r\n                        isCriteria ? 'criteria' : '',\r\n                        [\r\n                            TypeNoteElement.Init,\r\n                            TypeNoteElement.Section,\r\n                            TypeNoteElement.Chord,\r\n                            TypeNoteElement.Change,\r\n                        ].includes(type) ? 'selectable' : '',\r\n                        isCurrentSection() ? 'current' : '',\r\n                        getCopyTargetStyle(),\r\n                        getCloneRangeStyle()\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        if (editMode == EditMode.NORMAL) {\r\n                            normalElementClickAction();\r\n                            dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                        } else if (editMode == EditMode.TRANSPLANT) {\r\n                            selectorElementClickAction();\r\n                        } else if (editMode == EditMode.CLONE) {\r\n                            dispatcher.score.setCloneRange(props.index);\r\n                        }\r\n                    }}\r\n                    onContextMenu={(e: MouseEvent) => {\r\n                        if (editMode == EditMode.NORMAL) {\r\n                            normalElementClickAction();\r\n                            const element: NoteElement = state.noteData.dataList[props.index];\r\n                            switch (element.type) {\r\n                                case TypeNoteElement.Init: {\r\n                                    dispatcher.setDinamicCache(props.noteElement.detail);\r\n                                    dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.INIT_PALETTE });\r\n                                }\r\n                                    break;\r\n                                case TypeNoteElement.Section:\r\n                                case TypeNoteElement.Chord:\r\n                                case TypeNoteElement.Change:\r\n                                    {\r\n                                        state.reffers.contextMneu.style.left = e.clientX + 'px';\r\n                                        state.reffers.contextMneu.style.top = e.clientY + 'px';\r\n                                        dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.CONTEXT_MENU });\r\n                                    }\r\n                                    break;\r\n                            }\r\n                        }\r\n                    }}\r\n                    ref={ref}\r\n                >\r\n                    <ScoreElementDetail\r\n                        index={props.index}\r\n                        noteElement={props.noteElement}\r\n                    />\r\n                </div >\r\n            </div >\r\n            {/* プラス「＋」ボタン */}\r\n            {additionBtn}\r\n        </div >\r\n    );\r\n\r\n};\r\n\r\nexport default ScoreElement;\r\n","\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { DetailSection, TypeNoteElement } from 'contents/redux/store';\r\nimport { useContext, useEffect, useState } from 'react';\r\n\r\ntype OutlineSectionProps = {\r\n    label: String;\r\n    index: number;\r\n}\r\nconst OutlineSection = (props: OutlineSectionProps) => {\r\n    const { state, dispatch } = useContext(GlobalContext);\r\n\r\n    const isCurrent = (): boolean => {\r\n        const dataList = state.noteData.dataList;\r\n        const focusIndex = state.noteState.focusIndex;\r\n        let secNo = -1;\r\n        let curSecNo = -1;\r\n        dataList.forEach((el, i) => {\r\n            if (el.type == TypeNoteElement.Section) secNo++;\r\n            if (focusIndex == i) curSecNo = secNo;\r\n        });\r\n        return curSecNo == props.index;\r\n    }\r\n    return (\r\n        <div className={isCurrent() ? 'active' : ''}>\r\n            <span>{props.label}</span>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default OutlineSection;\r\n","import { SYMBOL_PARAMS_LIST, SYMBOL_TYPE_LIST } from \"contents/common/define\";\r\nimport { GlobalContext } from \"contents/MainFrame\";\r\nimport { ActionType } from \"contents/redux/reducer\";\r\nimport { ChordPaletteState, DetailChord, FloatWndState, TypeNoteElement } from \"contents/redux/store\";\r\nimport { useContext, useEffect, useRef } from \"react\";\r\n\r\nimport './NoteContextMenu.css';\r\n\r\nconst NoteContextMenu = () => {\r\n\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    /** コンテキストメニューを閉じる */\r\n    const close = () => dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n\r\n    /** コンテキストメニューの要素オブジェクト */\r\n    const ref = useRef({} as HTMLDivElement);\r\n    useEffect(() => {\r\n        // dispatch(ActionType.GET_REFFER, { reffers: {...state.reffers, contextMneu: ref.current }});\r\n        dispatch(ActionType.GET_REFFER_CONTEXT, { reffer: ref.current });\r\n    }, []);\r\n\r\n    // if (state.noteState.floatwndState != FloatWndState.CONTEXT_MENU) {\r\n    //     return (<></>);\r\n    // }\r\n    const menuPropsList: MenuRecordProps[] = [];\r\n    if (state.noteState.floatwndState == FloatWndState.CONTEXT_MENU) {\r\n        const curElement = state.noteData.dataList[state.noteState.focusIndex];\r\n        menuPropsList.push({\r\n            menuType: 'order', label: 'INSERT BLANK', keyName: 'A', disable: false,\r\n            executer: () => {\r\n                dispatcher.score.addChordElement();\r\n                close();\r\n            }\r\n        });\r\n        menuPropsList.push({\r\n            menuType: 'call', label: 'INSERT CHORD', keyName: 'W', disable: false,\r\n            executer: () => {\r\n                dispatcher.score.addChordElement();\r\n                dispatch(ActionType.SELECT_NOTE_ELEMENT, { index: state.noteState.focusIndex + 1 });\r\n                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.CHORD_PALETTE });\r\n                const detail = curElement.detail as DetailChord;\r\n                dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                    params: {\r\n                        ...state.noteState.chordPaletteState,\r\n                        isAddition: true,\r\n                        molecule: { rootIndex: 0, isFlat: false },\r\n                        denominator: null,\r\n                        symbolKey: SYMBOL_PARAMS_LIST[0].key,\r\n                        sustain: state.noteState.defaultSustain,\r\n                    } as ChordPaletteState\r\n                });\r\n            }\r\n        });\r\n        menuPropsList.push({\r\n            menuType: 'order', label: 'INSERT SECTION', keyName: 'S', disable: false,\r\n            executer: () => {\r\n                dispatcher.score.addSectionElement();\r\n                close();\r\n            }\r\n        });\r\n        menuPropsList.push({\r\n            menuType: 'order', label: 'INSERT CHANGE', keyName: 'F', disable: false,\r\n            executer: () => {\r\n                dispatcher.score.addChangeElement();\r\n                close();\r\n            }\r\n        });\r\n        switch (curElement.type) {\r\n            case TypeNoteElement.Chord: {\r\n                const detail = curElement.detail as DetailChord;\r\n                menuPropsList.push({\r\n                    menuType: 'order', label: 'SET BLANK', keyName: 'D', disable: detail.molecule == null,\r\n                    executer: () => {\r\n                        const noteData = state.noteData;\r\n                        const detail = noteData.dataList[state.noteState.focusIndex].detail as DetailChord;\r\n                        detail.molecule = null;\r\n                        detail.denominator = null;\r\n                        dispatcher.score.setNoteData(noteData);\r\n                        // dispatch(ActionType.SET_DEGREE_INDEX, { pos: state.noteState.focusIndex, degreeIndex: -1 });\r\n                        close();\r\n                    }\r\n                });\r\n                menuPropsList.push({\r\n                    menuType: 'call', label: 'EDIT CHORD', keyName: 'C', disable: false,\r\n                    executer: () => {\r\n                        dispatcher.score.callChordSelector();\r\n                    }\r\n                });\r\n                menuPropsList.push({\r\n                    menuType: 'call', label: 'EDIT BACKING', keyName: 'B', disable: detail.molecule == null,\r\n                    executer: () => {\r\n                        dispatcher.score.callBackingEditor();\r\n                    }\r\n                });\r\n                menuPropsList.push({\r\n                    menuType: 'call', label: 'THEMA', keyName: 'T', disable: false,\r\n                    executer: () => {\r\n                        dispatcher.score.callThemaAccessor();\r\n                    }\r\n                });\r\n                menuPropsList.push({\r\n                    menuType: 'order', label: 'COPY BACKING', keyName: 'X', disable: detail.molecule == null,\r\n                    executer: () => {\r\n                        dispatcher.score.setCriteria();\r\n                        dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                    }\r\n                });\r\n                menuPropsList.push({\r\n                    menuType: 'order', label: 'CLONE BLOCK', keyName: 'Q', disable: false,\r\n                    executer: () => {\r\n                        dispatcher.score.setCloneCriteria();\r\n                        dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                    }\r\n                });\r\n            }\r\n                break;\r\n            case TypeNoteElement.Section: {\r\n                menuPropsList.push({\r\n                    menuType: 'call', label: 'EDIT SECTION', keyName: 'C', disable: false,\r\n                    executer: () => {\r\n                        dispatcher.score.callSectionEditor();\r\n                    }\r\n                });\r\n            }\r\n                break;\r\n            case TypeNoteElement.Change: {\r\n                menuPropsList.push({\r\n                    menuType: 'call', label: 'EDIT CHANGE', keyName: 'C', disable: false,\r\n                    executer: () => {\r\n                        dispatcher.score.callChangeEditor();\r\n                    }\r\n                });\r\n            }\r\n                break;\r\n        }\r\n        menuPropsList.push({\r\n            menuType: 'order', label: 'REMOVE', keyName: 'DEL', disable: false,\r\n            executer: () => {\r\n                dispatcher.score.deleteCurElement();\r\n                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            }\r\n        });\r\n    }\r\n    const menuList: JSX.Element[] = [];\r\n    menuPropsList.forEach((data, i) => {\r\n        menuList.push(<MenuRecord\r\n            key={i}\r\n            menuType={data.menuType}\r\n            label={data.label}\r\n            keyName={data.keyName}\r\n            disable={data.disable}\r\n            executer={data.executer}\r\n        />);\r\n    });\r\n\r\n    return (\r\n        <div\r\n            ref={ref}\r\n            id=\"note-contextmenu\"\r\n            className={'floatwnd' + (state.noteState.floatwndState == FloatWndState.CONTEXT_MENU ? ' active' : '')}\r\n            onClick={() => {\r\n                // dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            }}\r\n        >\r\n            {menuList}\r\n        </div>\r\n    );\r\n}\r\n\r\ntype MenuRecordProps = {\r\n    menuType: 'call' | 'order';\r\n    label: string;\r\n    keyName: string;\r\n    disable: boolean;\r\n    executer: Function;\r\n}\r\nconst MenuRecord = (props: MenuRecordProps) => {\r\n\r\n    return (\r\n        <div className={props.disable ? 'disable' : ''}\r\n            onClick={() => {\r\n                props.executer();\r\n            }}\r\n        >\r\n            <span className={props.menuType}>{props.label}</span>\r\n            <span className=\"key\">{`<${props.keyName} key>`}</span>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default NoteContextMenu;","import { DEGREE12_FLAT_LIST, DEGREE12_SHARP_LIST, KEY12_FLAT_LIST, KEY12_SHARP_LIST, SymbolKey, SymbolParams, SYMBOL_PARAMS_LIST } from \"contents/common/define\";\r\nimport TabbedPane from \"contents/common/TabbedPane\";\r\nimport { getSymbolName, getSymbolParams } from \"contents/common/utils\";\r\nimport { GlobalContext } from \"contents/MainFrame\";\r\nimport { ActionType } from \"contents/redux/reducer\";\r\nimport { DetailChord, FloatWndState, ChordPaletteLine, TypeNoteElement, CHORD_MODE, ChordPaletteState, EditMode } from \"contents/redux/store\";\r\nimport { useContext, useEffect, useRef, useState } from \"react\";\r\n// import styled from 'styled-components';\r\n// npm i --save-dev @types/styled-components\r\nimport './ChordSelector.css';\r\n\r\nconst ChordSelector = () => {\r\n\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    // const [degreeIndex, setDegreeIndex] = useState(0);\r\n    // const [isFlat, setFlat] = useState(false);\r\n    // const [symbolKey, setSymbolKey] = useState(SYMBOL_PARAMS_LIST[0].key);\r\n    // const [sustain, setSustain] = useState(4);\r\n\r\n    /** コンテキストメニューの要素オブジェクト */\r\n    const ref = useRef<HTMLDivElement>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n    const editorState = state.noteState.chordPaletteState;\r\n    const focusIndex = state.noteState.focusIndex;\r\n    const chordDetail = state.noteData.dataList[focusIndex].detail as DetailChord;\r\n    const cache = state.noteState.cacheList[focusIndex];\r\n    const isPreview = state.noteState.editMode === EditMode.PREVIEW;\r\n    useEffect(() => {\r\n        // if (state.noteState.floatwndState == FloatWndState.CHORD_PALETTE) {\r\n        // dispatch(ActionType.GET_REFFER, { reffers: {...state.reffers, chordPalette: ref.current }});\r\n        dispatch(ActionType.GET_REFFER_CHORD_PALETTE, { reffer: ref.current });\r\n        const canvas: any = canvasRef.current;\r\n        canvas.width = 590;\r\n        canvas.height = 66;\r\n        // }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (state.noteState.floatwndState == FloatWndState.CHORD_PALETTE) {\r\n            updatePianoView(\r\n                editorState.molecule.rootIndex,\r\n                editorState.denominator == null ? -1 : editorState.denominator.rootIndex,\r\n                editorState.symbolKey\r\n            );\r\n        }\r\n    }, [editorState, state.noteState.floatwndState]);\r\n\r\n\r\n    // if (state.noteState.floatwndState != FloatWndState.CHORD_PALETTE) {\r\n    //     return (<></>);\r\n    // }\r\n    const updatePianoView = (molRootIndex: number, denRootIndex: number, symbolKey: SymbolKey) => {\r\n        const ctx = (canvasRef.current as HTMLCanvasElement).getContext('2d') as CanvasRenderingContext2D;\r\n\r\n        const keyIndex = (cache.init.keyIndex + molRootIndex) % 12;\r\n        const intervalList = (getSymbolParams(symbolKey) as SymbolParams).intervals;\r\n        const list = intervalList.map((value) => keyIndex + value);\r\n        let denIndex = -1;\r\n        if (denRootIndex != -1) {\r\n            denIndex = cache.init.keyIndex + denRootIndex;\r\n        }\r\n        ctx.fillStyle = '#008';\r\n        ctx.fillRect(0, 0, 594, 70);\r\n        const WIDTH = 34;\r\n        const HEIGHT = 60;\r\n        const BLACK_RATE_W = 0.5;\r\n        const BLACK_RATE_H = 0.6;\r\n        const MARGIN_W = 1;\r\n        const START_ADJUST = 1;\r\n        let posX = 0;\r\n        const keyboadList: {\r\n            posX: number;\r\n            fillStyle: string;\r\n            width: number;\r\n            height: number;\r\n            isBlack: boolean;\r\n        }[] = [];\r\n        for (let i = 0; i < 27; i++) {\r\n            let color = '#eee';\r\n            let width = WIDTH;\r\n            let height = HEIGHT;\r\n            const isBlack = [1, 3, 6, 8, 10].includes(i % 12);\r\n            if (isBlack) {\r\n                color = '#111';\r\n                width = WIDTH * BLACK_RATE_W;\r\n                height = HEIGHT * BLACK_RATE_H;\r\n            }\r\n            if (list.includes(i)) {\r\n                color = '#fa0';\r\n            }\r\n            if (denIndex == i) {\r\n                color = '#ff0000';\r\n            }\r\n            keyboadList.push({ posX: 15 + posX, fillStyle: color, width, height, isBlack });\r\n\r\n            switch (i % 12) {\r\n                case 0: case 2: case 5: case 7: case 9:\r\n                    //次が黒鍵\r\n                    posX += WIDTH - WIDTH * BLACK_RATE_W / 2;\r\n                    break;\r\n                case 1: case 3: case 6: case 8: case 10:\r\n                    //黒鍵\r\n                    posX += WIDTH * BLACK_RATE_W / 2 + MARGIN_W;\r\n                    break;\r\n                default:\r\n                    //次が白鍵\r\n                    posX += WIDTH + MARGIN_W;\r\n            }\r\n        }\r\n        keyboadList.forEach((keyboad) => {\r\n            if (!keyboad.isBlack) {\r\n                ctx.fillStyle = keyboad.fillStyle;\r\n                ctx.fillRect(keyboad.posX, 3, keyboad.width, keyboad.height);\r\n            }\r\n        });\r\n        keyboadList.forEach((keyboad) => {\r\n            if (keyboad.isBlack) {\r\n                ctx.fillStyle = keyboad.fillStyle;\r\n                ctx.fillRect(keyboad.posX, 3, keyboad.width, keyboad.height);\r\n                ctx.fillStyle = '#f00';\r\n                ctx.strokeRect(keyboad.posX, 3, keyboad.width, keyboad.height);\r\n            }\r\n        });\r\n        ctx.save();\r\n    }\r\n    const chordList: JSX.Element[] = [];\r\n    const symbolList: JSX.Element[] = [];\r\n    const beatList: JSX.Element[] = [];\r\n    let operationJsx: JSX.Element = <></>;\r\n    const isDirect = state.noteData.chordMode == CHORD_MODE.DIRECT;\r\n    if (state.noteState.floatwndState == FloatWndState.CHORD_PALETTE) {\r\n\r\n        DEGREE12_SHARP_LIST.forEach((degS, i) => {\r\n            const baseKey = cache.init.keyIndex;\r\n            const keyIndex = (baseKey + i) % 12;\r\n            const degF = DEGREE12_FLAT_LIST[i];\r\n            const chdS = KEY12_SHARP_LIST[keyIndex];\r\n            const chdF = KEY12_FLAT_LIST[keyIndex];\r\n            const isHalf = [1, 3, 6, 8, 10].includes(i);\r\n            const isSelected = editorState.molecule.rootIndex == i;\r\n            const isDenominator = (editorState.denominator == null ? -1 : editorState.denominator.rootIndex) == i;\r\n            const buildLabelSrc = (isFlat: boolean): JSX.Element => {\r\n                return (\r\n                    state.noteData.chordMode == CHORD_MODE.SCALE ?\r\n                        <>\r\n                            <span className=\"degree\">{isFlat ? degF : degS}</span>\r\n                            <span>&nbsp;(</span>\r\n                            <span className=\"chord\">{isFlat ? chdF : chdS}</span>\r\n                            <span>)</span>\r\n                        </>\r\n                        :\r\n                        <>\r\n                            <span className=\"degree\">{isFlat ? chdF : chdS}</span>\r\n                        </>\r\n                );\r\n            };\r\n            chordList.push(\r\n                <div key={i}>{\r\n                    !isHalf ?\r\n                        <div\r\n                            className={[\r\n                                isSelected ? 'active' : '',\r\n                                isDenominator ? 'denominator' : ''\r\n                            ].join(' ')}\r\n                            onClick={() => {\r\n                                // 分母が同じ場所に設定されていたら分子で上書きする\r\n                                const denominator = !isDenominator ? editorState.denominator : null;\r\n                                dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                                    params: {\r\n                                        ...editorState,\r\n                                        selectedLine: ChordPaletteLine.Root, molecule: { rootIndex: i, isFlat: false }, denominator\r\n                                    } as ChordPaletteState\r\n                                });\r\n                                // updatePianoView(\r\n                                //     i,\r\n                                //     editorState.denominator == null ? -1 : editorState.denominator.rootIndex,\r\n                                //     editorState.symbolKey\r\n                                // );\r\n                            }}\r\n                            onContextMenu={() => {\r\n                                if (isSelected) return;\r\n                                const denominator = (!isDenominator ? { rootIndex: i, isFlat: false } : null);\r\n                                dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                                    params: {\r\n                                        ...editorState,\r\n                                        selectedLine: ChordPaletteLine.Root, denominator\r\n                                    } as ChordPaletteState\r\n                                });\r\n                                // updatePianoView(\r\n                                //     editorState.molecule.rootIndex,\r\n                                //     i,\r\n                                //     editorState.symbolKey\r\n                                // );\r\n                            }}\r\n                        >\r\n                            {buildLabelSrc(false)}\r\n                        </div>\r\n                        :\r\n                        <>\r\n                            <div\r\n                                className={[\r\n                                    \"half\",\r\n                                    (isSelected && !editorState.molecule.isFlat ? ' active' : ''),\r\n                                    (isDenominator && editorState.denominator != null && !editorState.denominator.isFlat ? ' denominator' : '')\r\n                                ].join(' ')}\r\n                                onClick={() => {\r\n                                    // 分母が同じ場所に設定されていたら分子で上書きする\r\n                                    const denominator = !(isDenominator && editorState.denominator != null && !editorState.denominator.isFlat)\r\n                                        ? editorState.denominator : null;\r\n                                    dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                                        params: {\r\n                                            ...editorState,\r\n                                            selectedLine: ChordPaletteLine.Root, molecule: { rootIndex: i, isFlat: false }, denominator\r\n                                        } as ChordPaletteState\r\n                                    });\r\n                                    // updatePianoView(\r\n                                    //     i,\r\n                                    //     editorState.denominator == null ? -1 : editorState.denominator.rootIndex,\r\n                                    //     editorState.symbolKey\r\n                                    // );\r\n                                }}\r\n                                onContextMenu={() => {\r\n                                    if (isSelected && !editorState.molecule.isFlat) return;\r\n                                    const denominator = (\r\n                                        !(isDenominator && editorState.denominator != null && !editorState.denominator.isFlat)\r\n                                            ? { rootIndex: i, isFlat: false } : null);\r\n                                    dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                                        params: {\r\n                                            ...editorState,\r\n                                            selectedLine: ChordPaletteLine.Root, denominator\r\n                                        } as ChordPaletteState\r\n                                    });\r\n                                    // updatePianoView(\r\n                                    //     editorState.molecule.rootIndex,\r\n                                    //     i,\r\n                                    //     editorState.symbolKey\r\n                                    // );\r\n                                }}\r\n                            >\r\n                                {buildLabelSrc(false)}\r\n                            </div>\r\n                            <div\r\n                                className={[\r\n                                    \"half\",\r\n                                    (isSelected && editorState.molecule.isFlat ? ' active' : ''),\r\n                                    (isDenominator && editorState.denominator != null && editorState.denominator.isFlat ? ' denominator' : '')\r\n                                ].join(' ')}\r\n                                onClick={() => {\r\n                                    // 分母が同じ場所に設定されていたら分子で上書きする\r\n                                    const denominator = !(isDenominator && editorState.denominator != null && editorState.denominator.isFlat)\r\n                                        ? editorState.denominator : null;\r\n                                    dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                                        params: {\r\n                                            ...editorState,\r\n                                            selectedLine: ChordPaletteLine.Root, molecule: { rootIndex: i, isFlat: true }, denominator\r\n                                        } as ChordPaletteState\r\n                                    });\r\n                                    // updatePianoView(\r\n                                    //     i,\r\n                                    //     editorState.denominator == null ? -1 : editorState.denominator.rootIndex,\r\n                                    //     editorState.symbolKey\r\n                                    // );\r\n                                }}\r\n                                onContextMenu={() => {\r\n                                    if (isSelected && editorState.molecule.isFlat) return;\r\n                                    const denominator = (\r\n                                        !(isDenominator && editorState.denominator != null && editorState.denominator.isFlat)\r\n                                            ? { rootIndex: i, isFlat: true } : null);\r\n                                    dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                                        params: {\r\n                                            ...editorState,\r\n                                            selectedLine: ChordPaletteLine.Root, denominator\r\n                                        } as ChordPaletteState\r\n                                    });\r\n                                    // updatePianoView(\r\n                                    //     editorState.molecule.rootIndex,\r\n                                    //     i,\r\n                                    //     editorState.symbolKey\r\n                                    // );\r\n                                }}\r\n                            >\r\n                                {buildLabelSrc(true)}\r\n                            </div>\r\n                        </>\r\n                }</div>\r\n            );\r\n        });\r\n\r\n        SYMBOL_PARAMS_LIST.forEach((symbol, i) => {\r\n            // const isSelected = chordDetail.degreeIndex == i;\r\n            symbolList.push(\r\n                <div\r\n                    key={i}\r\n                    className={symbol.key == editorState.symbolKey ? 'active' : ''}\r\n                    onClick={() => {\r\n                        dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                            params: {\r\n                                ...editorState,\r\n                                selectedLine: ChordPaletteLine.Symbol, symbolKey: symbol.key\r\n                            }\r\n                        });\r\n                        // updatePianoView(\r\n                        //     editorState.molecule.rootIndex,\r\n                        //     editorState.denominator == null ? -1 : editorState.denominator.rootIndex,\r\n                        //     symbol.key\r\n                        // );\r\n                    }}\r\n                >\r\n                    <span>[{symbol.name}]</span>\r\n                </div>\r\n\r\n            );\r\n        });\r\n\r\n        for (let i = 0; i < 8; i++) {\r\n            beatList.push(\r\n                <div\r\n                    key={i}\r\n                    className={editorState.sustain >= i + 1 ? 'active' : ''}\r\n                    onClick={() => {\r\n                        dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                            params: {\r\n                                ...editorState, selectedLine: ChordPaletteLine.Sustain, sustain: i + 1\r\n                            }\r\n                        });\r\n                    }}\r\n                />\r\n            );\r\n        }\r\n\r\n        operationJsx = (<>\r\n            <div\r\n                onClick={() => {\r\n                    dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                }}>\r\n                <span>Cancel</span>\r\n            </div>\r\n            {/* <div\r\n                className={[\r\n                    chordDetail.backing == null ? 'disable' : ''\r\n                ].join(' ')}\r\n                onClick={() => {\r\n                    if (!isPreview) {\r\n                        dispatcher.backing.play(true);\r\n                    } else {\r\n                        dispatcher.preview.stop();\r\n                    }\r\n                }}>\r\n                <span>{!isPreview ? 'Play' : 'Stop'}</span>\r\n            </div> */}\r\n            <div\r\n                onClick={() => {\r\n                    dispatcher.chord.setCurChordParam();\r\n                }}>\r\n                <span>Enter</span>\r\n            </div>\r\n        </>);\r\n    }\r\n    const getAdjustOprJsx = (type: 'h' | 't', offset: number): JSX.Element => {\r\n        let [label, cls, isActive, callback] = type == 'h' ?\r\n            ['h', 'head', editorState.headAdjust == offset,\r\n                () => dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                    params: {\r\n                        ...editorState, headAdjust: offset\r\n                    }\r\n                })] :\r\n            ['t', 'tail', editorState.tailAdjust == offset,\r\n                () => dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                    params: {\r\n                        ...editorState, tailAdjust: offset\r\n                    }\r\n                })];\r\n        if (offset >= 0) {\r\n            label += (offset > 0 ? '+' : '±');\r\n        }\r\n        return (\r\n            <div\r\n                className={[\r\n                    cls,\r\n                    isActive ? 'active' : ''\r\n                ].join(' ')}\r\n                onClick={callback}\r\n            >\r\n                <span>{label + offset}</span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const scaleMatrixRowJsxList: JSX.Element[] = [];\r\n    const getScaleMatrixRowJsx = (\r\n        titleLabel: JSX.Element,\r\n        chordInfoList: {\r\n            rootIndex: number,\r\n            isFlat: boolean,\r\n            symbolKey: SymbolKey\r\n        }[]\r\n    ): JSX.Element => {\r\n        const boxJsxList: JSX.Element[] = [];\r\n        chordInfoList.forEach((info, i) => {\r\n            if (info.rootIndex === -1) {\r\n                boxJsxList.push(\r\n                    <div key={i} className=\"box blank\" />\r\n                );\r\n            } else {\r\n                const degreeList = info.isFlat ? DEGREE12_FLAT_LIST : DEGREE12_SHARP_LIST;\r\n                const souondList = info.isFlat ? KEY12_FLAT_LIST : KEY12_SHARP_LIST;\r\n                const degreeRoot = degreeList[info.rootIndex];\r\n                const soundRoot = souondList[info.rootIndex];\r\n                const symbol = getSymbolParams(info.symbolKey) as SymbolParams;\r\n                const isSelected = (\r\n                    info.rootIndex === editorState.molecule.rootIndex &&\r\n                    info.isFlat === editorState.molecule.isFlat &&\r\n                    info.symbolKey === editorState.symbolKey\r\n                );\r\n                boxJsxList.push(\r\n                    <div\r\n                        key={i}\r\n                        className={[\r\n                            'box',\r\n                            isSelected ? 'active' : ''\r\n                        ].join(' ')}\r\n                        onClick={() => {\r\n                            if (!isSelected) {\r\n                                dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                                    params: {\r\n                                        ...editorState,\r\n                                        molecule: { rootIndex: info.rootIndex, isFlat: info.isFlat },\r\n                                        symbolKey: info.symbolKey\r\n                                    } as ChordPaletteState\r\n                                });\r\n                            }\r\n                        }}>\r\n                        <div className=\"degree\">\r\n                            {degreeRoot}{symbol.name}\r\n                        </div>\r\n                        <div className=\"chord\">\r\n                            {soundRoot}{symbol.name}\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n        });\r\n        return (\r\n            <div key={scaleMatrixRowJsxList.length} className=\"scale-row\">\r\n                <div className=\"header\">\r\n                    <span>{titleLabel}</span>\r\n                </div>\r\n                {boxJsxList}\r\n            </div>\r\n        );\r\n    }\r\n    const BLANK = { rootIndex: -1, isFlat: false, symbolKey: {} as SymbolKey };\r\n    scaleMatrixRowJsxList.push(\r\n        getScaleMatrixRowJsx(\r\n            <>Diatonic<br />Triad</>,\r\n            [\r\n                { rootIndex: 0, isFlat: false, symbolKey: SymbolKey.MAJOR },\r\n                { rootIndex: 2, isFlat: false, symbolKey: SymbolKey.MINOR },\r\n                { rootIndex: 4, isFlat: false, symbolKey: SymbolKey.MINOR },\r\n                { rootIndex: 5, isFlat: false, symbolKey: SymbolKey.MAJOR },\r\n                { rootIndex: 7, isFlat: false, symbolKey: SymbolKey.MAJOR },\r\n                { rootIndex: 9, isFlat: false, symbolKey: SymbolKey.MINOR },\r\n                { rootIndex: 11, isFlat: false, symbolKey: SymbolKey.MINOR_MINUS5 },\r\n            ]\r\n        )\r\n    );\r\n    scaleMatrixRowJsxList.push(\r\n        getScaleMatrixRowJsx(\r\n            <>Diatonic<br />Tetrad</>,\r\n            [\r\n                { rootIndex: 0, isFlat: false, symbolKey: SymbolKey.MAJ7 },\r\n                { rootIndex: 2, isFlat: false, symbolKey: SymbolKey.MIN7 },\r\n                { rootIndex: 4, isFlat: false, symbolKey: SymbolKey.MIN7 },\r\n                { rootIndex: 5, isFlat: false, symbolKey: SymbolKey.MAJ7 },\r\n                { rootIndex: 7, isFlat: false, symbolKey: SymbolKey.SEVENTH },\r\n                { rootIndex: 9, isFlat: false, symbolKey: SymbolKey.MIN7 },\r\n                { rootIndex: 11, isFlat: false, symbolKey: SymbolKey.MIN7_MINUS5 },\r\n            ]\r\n        )\r\n    );\r\n    scaleMatrixRowJsxList.push(\r\n        getScaleMatrixRowJsx(\r\n            <>Sus4</>,\r\n            [\r\n                { rootIndex: 0, isFlat: false, symbolKey: SymbolKey.SUS4 },\r\n                BLANK,\r\n                BLANK,\r\n                BLANK,\r\n                { rootIndex: 7, isFlat: false, symbolKey: SymbolKey.SUS4 },\r\n                { rootIndex: 9, isFlat: false, symbolKey: SymbolKey.SUS4 },\r\n                BLANK,\r\n            ]\r\n        ),\r\n    );\r\n    scaleMatrixRowJsxList.push(\r\n        getScaleMatrixRowJsx(\r\n            <>Parallel</>,\r\n            [\r\n                { rootIndex: 0, isFlat: true, symbolKey: SymbolKey.MINOR },\r\n                { rootIndex: 2, isFlat: true, symbolKey: SymbolKey.MAJOR },\r\n                { rootIndex: 3, isFlat: true, symbolKey: SymbolKey.MAJOR },\r\n                { rootIndex: 5, isFlat: true, symbolKey: SymbolKey.MINOR },\r\n                { rootIndex: 7, isFlat: true, symbolKey: SymbolKey.MINOR },\r\n                { rootIndex: 8, isFlat: true, symbolKey: SymbolKey.MAJOR },\r\n                { rootIndex: 10, isFlat: true, symbolKey: SymbolKey.MAJOR },\r\n            ]\r\n        ),\r\n    );\r\n    scaleMatrixRowJsxList.push(\r\n        getScaleMatrixRowJsx(\r\n            <>Secondary<br />Dominant</>,\r\n            [\r\n                BLANK,\r\n                { rootIndex: 9, isFlat: false, symbolKey: SymbolKey.SEVENTH },\r\n                { rootIndex: 11, isFlat: false, symbolKey: SymbolKey.SEVENTH },\r\n                { rootIndex: 0, isFlat: false, symbolKey: SymbolKey.SEVENTH },\r\n                { rootIndex: 2, isFlat: false, symbolKey: SymbolKey.SEVENTH },\r\n                { rootIndex: 4, isFlat: false, symbolKey: SymbolKey.SEVENTH },\r\n                BLANK,\r\n            ]\r\n        ),\r\n    );\r\n    scaleMatrixRowJsxList.push(\r\n        getScaleMatrixRowJsx(\r\n            <>Secondary<br />Non Root</>,\r\n            [\r\n                BLANK,\r\n                { rootIndex: 1, isFlat: false, symbolKey: SymbolKey.DIM },\r\n                { rootIndex: 3, isFlat: false, symbolKey: SymbolKey.DIM },\r\n                { rootIndex: 4, isFlat: false, symbolKey: SymbolKey.DIM },\r\n                { rootIndex: 6, isFlat: false, symbolKey: SymbolKey.DIM },\r\n                { rootIndex: 8, isFlat: false, symbolKey: SymbolKey.DIM },\r\n                BLANK\r\n            ]\r\n        ),\r\n    );\r\n    return (\r\n        <div\r\n            ref={ref}\r\n            id=\"total-palette\"\r\n            className={'floatwnd' + (state.noteState.floatwndState == FloatWndState.CHORD_PALETTE ? ' active' : '')}\r\n            onClick={() => {\r\n            }}\r\n        >\r\n            <TabbedPane groupName=\"selector-tabs\"\r\n                tabElements={[\r\n                    {\r\n                        name: 'Scale', disable: isDirect, cont: (\r\n                            <>\r\n                                <div className={'scale-matrix'}>\r\n                                    {scaleMatrixRowJsxList}\r\n                                </div>\r\n                            </>\r\n                        )\r\n                    },\r\n                    {\r\n                        name: 'Direct', disable: false, cont: (\r\n                            <>\r\n                                <div className={'chord-selector' + (editorState.selectedLine == ChordPaletteLine.Root ? ' active' : '')}>\r\n                                    {chordList}\r\n                                </div>\r\n                                <div className={'symbol-selector' + (editorState.selectedLine == ChordPaletteLine.Symbol ? ' active' : '')}>\r\n                                    {symbolList}\r\n                                </div>\r\n                            </>\r\n                        )\r\n                    }\r\n                ]}\r\n                activeNo={1}\r\n            />\r\n            <div className={'piano-view'}>\r\n                <canvas ref={canvasRef} />\r\n            </div>\r\n            <div className={'beat-selector' + (editorState.selectedLine == ChordPaletteLine.Sustain ? ' active' : '')}>\r\n                {beatList}\r\n            </div>\r\n            <div className={'adjuster' + (editorState.selectedLine == ChordPaletteLine.Adjuster ? ' active' : '')}>\r\n                {getAdjustOprJsx('h', -0.5)}\r\n                {getAdjustOprJsx('h', -0.25)}\r\n                {getAdjustOprJsx('h', 0)}\r\n                {getAdjustOprJsx('h', 0.25)}\r\n                {getAdjustOprJsx('h', 0.5)}\r\n                {getAdjustOprJsx('t', -0.5)}\r\n                {getAdjustOprJsx('t', -0.25)}\r\n                {getAdjustOprJsx('t', 0)}\r\n                {getAdjustOprJsx('t', 0.25)}\r\n                {getAdjustOprJsx('t', 0.5)}\r\n            </div>\r\n            <div className=\"operation\">\r\n                {operationJsx}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChordSelector;","import { DEGREE12_SHARP_LIST, KEY12_SHARP_LIST, SCALE_LIST, SYMBOL_PARAMS_LIST } from 'contents/common/define';\r\nimport { getAdjustSusValue, getSymbolParams } from 'contents/common/utils';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { DetailChord, DetailSection, TypeNoteElement, DetailChange} from 'contents/redux/store';\r\nimport { useContext } from 'react';\r\nimport './CurrentBlockDetailBar.css';\r\n\r\nconst CurrentBlockDetailBar = () => {\r\n\r\n    const { state, dispatch } = useContext(GlobalContext);\r\n    const focusIndex = state.noteState.focusIndex;\r\n\r\n    if (focusIndex == -1) return (<></>);\r\n\r\n    const curData = state.noteData.dataList[focusIndex];\r\n    const cache = state.noteState.cacheList[focusIndex];\r\n\r\n    let innerJsx: JSX.Element = <></>;\r\n    switch (curData.type) {\r\n        // コードブロック選択時\r\n        case TypeNoteElement.Chord: {\r\n            const detail = curData.detail as DetailChord;\r\n            let root = '-';\r\n            if (detail.molecule != null) {\r\n                const rootIndex = detail.molecule.rootIndex;\r\n                const degreeRoot = DEGREE12_SHARP_LIST[rootIndex];\r\n                const chordRoot = KEY12_SHARP_LIST[rootIndex];\r\n                root = `${degreeRoot} (${chordRoot})`;\r\n            }\r\n            let symbolName = '-';\r\n            if (detail.molecule != null) {\r\n                symbolName = `[${getSymbolParams(detail.symbolKey)?.name as string}]`;\r\n            }\r\n\r\n            const baseBlockJsx = buildInfoBlock('Base', [\r\n                { labelName: 'Tempo', value: '' + cache.init.tempo, disable: false },\r\n                { labelName: 'Beat', value: cache.init.rythm, disable: false },\r\n                { labelName: 'Key', value: KEY12_SHARP_LIST[cache.init.keyIndex], disable: false },\r\n                { labelName: 'Scale', value: cache.init.scale, disable: false },\r\n            ]);\r\n\r\n            const chordBlockJsx = buildInfoBlock('Chord', [\r\n                { labelName: 'Root', value: root, disable: root == '-' },\r\n                { labelName: 'Symbol', value: symbolName, disable: symbolName == '-' },\r\n                { labelName: 'On chord', value: '-', disable: true },\r\n                { labelName: 'Sustain', value: String(detail.sustain), disable: false },\r\n                { labelName: 'Adjsut-H', value: getAdjustSusValue(detail.headAdjust), disable: detail.headAdjust == 0 },\r\n                { labelName: 'Adjsut-T', value: getAdjustSusValue(detail.tailAdjust), disable: detail.tailAdjust == 0 },\r\n            ]);\r\n\r\n            innerJsx = (\r\n                <div\r\n                    className={\r\n                        'block'\r\n                    }\r\n                >\r\n                    <div>\r\n                        {baseBlockJsx}\r\n                        {chordBlockJsx}\r\n                        {(() => {\r\n\r\n                            if (detail.molecule != null) {\r\n                                const structList: JSX.Element[] = [];\r\n                                const symbol = getSymbolParams(detail.symbolKey);\r\n                                const list = symbol?.intervals;\r\n                                const len = list?.length as number;\r\n                                for (let i = 0; i < 7; i++) {\r\n                                    if (i < len) {\r\n                                        const interval = symbol?.intervals[i] as number;\r\n                                        const struct = symbol?.struct[i];\r\n                                        const sound = KEY12_SHARP_LIST[(detail.molecule.rootIndex + interval) % 12];\r\n                                        structList.push(\r\n                                            <div key={i} className=\"record\">\r\n                                                <div className=\"interval\"><span>{interval}</span></div>\r\n                                                <div className=\"struct\"><span>{struct}</span></div>\r\n                                                <div className=\"sound\"><span>{sound}</span></div>\r\n                                            </div>\r\n                                        );\r\n                                    } else {\r\n                                        structList.push(\r\n                                            <div key={i} className=\"record disable\">\r\n                                                <div className=\"interval\"></div>\r\n                                                <div className=\"struct\"></div>\r\n                                                <div className=\"sound\"></div>\r\n                                            </div>\r\n                                        );\r\n                                    }\r\n                                };\r\n                                return (<>\r\n                                    <div className=\"title\">\r\n                                        <span>Struct</span>\r\n                                    </div>\r\n                                    <div className=\"symbol-struct\">\r\n                                        {structList}\r\n                                    </div>\r\n                                </>)\r\n                            }\r\n                            return (<></>);\r\n                        })()}\r\n                    </div>\r\n                </div>\r\n            )\r\n        }\r\n            break;\r\n        // セクションブロック選択時\r\n        case TypeNoteElement.Section: {\r\n            const detail = curData.detail as DetailSection;\r\n\r\n            const sectionBlockJsx = buildInfoBlock('Section', [\r\n                { labelName: 'label', value: detail.labelName, disable: false },\r\n                { labelName: 'box count', value: '-', disable: true },\r\n                { labelName: 'total bar', value: '-', disable: true },\r\n                { labelName: 'total time', value: '-', disable: true }\r\n            ]);\r\n            innerJsx = (\r\n                <div\r\n                    className={\r\n                        'block'\r\n                    }\r\n                >\r\n                    <div>\r\n                        {sectionBlockJsx}\r\n                    </div>\r\n                </div>\r\n            )\r\n        }\r\n            break;\r\n\r\n        // チェンジブロック選択時\r\n        case TypeNoteElement.Change: {\r\n            const detail = curData.detail as DetailChange;\r\n            let changeInfo = ['-','-','-','-','-','-','-','-','-'];\r\n\r\n            if(detail.changeType != null){\r\n                changeInfo[0] = String(detail.changeType);\r\n            }\r\n\r\n            if(detail.modulateRelation != null){\r\n                changeInfo[1] = String(detail.modulateRelation);\r\n            }\r\n\r\n            if(detail.domminantValue != 0){\r\n                changeInfo[2] = String(detail.domminantValue);\r\n            }\r\n\r\n            if(detail.keyAdjust != 0){\r\n                changeInfo[3] = String(detail.keyAdjust);\r\n            }\r\n            \r\n            if(detail.tempoRelation != null){\r\n                changeInfo[4] = String(detail.tempoRelation);\r\n            }\r\n\r\n            if(detail.tempoDiff != 0){\r\n                changeInfo[5] = String(detail.tempoDiff);\r\n            }\r\n\r\n            if(detail.tempoRate != 0){\r\n                changeInfo[6] = String(detail.tempoRate);\r\n            }\r\n\r\n            if(detail.tempoAbsolute != 0){\r\n                changeInfo[7] = String(detail.tempoAbsolute);\r\n            }\r\n\r\n            if(detail.beat != null){\r\n                changeInfo[8] = String(detail.beat);\r\n            }\r\n\r\n            const changeBlockJsx = buildInfoBlock('Change', [\r\n                { labelName: 'type', value: changeInfo[0], disable: changeInfo[0] == '-' },\r\n                { labelName: 'modulate', value: changeInfo[1], disable: changeInfo[1] == '-' },\r\n                { labelName: 'domm', value: changeInfo[2], disable: changeInfo[2] == '-' },\r\n                { labelName: 'key', value: changeInfo[3], disable: changeInfo[3] == '-' },\r\n                { labelName: 'tempo', value: changeInfo[4], disable: changeInfo[4] == '-' },\r\n                { labelName: 'diff', value: changeInfo[5], disable: changeInfo[5] == '-' },\r\n                { labelName: 'rate', value: changeInfo[6], disable: changeInfo[6] == '-' },\r\n                { labelName: 'absolute', value: changeInfo[7], disable: changeInfo[7] == '-' },\r\n                { labelName: 'beat', value: changeInfo[8], disable: changeInfo[8] == '-' },\r\n            ]);\r\n            innerJsx = (\r\n                <div\r\n                    className={\r\n                        'block'\r\n                    }\r\n                >\r\n                    <div>\r\n                        {changeBlockJsx}\r\n                    </div>\r\n                </div>\r\n            )\r\n        }\r\n            break;\r\n    }\r\n    return (\r\n        <div id=\"current-detail\">\r\n            {innerJsx}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default CurrentBlockDetailBar;\r\n\r\n/**\r\n * 情報レコードのプロパティ\r\n */\r\ntype DataRecord = {\r\n    /** 表示タイトル */\r\n    labelName: string;\r\n    /** 値 */\r\n    value: string;\r\n    /** 非活性にするかどうか（true: 非活性） */\r\n    disable: boolean;\r\n}\r\n\r\n/**\r\n * タイトルと情報レコードを持つブロックのJSXを生成します。\r\n *\r\n * @param {string} titleLabel ブロックのタイトル\r\n * @param {DataRecord[]} dataRecordList データレコード要素のリスト\r\n * @return {*}  {JSX.Element} 生成するJSX\r\n */\r\nconst buildInfoBlock = (titleLabel: string, dataRecordList: DataRecord[]): JSX.Element => {\r\n    const jsxList: JSX.Element[] = [];\r\n    dataRecordList.forEach((state, i) => {\r\n        jsxList.push(\r\n            <div\r\n                key={i}\r\n                className={\r\n                    'record' +\r\n                    (state.disable ? ' disable' : '')\r\n                }>\r\n                <div className=\"title\"><span>{state.labelName}:</span></div>\r\n                <div className=\"value\"><span>{state.value}</span></div>\r\n            </div>\r\n        );\r\n    });\r\n    return (<>\r\n        <div className=\"title\">\r\n            <span>{titleLabel}</span>\r\n        </div>\r\n        <div className=\"current-state\">\r\n            {jsxList}\r\n        </div>\r\n    </>);\r\n}","import { Dispatcher } from \"contents/redux/dispatcher\";\r\nimport { BackingLen, BackingEditorState, BACKING_LEN_TYPE, BACKING_SIDE } from \"contents/redux/store\";\r\n\r\n\r\ntype BackingOperationProps = {\r\n    dispatcher: Dispatcher;\r\n    paletteState: BackingEditorState;\r\n}\r\n\r\ntype ButtonBean = {\r\n    label: string;\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n    callback: Function;\r\n}\r\n\r\nconst BackingOperation = (props: BackingOperationProps) => {\r\n\r\n    const dispatcher = props.dispatcher;\r\n    const paletteState = props.paletteState;\r\n    const sideIndex = paletteState.sideIndex;\r\n    const curSideScript = paletteState.layers[sideIndex];\r\n    const selectedLenIndex = paletteState.selectedLenIndex;\r\n    const curLenBean = curSideScript.lens[selectedLenIndex];\r\n    const curVolume = curSideScript.vels[selectedLenIndex];\r\n\r\n    const setCurrentLenBean = (lenBean: BackingLen) => {\r\n        const script = paletteState.layers;\r\n        script[sideIndex].lens[selectedLenIndex] = lenBean;\r\n        dispatcher.initBackingPalette({\r\n            ...paletteState,\r\n            layers: script\r\n        });\r\n    };\r\n    const setCurrentLen = (lenType: BACKING_LEN_TYPE) => {\r\n        curLenBean.len = lenType;\r\n        curLenBean.isHalf = false;\r\n        curLenBean.isDiv3 = false;\r\n        setCurrentLenBean(curLenBean);\r\n    };\r\n    const updateCurrentVolume = (sub: number) => {\r\n        const script = paletteState.layers;\r\n        const nowVol = script[sideIndex].vels[selectedLenIndex];\r\n        script[sideIndex].vels[selectedLenIndex] = nowVol + sub;\r\n        dispatcher.initBackingPalette({\r\n            ...paletteState,\r\n            layers: script\r\n        });\r\n    };\r\n\r\n    const curLen = curLenBean.len;\r\n    const buttons: ButtonBean[] = [\r\n        {\r\n            label: '16',\r\n            isActive: curLen == BACKING_LEN_TYPE.LEN16,\r\n            isDisable: false,\r\n            callback: () => { setCurrentLen(BACKING_LEN_TYPE.LEN16); }\r\n        },\r\n        {\r\n            label: '8',\r\n            isActive: curLen == BACKING_LEN_TYPE.LEN8,\r\n            isDisable: false,\r\n            callback: () => { setCurrentLen(BACKING_LEN_TYPE.LEN8); }\r\n        },\r\n        {\r\n            label: '4',\r\n            isActive: curLen == BACKING_LEN_TYPE.LEN4,\r\n            isDisable: false,\r\n            callback: () => { setCurrentLen(BACKING_LEN_TYPE.LEN4); }\r\n        },\r\n        {\r\n            label: '2',\r\n            isActive: curLen == BACKING_LEN_TYPE.LEN2,\r\n            isDisable: false,\r\n            callback: () => { setCurrentLen(BACKING_LEN_TYPE.LEN2); }\r\n        },\r\n        {\r\n            label: '1',\r\n            isActive: curLen == BACKING_LEN_TYPE.LEN1,\r\n            isDisable: false,\r\n            callback: () => { setCurrentLen(BACKING_LEN_TYPE.LEN1); }\r\n        },\r\n        {\r\n            label: '.',\r\n            isActive: curLenBean.isHalf,\r\n            isDisable: !dispatcher.backing.isAcceptHalf(),\r\n            callback: () => {\r\n                curLenBean.isHalf = !curLenBean.isHalf;\r\n                curLenBean.isDiv3 = false;\r\n                setCurrentLenBean(curLenBean);\r\n            }\r\n        },\r\n        {\r\n            label: '/ 3',\r\n            isActive: curLenBean.isDiv3,\r\n            isDisable: !dispatcher.backing.isAcceptDiv3(),\r\n            callback: () => {\r\n                curLenBean.isDiv3 = !curLenBean.isDiv3;\r\n                curLenBean.isHalf = false;\r\n                setCurrentLenBean(curLenBean);\r\n            }\r\n        },\r\n        {\r\n            label: 'Add',\r\n            isActive: false,\r\n            isDisable: false,\r\n            callback: () => {\r\n                dispatcher.backing.addLen();\r\n            }\r\n        },\r\n        {\r\n            label: 'Del',\r\n            isActive: false,\r\n            isDisable: curSideScript.lens.length <= 1,\r\n            callback: () => {\r\n                dispatcher.backing.delLen();\r\n            }\r\n        },\r\n        {\r\n            label: 'vel-',\r\n            isActive: false,\r\n            isDisable: curVolume <= 1,\r\n            callback: () => {\r\n                updateCurrentVolume(-1);\r\n            }\r\n        },\r\n        {\r\n            label: 'vel+',\r\n            isActive: false,\r\n            isDisable: curVolume >= 10,\r\n            callback: () => {\r\n                updateCurrentVolume(1);\r\n            }\r\n        },\r\n        // {\r\n        //     label: 'all clear',\r\n        //     isActive: false,\r\n        //     isDisable: false,\r\n        //     callback: () => {\r\n        //         const backingState: BackingEditorState = {\r\n        //             useChannels: [],\r\n        //             isUsePedal: false,\r\n        //             sideIndex: 0,\r\n        //             selectedLenIndex: 0,\r\n        //             selectedChannelIndex: -1,\r\n        //             layers: [\r\n        //                 {\r\n        //                     lens: [{\r\n        //                         len: BACKING_LEN_TYPE.LEN4,\r\n        //                         isDiv3: false,\r\n        //                         isHalf: false\r\n        //                     }],\r\n        //                     side: BACKING_SIDE.LEFT,\r\n        //                     table: [],\r\n        //                     vels: [5]\r\n        //                 },\r\n        //                 {\r\n        //                     lens: [{\r\n        //                         len: BACKING_LEN_TYPE.LEN4,\r\n        //                         isDiv3: false,\r\n        //                         isHalf: false\r\n        //                     }],\r\n        //                     side: BACKING_SIDE.RIGHT,\r\n        //                     table: [],\r\n        //                     vels: [5]\r\n        //                 }\r\n        //             ],\r\n        //             isCorrect: true\r\n        //         };\r\n        //         dispatcher.initBackingPalette(backingState);\r\n        //     }\r\n        // }\r\n    ];\r\n    const buttonList: JSX.Element[] = [];\r\n    buttons.forEach((button, i) => {\r\n        buttonList.push(\r\n            <button\r\n                key={i}\r\n                className={\r\n                    (button.isActive ? 'active' : '') +\r\n                    (button.isDisable ? ' disable' : '')\r\n                }\r\n                onClick={() => button.callback()}\r\n            >\r\n                <span>{button.label}</span>\r\n            </button>\r\n        );\r\n    });\r\n\r\n    return (<>\r\n        <select\r\n            value={paletteState.channelRowSize}\r\n            onChange={(e) => {\r\n                const backing = props.paletteState;\r\n                const newValue = parseInt(e.target.value);\r\n                const diff = newValue - backing.channelRowSize;\r\n                const layers = backing.layers;\r\n                if (diff > 0) {\r\n                    layers.forEach((layer) => {\r\n                        for (let i = 0; i < diff; i++) {\r\n                            const record: boolean[][] = [];\r\n                            for (let j = 0; j < layer.lens.length; j++) {\r\n                                record.push([false]);\r\n                            }\r\n                            layer.table.splice(backing.channelRowSize, 0, record);\r\n                        }\r\n                    });\r\n                } else if (diff < 0) {\r\n                    layers.forEach((layer) => {\r\n                        layer.table.splice(newValue, Math.abs(diff));\r\n                    });\r\n                }\r\n                backing.channelRowSize = newValue;\r\n                dispatcher.backing.setPaletteState(props.paletteState);\r\n            }}>\r\n            {(() => {\r\n                const list: JSX.Element[] = [];\r\n                for (let i = 0; i < 12; i++) {\r\n                    const val = i + 1;\r\n                    const isDisabled = val < paletteState.channelRowSize;\r\n                    list.push(\r\n                        <option\r\n                            key={i}\r\n                            value={val}\r\n                            className={isDisabled ? 'del' : ''}\r\n                        >\r\n                            {val}\r\n                        </option>\r\n                    );\r\n                }\r\n                return list;\r\n            })()}\r\n        </select>\r\n        {buttonList}\r\n    </>);\r\n}\r\n\r\nexport default BackingOperation;","import { Dispatcher } from \"contents/redux/dispatcher\";\r\nimport { BackingLen, BackingLayer, BackingEditorState, BACKING_LEN_TYPE } from \"contents/redux/store\";\r\nimport { useContext } from \"react\";\r\nimport { BackingContext } from \"./BackingEditor\";\r\nimport { ChannelBean } from \"./BackingTable\";\r\n\r\ntype NotesMatrixProps = {\r\n    paletteState: BackingEditorState;\r\n    channelList: ChannelBean[];\r\n    dispatcher: Dispatcher;\r\n}\r\n\r\nconst NotesMatrix = (props: NotesMatrixProps) => {\r\n\r\n    // const { setCorrect } = useContext(BackingContext);\r\n\r\n    const paletteState = props.paletteState\r\n    const channelList = props.channelList;\r\n    const dispatcher = props.dispatcher;\r\n\r\n    const matrixLayersJsx: JSX.Element[] = [];\r\n\r\n    let hasError = false;\r\n    for (let l = 0; l < 2; l++) {\r\n        const linesJsx: JSX.Element[] = [];\r\n        const layer = paletteState.layers[l];\r\n        const isCurLayer = paletteState.sideIndex == l;\r\n        // 逆に表示する（音程が低い方が下になるようにする）\r\n        for (let i = paletteState.channelRowSize - 1; i >= 0; i--) {\r\n            const cellList: JSX.Element[] = [];\r\n            layer.lens.forEach((lenBean, j) => {\r\n                let classes = '';\r\n                let label = '';\r\n                switch (lenBean.len) {\r\n                    case BACKING_LEN_TYPE.LEN4: classes += 'len4'; label = '4'; break;\r\n                    case BACKING_LEN_TYPE.LEN8: classes += 'len8'; label = '8'; break;\r\n                    case BACKING_LEN_TYPE.LEN16: classes += 'len16'; label = '16'; break;\r\n                    case BACKING_LEN_TYPE.LEN2: classes += 'len2'; label = '2'; break;\r\n                    case BACKING_LEN_TYPE.LEN1: classes += 'len1'; label = '1'; break;\r\n                }\r\n                if (lenBean.isHalf) {\r\n                    classes += ' half';\r\n                }\r\n\r\n                const divList: JSX.Element[] = [];\r\n                const divCnt = lenBean.isDiv3 ? 3 : 1;\r\n                for (let k = 0; k < divCnt; k++) {\r\n                    const activeState = getActiveState(paletteState.layers, l, i, j, k);\r\n                    if(activeState == 'overlap') {\r\n                        hasError = true;\r\n                    }\r\n                    divList.push(\r\n                        <div\r\n                            key={k}\r\n                            className={[\r\n                                activeState,\r\n                                (lenBean.isDiv3 ? 'div3' : '')\r\n                            ].join(' ')}\r\n                            onClick={() => {\r\n                                dispatcher.backing.toggleMatrix(i, j, k);\r\n                            }}\r\n                        />\r\n                    );\r\n                }\r\n                cellList.push(\r\n                    <div\r\n                        key={j}\r\n                        className={classes}\r\n                    >\r\n                        {divList}\r\n                    </div>\r\n                );\r\n            });\r\n            linesJsx.push(\r\n                <div key={i} className=\"line\">\r\n                    {cellList}\r\n                </div>\r\n            );\r\n        };\r\n        matrixLayersJsx.push(\r\n            <div\r\n                key={l}\r\n                className={\r\n                    isCurLayer ? 'cur' : 'back'\r\n                }\r\n            >\r\n                {linesJsx}\r\n            </div>\r\n        );\r\n    }\r\n    // setCorrect(!hasError);\r\n\r\n    return (\r\n        <div className=\"matrix\">\r\n            {matrixLayersJsx}\r\n        </div>\r\n\r\n    );\r\n}\r\n\r\n/**\r\n * セルの状態を元に適用するスタイルのclassを返す。\r\n * @param layers レイヤーの配列\r\n * @param curLayerIndex 選択中のレイヤーの連番\r\n * @param lineIndex 走査中のセルの連番\r\n * @param lenIndex 走査中の音価の連番\r\n * @returns スタイルのclass\r\n */\r\nconst getActiveState = (layers: BackingLayer[], curLayerIndex: number, lineIndex: number, lenIndex: number, divIndex: number): string => {\r\n    const cur = layers[curLayerIndex == 0 ? 0 : 1];\r\n    const back = layers[curLayerIndex == 1 ? 0 : 1];\r\n    let className = '';\r\n\r\n    if (cur.table[lineIndex][lenIndex][divIndex]) {\r\n        className = 'active';\r\n        const curCellRange = getCellRange(cur.lens, lenIndex, divIndex);\r\n        back.lens.forEach((backLenBean, j) => {\r\n            for (let k = 0; k < (backLenBean.isDiv3 ? 3 : 1); k++) {\r\n                const backRange = getCellRange(back.lens, j, k);\r\n                if (back.table[lineIndex][j][k] &&\r\n                    // 双方向で判定する\r\n                    (isOverlapJudge(curCellRange, backRange) || isOverlapJudge(backRange, curCellRange))\r\n                ) {\r\n                    className = 'overlap';\r\n                }\r\n            }\r\n        });\r\n    }\r\n    return className;\r\n}\r\n\r\n/**\r\n * 比較する2つのセルが重なっているか判定する。\r\n * @param range1 比較対象セル1\r\n * @param range2 比較対象セル2\r\n * @returns 判定結果\r\n */\r\nconst isOverlapJudge = (range1: CellRange, range2: CellRange): boolean => {\r\n    return (range1.head + range1.width > range2.head && range1.head + range1.width <= range2.head + range2.width)\r\n        || (range1.head < range2.head + range2.width && range1.head >= range2.head);\r\n}\r\n\r\n/**\r\n * セルの幅を返す。\r\n * @param lens 音価\r\n * @param lenIndex 音価リストの連番\r\n * @param divIndex 連符リストの連番\r\n * @returns セルの幅\r\n */\r\nconst getCellRange = (lens: BackingLen[], lenIndex: number, divIndex: number): CellRange => {\r\n    let head = 0;\r\n    for (let i = 0; i < lenIndex; i++) {\r\n        const lenBean = lens[i];\r\n        head += getLenSize(lenBean);\r\n    }\r\n    const curLen = lens[lenIndex];\r\n    let width = getLenSize(curLen);\r\n\r\n    if (curLen.isDiv3) {\r\n        head += width / 3 * divIndex;\r\n        width = width / 3;\r\n    }\r\n    return { head, width };\r\n}\r\n\r\n/**\r\n * セルの幅を定義する要素。\r\n */\r\ntype CellRange = {\r\n    head: number;\r\n    width: number;\r\n}\r\n\r\n/**\r\n * 計算に使う音価の長さを返す。\r\n * @param lenBean 音価パラメータ\r\n * @returns 計算に使う音価の長さ\r\n */\r\nconst getLenSize = (lenBean: BackingLen): number => {\r\n    let size = 0;\r\n    switch (lenBean.len) {\r\n        case BACKING_LEN_TYPE.LEN1: size = 16; break;\r\n        case BACKING_LEN_TYPE.LEN2: size = 8; break;\r\n        case BACKING_LEN_TYPE.LEN4: size = 4; break;\r\n        case BACKING_LEN_TYPE.LEN8: size = 2; break;\r\n        case BACKING_LEN_TYPE.LEN16: size = 1; break;\r\n    }\r\n    if (lenBean.isHalf) {\r\n        size *= 1.5;\r\n    }\r\n    return size;\r\n}\r\n\r\nexport default NotesMatrix;","import { BackingEditorState, BackingLayer, BACKING_LEN_TYPE, DetailChord } from \"contents/redux/store\";\r\nimport { useRef } from \"react\";\r\n\r\n\r\ntype SplitMeasureProps = {\r\n    paletteState: BackingEditorState;\r\n    layer: BackingLayer;\r\n}\r\n\r\nconst SplitMeasure = (props: SplitMeasureProps) => {\r\n\r\n    const curLayer = props.layer;\r\n    const paletteState = props.paletteState;\r\n    const sustainLength = (paletteState.sustain + paletteState.headAdjust + paletteState.tailAdjust) * 4;\r\n\r\n    // 音価のメジャー\r\n    const measureInner: JSX.Element[] = [];\r\n    let measureLength = 0;\r\n    curLayer.lens.forEach((lenBean, i) => {\r\n        let cnt = 0;\r\n        switch (lenBean.len) {\r\n            case BACKING_LEN_TYPE.LEN1: cnt = 16; break;\r\n            case BACKING_LEN_TYPE.LEN2: cnt = 8; break;\r\n            case BACKING_LEN_TYPE.LEN4: cnt = 4; break;\r\n            case BACKING_LEN_TYPE.LEN8: cnt = 2; break;\r\n            case BACKING_LEN_TYPE.LEN16: cnt = 1; break;\r\n        }\r\n        if (lenBean.isHalf) {\r\n            cnt *= 1.5;\r\n        }\r\n        measureLength += cnt;\r\n    });\r\n    // コードブロックの拍の方が長い場合は上書き\r\n    const isLimit = measureLength > sustainLength;\r\n    measureLength = (!isLimit ? sustainLength : measureLength);\r\n    for (let i = 0; i < measureLength; i++) {\r\n        const pos = i + (paletteState.headAdjust * 4);\r\n        const getLen = () => {\r\n            if (pos % 2 == 0) {\r\n                if (pos % 4 == 0) {\r\n                    return 'mem4';\r\n                } else {\r\n                    return 'mem8';\r\n                }\r\n            } else {\r\n                return 'mem16';\r\n            }\r\n        }\r\n        const isLimit = false;//i == sustainLength;\r\n        measureInner.push(<div key={i} className={getLen() + (isLimit ? ' limit' : '')} />);\r\n    }\r\n\r\n    const limitLeft = sustainLength * 31;\r\n    const limitJsx = !isLimit ?\r\n        (<div style={{\r\n            left: `${limitLeft}px`,\r\n            width: '5px'\r\n        }} className=\"safe\"></div>)\r\n        :\r\n        (<div style={{\r\n            left: `${limitLeft}px`,\r\n            width: `${(measureLength - sustainLength) * 31}px`\r\n        }} className=\"over\"></div>);\r\n    return (\r\n        <div className=\"measure\">\r\n            {measureInner}\r\n            {limitJsx}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SplitMeasure;","import { Dispatcher } from \"contents/redux/dispatcher\";\r\nimport { BackingEditorState, BACKING_LEN_TYPE, ChannelParam, DetailChord } from \"contents/redux/store\";\r\nimport { createContext } from \"react\";\r\nimport BackingOperation from \"./BackingOperation\";\r\nimport NotesMatrix from \"./NotesMatrix\";\r\nimport SplitMeasure from \"./SplitMeasure\";\r\n\r\n\r\nexport type ChannelBean = {\r\n    soundIndex: number;\r\n    soundFullName: string;\r\n}\r\n\r\ntype BackingTableProps = {\r\n    paletteState: BackingEditorState;\r\n    dispatcher: Dispatcher;\r\n    channelList: ChannelBean[];\r\n    testPlaySound: Function;\r\n}\r\n\r\nconst BackingTable = (props: BackingTableProps) => {\r\n\r\n    const paletteState = props.paletteState;\r\n    const sideIndex = paletteState.sideIndex;\r\n    const curLayer = paletteState.layers[sideIndex];\r\n    const dispatcher = props.dispatcher;\r\n    const channelList = props.channelList;\r\n    const testPlaySound = props.testPlaySound;\r\n\r\n\r\n    const channelJsxList: JSX.Element[] = [];\r\n    // チャンネル数に対してボイシングが足りなければ、その数（高音）だけ空白を設定する\r\n    const blankAdjust = paletteState.channelRowSize - channelList.length;\r\n    for (let i = 0; i < paletteState.channelRowSize; i++) {\r\n        // ブランクの数だけボイシングから取得するインデックスを調整する\r\n        const curIndex = i - blankAdjust;\r\n        // チャンネルに音が設定済みかどうか\r\n        const isExist = curIndex >= 0;\r\n        let soundFullName = '-';\r\n        if (isExist) {\r\n            soundFullName = channelList[curIndex].soundFullName;\r\n        }\r\n        channelJsxList.push(\r\n            <div key={i}>\r\n                <div\r\n                    className={[\r\n                        'channel',\r\n                        !isExist ? 'blank' : ''\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        if (isExist) {\r\n                            testPlaySound(soundFullName)\r\n                        }\r\n                    }}\r\n                >\r\n                    <span>{soundFullName}</span>\r\n                </div>\r\n                <div\r\n                    className={[\r\n                        'opr',\r\n                        props.paletteState.channelRowSize == 1 ? 'disable' : ''\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        const backing = props.paletteState;\r\n                        const layers = backing.layers;\r\n                        const index = backing.channelRowSize - (i + 1);\r\n                        layers.forEach((layer) => {\r\n                            layer.table.splice(index, 1);\r\n                        });\r\n                        backing.channelRowSize = backing.channelRowSize - 1;\r\n                        dispatcher.backing.setPaletteState(props.paletteState);\r\n                    }}\r\n                >\r\n                    <span>-</span>\r\n                </div>\r\n                <div\r\n                    className={[\r\n                        'opr',\r\n                        props.paletteState.channelRowSize == 12 ? 'disable' : ''\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        const backing = props.paletteState;\r\n                        const layers = backing.layers;\r\n                        const index = backing.channelRowSize - (i + 1);\r\n                        layers.forEach((layer) => {\r\n                            const record: boolean[][] = [];\r\n                            for (let j = 0; j < layer.lens.length; j++) {\r\n                                record.push([false]);\r\n                            }\r\n                            layer.table.splice(index, 0, record);\r\n                        });\r\n                        backing.channelRowSize = backing.channelRowSize + 1;\r\n                        dispatcher.backing.setPaletteState(props.paletteState);\r\n                    }}\r\n                >\r\n                    <span>+</span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 音価の分割リスト\r\n    const lens: JSX.Element[] = [];\r\n    const volumeList: JSX.Element[] = [];\r\n    curLayer.lens.forEach((lenBean, i) => {\r\n        const isSelected = paletteState.selectedLenIndex == i;\r\n        let classes = isSelected ? 'active ' : '';\r\n        let label = '';\r\n        switch (lenBean.len) {\r\n            case BACKING_LEN_TYPE.LEN4: classes += 'len4'; label = '4'; break;\r\n            case BACKING_LEN_TYPE.LEN8: classes += 'len8'; label = '8'; break;\r\n            case BACKING_LEN_TYPE.LEN16: classes += 'len16'; label = '16'; break;\r\n            case BACKING_LEN_TYPE.LEN2: classes += 'len2'; label = '2'; break;\r\n            case BACKING_LEN_TYPE.LEN1: classes += 'len1'; label = '1'; break;\r\n        }\r\n        if (lenBean.isHalf) {\r\n            label += ' .';\r\n            classes += ' half';\r\n        }\r\n        if (lenBean.isDiv3) {\r\n            label += ' /';\r\n        }\r\n        lens.push(\r\n            <div\r\n                key={i}\r\n                className={classes}\r\n                onClick={() => {\r\n                    dispatcher.initBackingPalette({\r\n                        ...paletteState,\r\n                        selectedLenIndex: i\r\n                    });\r\n                }}>\r\n                <span>{label}</span>\r\n            </div>\r\n        );\r\n        const volume = curLayer.vels[i];\r\n        volumeList.push(\r\n            <div\r\n                key={i}\r\n                className={classes}\r\n            >\r\n                <div style={{ height: (volume * 10) + '%' }}></div>\r\n            </div>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <div className={[\r\n            'backing-table',\r\n            paletteState.isEditPattern ? '' : 'disable'\r\n        ].join(' ')}>\r\n            <div className=\"switch\">\r\n                <BackingOperation\r\n                    dispatcher={dispatcher}\r\n                    paletteState={paletteState}\r\n                />\r\n            </div>\r\n            <div className=\"fixed\">\r\n                <div className=\"layer\">\r\n                    <button\r\n                        className={\r\n                            paletteState.sideIndex == 1 ? 'active' : ''\r\n                        }\r\n                        onClick={() => {\r\n                            dispatcher.backing.setLayerIndex(1);\r\n                        }}\r\n                    >\r\n                        <span>R-Layer</span>\r\n                    </button>\r\n                    <button\r\n                        className={\r\n                            paletteState.sideIndex == 0 ? 'active' : ''\r\n                        }\r\n                        onClick={() => {\r\n                            dispatcher.backing.setLayerIndex(0);\r\n                        }}\r\n                    >\r\n                        <span>L-Layer</span>\r\n                    </button>\r\n                </div>\r\n                <div className=\"matrix\">\r\n                    {channelJsxList}\r\n                </div>\r\n                <div className=\"pedal\">\r\n                    <button\r\n                        className={\r\n                            paletteState.isUsePedal ? 'active' : ''\r\n                        }\r\n                        onClick={() => {\r\n                            dispatcher.backing.setUsePedal(!paletteState.isUsePedal);\r\n                        }}\r\n                    >\r\n                        <span>Pedal</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <div className=\"main\">\r\n                <div className=\"split\">\r\n                    {lens}\r\n                </div>\r\n                <SplitMeasure\r\n                    paletteState={paletteState}\r\n                    layer={curLayer}\r\n                />\r\n                <NotesMatrix\r\n                    paletteState={paletteState}\r\n                    channelList={channelList}\r\n                    dispatcher={dispatcher}\r\n                />\r\n                <div className=\"volume\">\r\n                    {volumeList}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default BackingTable;","import styled from \"styled-components\";\r\n\r\n\r\nexport const _Record = styled.div<{\r\n    backgroundColor?: string,\r\n    textAlign?: string,\r\n    padding?: string,\r\n    margin?: string,\r\n}>`\r\n    display: inline-block;\r\n    background-color: ${(props) => props.backgroundColor};\r\n    width: 100%;\r\n    padding: ${(props) => props.padding};\r\n    margin: ${(props) => props.margin};\r\n    text-align: ${(props) => props.textAlign};\r\n    box-sizing: border-box;\r\n`;\r\n_Record.defaultProps = {\r\n    backgroundColor: 'inherit',\r\n    textAlign: 'inherit',\r\n    padding: '0',\r\n    margin: '0'\r\n}\r\n\r\nexport const _Hide = styled.div`\r\n    opacity: ${(props: { opacity: number }) => props.opacity}\r\n`;\r\n\r\nexport const _Text = styled.span<{\r\n    fontSize?: string,\r\n    color?: string,\r\n    fontWeight?: string\r\n}>`\r\n    font-size: ${(props)=> props.fontSize};\r\n    color: ${(props)=> props.color};\r\n    font-weight: ${(props)=> props.fontWeight};\r\n`;\r\n_Text.defaultProps = {\r\n    fontSize: 'inherit',\r\n    color: 'inherit',\r\n    fontWeight: 'inherit'\r\n}","import { SymbolParams } from \"contents/common/define\";\r\nimport { _Text } from \"contents/common/Styles\";\r\nimport { BackingEditorState } from \"contents/redux/store\";\r\n\r\nexport const StructMatrix = (props: {\r\n    paletteState: BackingEditorState;\r\n    structs: string[];\r\n    symbol: SymbolParams;\r\n    degreeIndex: number;\r\n    testPlaySound: Function;\r\n    setUseChannels: Function\r\n}) => {\r\n    if(!props.paletteState.isDispVoicing) {\r\n        return <></>;\r\n    }\r\n    const useChannels = props.paletteState.useChannels;\r\n\r\n    const structTable: JSX.Element[] = [];\r\n    const ChordStructMax = 7;\r\n    const OctaveMax = 8;\r\n    \r\n    // 音程の降順にソート\r\n    useChannels.sort((a, b) => {\r\n        return (a.octave * 12 + a.structIndex) - (b.octave * 12 + b.structIndex);\r\n    });\r\n    const overVoicingList = useChannels.slice(props.paletteState.channelRowSize);\r\n    for (let i = 0; i < ChordStructMax; i++) {\r\n        // for (let i = ChordStructMax - 1; i >= 0; i--) {\r\n        const isUse = i < props.structs.length;\r\n        const cols: JSX.Element[] = [];\r\n        if (isUse) {\r\n            const soundName = props.structs[i];\r\n            const hasDom = props.structs.length - props.symbol.intervals.length == 1;\r\n            const index = hasDom ? i - 1 : i;\r\n            const interval = index == -1 ? -1 : props.symbol.intervals[index];\r\n            const relation = index == -1 ? 'dom' : props.symbol.struct[index];\r\n            // 左の固定列\r\n            cols.push(\r\n                <div key={0} className=\"label\">\r\n                    <span>{relation}[{interval}]: <_Text color=\"#000\">{soundName}</_Text></span>\r\n                </div>\r\n            );\r\n            // 中のマトリクス\r\n            for (let j = 0; j < OctaveMax; j++) {\r\n                // for (let j = OctaveMax - 1; j >= 0; j--) {\r\n                const soundIndex = props.degreeIndex + interval + j * 12;\r\n                const octave = Math.floor(soundIndex / 12);\r\n                const soundFullName = soundName + octave;\r\n                const isNone = soundIndex < 9 || soundIndex >= 97;\r\n                let isSelected = false;\r\n                useChannels.forEach((channel) => {\r\n                    if (channel.octave == j && channel.structIndex == i) {\r\n                        isSelected = true;\r\n                    }\r\n                });\r\n                // チャンネルが最大数に達している場合、それ以上増やせない\r\n                // const isLimit = props.paletteState.useChannels.length >= props.paletteState.channelRowSize && !isSelected;\r\n                const isLimit = useChannels.length >= 12 && !isSelected;\r\n\r\n                // if(isSelected) {\r\n                //     useChannels.forEach((channel, k) =>{\r\n                //         if (channel.octave == j && channel.structIndex == i) {\r\n\r\n                //         }\r\n                //     });\r\n                // }\r\n                let isOverVoicing = false;\r\n                overVoicingList.forEach((channel) => {\r\n                    if (channel.octave == j && channel.structIndex == i) {\r\n                        isOverVoicing = true;\r\n                    }\r\n                });\r\n\r\n                cols.push(\r\n                    <div\r\n                        key={j + 1}\r\n                        className={[\r\n                            'col',\r\n                            (isNone || isLimit ? 'disable' : ''),\r\n                            (isSelected ? 'active' : ''),\r\n                            (isOverVoicing ? 'over' : '')\r\n                        ].join(' ')}\r\n                        onClick={() => {\r\n                            const list = props.paletteState.useChannels;\r\n                            if (!isSelected) {\r\n                                list.push({ octave: j, structIndex: i });\r\n                            } else {\r\n                                let pos = -1;\r\n                                list.forEach((channel, index) => {\r\n                                    if (channel.octave == j && channel.structIndex == i) {\r\n                                        pos = index;\r\n                                    }\r\n                                });\r\n                                list.splice(pos, 1);\r\n                            }\r\n                            list.sort((a, b) => {\r\n                                const aVal = a.octave * 8 + a.structIndex;\r\n                                const bVal = b.octave * 8 + b.structIndex;\r\n                                return aVal - bVal;;\r\n                            });\r\n                            props.paletteState.useChannels = list;\r\n                            props.setUseChannels(props.paletteState.useChannels);\r\n                        }}\r\n                        onContextMenu={() => {\r\n                            props.testPlaySound(soundFullName);\r\n                        }}\r\n                    >\r\n                        <span>{!isNone ? soundFullName : '-'}</span>\r\n                    </div>\r\n                );\r\n            }\r\n        } else {\r\n            // 空の要素を入れる\r\n            cols.push(\r\n                <div key={0} className=\"label\"></div>\r\n            );\r\n            for (let j = 0; j < OctaveMax; j++) {\r\n                cols.push(\r\n                    <div key={j + 1} className=\"col\"></div>\r\n                );\r\n            }\r\n        }\r\n        structTable.push(\r\n            <div\r\n                key={i}\r\n                className={\r\n                    'record' +\r\n                    (!isUse ? ' disable' : '')\r\n                }\r\n            >\r\n                {cols}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"struct-table\">\r\n            {structTable}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default StructMatrix;","\r\nimport { KEY12_SHARP_LIST, SymbolParams, SYMBOL_PARAMS_LIST } from \"contents/common/define\";\r\nimport { applyOnChord, getChordRoot, getSymbolParams, getSymbolTypeName } from \"contents/common/utils\";\r\nimport { GlobalContext } from \"contents/MainFrame\";\r\nimport { ActionType } from \"contents/redux/reducer\";\r\nimport { DetailChord, FloatWndState, CHORD_MODE, BACKING_LEN_TYPE, BackingLen, BACKING_SIDE, BackingEditorState, BackingLayer, ChannelParam, Key12Info, EditMode } from \"contents/redux/store\";\r\nimport { createContext, useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport './BackingEditor.css';\r\nimport BackingTable, { ChannelBean } from \"./BackingTable\";\r\nimport StructMatrix from \"./StructMatrix\";\r\n\r\ntype BackingContextType = {\r\n    // isCorrect: boolean;\r\n    // setCorrect: (isCorrect: boolean) => void;\r\n    editorState: BackingEditorState;\r\n}\r\n\r\nexport const BackingContext = createContext({} as BackingContextType);\r\n\r\nconst BackingEditor = () => {\r\n\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    // const [isCorrect, setCorrect] = useState(true);\r\n\r\n    /** コンテキストメニューの要素オブジェクト */\r\n    const ref = useRef({} as HTMLDivElement);\r\n    useEffect(() => {\r\n        // dispatch(ActionType.GET_REFFER, { reffers: {...state.reffers, chordPalette: ref.current }});\r\n        dispatch(ActionType.GET_REFFER_BACKING_PALETTE, { reffer: ref.current });\r\n    }, []);\r\n\r\n    // useEffect(() => {\r\n    //     dispatcher.backing.setCorrect(isCorrect);\r\n    // }, [isCorrect]);\r\n    // if (state.noteState.focusIndex == -1 ||\r\n    //     state.noteData.dataList[state.noteState.focusIndex].type != TypeNoteElement.Chord) {\r\n    //     return (<></>);\r\n    // }\r\n    if (state.noteState.floatwndState != FloatWndState.BACKING_PALETTE) {\r\n        return (<></>);\r\n    }\r\n    const isPreview = state.noteState.editMode === EditMode.PREVIEW;\r\n    const paletteState = state.noteState.backingPaletteState as BackingEditorState;\r\n\r\n    // const foocusIndex = state.noteState.focusIndex;\r\n    // const detail = state.noteData.dataList[foocusIndex].detail as DetailChord;\r\n    // const cache = state.noteState.cacheList[foocusIndex];\r\n    // if(detail.symbolKey == null) return (<></>);\r\n    // let rootIndex = (detail.molecule as Key12Info).rootIndex;\r\n    // const symbol: SymbolParams = { ...(getSymbolParams(detail.symbolKey) as SymbolParams) };\r\n\r\n    const molecule = paletteState.molecule as Key12Info;\r\n    const denominator = paletteState.denominator;\r\n    const symbol: SymbolParams = { ...(getSymbolParams(paletteState.symbolKey) as SymbolParams) };\r\n    const sustain = paletteState.sustain;\r\n    const headAdjust = paletteState.headAdjust;\r\n    const tailAdjust = paletteState.tailAdjust;\r\n\r\n    const root = KEY12_SHARP_LIST[molecule.rootIndex];\r\n    let chordName = root + symbol.name;\r\n    const structs: string[] = [];\r\n    //オンコードの追加\r\n    if (denominator != null) {\r\n\r\n        // コードネームの修正\r\n        chordName += `/${getChordRoot(denominator, 0)}`;\r\n\r\n        // オンコードをシンボル情報に反映する\r\n        applyOnChord(symbol, molecule.rootIndex, denominator.rootIndex);\r\n    }\r\n    symbol.intervals.forEach((value) => {\r\n        // structs.push(KEY12_SHARP_LIST[(cache.init.keyIndex + rootIndex + value) % 12]);\r\n        structs.push(KEY12_SHARP_LIST[(molecule.rootIndex + value) % 12]);\r\n    });\r\n\r\n    const channelList = getChannelList(paletteState.useChannels, molecule.rootIndex, symbol, structs);\r\n\r\n    const testPlaySound = (soundFullName: string) => {\r\n        state.sampler.triggerAttack(soundFullName, '+0', 0.15);\r\n        setTimeout(() => {\r\n            state.sampler.triggerRelease(soundFullName);\r\n        }, 1000);\r\n    };\r\n\r\n    let operation: JSX.Element = <></>;\r\n    operation = (<>\r\n        <div className={[\r\n            isPreview ? 'disable' : ''\r\n        ].join(' ')}\r\n            onClick={() => {\r\n                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            }}>\r\n            <span>Cancel</span>\r\n        </div>\r\n        <div\r\n            className={[\r\n                !paletteState.isCorrect ? 'disable' : ''\r\n            ].join(' ')}\r\n            onClick={() => {\r\n                if (!isPreview) {\r\n                    dispatcher.backing.play(false);\r\n                } else {\r\n                    dispatcher.preview.stop();\r\n                }\r\n            }}>\r\n            <span>{!isPreview ? 'Play' : 'Stop'}</span>\r\n        </div>\r\n        <div\r\n            className={[\r\n                isPreview || !paletteState.isCorrect ? 'disable' : ''\r\n            ].join(' ')}\r\n            onClick={() => {\r\n                switch (paletteState.target) {\r\n                    case 'note': {\r\n                        dispatcher.backing.setCurBackingScript();\r\n                    }\r\n                        break;\r\n                    case 'thema-pattern': {\r\n                        dispatcher.thema.applyBackingPattern();\r\n                    }\r\n                        break;\r\n                    case 'thema-voicing': {\r\n                        dispatcher.thema.applyBackingVoicing();\r\n                    }\r\n                        break;\r\n                }\r\n            }}>\r\n            <span>Update</span>\r\n        </div>\r\n    </>);\r\n    return (\r\n        <BackingContext.Provider value={{\r\n            editorState: paletteState\r\n            // isCorrect: isCorrect,\r\n            // setCorrect: (isCorrect) => setCorrect(isCorrect)\r\n        }}>\r\n            <div\r\n                ref={ref}\r\n                // id=\"backing-palette\"\r\n                className={[\r\n                    'backing-palette',\r\n                    'floatwnd',\r\n                    state.noteState.floatwndState == FloatWndState.BACKING_PALETTE ? ' active' : ''\r\n                ].join(' ')}\r\n                // className={'floatwnd' + (state.noteState.floatwndState == FloatWndState.BACKING_PALETTE ? ' active' : '')}\r\n                // className=\"floatwnd\"\r\n                onClick={() => {\r\n                }}\r\n            >\r\n                <div className=\"base-info\">\r\n                    <div className={[\r\n                        'record',\r\n                        paletteState.isDispVoicing ? '' : 'hidden'\r\n                    ].join(' ')}>\r\n                        <div className=\"title\"><span>Chord:</span></div>\r\n                        <div className=\"value\"><span>{chordName}</span></div>\r\n                    </div>\r\n                    <div className={[\r\n                        'record',\r\n                        paletteState.isDispVoicing ? '' : 'hidden'\r\n                    ].join(' ')}>\r\n                        <div className=\"title\"><span>Category:</span></div>\r\n                        <div className=\"value\"><span>{getSymbolTypeName(symbol.category)}</span></div>\r\n                    </div>\r\n                    <div className={[\r\n                        'record',\r\n                        paletteState.isDispVoicing ? '' : 'hidden'\r\n                    ].join(' ')}>\r\n                        <div className=\"title\"><span>Struct:</span></div>\r\n                        <div className=\"value\"><span>{structs.join(', ')}</span></div>\r\n                    </div>\r\n                    <div className=\"record\">\r\n                        <div className=\"title\"><span>Sustain:</span></div>\r\n                        <div className=\"value\"><span>{sustain + headAdjust + tailAdjust}</span></div>\r\n                    </div>\r\n                </div>\r\n                <StructMatrix\r\n                    paletteState={paletteState}\r\n                    structs={structs}\r\n                    symbol={symbol}\r\n                    degreeIndex={molecule.rootIndex}\r\n                    testPlaySound={testPlaySound}\r\n                    setUseChannels={(useChannels: ChannelParam[]) => dispatcher.setUseChannels(useChannels)}\r\n                />\r\n                <BackingTable\r\n                    channelList={channelList}\r\n                    paletteState={paletteState}\r\n                    dispatcher={dispatcher}\r\n                    testPlaySound={testPlaySound}\r\n                />\r\n\r\n                <div className=\"operation\">\r\n                    {operation}\r\n                </div>\r\n            </div>\r\n        </BackingContext.Provider>\r\n    );\r\n}\r\n\r\nconst getChannelList = (useChannels: ChannelParam[], degreeIndex: number, symbol: SymbolParams, structs: string[]): ChannelBean[] => {\r\n\r\n    const channelList: ChannelBean[] = [];\r\n\r\n    const OctaveMax = 8;\r\n    for (let i = 0; i < symbol.intervals.length; i++) {\r\n        // for (let i = ChordStructMax - 1; i >= 0; i--) {\r\n        for (let j = 0; j < OctaveMax; j++) {\r\n            // for (let j = OctaveMax - 1; j >= 0; j--) {\r\n            const soundIndex = degreeIndex + symbol.intervals[i] + j * 12;\r\n            let isSelected = false;\r\n            useChannels.forEach((channel) => {\r\n                if (channel.octave == j && channel.structIndex == i) {\r\n                    isSelected = true;\r\n                }\r\n            });\r\n            const octave = Math.floor(soundIndex / 12);\r\n            const soundFullName = structs[i] + octave;\r\n            if (isSelected) {\r\n                channelList.push({ soundIndex, soundFullName });\r\n            }\r\n        }\r\n    }\r\n    // 音程の昇順にソート\r\n    channelList.sort((a, b) => {\r\n        return b.soundIndex - a.soundIndex;\r\n    });\r\n    return channelList;\r\n}\r\n\r\nexport default BackingEditor;","\r\nimport { getAdjustSusValue } from 'contents/common/utils';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { DetailChord, TypeNoteElement } from 'contents/redux/store';\r\nimport { useContext, useEffect, useRef, useState, VFC } from 'react';\r\nimport './FooterTiming.css';\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport styled from 'styled-components';\r\n\r\nconst MEM_WIDTH = 16;\r\nconst FIXED_BLANK = 100;\r\n\r\nconst StyleTest = styled.div`\r\n    font-size: 0;\r\n    display: inline-inline-block;\r\n`;\r\n\r\n\r\n\r\nconst FooterTiming: VFC = () => {\r\n\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n    const dataList = state.noteData.dataList;\r\n    const focusIndex = state.noteState.focusIndex;\r\n    const dataCount = state.noteData.dataList.length;\r\n\r\n    /** スクロールエリアのRef */\r\n    const scrollRef = useRef({} as HTMLDivElement);\r\n\r\n    const [blockJsxList, setBlockJsxList] = useState([] as JSX.Element[]);\r\n    const [measureJsxList, setMeasureJsxList] = useState([] as JSX.Element[]);\r\n    const [total, setTotal] = useState(0);\r\n\r\n    const chordDetail = dataList[focusIndex].type == TypeNoteElement.Chord ?\r\n        (dataList[focusIndex].detail as DetailChord) : null;\r\n    const sustain = chordDetail == null ? 0 : chordDetail.sustain;\r\n    const headAdjust = chordDetail == null ? 0 : chordDetail.headAdjust;\r\n    const tailAdjust = chordDetail == null ? 0 : chordDetail.tailAdjust;\r\n    useEffect(() => {\r\n        let total = 0;\r\n        const blockJsxList: JSX.Element[] = [];\r\n        const measureJsxList: JSX.Element[] = [];\r\n        const dataList = state.noteData.dataList;\r\n\r\n        dataList.forEach((data, i) => {\r\n\r\n            if (data.type == TypeNoteElement.Init) {\r\n                blockJsxList.push(\r\n                    <div\r\n                        key={blockJsxList.length}\r\n                        className={[\r\n                        ].join(' ')}\r\n                        style={{ width: `${FIXED_BLANK}px` }}\r\n                    />\r\n                )\r\n            }\r\n            if (data.type == TypeNoteElement.Chord) {\r\n                const detail = data.detail as DetailChord;\r\n                const len = detail.sustain + detail.headAdjust + detail.tailAdjust;\r\n                const width = len * MEM_WIDTH * 4;\r\n                const isCur = focusIndex == i;\r\n                const isNear = focusIndex == i - 1 || focusIndex == i + 1;\r\n                blockJsxList.push(\r\n                    <div\r\n                        key={blockJsxList.length}\r\n                        className={[\r\n                            isCur ? 'active' : '',\r\n                            isNear ? 'near' : '',\r\n                        ].join(' ')}\r\n                        style={{ width: `${width - 1}px` }}\r\n                    >\r\n                        <div className=\"sus\">\r\n                            <span>{detail.sustain}</span>\r\n                        </div>\r\n                        <div className=\"adjust\">\r\n                            <span className={getAdjustCls(detail.headAdjust)}>\r\n                                {getAdjustSusValue(detail.headAdjust)}\r\n                            </span>\r\n                            <span className={getAdjustCls(detail.tailAdjust)}>\r\n                                {getAdjustSusValue(detail.tailAdjust)}\r\n                            </span>\r\n                        </div>\r\n                    </div >\r\n                );\r\n                if (isCur) {\r\n                    scrollRef.current.scrollTo({ left: total * MEM_WIDTH - FIXED_BLANK, behavior: 'smooth' });\r\n                }\r\n                total += len * 4;\r\n            }\r\n        });\r\n\r\n        // measureJsxList.push(\r\n        //     <div key={measureJsxList.length} className=\"blank\" style={{ left: `${0}px` }} />\r\n        // )\r\n        for (let i = 0; i < total; i++) {\r\n            let name = '';\r\n            const isBar = i % 16 == 0;\r\n            /** 小節数 */\r\n            const barCount = 1 + (i / 16);\r\n            if (isBar) {\r\n                name = 'mem-bar';\r\n            } else {\r\n                switch (i % 4) {\r\n                    case 0: name = 'mem4'; break;\r\n                    case 2: name = 'mem8'; break;\r\n                    default: name = 'mem16'; break;\r\n                }\r\n            }\r\n            measureJsxList.push(\r\n                <div key={measureJsxList.length} className={name} style={{ left: `${FIXED_BLANK + i * MEM_WIDTH}px` }}>{\r\n                    i % 16 == 0 ?\r\n                        <div className=\"bar\" style={{ left: `${-14}px`, top: '24px' }}>{barCount}</div>\r\n                        :\r\n                        <></>\r\n                }</div>\r\n            );\r\n        }\r\n        // alert(measureJsxList.length);\r\n        setBlockJsxList(blockJsxList);\r\n        setMeasureJsxList(measureJsxList);\r\n        setTotal(total);\r\n    }, [dataCount, focusIndex, sustain, headAdjust, tailAdjust]);\r\n\r\n    if (chordDetail == null) {\r\n        return (<></>);\r\n    }\r\n\r\n    const totalWidth = FIXED_BLANK * 2 + total * MEM_WIDTH;\r\n    return (\r\n        <div id=\"footer-timing\" className=\"footer-child\">\r\n            <div className=\"scroll\" ref={scrollRef}>\r\n                <div className=\"blocks\" style={{ width: `${totalWidth}px` }}>\r\n                    {blockJsxList}\r\n                </div>\r\n                <div className=\"measure\" style={{ width: `${totalWidth}px` }}>\r\n                    {measureJsxList}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst getAdjustCls = (value: number): string => {\r\n    let ret = '';\r\n    if (value != 0) {\r\n        if (value > 0) ret = 'aug';\r\n        else ret = 'dim';\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport default FooterTiming;","\r\nimport { getAdjustSusValue } from 'contents/common/utils';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { DetailChord, TypeNoteElement } from 'contents/redux/store';\r\nimport { useContext, useEffect, useRef, useState, VFC } from 'react';\r\n// import './FooterEnsemble.css';\r\n\r\nconst FooterEnsemble: VFC = () => {\r\n\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [isPlay, setPlay] = useState<boolean>(false);\r\n    const [startPosition, setStartPosition] = useState<string>('0');\r\n\r\n    const dataList = state.noteData.dataList;\r\n    const focusIndex = state.noteState.focusIndex;\r\n    const dataCount = state.noteData.dataList.length;\r\n    const info = state.noteState.ensembleInfo;\r\n\r\n    useEffect(() => {\r\n        setPlay(!info.audio.paused);\r\n    }, [info.audio.paused]);\r\n\r\n    // useEffect(() => {\r\n    //     // setLoad(!isNaN(info.audio.duration));\r\n    //     alert(info.audio);\r\n    //     info.volume = 1;\r\n    //     dispatcher.score.setNoteState({\r\n    //         ...state.noteState, ensembleInfo: info\r\n    //     });\r\n    // }, [info.audio]);\r\n\r\n    // const [blockJsxList, setBlockJsxList] = useState([] as JSX.Element[]);\r\n\r\n    return (\r\n        <div id=\"footer-ensemble\" className=\"footer-child\">\r\n            <div className={[\r\n                'record data',\r\n                info.isLoad ? 'disable' : ''\r\n            ].join(' ')}>\r\n                <input type=\"text\" value={info.fileURL} onChange={(e) => {\r\n                    info.fileURL = e.target.value;\r\n                    dispatcher.score.setNoteState({\r\n                        ...state.noteState, ensembleInfo: info\r\n                    });\r\n                }} />\r\n                <input type=\"file\" onChange={(e) => {\r\n                    if (e.target.files != null && e.target.files[0] != null) {\r\n                        const objectURL = window.URL.createObjectURL(e.target.files[0]);\r\n                        info.fileURL = objectURL;\r\n                        dispatcher.score.setNoteState({\r\n                            ...state.noteState, ensembleInfo: info\r\n                        });\r\n                    }\r\n                }} />\r\n            </div>\r\n            <div className={[\r\n                'record adjust',\r\n                info.isLoad ? 'disable' : ''\r\n            ].join(' ')}>\r\n                <input type=\"text\" value={startPosition} onChange={(e) => {\r\n                    setStartPosition(e.target.value);\r\n                }} />\r\n                <input type=\"range\" min={1} max={100} value={info.volume} onChange={(e) => {\r\n                    info.volume = Number(e.target.value);\r\n                    dispatcher.score.setNoteState({\r\n                        ...state.noteState, ensembleInfo: info\r\n                    });\r\n                }} />\r\n                <button\r\n                    className={[\r\n                        isPlay ? 'disable' : ''\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        if(startPosition === '') return;\r\n                        try {\r\n                            info.startPosition = Number(startPosition);\r\n                            info.isLoad = true;\r\n                            const audio = new Audio();\r\n                            audio.onerror = () => {\r\n                                info.isLoad = false;\r\n                                dispatcher.score.setNoteState({\r\n                                    ...state.noteState, ensembleInfo: info\r\n                                });\r\n                            }\r\n                            audio.src = info.fileURL;\r\n                            audio.currentTime = info.startPosition * 0.001;\r\n                            audio.volume = info.volume * 0.01;\r\n                            info.audio = audio;\r\n                            dispatcher.score.setNoteState({\r\n                                ...state.noteState, ensembleInfo: info\r\n                            });\r\n                        } catch (e) {\r\n                            info.isLoad = false;\r\n                            dispatcher.score.setNoteState({\r\n                                ...state.noteState, ensembleInfo: info\r\n                            });\r\n                        }\r\n                    }}>Aplly</button>\r\n            </div>\r\n            <div className={[\r\n                'record',\r\n                !info.isLoad ? 'disable' : ''\r\n            ].join(' ')}>\r\n                <button\r\n                    className={[\r\n                        isPlay ? 'disable' : ''\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        info.audio = new Audio();\r\n                        info.isLoad = false;\r\n                        dispatcher.score.setNoteState({\r\n                            ...state.noteState, ensembleInfo: info\r\n                        });\r\n                    }}>Remove</button>\r\n                <button\r\n                    className={[\r\n                        isPlay ? 'disable' : ''\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        info.audio.play();\r\n                        setPlay(true);\r\n                    }}>Play</button>\r\n                <button\r\n                    className={[\r\n                        !isPlay ? 'disable' : ''\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        info.audio.pause();\r\n                        setPlay(false);\r\n                    }}>Stop</button>\r\n                <button\r\n                    className={[\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        info.audio.currentTime = info.startPosition * 0.001;\r\n                    }}>Reset</button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FooterEnsemble;","\r\nimport TabbedPane from 'contents/common/TabbedPane';\r\nimport FooterTiming from './timing/FooterTiming';\r\nimport './NoteFooter.css';\r\nimport FooterEnsemble from './ensemble/FooterEnsemble';\r\nimport { useContext, useEffect, useState } from 'react';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { TypeNoteElement } from 'contents/redux/store';\r\n\r\nconst NoteFooter = () => {\r\n\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n    const curType = state.noteData.dataList[state.noteState.focusIndex].type;\r\n\r\n    const [activeTabIndex, setActiveTabIndex] = useState<number>(0);\r\n\r\n    useEffect(()=>{\r\n        if(curType) {\r\n            setActiveTabIndex(curType !== TypeNoteElement.Init ? 0 : 2);\r\n        }\r\n    }, [state.noteState.focusIndex]);\r\n    return (\r\n        <div id=\"score-footer\">\r\n            <TabbedPane groupName=\"score-tabs\"\r\n                tabElements={[\r\n                    { name: 'Progress', disable: true, cont: <FooterTiming /> },\r\n                    { name: 'Target', disable: true, cont: <div></div> },\r\n                    { name: 'Ensemble', disable: true, cont: <FooterEnsemble /> }\r\n                ]}\r\n                activeNo={activeTabIndex}\r\n            // selectTabIndex={(index: number) => dispatch(ActionType.SELECT_SCORETAB, { index: index })}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default NoteFooter;","import { KEY12_MAJOR_SCALE_LIST, KEY12_MINOR_SCALE_LIST, RYTHM_LIST, SCALE_LIST } from \"contents/common/define\";\r\nimport { GlobalContext } from \"contents/MainFrame\";\r\nimport { ActionType } from \"contents/redux/reducer\";\r\nimport { CHORD_MODE, DetailInit, FloatWndState } from \"contents/redux/store\";\r\nimport { useContext, useEffect, useRef, useState } from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\nimport './InitEditor.css';\r\n\r\nconst InitEditor = () => {\r\n\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [tempo, setTempo] = useState(55);\r\n    const [rythm, setRythm] = useState('4/4');\r\n    const [keyIndex, setKey] = useState(0);\r\n    const [scale, setScale] = useState('major');\r\n\r\n    const ref = useRef({} as HTMLDivElement);\r\n    useEffect(() => {\r\n        // dispatch(ActionType.GET_REFFER, { reffers: {...state.reffers, chordPalette: ref.current }});\r\n        dispatch(ActionType.GET_REFFER_CHORD_PALETTE, { reffer: ref.current });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if(state.noteState.floatwndState === FloatWndState.INIT_PALETTE) {\r\n            const initBean = state.dinamicCache as DetailInit;\r\n            dispatcher.setDinamicCache(null);\r\n            setTempo(initBean.tempo);\r\n            setRythm(initBean.rythm);\r\n            setKey(initBean.keyIndex);\r\n            setScale(initBean.scale);\r\n        }\r\n    }, [state.noteState.floatwndState]);\r\n\r\n    // if (state.noteState.floatwndState != FloatWndState.INIT_PALETTE) {\r\n    //     return (<></>);\r\n    // }\r\n\r\n    let operation: JSX.Element = <></>;\r\n    operation = (<>\r\n        <div\r\n            onClick={() => {\r\n                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            }}>\r\n            <span>Cancel</span>\r\n        </div>\r\n        <div\r\n            onClick={() => {\r\n                dispatcher.init.setInitParam(tempo, rythm, keyIndex, scale);\r\n            }}>\r\n            <span>Enter</span>\r\n        </div>\r\n    </>);\r\n\r\n\r\n\r\n    const getItemSlider = (label: string, list: string[]): JSX.Element => {\r\n        return (\r\n            <div className=\"item\">\r\n                <div className=\"label\">\r\n                    <span>{label}</span>\r\n                </div>\r\n                <div className=\"value\">\r\n                    {/* <span>{tempo}</span> */}\r\n                    <input\r\n                        type=\"number\" value={tempo} min=\"30\" max=\"180\"\r\n                        onChange={(e) => {\r\n                            setTempo(Number(e.target.value));\r\n                        }}\r\n                    />\r\n                    <input\r\n                        type=\"range\" name=\"speed\" min=\"30\" max=\"180\" value={tempo}\r\n                        onChange={(e) => {\r\n                            setTempo(Number(e.target.value));\r\n                        }}\r\n                    />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n    const getItemSelector = (label: string, value: string, callback: (value: string) => void,\r\n        list: { value: string, display: string }[]): JSX.Element => {\r\n        const optionsJsx: JSX.Element[] = [];\r\n        list.forEach((data) => {\r\n            optionsJsx.push(\r\n                <option key={optionsJsx.length} value={data.value}>{data.display}</option>\r\n            );\r\n        });\r\n        return (\r\n            <div className=\"item\">\r\n                <div className=\"label\">\r\n                    <span>{label}</span>\r\n                </div>\r\n                <div className=\"value\">\r\n                    <select\r\n                        value={value}\r\n                        onChange={(e) => {\r\n                            callback(e.target.value);\r\n                        }}\r\n                    >\r\n                        {optionsJsx}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n    const isDirect = state.noteData.chordMode == CHORD_MODE.DIRECT;\r\n    return (\r\n        <div\r\n            id=\"init-editor\"\r\n            className={'floatwnd' + (state.noteState.floatwndState == FloatWndState.INIT_PALETTE ? ' active' : '')}\r\n            onClick={() => {\r\n            }}\r\n        >\r\n            <div className=\"items\">\r\n                {getItemSlider('Tempo', [])}\r\n                {getItemSelector('Beat', rythm, (value: string) => { setRythm(value) },\r\n                    RYTHM_LIST.map(item => { return { value: item, display: item } })\r\n                )}\r\n                {isDirect ? <></> :\r\n                    getItemSelector('Scale', scale, (value: string) => { setScale(value) },\r\n                        SCALE_LIST.map(item => { return { value: item, display: item } })\r\n                    )\r\n                }\r\n                {isDirect ? <></> :\r\n                    getItemSelector('Key', String(keyIndex), (value: string) => { setKey(Number(value)) },\r\n                        (scale == SCALE_LIST[0] ?\r\n                            // メジャースケールの時のリスト\r\n                            KEY12_MAJOR_SCALE_LIST.map((item, i) => { return { value: i.toString(), display: item } })\r\n                            :\r\n                            // マイナースケールの時のリスト\r\n                            KEY12_MINOR_SCALE_LIST.map((item, i) => { return { value: i.toString(), display: item } })\r\n                        )\r\n                    )\r\n                }\r\n            </div>\r\n            <div className=\"operation\">\r\n                {operation}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default InitEditor;","\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport { DetailSection, FloatWndState } from 'contents/redux/store';\r\nimport { useContext, useEffect, useRef, useState } from 'react';\r\nimport './SectionEditor.css';\r\n\r\nconst SectionEditor = () => {\r\n\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    const ref = useRef({} as HTMLDivElement);\r\n    useEffect(() => {\r\n        // dispatch(ActionType.GET_REFFER, { reffers: {...state.reffers, chordPalette: ref.current }});\r\n        dispatch(ActionType.GET_REFFER_SECTION_PALETTE, { reffer: ref.current });\r\n    }, []);\r\n    const [labelName, setLabelName] = useState('Section');\r\n\r\n    useEffect(() => {\r\n        if(state.noteState.floatwndState === FloatWndState.SECTION_PALETTE) {\r\n            const sectionBean = state.dinamicCache as DetailSection;\r\n            setLabelName(sectionBean.labelName);\r\n        }\r\n    }, [state.noteState.floatwndState]);\r\n\r\n    // if (state.noteState.floatwndState != FloatWndState.SECTION_PALETTE) {\r\n    //     return (<></>);\r\n    // }\r\n\r\n    let operation: JSX.Element = <></>;\r\n    operation = (<>\r\n        <div\r\n            onClick={() => {\r\n                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            }}>\r\n            <span>Cancel</span>\r\n        </div>\r\n        <div\r\n            onClick={() => {\r\n                dispatcher.section.setSectionParam(labelName);\r\n            }}>\r\n            <span>Enter</span>\r\n        </div>\r\n    </>);\r\n\r\n    const getTextForm = (label: string, value: string, callback: (value: string) => void): JSX.Element => {\r\n        return (\r\n            <div className=\"item\">\r\n                <div className=\"label\">\r\n                    <span>{label}</span>\r\n                </div>\r\n                <div className=\"value\">\r\n                    <input\r\n                        type=\"text\"\r\n                        value={value}\r\n                        onChange={(e) => {\r\n                            callback(e.target.value);\r\n                        }}\r\n                    />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n\r\n        <div\r\n            id=\"section-editor\"\r\n            className={'floatwnd' + (state.noteState.floatwndState == FloatWndState.SECTION_PALETTE ? ' active' : '')}\r\n            onClick={() => {\r\n            }}\r\n        >\r\n            <div className=\"items\">\r\n                {getTextForm('Name', labelName, (value: string) => { setLabelName(value) })}\r\n            </div>\r\n            <div className=\"operation\">\r\n                {operation}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SectionEditor;","import { GlobalContext } from 'contents/MainFrame';\r\nimport { FloatWndState } from 'contents/redux/store';\r\nimport { useContext } from 'react';\r\nimport './SettingEditor.css';\r\n\r\nconst SettingEditor = () => {\r\n\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n\r\n    if (state.noteState.floatwndState != FloatWndState.SETTING_EDITOR) {\r\n        return (<></>);\r\n    }\r\n    const defsus = state.noteState.defaultSustain;\r\n    const sustainJsxList: JSX.Element[] = [];\r\n    for (let i = 0; i < 8; i++) {\r\n        sustainJsxList.push(\r\n            <div\r\n                key={sustainJsxList.length}\r\n                className={[\r\n                    i + 1 <= defsus ? 'active' : ''\r\n                ].join(' ')}\r\n                onClick={()=>{\r\n                    dispatcher.score.setNoteState({...state.noteState, defaultSustain: i + 1});\r\n                }}\r\n            />\r\n        );\r\n    }\r\n    return (\r\n        <div id=\"setting-editor\"\r\n            className=\"floatwnd active\">\r\n            <div className=\"sustain\">{sustainJsxList}</div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SettingEditor;\r\n","\r\nimport { RYTHM_LIST, TimeSignatures } from 'contents/common/define';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport { ChangeType, CHORD_MODE, DetailChange, FloatWndState, ModulateRelation, TempoRelation } from 'contents/redux/store';\r\nimport { useContext, useEffect, useRef, useState } from 'react';\r\nimport './ChangeEditor.css';\r\n\r\nconst ChangeEditor = () => {\r\n\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n\r\n    const ref = useRef({} as HTMLDivElement);\r\n    useEffect(() => {\r\n        // dispatch(ActionType.GET_REFFER, { reffers: {...state.reffers, chordPalette: ref.current }});\r\n        // dispatch(ActionType.GET_REFFER_SECTION_PALETTE, { reffer: ref.current });\r\n    }, []);\r\n\r\n    const [changeType, setChangeType] = useState<string>('');\r\n    const [modulateRelation, setModulateRelation] = useState<string>('');\r\n    const [domminantValue, setDomminantValue] = useState<'' | number>('');\r\n    const [keyAdjust, setKeyAdjust] = useState<'' | number>('');\r\n    const [tempoRelation, setTempoRelation] = useState<string>('');\r\n    const [tempoRate, setTempoRate] = useState<'' | number>('');\r\n    const [tempoDiff, setTempoDiff] = useState<'' | number>('');\r\n    const [tempoAbsolute, setTempoAbsolute] = useState<'' | number>('');\r\n    const [beat, setBeat] = useState<string>('');\r\n\r\n    const [isInputOK, setInputOK] = useState<boolean>(false);\r\n\r\n    const chordMode = state.noteData.chordMode;\r\n\r\n    const checkInput = () => {\r\n        setInputOK(false);\r\n        switch (changeType) {\r\n            case ChangeType.MODULATE: {\r\n                switch (modulateRelation) {\r\n                    case ModulateRelation.DOMINANT: {\r\n                        if (domminantValue !== '') setInputOK(true);\r\n                    }\r\n                        break;\r\n                    case ModulateRelation.KEY: {\r\n                        if (keyAdjust !== '') setInputOK(true);\r\n                    }\r\n                        break;\r\n                    case ModulateRelation.RELATIVE: {\r\n                        setInputOK(true);\r\n                    }\r\n                        break;\r\n                    case ModulateRelation.PARALLEL: {\r\n                        setInputOK(true);\r\n                    }\r\n                        break;\r\n                }\r\n            }\r\n                break;\r\n            case ChangeType.TEMPO: {\r\n                switch (tempoRelation) {\r\n                    case TempoRelation.DIFF: {\r\n                        if (tempoDiff !== '') setInputOK(true);\r\n                    }\r\n                        break;\r\n                    case TempoRelation.RATE: {\r\n                        if (tempoRate !== '') setInputOK(true);\r\n                    }\r\n                        break;\r\n                    case TempoRelation.ABSOLUTE: {\r\n                        if (tempoAbsolute !== '') setInputOK(true);\r\n                    }\r\n                        break;\r\n                }\r\n            }\r\n                break;\r\n            case ChangeType.BEAT: {\r\n                if (beat !== '') setInputOK(true);\r\n            }\r\n                break;\r\n        }\r\n    }\r\n    useEffect(() => {\r\n        if (state.noteState.floatwndState === FloatWndState.CHANGE_PALETTE) {\r\n            const bean = state.dinamicCache as DetailChange;\r\n            setChangeType(bean.changeType == null ? '' : bean.changeType);\r\n            setModulateRelation(bean.modulateRelation == null ? '' : bean.modulateRelation);\r\n            setDomminantValue(bean.domminantValue);\r\n            setKeyAdjust(bean.keyAdjust);\r\n            setTempoRelation(bean.tempoRelation == null ? '' : bean.tempoRelation?.toString());\r\n            setTempoRate(bean.tempoRate);\r\n            setTempoDiff(bean.tempoDiff);\r\n            setTempoAbsolute(bean.tempoAbsolute);\r\n            setBeat(bean.beat == null ? '' : bean.beat);\r\n        }\r\n    }, [state.noteState.floatwndState]);\r\n\r\n    useEffect(() => {\r\n        checkInput();\r\n    }, [changeType, modulateRelation, domminantValue, keyAdjust,\r\n        tempoRelation, tempoDiff, tempoRate, tempoAbsolute, beat\r\n    ]);\r\n\r\n\r\n    // if (state.noteState.floatwndState != FloatWndState.CHANGE_PALETTE) {\r\n    //     return (<></>);\r\n    // }\r\n    const directModeFilter = (type: ChangeType) => !(chordMode === CHORD_MODE.DIRECT && type === ChangeType.MODULATE);\r\n    let itemsJsxList: JSX.Element[] = [];\r\n    itemsJsxList.push(\r\n        getItemSelectorJsx(itemsJsxList.length, 'Change Type', changeType,\r\n            (value: string) => {\r\n                setChangeType(value);\r\n                if (value !== ChangeType.MODULATE) {\r\n                    setModulateRelation('');\r\n                    setDomminantValue('');\r\n                    setKeyAdjust('');\r\n                }\r\n                if (value !== ChangeType.TEMPO) {\r\n                    setTempoRelation('');\r\n                    setTempoRate('');\r\n                    setTempoDiff('');\r\n                    setTempoAbsolute('');\r\n                }\r\n                if (value !== ChangeType.BEAT) {\r\n                    setBeat('');\r\n                }\r\n            },\r\n            // 先頭に空白を挿入\r\n            [{ value: '', display: '' }].concat(\r\n                Object.values(ChangeType).filter(directModeFilter).map((item) => {\r\n                    return { value: item.toString(), display: item.toString() };\r\n                })\r\n            ),\r\n            false\r\n        )\r\n    );\r\n\r\n    // スケールモード時のみ追加\r\n    if (chordMode === CHORD_MODE.SCALE) {\r\n        itemsJsxList.push(\r\n            getItemSelectorJsx(itemsJsxList.length, 'Modulate Relation', modulateRelation,\r\n                (value: string) => {\r\n                    setModulateRelation(value);\r\n\r\n                    if (value !== ModulateRelation.KEY) {\r\n                        setKeyAdjust('');\r\n                    }\r\n                    if (value !== ModulateRelation.DOMINANT) {\r\n                        setDomminantValue('');\r\n                    }\r\n                },\r\n                // 先頭に空白を挿入\r\n                [{ value: '', display: '' }].concat(\r\n                    Object.values(ModulateRelation).map((item) => {\r\n                        const str = item.toString();\r\n                        return { value: str, display: str };\r\n                    })\r\n                ),\r\n                changeType !== ChangeType.MODULATE.toString()\r\n            )\r\n        );\r\n        itemsJsxList.push(\r\n            getItemNumberRangeJsx(itemsJsxList.length, 'Domminant Value', domminantValue, -3, 3,\r\n                (value: string) => {\r\n                    setDomminantValue(value as '' | number);\r\n                },\r\n                modulateRelation !== ModulateRelation.DOMINANT.toString()\r\n            )\r\n        );\r\n        itemsJsxList.push(\r\n            getItemNumberRangeJsx(itemsJsxList.length, 'Key Adjust', keyAdjust, -3, 3,\r\n                (value: string) => {\r\n                    setKeyAdjust(value as '' | number);\r\n                },\r\n                modulateRelation !== ModulateRelation.KEY.toString()\r\n            )\r\n        );\r\n    }\r\n    itemsJsxList.push(\r\n        getItemSelectorJsx(itemsJsxList.length, 'Tempo Relation', tempoRelation,\r\n            (value: string) => {\r\n                setTempoRelation(value);\r\n\r\n                if (value !== TempoRelation.RATE) {\r\n                    setTempoRate('');\r\n                }\r\n                if (value !== TempoRelation.DIFF) {\r\n                    setTempoDiff('');\r\n                }\r\n                if (value !== TempoRelation.ABSOLUTE) {\r\n                    setTempoAbsolute('');\r\n                }\r\n            },\r\n            // 先頭に空白を挿入\r\n            [{ value: '', display: '' }].concat(\r\n                Object.values(TempoRelation).map((item) => {\r\n                    const str = item.toString();\r\n                    return { value: str, display: str };\r\n                })\r\n            ),\r\n            changeType !== ChangeType.TEMPO.toString()\r\n        )\r\n    );\r\n    itemsJsxList.push(\r\n        getItemNumberRangeJsx(itemsJsxList.length, 'Tempo Diff', tempoDiff, -150, 150,\r\n            (value: string) => {\r\n                setTempoDiff(value as '' | number);\r\n            },\r\n            tempoRelation !== TempoRelation.DIFF.toString()\r\n        )\r\n    );\r\n    itemsJsxList.push(\r\n        getItemNumberRangeJsx(itemsJsxList.length, 'Tempo Rate', tempoRate, 20, 200,\r\n            (value: string) => {\r\n                setTempoRate(value as '' | number);\r\n            },\r\n            tempoRelation !== TempoRelation.RATE.toString()\r\n        )\r\n    );\r\n    itemsJsxList.push(\r\n        getItemNumberRangeJsx(itemsJsxList.length, 'Tempo Absolute', tempoAbsolute, 30, 180,\r\n            (value: string) => {\r\n                setTempoAbsolute(value as '' | number);\r\n            },\r\n            tempoRelation !== TempoRelation.ABSOLUTE.toString()\r\n        )\r\n    );\r\n    itemsJsxList.push(\r\n        getItemSelectorJsx(itemsJsxList.length, 'Beat', beat,\r\n            (value: string) => {\r\n                setBeat(value);\r\n            },\r\n            // 先頭に空白を挿入\r\n            [{ value: '', display: '' }].concat(\r\n                Object.values(TimeSignatures).map((item) => {\r\n                    const key = item.toString();\r\n                    return { value: key, display: key };\r\n                })\r\n            ),\r\n            changeType !== ChangeType.BEAT.toString()\r\n        )\r\n    );\r\n\r\n    let operation: JSX.Element = <></>;\r\n    operation = (<>\r\n        <div\r\n            onClick={() => {\r\n                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            }}>\r\n            <span>Cancel</span>\r\n        </div>\r\n        <div\r\n            className={[\r\n                isInputOK ? '' : 'disable'\r\n            ].join('')}\r\n            onClick={() => {\r\n                dispatcher.change.applyChangeParams(\r\n                    changeType as ChangeType,\r\n                    modulateRelation === '' ? null : modulateRelation as ModulateRelation,\r\n                    domminantValue === '' ? 0 : domminantValue as number,\r\n                    keyAdjust === '' ? 0 : keyAdjust as number,\r\n                    tempoRelation === '' ? null : tempoRelation as TempoRelation,\r\n                    tempoDiff === '' ? 0 : tempoDiff as number,\r\n                    tempoRate === '' ? 0 : tempoRate as number,\r\n                    tempoAbsolute === '' ? 0 : tempoAbsolute as number,\r\n                    beat === '' ? null : beat as TimeSignatures\r\n                );\r\n            }}>\r\n            <span>Enter</span>\r\n        </div>\r\n    </>);\r\n\r\n\r\n    return (\r\n\r\n        <div\r\n            id=\"change-editor\"\r\n            className={[\r\n                'floatwnd',\r\n                state.noteState.floatwndState == FloatWndState.CHANGE_PALETTE ? ' active' : ''\r\n            ].join(' ')}\r\n            onClick={() => {\r\n            }}\r\n        >\r\n            <div className=\"items\">\r\n                {itemsJsxList}\r\n            </div>\r\n            <div className=\"operation\">\r\n                {operation}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst getItemSelectorJsx = (key: number, label: string, value: string,\r\n    callback: (value: string) => void,\r\n    list: { value: string, display: string }[], isDisable: boolean\r\n): JSX.Element => {\r\n    const optionsJsx: JSX.Element[] = [];\r\n    list.forEach((data) => {\r\n        optionsJsx.push(\r\n            <option key={optionsJsx.length} value={data.value}>{data.display}</option>\r\n        );\r\n    });\r\n    return (\r\n        <div\r\n            key={key}\r\n            className={[\r\n                'record',\r\n                isDisable ? 'disable' : ''\r\n            ].join(' ')}\r\n        >\r\n            <div className=\"label\">{label}</div>\r\n            <div className=\"value\">\r\n                <select\r\n                    className={\r\n                        !isDisable && value === '' ? 'error' : ''\r\n                    }\r\n                    value={value}\r\n                    onChange={(e) => {\r\n                        callback(e.target.value);\r\n                    }}\r\n                >\r\n                    {optionsJsx}\r\n                </select>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst getItemNumberRangeJsx = (key: number, label: string, value: '' | number,\r\n    min: number, max: number, callback: (value: string) => void, isDisable: boolean\r\n): JSX.Element => {\r\n    return (\r\n        <div\r\n            key={key}\r\n            className={[\r\n                'record',\r\n                isDisable ? 'disable' : ''\r\n            ].join(' ')}\r\n        >\r\n            <div className=\"label\">{label}</div>\r\n            <div className=\"value\">\r\n                <input type=\"number\"\r\n                    className={\r\n                        !isDisable && (value === '' || !(value >= min && value <= max)) ? 'error' : ''\r\n                    }\r\n                    value={value} min={min} max={max}\r\n                    onChange={(e) => {\r\n                        callback(e.target.value);\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChangeEditor;","\r\nimport Soundfont from 'soundfont-player';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport { DetailChord, FloatWndState } from 'contents/redux/store';\r\nimport { useContext, useEffect, useRef, useState } from 'react';\r\nimport styled from 'styled-components';\r\nimport './ThemaLoader.css';\r\n\r\ninterface PatternBean {\r\n    name: string;\r\n\r\n}\r\n\r\nconst ThemaLoader = () => {\r\n\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [patterns, setPatterns] = useState<PatternBean[]>([]);\r\n\r\n    // const ref = useRef({} as HTMLDivElement);\r\n    // useEffect(() => {\r\n    //     dispatch(ActionType.GET_REFFER_SECTION_PALETTE, { reffer: ref.current });\r\n    // }, []);\r\n\r\n    useEffect(() => {\r\n        const patterns: PatternBean[] = [];\r\n\r\n        if (state.noteState.floatwndState === FloatWndState.THEMA_ACCESSOR) {\r\n            const bean = state.dinamicCache as DetailChord;\r\n\r\n            for (let sus of state.themaDataTree.sustains) {\r\n                const isSustainMatch = sus.beat === bean.sustain && sus.headAdjust === bean.headAdjust && sus.tailAdjust === bean.tailAdjust;\r\n                if (isSustainMatch) {\r\n\r\n                    sus.patterns.forEach((pattern) => {\r\n                        patterns.push({\r\n                            name: pattern.name,\r\n                        });\r\n                    });\r\n                    break;\r\n                }\r\n            }\r\n            setPatterns(patterns);\r\n            Soundfont.instrument(new AudioContext(), 'violin', {gain: 4, release: 0.5}).then((instrument) => {\r\n                dispatcher.setInstruments(instrument);\r\n            });\r\n        }\r\n    }, [state.noteState.floatwndState]);\r\n\r\n    const instrument = state.instrument as Soundfont.Player;\r\n\r\n    let operation: JSX.Element = <></>;\r\n    operation = (<>\r\n        <div\r\n            onClick={() => {\r\n                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                instrument.stop();\r\n            }}>\r\n            <span>Cancel</span>\r\n        </div>\r\n        <div\r\n            onClick={() => {\r\n                // instrument.play('C4', 0).stop(5);\r\n                \r\n                // instrument.start('C4', 2);\r\n                // const nodes: AudioNode[] = [];\r\n                // instrument.stop(1000);\r\n                instrument.schedule(0, [\r\n                    { time: 0, note: 60, duration: 2 },\r\n                    { time: 2.5, note: 63, duration: 2 },\r\n                ]);\r\n\r\n            }}>\r\n            <span>Enter</span>\r\n        </div>\r\n    </>);\r\n\r\n    const itemJsxList: JSX.Element[] = [];\r\n    patterns.forEach((pattern, i) => {\r\n        itemJsxList.push(\r\n            <_Item key={i}>{pattern.name}</_Item>\r\n        );\r\n    });\r\n    return (\r\n\r\n        <div\r\n            id=\"thema-accessor\"\r\n            className={'floatwnd' + (state.noteState.floatwndState == FloatWndState.THEMA_ACCESSOR ? ' active' : '')}\r\n            onClick={() => {\r\n            }}\r\n        >\r\n            <_Wrap>\r\n                <_WrapList>\r\n                    {itemJsxList}\r\n                </_WrapList>\r\n                <_WrapMatrix>\r\n\r\n                </_WrapMatrix>\r\n            </_Wrap>\r\n            <div className=\"operation\">\r\n                {operation}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ThemaLoader;\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    height: 250px;\r\n`;\r\n\r\nconst _WrapList = styled.div`\r\n    display: inline-block;\r\n    width: 280px;\r\n    height: 100%;\r\n    background-color: #000000;\r\n    vertical-align: top;\r\n    overflow-y: auto;\r\n`;\r\nconst _Item = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    background-color: #272727;\r\n    overflow-x: hidden;\r\n    border: solid 1px #b4b4b4;\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    color: #ffffff;\r\n    line-height: 25px;\r\n    padding-left: 10px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _WrapMatrix = styled.div`\r\n    display: inline-block;\r\n    width: 280px;\r\n    height: 100%;\r\n    background-color: #868686;\r\n    vertical-align: top;\r\n    overflow-y: auto;\r\n`;\r\n","import { GlobalContext } from 'contents/MainFrame';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport { useContext, useState } from 'react';\r\nimport './SourceDialog.css';\r\n\r\nconst SourceDialog = (props: { target: 'score' | 'backing' }) => {\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [source, setSource] = useState<string>(JSON.stringify(state.noteData));\r\n    return (\r\n\r\n        <div className=\"source-dialog\">\r\n            <textarea value={source} onChange={(e) => {\r\n                setSource(e.target.value);\r\n            }}></textarea>\r\n            <button\r\n                onClick={() => {\r\n                    dispatcher.closeDialog();\r\n                }}\r\n            >\r\n                Cancel\r\n            </button>\r\n            <button\r\n                onClick={() => {\r\n                    switch(props.target) {\r\n                        case 'score': {\r\n                            dispatcher.score.setNoteData(JSON.parse(source));\r\n                        }\r\n                        break;\r\n                        case 'backing': {\r\n                            dispatcher.score.setNoteData(JSON.parse(source));\r\n                        }\r\n                        break;\r\n                    }\r\n                    dispatcher.closeDialog();\r\n                }}\r\n            >\r\n                Aplly\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SourceDialog;","\r\nimport { GlobalContext } from \"contents/MainFrame\";\r\nimport { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\nconst ConfirmDialog = (props: {\r\n    message: string,\r\n    callback: () => void\r\n}) => {\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    return (\r\n\r\n        <_MainFrame>\r\n            <_Message>{props.message}</_Message>\r\n            <_Button\r\n                onClick={() => {\r\n                    dispatcher.closeDialog();\r\n                }}\r\n            >\r\n                No\r\n            </_Button>\r\n            <_Button\r\n                onClick={() => {\r\n                    props.callback();\r\n                }}\r\n            >\r\n                Yes\r\n            </_Button>\r\n        </_MainFrame>\r\n    );\r\n}\r\n\r\nexport default ConfirmDialog;\r\n\r\nconst _MainFrame = styled.div`\r\n    display: inline-block;\r\n    width: 250px;\r\n    height: 100px;\r\n    background-color: rgba(0, 0, 0, 0.842);\r\n    border: solid 2px white;\r\n`;\r\n\r\nconst _Message = styled.div`\r\n    display:  inline-block;\r\n    width: 100%;\r\n    height: 50px;\r\n    padding: 5px;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    /* line-height: -10px; */\r\n    color: rgba(255, 255, 255, 0.856);\r\n    text-align: left;\r\n`;\r\n\r\nconst _Button = styled.div`\r\n    display:  inline-block;\r\n    width: 70px;\r\n    height: 28px;\r\n    margin: 4px 0 0 4px;\r\n    background-color: rgb(180, 180, 180);\r\n    border: solid 1px rgb(85, 85, 85);\r\n    border-radius: 3px;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    line-height: 25px;\r\n    color: rgba(0, 0, 0, 0.685);\r\n    text-align: center;\r\n\r\n    &:hover {\r\n        background-color: rgb(139, 139, 139);\r\n    }\r\n`;","import './ScoreContNoteTab.css';\r\n\r\n// import TabbedPane from './common/TabbedPane.jsx';\r\nimport { ScoreCache, DetailChord, DetailInit, DetailSection, EditMode, FloatWndState, Store, TypeNoteElement, ScoreProgress, DetailChange, ChangeType, ModulateRelation, TempoRelation } from 'contents/redux/store';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport React, { useContext, KeyboardEvent, useEffect, useState, useRef } from 'react';\r\n\r\nimport ScoreElement, { } from './element/ScoreElement';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport OutlineSection from './OutlineSection';\r\nimport NoteContextMenu from './floatwnd/context/NoteContextMenu';\r\nimport ChordSelector from './floatwnd/chord/ChordSelector';\r\nimport CurrentBlockDetailBar from './sideDetail/CurrentBlockDetailBar';\r\nimport BackingEditor from './floatwnd/backing/BackingEditor';\r\nimport NoteFooter from './footer/NoteFooter';\r\nimport styled from 'styled-components';\r\nimport InitEditor from './floatwnd/init/InitEditor';\r\nimport SectionEditor from './floatwnd/section/SectionEditor';\r\nimport SettingEditor from './floatwnd/setting/SettingEditor';\r\nimport ChangeEditor from './floatwnd/change/ChangeEditor';\r\nimport ThemaLoader from './floatwnd/thema/ThemaLoader';\r\nimport SourceDialog from 'contents/systab/dialog/SourceDialog';\r\nimport { sendQueryRequestToAPI } from 'contents/common/utils';\r\nimport ConfirmDialog from 'contents/systab/dialog/ConfirmDialog';\r\n\r\nconst ScoreContNoteTab = () => {\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    /** 譜面の要素リスト */\r\n    const [elementList, setElementList] = useState([] as JSX.Element[]);\r\n    /** 画面上部のセクションリスト */\r\n    const [sectionList, setSectionList] = useState([] as JSX.Element[]);\r\n\r\n    useEffect(() => {\r\n        // alert(state.noteData.dataList.length);\r\n        const dataList = state.noteData.dataList;\r\n        // const isNormalMode = editMode == EditMode.NORMAL;\r\n        let index = 0;\r\n        const elementList: JSX.Element[] = [];\r\n        const sectionList: JSX.Element[] = [];\r\n\r\n        // const cacheList: ScoreCache[] = [];\r\n\r\n        const cacheList = state.noteState.cacheList;\r\n        // const cache = {} as ScoreCache;\r\n        const cache = {} as ScoreCache;\r\n\r\n        let no = 1;\r\n        let totalBeat = 0;\r\n        let totalMsec = 0;\r\n        let lastBar = -1;\r\n        dataList.forEach((data, i) => {\r\n\r\n            if (data.type == TypeNoteElement.Init) {\r\n                const init = data.detail as DetailInit;\r\n                cache.init = { ...init };\r\n            }\r\n\r\n            const bar = Math.floor(totalBeat / 4) + 1;\r\n            const progress = {} as ScoreProgress;\r\n            progress.no = no;\r\n            progress.barCount = lastBar != bar ? bar : -1;\r\n            progress.remaindBeat = totalBeat % 4 > 0 ? totalBeat % 4 : -1;\r\n            progress.headMSec = totalMsec;\r\n            elementList.push(\r\n                <ScoreElement\r\n                    key={i}\r\n                    index={i}\r\n                    noteElement={data}\r\n                />\r\n            );\r\n            if (data.type == TypeNoteElement.Chord) {\r\n                lastBar = bar;\r\n                const detail = data.detail as DetailChord;\r\n\r\n                const tempo = cache.init.tempo;\r\n                const sustain = detail.sustain + detail.headAdjust + detail.tailAdjust;\r\n                totalBeat += sustain;\r\n                const sectionMSec = 60000 / tempo * 4;\r\n                totalMsec += sectionMSec / 4 * sustain;\r\n                no++;\r\n            } else if (data.type == TypeNoteElement.Change) {\r\n                const detail = data.detail as DetailChange;\r\n                switch (detail.changeType) {\r\n                    case ChangeType.MODULATE: {\r\n                        let newKeyIndex = cache.init.keyIndex;\r\n                        let newIsMinor = cache.init.scale == 'minor';\r\n                        switch (detail.modulateRelation) {\r\n                            case ModulateRelation.DOMINANT: {\r\n                                newKeyIndex = (24 + newKeyIndex + detail.domminantValue * 7) % 12;\r\n                            }\r\n                                break;\r\n                            case ModulateRelation.KEY: {\r\n                                const keyAdjust = Number(detail.keyAdjust);\r\n                                newKeyIndex = (12 + newKeyIndex + keyAdjust) % 12;\r\n                            }\r\n                                break;\r\n                            case ModulateRelation.RELATIVE: {\r\n                                if (!newIsMinor) {\r\n                                    newKeyIndex = (12 + newKeyIndex - 3) % 12;\r\n                                } else {\r\n                                    newKeyIndex = (12 + newKeyIndex + 3) % 12;\r\n                                }\r\n                                newIsMinor = !newIsMinor;\r\n                            }\r\n                                break;\r\n                            case ModulateRelation.PARALLEL: {\r\n                                newIsMinor = !newIsMinor;\r\n                            }\r\n                                break;\r\n                        }\r\n\r\n                        cache.init.keyIndex = newKeyIndex;\r\n                        cache.init.scale = newIsMinor ? 'minor' : 'major';\r\n                    }\r\n                        break;\r\n                    case ChangeType.TEMPO: {\r\n                        let newTempo: number = cache.init.tempo;\r\n                        switch (detail.tempoRelation) {\r\n                            case TempoRelation.DIFF: {\r\n                                newTempo += Number(detail.tempoDiff);\r\n                            }\r\n                                break;\r\n                            case TempoRelation.RATE: {\r\n                                newTempo = Math.floor(newTempo * detail.tempoRate / 100);\r\n                            }\r\n                                break;\r\n                            case TempoRelation.ABSOLUTE: {\r\n                                newTempo = detail.tempoAbsolute;\r\n                            }\r\n                                break;\r\n                        }\r\n                        cache.init.tempo = newTempo;\r\n                    }\r\n                        break;\r\n                }\r\n            }\r\n\r\n            cacheList[i] = { ...cacheList[i], init: { ...cache.init }, progress };\r\n\r\n            // セクションアウトラインの生成\r\n            if (data.type == TypeNoteElement.Section) {\r\n                sectionList.push(\r\n                    <OutlineSection key={i} index={index} label={(data.detail as DetailSection).labelName} />\r\n                );\r\n                index++;\r\n            }\r\n        });\r\n        setElementList(elementList);\r\n        setSectionList(sectionList);\r\n        dispatcher.score.setNoteState({ ...state.noteState, cacheList });\r\n\r\n    }, [state.noteData.dataList, state.noteData.dataList.length]);\r\n\r\n    const editMode = state.noteState.editMode;\r\n    const isModalBlind = !(state.noteState.floatwndState == FloatWndState.NONE || state.noteState.floatwndState == FloatWndState.CONTEXT_MENU);\r\n    return (\r\n        <div id=\"scorecont-notetab-root\">\r\n            <div className=\"left-cont\">\r\n                <div id=\"score-note\">\r\n                    <div\r\n                        id=\"operation-header\"\r\n                        className={[\r\n                            [EditMode.TRANSPLANT, EditMode.CLONE].includes(editMode) ? 'mode-selector' : '',\r\n                            [EditMode.PREVIEW].includes(editMode) ? 'mode-preview' : ''\r\n                        ].join(' ')}\r\n                    >\r\n                        {/* <button className=\"\" onClick={() => {\r\n                            dispatch(ActionType.SELECT_SCORETAB, { index: 0 });\r\n                        }}><span>BACK</span></button> */}\r\n                        <button className=\"\" onClick={() => {\r\n\r\n                            dispatcher.callDialog(50, 50, <ConfirmDialog message=\"Do you want to save it?\" callback={() => {\r\n                                (async () => {\r\n                                    const curScoreId = state.noteState.cuScoreId;\r\n                                    console.log('----start----');\r\n                                    const values: string[] = [];\r\n                                    state.noteData.dataList.forEach((data, i) => {\r\n                                        values.push(`(${curScoreId}, ${i}, '${JSON.stringify(data)}')`);\r\n                                    });\r\n                                    await sendQueryRequestToAPI('update', `delete from data_tbl where score = ${curScoreId}`);\r\n                                    await sendQueryRequestToAPI('update', `insert into data_tbl values${values.join(',')}`);\r\n                                    console.log('----end----');\r\n                                    alert('The data was saved successfully!');\r\n                                    dispatcher.closeDialog();\r\n                                })();\r\n                            }} />);\r\n                        }}><span>SAVE</span></button>\r\n                        <button className=\"\" onClick={() => {\r\n                            dispatcher.callDialog(50, 50, <SourceDialog target=\"score\" />);\r\n                        }}><span>SOURCE</span></button>\r\n                        <button className=\"\" onClick={() => {\r\n                            dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.SETTING_EDITOR })\r\n                        }}> <span>SETTING</span></button>\r\n                        <button className=\"disable\"><span>Help</span></button>\r\n                        <EditModeBorder />\r\n                    </div>\r\n                    <div\r\n                        id=\"section-list\"\r\n                        className={[\r\n                            [EditMode.TRANSPLANT, EditMode.CLONE].includes(editMode) ? 'mode-selector' : '',\r\n                            [EditMode.PREVIEW].includes(editMode) ? 'mode-preview' : ''\r\n                        ].join(' ')}\r\n                    >\r\n                        {sectionList}\r\n                    </div>\r\n                    <div\r\n                        id=\"score-list-root\"\r\n                        className={[\r\n                            [EditMode.TRANSPLANT, EditMode.CLONE].includes(editMode) ? 'mode-selector' : '',\r\n                            [EditMode.PREVIEW].includes(editMode) ? 'mode-preview' : ''\r\n                        ].join(' ')}\r\n                    >\r\n                        {elementList}\r\n                    </div>\r\n                    {/* モーダルブラインド */}\r\n                    <div id=\"modal-blind\"\r\n                        className={isModalBlind ? 'active' : ''}\r\n                        onClick={() => {\r\n                            if (state.noteState.editMode !== EditMode.PREVIEW) {\r\n                                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                            }\r\n                        }}\r\n                    />\r\n                    {/* コンテキストメニュー */}\r\n                    <InitEditor />\r\n                    <NoteContextMenu />\r\n                    <SectionEditor />\r\n                    <ChangeEditor />\r\n                    <ChordSelector />\r\n                    <BackingEditor />\r\n                    <SettingEditor />\r\n                    <ThemaLoader />\r\n                </div>\r\n                <NoteFooter />\r\n\r\n            </div>\r\n            <div className=\"right-cont\">\r\n                <CurrentBlockDetailBar />\r\n                {/* <div id=\"sidebar-param-selector\" className=\"hidden\" tabIndex=\"999\">\r\n                </div> */}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst EditModeBorder = () => {\r\n    const { state, dispatch } = useContext(GlobalContext);\r\n\r\n    const editMode = state.noteState.editMode;\r\n    // const isNormal = editMode == EditMode.NORMAL;\r\n    // const setEditMode = (editMode: EditMode) => {\r\n    //     dispatch(ActionType.SET_NOTE_STATE, { noteState: { ...state.noteState, editMode } });\r\n    // };\r\n    return (\r\n        <div className=\"mode\">\r\n            <div className=\"label\"><span>MODE:</span></div>\r\n            <div className=\"border\">\r\n                <button\r\n                    className={editMode == EditMode.NORMAL ? 'active' : ''}\r\n                // onClick={() => setEditMode(EditMode.NORMAL)}\r\n                >\r\n                    <span>NORMAL</span>\r\n                </button>\r\n                <button\r\n                    className={editMode == EditMode.TRANSPLANT ? 'active' : ''}\r\n                // onClick={() => setEditMode(EditMode.BACKING)}\r\n                >\r\n                    <span>TRANSPLANT</span>\r\n                </button>\r\n                <button\r\n                    className={editMode == EditMode.CLONE ? 'active' : ''}\r\n                // onClick={() => setEditMode(EditMode.BACKING)}\r\n                >\r\n                    <span>CLONE</span>\r\n                </button>\r\n                <button\r\n                    className={editMode == EditMode.PREVIEW ? 'active' : ''}\r\n                // onClick={() => setEditMode(EditMode.BACKING)}\r\n                >\r\n                    <span>PREVIEW</span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ScoreContNoteTab;\r\n\r\n","import './ScoreContLibraryTab.css';\r\n\r\n// import TabbedPane from './common/TabbedPane.jsx';\r\nimport { DetailSection, CHORD_MODE, Store, TypeNoteElement, EditMode, NoteData, NoteElement } from 'contents/redux/store';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport React, { useContext, KeyboardEvent, useEffect, useState } from 'react';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport { API_DOMAIN, HOSTING_URL_ROOT } from 'contents/common/define';\r\nimport { createQueryRequestInit, getDefaultNoteData, sendQueryRequestToAPI } from 'contents/common/utils';\r\nimport Soundfont from 'soundfont-player';\r\nimport { SclibEntity } from 'contents/common/Entity';\r\n\r\nconst ScoreContLiblaryTab = () => {\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [focus, setFocus] = useState<number>(-1);\r\n    const [message, setMessage] = useState<string>('');\r\n    const [recordList, setRecordList] = useState<SclibEntity[]>([]);\r\n    const [titleList, setTitleList] = useState<JSX.Element[]>([]);\r\n    const [isEdit, setEdit] = useState<boolean>(false);\r\n    const [title, setTitle] = useState<string>('');\r\n    const [chordMode, setChordMode] = useState<CHORD_MODE | ''>('');\r\n    const [isLoad, setLoad] = useState<boolean>(false);\r\n\r\n    useEffect(() => {\r\n        console.log('create ScoreContLiblaryTab');\r\n    }, []);\r\n\r\n    // 非同期で表示データを更新。\r\n    const reload = (initFocus: number) => {\r\n        // setFocus(initFocus);\r\n        setLoad(true);\r\n        setMessage('Now roading scores...');\r\n        sendQueryRequestToAPI('select', `SELECT s.*, (select count(*) from data_tbl where score = s.id) as data_cnt FROM sclibtbl s where user = ${state.login.id}`)\r\n            .then(response => {\r\n                return response.json();\r\n            })\r\n            .then(results => {\r\n                console.log(results);\r\n                console.log(`[${state.login.id}]score count: ` + results.length);\r\n                const isExist = results.length > 0;\r\n                if (isExist) {\r\n                    setRecordList(results);\r\n                    setMessage('');\r\n                } else {\r\n                    setMessage('There is no musical score you manage yet.');\r\n                }\r\n                setLoad(false);\r\n            })\r\n            .catch(error => {\r\n                console.log(error + \"失敗しました\");\r\n                setLoad(false);\r\n            });\r\n    }\r\n\r\n    useEffect(() => {\r\n        const list: JSX.Element[] = [];\r\n        recordList.forEach((record, i) => {\r\n            list.push(\r\n                <div\r\n                    key={i}\r\n                    className={[\r\n                        'record',\r\n                        focus == i ? 'focus' : ''\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        setFocus(i);\r\n                    }}\r\n                >\r\n                    <span>{record.id}:</span>\r\n                    <span className=\"title\">{record.title}</span>\r\n                    <span>[</span>\r\n                    <span className=\"mode\">{record.chord_mode}</span>\r\n                    <span>]</span>\r\n                </div>\r\n            );\r\n        });\r\n        setTitleList(list);\r\n    }, [recordList, focus]);\r\n\r\n    useEffect(() => {\r\n        if (!isEdit) {\r\n            reload(-1);\r\n        }\r\n\r\n    }, [isEdit]);\r\n\r\n    const createButton = (label: string, isDisable: boolean, callback: () => void, isActive: boolean = false): JSX.Element => {\r\n        return (\r\n            <button className={[\r\n                isDisable ? 'disable' : '',\r\n                isActive ? 'active' : ''\r\n            ].join(' ')}\r\n                onClick={callback}\r\n            >\r\n                <span>{label}</span>\r\n            </button>\r\n        );\r\n    }\r\n\r\n    const createInfoRecored = (label: string, innerJsx: JSX.Element): JSX.Element => {\r\n        return (\r\n            <div\r\n                className=\"info-record\"\r\n            >\r\n                <span>{label}</span>\r\n                <span>{': '}</span>\r\n                {innerJsx}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const isDisplayMsg = message != '';\r\n    const selectedRecord = recordList[focus];\r\n    return (\r\n        <div id=\"scorecont-listtab-root\">\r\n            <div className=\"left-cont\">\r\n                <div className=\"opr\">\r\n                    {createButton('Create', isEdit || isLoad, () => {\r\n                        setMessage('Create...');\r\n                        sendQueryRequestToAPI('update', `INSERT INTO sclibtbl(user, title, chord_mode) VALUES(${state.login.id}, 'new_title', '')`)\r\n                            .then((result) => {\r\n                                reload(recordList.length);\r\n                                return result;\r\n                            })\r\n                    })}\r\n                    {createButton('Update', focus == -1 || isLoad, () => {\r\n                        if (!isEdit) {\r\n                            setEdit(true);\r\n                            setTitle(selectedRecord.title);\r\n                            setChordMode(selectedRecord.chord_mode);\r\n                        }\r\n                    }, isEdit)}\r\n                    {createButton('Delete', focus == -1 || isEdit || isLoad, () => {\r\n                        (async () => {\r\n                            setMessage('Delete...');\r\n                            console.log('----start----');\r\n                            await sendQueryRequestToAPI('update', `delete from data_tbl where score = ${recordList[focus].id}`);\r\n                            await sendQueryRequestToAPI('update', `delete from sclibtbl where id = ${recordList[focus].id}`);\r\n                            reload(-1);\r\n                            setFocus(-1);\r\n                            console.log('----end----');\r\n                        })();\r\n                    })}\r\n                </div>\r\n                <div className={[\r\n                    'lib',\r\n                    isEdit ? 'disable' : ''\r\n                ].join(' ')}>\r\n                    <div className={[\r\n                        'message',\r\n                        !isDisplayMsg ? 'hidden' : ''\r\n                    ].join(' ')}>\r\n                        <span>{message}</span>\r\n                    </div>\r\n                    <div className={[\r\n                        'list',\r\n                        isDisplayMsg ? 'hidden' : ''\r\n                    ].join(' ')}>\r\n                        {titleList}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div className=\"right-cont\">\r\n                <div className=\"opr\">\r\n                    {createButton('Cancel', !isEdit || isLoad, () => {\r\n                        dispatcher.score.setNoteData({ ...state.noteData, dataList: [] });\r\n                        setEdit(false);\r\n                        dispatcher.setInstruments(null);\r\n                    })}\r\n                    {createButton('Save', !isEdit || chordMode === '' || isLoad, () => {\r\n                        setLoad(true);\r\n                        (async () => {\r\n                            console.log('----start----');\r\n                            const values: string[] = [];\r\n                            await sendQueryRequestToAPI('update', `\r\n                                update sclibtbl set\r\n                                title = '${title}',\r\n                                chord_mode = '${chordMode}',\r\n                                soundfont = '${state.noteData.soundFont.name}',\r\n                                gain = ${state.noteData.soundFont.gain},\r\n                                tune = '${JSON.stringify(state.noteData.columnList)}'\r\n                                where id = ${selectedRecord.id}\r\n                            `);\r\n                            if (state.noteData.dataList.length > 0) {\r\n                                state.noteData.dataList.forEach((data, i) => {\r\n                                    values.push(`(${selectedRecord.id}, ${i}, '${JSON.stringify(data)}')`);\r\n                                });\r\n                                await sendQueryRequestToAPI('update', `delete from data_tbl where score = ${selectedRecord.id}`);\r\n                                await sendQueryRequestToAPI('update', `insert into data_tbl values${values.join(',')}`);\r\n                            }\r\n                            console.log('----end----');\r\n                            alert('The data was saved successfully!');\r\n                            // setEdit(false);\r\n                            setLoad(false);\r\n                        })();\r\n                    })}\r\n                    {createButton('Edit', !isEdit || chordMode === '' || isLoad, () => {\r\n                        setLoad(true);\r\n                        (\r\n                            async () => {\r\n                                const noteData = state.noteData;\r\n                                noteData.chordMode = chordMode as CHORD_MODE;\r\n                                if (selectedRecord.data_cnt == 0) {\r\n                                    // dispatch(ActionType.INIT_DEFAULT_ELEMENTS, null);\r\n                                    noteData.dataList = getDefaultNoteData();\r\n                                } else {\r\n                                    const dataList: NoteElement[] = [];\r\n                                    const response = await sendQueryRequestToAPI('select', `SELECT json from data_tbl where score = ${selectedRecord.id} order by seq`);\r\n                                    const results = await response.json();\r\n                                    // alert(JSON.stringify(results));\r\n                                    results.forEach((result: { json: string }) => {\r\n                                        dataList.push(JSON.parse(result.json));\r\n                                    });\r\n                                    noteData.dataList = dataList;\r\n                                }\r\n                                state.noteState.cuScoreId = selectedRecord.id;\r\n                                const soundFont = state.noteData.soundFont;\r\n                                soundFont.name = selectedRecord.soundfont == null ? '' : selectedRecord.soundfont as Soundfont.InstrumentName;\r\n                                soundFont.gain = selectedRecord.gain == null ? 1 : selectedRecord.gain;\r\n                                state.noteData.columnList = selectedRecord.tune == null ? [] : JSON.parse(selectedRecord.tune);\r\n                                dispatcher.score.setNoteState({ ...state.noteState });\r\n                                dispatcher.score.setNoteData(noteData);\r\n                                dispatch(ActionType.SELECT_NOTE_ELEMENT, { index: 2 });\r\n                                dispatch(ActionType.SELECT_SCORETAB, { index: 1 });\r\n                                setLoad(false);\r\n                            })();\r\n                    })}\r\n                </div>\r\n                {\r\n                    !isEdit ? <></> : (\r\n                        <div className=\"data\">\r\n                            {createInfoRecored('Id', (\r\n                                <span className=\"value\">{selectedRecord.id}</span>\r\n                            ))}\r\n                            {createInfoRecored('Title', (\r\n                                <input\r\n                                    type=\"text\"\r\n                                    onChange={(e) => {\r\n                                        // recordList[focus].title = e.target.value;\r\n                                        // setRecordList(recordList);\r\n                                        setTitle(e.target.value);\r\n                                    }}\r\n                                    value={title}\r\n                                />\r\n                            ))}\r\n                            {createInfoRecored('Mode', (\r\n                                // <span className=\"value\">{selectedRecord.chord_mode}</span>\r\n                                <select className={[\r\n                                    'value',\r\n                                    selectedRecord.data_cnt > 0 ? 'disable' : ''\r\n                                ].join(' ')}\r\n                                    value={chordMode}\r\n                                    onChange={(e) => {\r\n                                        setChordMode(e.target.value as CHORD_MODE | '');\r\n                                    }}>\r\n                                    <option value=''></option>\r\n                                    <option value={CHORD_MODE.SCALE}>{CHORD_MODE.SCALE}</option>\r\n                                    <option value={CHORD_MODE.DIRECT}>{CHORD_MODE.DIRECT}</option>\r\n                                </select>\r\n                            ))}\r\n                            {createInfoRecored('Show', (\r\n                                <span className=\"value\">{'PRIVATE'}</span>\r\n                            ))}\r\n                            {createInfoRecored('Data', (\r\n                                <span className=\"value\">{selectedRecord.data_cnt}</span>\r\n                            ))}\r\n                            {createInfoRecored('URL', (\r\n                                <span className=\"url\">{`${HOSTING_URL_ROOT}#/viewer?v=${selectedRecord.id}`}</span>\r\n                            ))}\r\n                        </div>\r\n                    )\r\n                }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ScoreContLiblaryTab;\r\n","\r\nexport const createFixedForm = (label: string, value: string): JSX.Element => {\r\n    return (\r\n        <div className=\"record\">\r\n            <div className=\"label\">{label}</div>\r\n            <div className=\"fixed\">{value}</div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport const createTextForm = (\r\n    label: string, value: string,\r\n    callback: (e: React.ChangeEvent<HTMLInputElement>) => void): JSX.Element => {\r\n    return (\r\n        <div className=\"record\">\r\n            <div className=\"label\">{label}</div>\r\n            <input type=\"text\" value={value} onChange={(e) => callback(e)} />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport const createSelectForm = (\r\n    label: string, value: string,\r\n    list: { value: string, display: string }[],\r\n    callback: (e: React.ChangeEvent<HTMLSelectElement>) => void): JSX.Element => {\r\n\r\n    const optionJSXList: JSX.Element[] = [];\r\n    list.forEach((item, i) => {\r\n        optionJSXList.push(\r\n            <option key={i} value={item.value}>{item.display}</option>\r\n        );\r\n    });\r\n    return (\r\n        <div className=\"record\">\r\n            <div className=\"label\">{label}</div>\r\n            <select value={value} onChange={(e) => callback(e)}>\r\n                {optionJSXList}\r\n            </select>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport const createButtonRecord = (list: { label: string, disabled: boolean, callback: () => void }[]) => {\r\n\r\n    const buttonJSXList: JSX.Element[] = [];\r\n    list.forEach((item, i) => {\r\n        buttonJSXList.push(\r\n            <button\r\n                key={i}\r\n                className={[item.disabled ? 'disable' : ''].join(' ')}\r\n                onClick={() => item.callback()}\r\n            >{item.label}</button>\r\n        );\r\n    });\r\n    return (\r\n        <div className=\"record\">{buttonJSXList}</div>\r\n    );\r\n}","import { GlobalContext } from \"contents/MainFrame\";\r\nimport { BTSustain, ThemaDataTree, ThemaIndexedElement } from \"contents/redux/store\";\r\nimport { useContext } from \"react\";\r\nimport { createButtonRecord, createFixedForm, createSelectForm, createTextForm } from \"./ThemaTabCommonUtil\";\r\n\r\n\r\nconst ThemaTabRoot = () => {\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const thema = state.themaDataTree;\r\n    const form = state.themaState.form.root;\r\n    const cur = dispatcher.thema.getFocusElement();\r\n\r\n    if (cur.type !== 'root') {\r\n        return <></>\r\n    }\r\n    const data = dispatcher.thema.getFocusElement().reffer as ThemaDataTree;\r\n\r\n    return (\r\n        <div className=\"thematab-detail\">\r\n            {createTextForm(\r\n                'Name',\r\n                form.themaName,\r\n                (e) => {\r\n                    form.themaName = e.target.value;\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }\r\n            )}\r\n            {createFixedForm(\r\n                'Children',\r\n                String(data.sustains.length)\r\n            )}\r\n\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Cancel',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            form.themaName = data.themaName;\r\n                            dispatcher.thema.setThemaState(state.themaState);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Update',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            data.themaName = form.themaName;\r\n                            dispatcher.thema.setThemaeData(thema);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Delete',\r\n                        disabled: false,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                ])\r\n            }\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Add Sustain',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            dispatcher.thema.addChildSustain();\r\n                        }\r\n                    }\r\n                ])\r\n            }\r\n\r\n            <div className=\"src\">\r\n                <textarea value={form.src} onChange={(e) => {\r\n                    form.src = e.target.value;\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }} />\r\n            </div>\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Sync',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            dispatcher.thema.setThemaeData(JSON.parse(form.src));\r\n                        }\r\n                    }\r\n                ])\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ThemaTabRoot;","import { GlobalContext } from \"contents/MainFrame\";\r\nimport { BTSustain, ThemaIndexedElement } from \"contents/redux/store\";\r\nimport { useContext } from \"react\";\r\nimport { createButtonRecord, createFixedForm, createSelectForm } from \"./ThemaTabCommonUtil\";\r\n\r\nconst ThemaTabSustain = () => {\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const thema = state.themaDataTree;\r\n    const form = state.themaState.form.sustain;\r\n    const cur = dispatcher.thema.getFocusElement();\r\n\r\n    if (cur.type !== 'sustain') {\r\n        return <></>\r\n    }\r\n    const data = dispatcher.thema.getFocusElement().reffer as BTSustain;\r\n    let sustain = '-';\r\n    if (form.beat != null) {\r\n        sustain = String(form.beat + form.headAdjust + form.tailAdjust);\r\n    }\r\n    const validate = form.beat != null;\r\n    return (\r\n        <div className=\"thematab-detail\">\r\n            {createSelectForm(\r\n                'Beat',\r\n                form.beat ? String(form.beat) : '',\r\n                [\r\n                    { value: '', display: '' },\r\n                    { value: String(1), display: String(1) },\r\n                    { value: String(2), display: String(2) },\r\n                    { value: String(3), display: String(3) },\r\n                    { value: String(4), display: String(4) }\r\n                ],\r\n                (e) => {\r\n                    form.beat = Number(e.target.value);\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }\r\n            )}\r\n            {createSelectForm(\r\n                'Head',\r\n                String(form.headAdjust),\r\n                [\r\n                    { value: String(-0.5), display: String(-0.5) },\r\n                    { value: String(-0.25), display: String(-0.25) },\r\n                    { value: String(0), display: String(0) },\r\n                    { value: String(0.25), display: String(+0.25) },\r\n                    { value: String(0.5), display: String(+0.5) },\r\n                ],\r\n                (e) => {\r\n                    form.headAdjust = Number(e.target.value);\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }\r\n            )}\r\n            {createSelectForm(\r\n                'Tail',\r\n                String(form.tailAdjust),\r\n                [\r\n                    { value: String(-0.5), display: String(-0.5) },\r\n                    { value: String(-0.25), display: String(-0.25) },\r\n                    { value: String(0), display: String(0) },\r\n                    { value: String(0.25), display: String(+0.25) },\r\n                    { value: String(0.5), display: String(+0.5) },\r\n                ],\r\n                (e) => {\r\n                    form.tailAdjust = Number(e.target.value);\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }\r\n            )}\r\n            {createFixedForm('Sustain', sustain)}\r\n            {createFixedForm(\r\n                'Children',\r\n                String(data.patterns.length)\r\n            )}\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Cancel',\r\n                        disabled: state.themaState.isCreate,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Update',\r\n                        disabled: !validate,\r\n                        callback: () => {\r\n                            data.beat = form.beat as number;\r\n                            data.headAdjust = form.headAdjust;\r\n                            data.tailAdjust = form.tailAdjust;\r\n                            dispatcher.thema.setThemaeData(thema);\r\n                            state.themaState.isCreate = false;\r\n                            dispatcher.thema.setThemaState(state.themaState);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Delete',\r\n                        disabled: false,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                ])\r\n            }\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Add Pattern',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            dispatcher.thema.addChildPattern(cur);\r\n                        }\r\n                    }\r\n                ])\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ThemaTabSustain;","import { GlobalContext } from \"contents/MainFrame\";\r\nimport { BTPattern, BTVoicing, ThemaIndexedElement, VoicingTargetCondition } from \"contents/redux/store\";\r\nimport { useContext, useEffect } from \"react\";\r\nimport { createButtonRecord, createFixedForm, createTextForm } from \"./ThemaTabCommonUtil\";\r\n\r\nconst ThemaTabVoicing = () => {\r\n\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const thema = state.themaDataTree;\r\n    const form = state.themaState.form.voicing;\r\n    const cur = dispatcher.thema.getFocusElement();\r\n\r\n    useEffect(()=>{\r\n        try {\r\n            form.def = JSON.parse(form.src);\r\n        } catch (e) {\r\n            form.def = null;\r\n        }\r\n    },[form.src]);\r\n\r\n    if (cur.type !== 'voicing') {\r\n        return <></>\r\n    }\r\n    const data = dispatcher.thema.getFocusElement().reffer as BTVoicing;\r\n\r\n    const getList = () => {\r\n        const list:string[] = [];\r\n        if(form.def != null)  {\r\n            form.def.useChannels.forEach(param=>{\r\n                list.push(`${param.octave}-${param.structIndex}`);\r\n            });\r\n        }\r\n        return list.join(' ');\r\n    }\r\n\r\n    return (\r\n        <div className=\"thematab-detail\">\r\n        {createFixedForm('Channel', getList())}\r\n        <div className=\"src\">\r\n            <textarea value={form.src} onChange={(e) => {\r\n                form.src = e.target.value;\r\n                dispatcher.thema.setThemaState(state.themaState);\r\n            }} />\r\n        </div>\r\n        {\r\n            createButtonRecord([\r\n                {\r\n                    label: 'Edit',\r\n                    disabled: false,\r\n                    callback: () => {\r\n                        dispatcher.thema.callBackingVoicingEditor();\r\n                    }\r\n                }\r\n            ])\r\n        }\r\n        {\r\n            createButtonRecord([\r\n                {\r\n                    label: 'Cancel',\r\n                    disabled: state.themaState.isCreate,\r\n                    callback: () => {\r\n\r\n                    }\r\n                },\r\n                {\r\n                    label: 'Update',\r\n                    disabled: false,\r\n                    callback: () => {\r\n                        data.def = JSON.parse(form.src);\r\n                        dispatcher.thema.setThemaeData(thema);\r\n                        state.themaState.isCreate = false;\r\n                        dispatcher.thema.setThemaState(state.themaState);\r\n                    }\r\n                },\r\n                {\r\n                    label: 'Delete',\r\n                    disabled: false,\r\n                    callback: () => {\r\n\r\n                    }\r\n                },\r\n            ])\r\n        }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ThemaTabVoicing;","import { KEY12_SHARP_LIST, SymbolType } from \"contents/common/define\";\r\nimport { getSymbolName, getSymbolsIncludeCategory, getSymbolTypeName } from \"contents/common/utils\";\r\nimport { GlobalContext } from \"contents/MainFrame\";\r\nimport { BTPattern, ThemaIndexedElement, VoicingTargetCondition, VoicingTargetType } from \"contents/redux/store\";\r\nimport { useContext } from \"react\";\r\nimport { createButtonRecord, createFixedForm, createSelectForm, createTextForm } from \"./ThemaTabCommonUtil\";\r\n\r\nconst ThemaTabCondition = () => {\r\n\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const thema = state.themaDataTree;\r\n    const form = state.themaState.form.condition;\r\n    const cur = dispatcher.thema.getFocusElement();\r\n\r\n    if (cur.type !== 'condition') {\r\n        return <></>\r\n    }\r\n    const data = cur.reffer as VoicingTargetCondition;\r\n    const parent = cur.parent?.reffer as VoicingTargetType;\r\n    return (\r\n        <div className=\"thematab-detail\">\r\n        {createFixedForm(\r\n            'Category',\r\n            getSymbolTypeName(parent.symbolType)\r\n        )}\r\n            {createSelectForm(\r\n                'Root Min',\r\n                form.minRootIndex.toString(),\r\n                (() => {\r\n                    const list: { value: string, display: string }[] = [];\r\n                    for (let i = 0; i < 12; i++) {\r\n                        list.push({\r\n                            value: String(i),\r\n                            display: KEY12_SHARP_LIST[i]\r\n                        });\r\n                    }\r\n                    return list;\r\n                })(),\r\n                (e) => {\r\n                    form.minRootIndex = Number(e.target.value);\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }\r\n            )}\r\n            {createSelectForm(\r\n                'Root Max',\r\n                form.maxRootIndex.toString(),\r\n                (() => {\r\n                    const list: { value: string, display: string }[] = [];\r\n                    for (let i = 0; i < 12; i++) {\r\n                        list.push({\r\n                            value: String(i),\r\n                            display: KEY12_SHARP_LIST[i]\r\n                        });\r\n                    }\r\n                    return list;\r\n                })(),\r\n                (e) => {\r\n                    form.maxRootIndex = Number(e.target.value);\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }\r\n            )}\r\n            {/* {createFixedForm(\r\n                'Symbols',\r\n                String(data.tgtSymbols.map((symbol) => `[${getSymbolName(symbol)}]`).join(', '))\r\n            )} */}\r\n            <div className={['selector'].join(' ')}>\r\n                {(() => {\r\n                    const category: SymbolType = (cur.parent?.reffer as VoicingTargetType).symbolType;\r\n                    return getSymbolsIncludeCategory(category).\r\n                        map((symbol, i): JSX.Element => {\r\n                            return (\r\n                                <div key={i} className={[\r\n                                    'item',\r\n                                    form.tgtSymbols.includes(symbol) ? 'active' : ''\r\n                                ].join(' ')}\r\n                                    onClick={() => {\r\n                                        if (!form.tgtSymbols.includes(symbol)) {\r\n                                            form.tgtSymbols.push(symbol);\r\n                                        } else {\r\n                                            form.tgtSymbols = form.tgtSymbols.filter((item) => item !== symbol);\r\n                                        }\r\n                                        dispatcher.thema.setThemaState(state.themaState);\r\n                                    }}\r\n                                >[{getSymbolName(symbol)}]</div>\r\n                            );\r\n                        });\r\n                })()}\r\n            </div>\r\n            {createFixedForm(\r\n                'Children',\r\n                String(data.voicings.length)\r\n            )}\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Cancel',\r\n                        disabled: state.themaState.isCreate,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Update',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            data.minRootIndex = form.minRootIndex;\r\n                            data.maxRootIndex = form.maxRootIndex;\r\n                            data.tgtSymbols = form.tgtSymbols;\r\n                            dispatcher.thema.setThemaeData(thema);\r\n                            state.themaState.isCreate = false;\r\n                            dispatcher.thema.setThemaState(state.themaState);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Delete',\r\n                        disabled: false,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                ])\r\n            }\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Add Voicing',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            dispatcher.thema.addChildVoicing(cur);\r\n                        }\r\n                    }\r\n                ])\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ThemaTabCondition;","import { SymbolType } from \"contents/common/define\";\r\nimport { getSymbolTypeName } from \"contents/common/utils\";\r\nimport { GlobalContext } from \"contents/MainFrame\";\r\nimport { BTPattern, ThemaIndexedElement, VoicingTargetType } from \"contents/redux/store\";\r\nimport { useContext } from \"react\";\r\nimport { createButtonRecord, createSelectForm } from \"./ThemaTabCommonUtil\";\r\n\r\nconst ThemaTabCategory = () => {\r\n\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const thema = state.themaDataTree;\r\n    const form = state.themaState.form.category;\r\n    const cur = dispatcher.thema.getFocusElement();\r\n\r\n    if (cur.type !== 'category') {\r\n        return <></>\r\n    }\r\n    const data = dispatcher.thema.getFocusElement().reffer as VoicingTargetType;\r\n    // alert('cat: ' + state.themaState.themaCacheList[state.themaState.focusIndex].type);\r\n    return (\r\n        <div className=\"thematab-detail\">\r\n            {createSelectForm(\r\n                'Category',\r\n                form.category == null ? '' : form.category.toString(),\r\n                (() => {\r\n                    const list: { value: string, display: string }[] = [];\r\n                    list.push({ value: '', display: '' });\r\n                    Object.values(SymbolType).filter(v => !isNaN(Number(v))).forEach((item, i) => {\r\n                        list.push({\r\n                            value: String(item),\r\n                            display: getSymbolTypeName(Number(item))\r\n                        });\r\n                    });\r\n                    return list;\r\n                })(),\r\n                (e) => {\r\n                    form.category = Number(e.target.value);\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }\r\n            )}\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Cancel',\r\n                        disabled: state.themaState.isCreate,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Update',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            data.symbolType = form.category as SymbolType;\r\n                            dispatcher.thema.setThemaeData(thema);\r\n                            state.themaState.isCreate = false;\r\n                            dispatcher.thema.setThemaState(state.themaState);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Delete',\r\n                        disabled: false,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                ])\r\n            }\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Add Condition',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            dispatcher.thema.addChildCondition(cur);\r\n                        }\r\n                    }\r\n                ])\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ThemaTabCategory;","import { GlobalContext } from \"contents/MainFrame\";\r\nimport { BackingPattern, BTPattern, BTSustain, ThemaIndexedElement } from \"contents/redux/store\";\r\nimport { useContext, useEffect } from \"react\";\r\nimport { createButtonRecord, createFixedForm, createTextForm } from \"./ThemaTabCommonUtil\";\r\n\r\nconst ThemaTabPattern = () => {\r\n\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const thema = state.themaDataTree;\r\n    const form = state.themaState.form.pattern;\r\n    const cur = dispatcher.thema.getFocusElement();\r\n\r\n    useEffect(()=>{\r\n        try {\r\n            form.def = JSON.parse(form.src);\r\n        } catch (e) {\r\n            form.def = null;\r\n        }\r\n    },[form.src]);\r\n\r\n    if (cur.type !== 'pattern') {\r\n        return <></>\r\n    }\r\n    const data = cur.reffer as BTPattern;\r\n\r\n    const parent = cur.parent?.reffer as BTSustain;\r\n    \r\n\r\n    const getChannel = () => {\r\n        let channel = '-';\r\n        if(form.def != null)  {\r\n            channel = String(form.def.layers[0].table.length);\r\n        }\r\n        return channel;\r\n    }\r\n\r\n    const getNotes = () => {\r\n        let notes = '-';\r\n        if(form.def != null)  {\r\n            const def: BackingPattern = JSON.parse(form.src);\r\n            let count = 0;\r\n            def.layers.forEach(layer => {\r\n                layer.table.forEach(line => {\r\n                    line.forEach(cell => {\r\n                        cell.forEach(isUse => {\r\n                            if (isUse) count++;\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n            notes = String(count);\r\n        }\r\n        return notes;\r\n    }\r\n\r\n    const validate = ():boolean => {\r\n        return form.name != '' && form.def != null;\r\n    };\r\n    return (\r\n        <div className=\"thematab-detail\">\r\n            {createFixedForm('Beat', String(parent.beat))}\r\n            {createFixedForm('Head', String(parent.headAdjust))}\r\n            {createFixedForm('Tail', String(parent.tailAdjust))}\r\n            {createFixedForm('Sustain', String(parent.beat + parent.headAdjust + parent.tailAdjust))}\r\n            {createTextForm(\r\n                'Name',\r\n                form.name,\r\n                (e) => {\r\n                    form.name = e.target.value;\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }\r\n            )}\r\n            {createFixedForm('Channel', getChannel())}\r\n            {createFixedForm('Notes', getNotes())}\r\n            <div className=\"src\">\r\n                <textarea value={form.src} onChange={(e) => {\r\n                    form.src = e.target.value;\r\n                    dispatcher.thema.setThemaState(state.themaState);\r\n                }} />\r\n            </div>\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Edit',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            dispatcher.thema.callBackingPatternEditor();\r\n                        }\r\n                    }\r\n                ])\r\n            }\r\n            {createFixedForm(\r\n                'Children',\r\n                String(data.tgtTypes.length)\r\n            )}\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Cancel',\r\n                        disabled: state.themaState.isCreate,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Update',\r\n                        disabled: !validate(),\r\n                        callback: () => {\r\n                            data.name = form.name;\r\n                            data.def = JSON.parse(form.src);\r\n                            dispatcher.thema.setThemaeData(thema);\r\n                            state.themaState.isCreate = false;\r\n                            dispatcher.thema.setThemaState(state.themaState);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Delete',\r\n                        disabled: false,\r\n                        callback: () => {\r\n\r\n                        }\r\n                    },\r\n                ])\r\n            }\r\n            {\r\n                createButtonRecord([\r\n                    {\r\n                        label: 'Add Category',\r\n                        disabled: false,\r\n                        callback: () => {\r\n                            dispatcher.thema.addChildCategory(cur);\r\n                        }\r\n                    }\r\n                ])\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ThemaTabPattern;","import './ScoreContThemaTab.css';\r\n\r\nimport { BTSustain, ThemaDataTree, BTPattern, VoicingTargetType, VoicingTargetCondition, BTVoicing, ThemaElementType, ThemaIndexedElement, FloatWndState, BackingVoicing, ChannelParam } from 'contents/redux/store';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { useContext, useEffect, useState } from 'react';\r\nimport TabbedPane from 'contents/common/TabbedPane';\r\nimport ThemaTabRoot from './tabs/ThemaTabRoot';\r\nimport { KEY12_SHARP_LIST, SymbolType } from 'contents/common/define';\r\nimport ThemaTabSustain from './tabs/ThemaTabSustain';\r\nimport ThemaTabVoicing from './tabs/ThemaTabVoicing';\r\nimport ThemaTabCondition from './tabs/ThemaTabCondition';\r\nimport ThemaTabCategory from './tabs/ThemaTabCategory';\r\nimport ThemaTabPattern from './tabs/ThemaTabPattern';\r\nimport { getSymbolName, getSymbolTypeName } from 'contents/common/utils';\r\nimport BackingEditor from '../note/floatwnd/backing/BackingEditor';\r\n\r\nconst ScoreContThemaTab = () => {\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const thema = state.themaDataTree;\r\n    const themaState = state.themaState;\r\n    const dataIndexies = themaState.themaCacheList;\r\n\r\n    const [treeItemJsxList, setTreeItemJsxList] = useState<JSX.Element[]>([]);\r\n\r\n    // ツリーのインデックス化\r\n    useEffect(() => {\r\n        dispatcher.thema.buildIndex();\r\n    }, [thema]);\r\n\r\n    // インデックスのJSX化\r\n    useEffect(() => {\r\n        const treeItemJsxList: JSX.Element[] = [];\r\n\r\n        const createTreeItemJsx = (data: ThemaIndexedElement, isActive: boolean): JSX.Element => {\r\n            const key = treeItemJsxList.length;\r\n            const depth = ((): number => {\r\n                switch (data.type) {\r\n                    case 'root': return 0;\r\n                    case 'sustain': return 1;\r\n                    case 'pattern': return 2;\r\n                    case 'category': return 3;\r\n                    case 'condition': return 4;\r\n                    case 'voicing': return 5;\r\n                }\r\n            })();\r\n\r\n            const label: JSX.Element = themaState.isCreate && key === themaState.focusIndex ?\r\n                (<span className=\"create\">Creating...</span>)\r\n                : (() => {\r\n                    switch (data.type) {\r\n                        case 'root': {\r\n                            const reffer = data.reffer as ThemaDataTree;\r\n                            return (\r\n                                <span className=\"value\">{reffer.themaName}</span>\r\n                            );\r\n                        }\r\n                        case 'sustain': {\r\n                            const reffer = data.reffer as BTSustain;\r\n                            return (<>\r\n                                <span>beat: </span>\r\n                                <span className=\"value\">{reffer.beat}</span>\r\n                                <span>[head: </span>\r\n                                <span className=\"value\">{reffer.headAdjust}</span>\r\n                                <span>, tail: </span>\r\n                                <span className=\"value\">{reffer.tailAdjust}</span>\r\n                                <span>]</span>\r\n                            </>);\r\n                        }\r\n                        case 'pattern': {\r\n                            const reffer = data.reffer as BTPattern;\r\n                            return (<>\r\n                                <span className=\"value\">{reffer.name}</span>\r\n                                <span> [channel: </span>\r\n                                <span className=\"value\">0</span>\r\n                                <span>, notes: </span>\r\n                                <span className=\"value\">0</span>\r\n                                <span>]</span>\r\n                            </>);\r\n                        }\r\n                        case 'category': {\r\n                            const reffer = data.reffer as VoicingTargetType;\r\n                            return (<>\r\n                                <span className=\"value\">{getSymbolTypeName(reffer.symbolType as SymbolType)}</span>\r\n                            </>);\r\n                        }\r\n                        case 'condition': {\r\n                            const reffer = data.reffer as VoicingTargetCondition;\r\n                            const min = KEY12_SHARP_LIST[reffer.minRootIndex];\r\n                            const max = KEY12_SHARP_LIST[reffer.maxRootIndex];\r\n                            const symbols = reffer.tgtSymbols.map((symbol) => `[${getSymbolName(symbol)}]`).join(', ');\r\n                            return (<>\r\n                                <span className=\"value\">{min}</span>\r\n                                <span>～</span>\r\n                                <span className=\"value\">{max}</span>\r\n                                <span> {'{'}</span>\r\n                                <span className=\"value\">{symbols}</span>\r\n                                <span>{'}'}</span>\r\n                            </>);\r\n                        }\r\n                        case 'voicing': {\r\n                            const reffer = data.reffer as BTVoicing;\r\n                            let src = '';\r\n                            if (reffer.def !== null) {\r\n                                const list = reffer.def.useChannels;\r\n                                const items = list.map((item) => {\r\n                                    return `${item.octave}-${item.structIndex}`;\r\n                                });\r\n                                src = items.join(', ');\r\n                            }\r\n                            return (<>\r\n                                <span>[</span>\r\n                                <span className=\"value\">{src}</span>\r\n                                <span>]</span>\r\n                            </>);\r\n                        }\r\n                    }\r\n                })();\r\n\r\n            const callback: Function = (() => {\r\n                switch (data.type) {\r\n                    case 'root': return () => dispatcher.thema.addChildSustain();\r\n                    case 'sustain': return () => dispatcher.thema.addChildPattern(data);\r\n                    case 'pattern': return () => dispatcher.thema.addChildCategory(data);\r\n                    case 'category': return () => dispatcher.thema.addChildCondition(data);\r\n                    case 'condition': return () => dispatcher.thema.addChildVoicing(data);\r\n                }\r\n                return () => { };\r\n            })();\r\n            const indentWidth = 10 + depth * 50;\r\n            return (\r\n                <div\r\n                    key={key}\r\n                    className={[\r\n                        'item',\r\n                        isActive ? 'active' : '',\r\n                        themaState.isCreate && themaState.focusIndex !== key ? 'lock' : ''\r\n                    ].join(' ')}\r\n                >\r\n                    <div className=\"indent\" style={{ width: indentWidth + 'px' }}></div>\r\n                    <div className={[\r\n                        'opener',\r\n                        data.ChildCnt == 0 ? 'hidden' : ''\r\n                    ].join(' ')} onClick={() => {\r\n                        data.isClose = !data.isClose;\r\n                        themaState.themaCacheList = dataIndexies.slice();\r\n                        dispatcher.thema.setThemaState(themaState);\r\n                    }}>\r\n                        <span>{data.isClose ? '＋' : '－'}</span>\r\n                    </div>\r\n                    {((): JSX.Element => {\r\n                        switch (data.type) {\r\n                            case 'root': return (<div className=\"type root\"><span>ROOT</span></div>);\r\n                            case 'sustain': return (<div className=\"type sustain\"><span>SUSTAIN</span></div>);\r\n                            case 'pattern': return (<div className=\"type pattern\"><span>PATTERN</span></div>);\r\n                            case 'category': return (<div className=\"type category\"><span>CATEGORY</span></div>);\r\n                            case 'condition': return (<div className=\"type condition\"><span>CONDITION</span></div>);\r\n                            case 'voicing': return (<div className=\"type voicing\"><span>VOICING</span></div>);\r\n                        }\r\n                    })()}\r\n                    <div\r\n                        className={[\r\n                            'label',\r\n                            themaState.focusIndex === key ? 'active' : ''\r\n                        ].join(' ')}\r\n                        onClick={() => {\r\n                            themaState.focusIndex = key;\r\n                            const cur = themaState.themaCacheList[themaState.focusIndex];\r\n                            switch (cur.type) {\r\n                                case 'root': {\r\n                                    const data = cur.reffer as ThemaDataTree;\r\n                                    const form = themaState.form.root;\r\n                                    form.themaName = data.themaName;\r\n                                    form.src = JSON.stringify(thema);\r\n                                }\r\n                                    break;\r\n                                case 'sustain': {\r\n                                    const data = cur.reffer as BTSustain;\r\n                                    const form = themaState.form.sustain;\r\n                                    form.beat = data.beat;\r\n                                    form.headAdjust = data.headAdjust;\r\n                                    form.tailAdjust = data.tailAdjust;\r\n                                }\r\n                                    break;\r\n                                case 'pattern': {\r\n                                    const data = cur.reffer as BTPattern;\r\n                                    const form = themaState.form.pattern;\r\n                                    form.name = data.name;\r\n                                    form.def = null;\r\n                                    form.src = JSON.stringify(data.def);\r\n                                }\r\n                                    break;\r\n                                case 'category': {\r\n                                    const data = cur.reffer as VoicingTargetType;\r\n                                    const form = themaState.form.category;\r\n                                    form.category = data.symbolType as SymbolType;\r\n                                }\r\n                                    break;\r\n                                case 'condition': {\r\n                                    const data = cur.reffer as VoicingTargetCondition;\r\n                                    const form = themaState.form.condition;\r\n                                    form.tgtSymbols = data.tgtSymbols;\r\n                                    form.minRootIndex = data.minRootIndex;\r\n                                    form.maxRootIndex = data.maxRootIndex;\r\n                                }\r\n                                    break;\r\n                                case 'voicing': {\r\n                                    const data = cur.reffer as BTVoicing;\r\n                                    const form = themaState.form.voicing;\r\n                                    form.def = null;\r\n                                    form.src = JSON.stringify(data.def);\r\n                                }\r\n                                    break;\r\n                            }\r\n                            dispatcher.thema.setThemaState(themaState);\r\n                        }}\r\n                        onContextMenu={() => callback()}\r\n                    >{label}</div>\r\n                </div>\r\n            )\r\n        }\r\n\r\n        const activeRefList: ThemaIndexedElement[] = [];\r\n        let ref: null | ThemaIndexedElement = dataIndexies[themaState.focusIndex];\r\n        while (ref != null) {\r\n            activeRefList.push(ref);\r\n            ref = ref.parent;\r\n        }\r\n        // for (let ref = dataIndexies[themaState.focusIndex]; ref.parent !== null; ref = ref.parent) {\r\n        //     activeRefList.push(ref);\r\n        // }\r\n        // activeRefList.push(dataIndexies[0]);\r\n        dataIndexies.forEach((data) => {\r\n            treeItemJsxList.push(\r\n                createTreeItemJsx(data, activeRefList.includes(data))\r\n            );\r\n        });\r\n\r\n        setTreeItemJsxList(treeItemJsxList);\r\n    }, [dataIndexies, themaState.focusIndex]);\r\n\r\n\r\n    if (dataIndexies.length === 0) {\r\n        return (<></>);\r\n    }\r\n    const cur = dataIndexies[themaState.focusIndex];\r\n\r\n    return (\r\n        <div id=\"scorecont-thematab-root\">\r\n            <BackingEditor />\r\n            <div className=\"cont left\">\r\n                <div className=\"loader\">\r\n\r\n                </div>\r\n                <div className={[\r\n                    'tree',\r\n                    themaState.isCreate ? 'lock' : ''\r\n                ].join(' ')}>\r\n                    {treeItemJsxList}\r\n                </div>\r\n                <div className=\"operation\">\r\n\r\n                </div>\r\n            </div>\r\n            <div className=\"cont right\">\r\n\r\n                <div id=\"themainfotab-root\">\r\n                    <TabbedPane groupName=\"themainfo-tabs\"\r\n                        tabElements={[\r\n                            { name: 'Root', disable: true, cont: <ThemaTabRoot /> },\r\n                            { name: 'Sustain', disable: true, cont: <ThemaTabSustain /> },\r\n                            { name: 'Pattern', disable: true, cont: <ThemaTabPattern /> },\r\n                            { name: 'Type', disable: true, cont: <ThemaTabCategory /> },\r\n                            { name: 'Condition', disable: true, cont: <ThemaTabCondition /> },\r\n                            { name: 'Voicing', disable: true, cont: <ThemaTabVoicing /> },\r\n                        ]}\r\n                        activeNo={(\r\n                            (): number => {\r\n                                switch (cur.type) {\r\n                                    case 'root': return 0;\r\n                                    case 'sustain': return 1;\r\n                                    case 'pattern': return 2;\r\n                                    case 'category': return 3;\r\n                                    case 'condition': return 4;\r\n                                    case 'voicing': return 5;\r\n                                }\r\n                            }\r\n                        )()}\r\n                    />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport default ScoreContThemaTab;\r\n","export const FluidR3_GM = [\r\n    \"\",\r\n    \"accordion\",\r\n    \"acoustic_bass\",\r\n    \"acoustic_grand_piano\",\r\n    \"acoustic_guitar_nylon\",\r\n    \"acoustic_guitar_steel\",\r\n    \"agogo\",\r\n    \"alto_sax\",\r\n    \"applause\",\r\n    \"bagpipe\",\r\n    \"banjo\",\r\n    \"baritone_sax\",\r\n    \"bassoon\",\r\n    \"bird_tweet\",\r\n    \"blown_bottle\",\r\n    \"brass_section\",\r\n    \"breath_noise\",\r\n    \"bright_acoustic_piano\",\r\n    \"celesta\",\r\n    \"cello\",\r\n    \"choir_aahs\",\r\n    \"church_organ\",\r\n    \"clarinet\",\r\n    \"clavinet\",\r\n    \"contrabass\",\r\n    \"distortion_guitar\",\r\n    \"drawbar_organ\",\r\n    \"dulcimer\",\r\n    \"electric_bass_finger\",\r\n    \"electric_bass_pick\",\r\n    \"electric_grand_piano\",\r\n    \"electric_guitar_clean\",\r\n    \"electric_guitar_jazz\",\r\n    \"electric_guitar_muted\",\r\n    \"electric_piano_1\",\r\n    \"electric_piano_2\",\r\n    \"english_horn\",\r\n    \"fiddle\",\r\n    \"flute\",\r\n    \"french_horn\",\r\n    \"fretless_bass\",\r\n    \"fx_1_rain\",\r\n    \"fx_2_soundtrack\",\r\n    \"fx_3_crystal\",\r\n    \"fx_4_atmosphere\",\r\n    \"fx_5_brightness\",\r\n    \"fx_6_goblins\",\r\n    \"fx_7_echoes\",\r\n    \"fx_8_scifi\",\r\n    \"glockenspiel\",\r\n    \"guitar_fret_noise\",\r\n    \"guitar_harmonics\",\r\n    \"gunshot\",\r\n    \"harmonica\",\r\n    \"harpsichord\",\r\n    \"helicopter\",\r\n    \"honkytonk_piano\",\r\n    \"kalimba\",\r\n    \"koto\",\r\n    \"lead_1_square\",\r\n    \"lead_2_sawtooth\",\r\n    \"lead_3_calliope\",\r\n    \"lead_4_chiff\",\r\n    \"lead_5_charang\",\r\n    \"lead_6_voice\",\r\n    \"lead_7_fifths\",\r\n    \"lead_8_bass__lead\",\r\n    \"marimba\",\r\n    \"melodic_tom\",\r\n    \"music_box\",\r\n    \"muted_trumpet\",\r\n    \"oboe\",\r\n    \"ocarina\",\r\n    \"orchestra_hit\",\r\n    \"orchestral_harp\",\r\n    \"overdriven_guitar\",\r\n    \"pad_1_new_age\",\r\n    \"pad_2_warm\",\r\n    \"pad_3_polysynth\",\r\n    \"pad_4_choir\",\r\n    \"pad_5_bowed\",\r\n    \"pad_6_metallic\",\r\n    \"pad_7_halo\",\r\n    \"pad_8_sweep\",\r\n    \"pan_flute\",\r\n    \"percussive_organ\",\r\n    \"percussion\",\r\n    \"piccolo\",\r\n    \"pizzicato_strings\",\r\n    \"recorder\",\r\n    \"reed_organ\",\r\n    \"reverse_cymbal\",\r\n    \"rock_organ\",\r\n    \"seashore\",\r\n    \"shakuhachi\",\r\n    \"shamisen\",\r\n    \"shanai\",\r\n    \"sitar\",\r\n    \"slap_bass_1\",\r\n    \"slap_bass_2\",\r\n    \"soprano_sax\",\r\n    \"steel_drums\",\r\n    \"string_ensemble_1\",\r\n    \"string_ensemble_2\",\r\n    \"synth_bass_1\",\r\n    \"synth_bass_2\",\r\n    \"synth_brass_1\",\r\n    \"synth_brass_2\",\r\n    \"synth_choir\",\r\n    \"synth_drum\",\r\n    \"synth_strings_1\",\r\n    \"synth_strings_2\",\r\n    \"taiko_drum\",\r\n    \"tango_accordion\",\r\n    \"telephone_ring\",\r\n    \"tenor_sax\",\r\n    \"timpani\",\r\n    \"tinkle_bell\",\r\n    \"tremolo_strings\",\r\n    \"trombone\",\r\n    \"trumpet\",\r\n    \"tuba\",\r\n    \"tubular_bells\",\r\n    \"vibraphone\",\r\n    \"viola\",\r\n    \"violin\",\r\n    \"voice_oohs\",\r\n    \"whistle\",\r\n    \"woodblock\",\r\n    \"xylophone\"\r\n]","import { DetailSection, CHORD_MODE, Store, TypeNoteElement, EditMode, Column } from 'contents/redux/store';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport React, { useContext, KeyboardEvent, useEffect, useState, useRef, useMemo } from 'react';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport styled, { css } from 'styled-components';\r\nimport { BEAT_WIDTH, KEY12_SHARP_LIST, NOTES_HEIGHT } from 'contents/common/define';\r\nimport { FluidR3_GM } from './SoundFontNames';\r\nimport Soundfont from 'soundfont-player';\r\nimport { TuneCache } from 'contents/redux/store/TuneState';\r\n\r\nconst ScoreContTuneTab = () => {\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    // const [len, setLen] = useState<number>(4);\r\n    // const [isDiv3, setDiv3] = useState<boolean>(false);\r\n    // const [soundFont, setSoundFont] = useState<Soundfont.InstrumentName>('viola');\r\n    // const [columnList, setColumnList] = useState<Column[]>([]);\r\n    // const [columnIndex, setColumnIndex] = useState<number>(0);\r\n    // const [isEdit, setEdit] = useState<boolean>(false);\r\n    const [isLoad, setLoad] = useState<boolean>(false);\r\n\r\n    const [columnJsxList, setColumnJsxList] = useState<JSX.Element[]>([]);\r\n    const [boxJsxList, setBoxJsxList] = useState<JSX.Element[]>([]);\r\n\r\n    const tableRef = useRef({} as HTMLDivElement);\r\n    const intervalRef = useRef({} as HTMLDivElement);\r\n    const measureRef = useRef({} as HTMLDivElement);\r\n    const BlocksRef = useRef({} as HTMLDivElement);\r\n\r\n    const instrument = state.instrument as Soundfont.Player;\r\n    const tuneState = state.tuneState;\r\n    const columnList = state.noteData.columnList;\r\n    const curColumn = columnList[tuneState.columnIndex];\r\n    const soundFont = state.noteData.soundFont;\r\n    const totalColumnSize = tuneState.totalColumnWidth;\r\n\r\n    useEffect(() => {\r\n        const columnList: Column[] = [];\r\n        columnList.push({\r\n            len4: 1,\r\n            len8: 0,\r\n            len16: 0,\r\n            len4div3: 0,\r\n            len8div3: 0,\r\n            soundIndex: -1\r\n        });\r\n        dispatcher.tune.setColumnList(columnList);\r\n        // dispatcher.tune.setState({ ...state.tuneState, soundFont: 'violin' });\r\n        tuneState.tableRef = tableRef;\r\n        tuneState.intervalRef = intervalRef;\r\n        tuneState.BlocksRef = BlocksRef;\r\n        tuneState.measureRef = measureRef;\r\n        dispatcher.tune.setState(tuneState);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let size = 0;\r\n        const list: TuneCache[] = [];\r\n\r\n        let baseKey = 0;\r\n        if (state.noteState.cacheList.length > 0) {\r\n            baseKey = state.noteState.cacheList[0].init.keyIndex;\r\n        }\r\n        columnList.forEach((column) => {\r\n            const cache: TuneCache = {\r\n                posX: size, baseKey\r\n            }\r\n            list.push(cache);\r\n            size += column.len4;\r\n            size += column.len8 / 2;\r\n            size += column.len16 / 4;\r\n            size += column.len4div3 / 3;\r\n            size += column.len8div3 / 6;\r\n        });\r\n        tuneState.totalColumnWidth = size;\r\n        tuneState.cacheList = list;\r\n        dispatcher.tune.setState(tuneState);\r\n    }, [columnList]);\r\n\r\n    const measureJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        for (let i = 0; i <= totalColumnSize * 4; i++) {\r\n            let barJsx = <></>;\r\n            if (i % 16 == 0) {\r\n                barJsx = <_Bar>{Math.floor(i / 16) + 1}</_Bar>\r\n            }\r\n            jsxList.push(\r\n                <_Scale key={i} isHead={i % 4 === 0}>{barJsx}</_Scale>\r\n            );\r\n        }\r\n        return jsxList;\r\n    }, [totalColumnSize]);\r\n\r\n\r\n    // const [columnJsxList, boxList]: [JSX.Element[], JSX.Element[]] = useMemo(() => {\r\n    useEffect(() => {\r\n        const columnJsxList: JSX.Element[] = [];\r\n        const boxJsxList: JSX.Element[] = [];\r\n        let pos = 0;\r\n        state.noteData.columnList.forEach((column, i) => {\r\n            const width = (column.len4 + column.len8 / 2 + column.len16 / 4 + column.len4div3 / 3 + column.len8div3 / 6) * BEAT_WIDTH;\r\n            const isActive = i === tuneState.columnIndex;\r\n            const cache = tuneState.cacheList[i];\r\n            columnJsxList.push(\r\n                <_Block key={i} pos={pos} width={width} isActive={isActive}\r\n                    onClick={() => {\r\n                        dispatcher.tune.setState({ ...tuneState, columnIndex: i, isEdit: false });\r\n                    }}\r\n                >\r\n                    {/* <_Sus>{block.sustain}</_Sus>\r\n                    <_ChordName>{block.chordName}</_ChordName> */}\r\n                    {/* <_Size>{tuneState.posList[i]}</_Size> */}\r\n                    <_Size>{column.len4}</_Size>\r\n                    <_Size>{column.len8}</_Size>\r\n                    <_Size>{column.len16}</_Size>\r\n                </_Block>\r\n            );\r\n            const lineJsxList: JSX.Element[] = [];\r\n            for (let j = 0; j < 88; j++) {\r\n                const octave = Math.floor((87 + 9 - j) / 12);\r\n                const keyIndex = (87 + 9 - j) % 12;\r\n                const scaleIndex = (12 - cache.baseKey + 87 + 9 - j) % 12;\r\n                const chordName = KEY12_SHARP_LIST[keyIndex];\r\n                const soundName = chordName + octave;\r\n                const isNotes = j === column.soundIndex;\r\n                lineJsxList.push(\r\n                    <_Line key={j} soundIndex={scaleIndex} onClick={() => {\r\n                        dispatcher.tune.setState({ ...tuneState, columnIndex: i, isEdit: true });\r\n                        // 音声の再生\r\n                        if (columnList[i].soundIndex === j) {\r\n                            columnList[i].soundIndex = -1;\r\n                        } else {\r\n                            columnList[i].soundIndex = j;\r\n                            dispatcher.tune.playSoundFont(soundName, 0.5);\r\n                        }\r\n                        dispatcher.tune.setColumnList(columnList.slice());\r\n                        if (tuneState.isAutoScroll) {\r\n                            dispatcher.tune.adjustScrollX(i);\r\n                            dispatcher.tune.adjustScrollY(i);\r\n                        }\r\n                    }} onContextMenu={() => {\r\n                        dispatcher.tune.setState({ ...tuneState, columnIndex: i, isEdit: true });\r\n                        const soundIndex = columnList[i].soundIndex;\r\n                        if (soundIndex !== -1) {\r\n                            dispatcher.tune.playSoundFont(getSoundName(soundIndex), 0.5);\r\n                        }\r\n                        if (tuneState.isAutoScroll) {\r\n                            dispatcher.tune.adjustScrollY(i);\r\n                        }\r\n                    }}>\r\n                        {isNotes ? <_Notes isScale={isScale(0, scaleIndex)}>{soundName}</_Notes> : ''}\r\n                    </_Line>\r\n                );\r\n            }\r\n            boxJsxList.push(\r\n                <_Box key={i} isActive={isActive} isEdit={isActive && tuneState.isEdit} pos={pos} width={width}\r\n                >\r\n                    {lineJsxList}\r\n                </_Box>\r\n            );\r\n            pos += width;\r\n            setColumnJsxList(columnJsxList);\r\n            setBoxJsxList(boxJsxList);\r\n        });\r\n        // return [columnJsxList, boxJsxList];\r\n    }, [instrument, columnList, tuneState.columnIndex, tuneState.isEdit]);\r\n\r\n    // useEffect(()=> {\r\n    //     const i = tuneState.columnIndex;\r\n    //     boxJsxList[i] = (\r\n    //         <_Box key={i} isActive={true} isEdit={tuneState.isEdit} pos={pos} width={width}\r\n    //         >\r\n    //             {lineJsxList}\r\n    //         </_Box>\r\n    //     );\r\n    //     setBoxJsxList(boxJsxList);\r\n    // }, [tuneState.isEdit]);\r\n\r\n    const intervalListJSX: JSX.Element[] = useMemo(() => {\r\n        const intervalListJSX: JSX.Element[] = [];\r\n        for (let i = 0; i < 88; i++) {\r\n            const num = 88 - (i);\r\n            const octave = Math.floor((87 + 9 - i) / 12);\r\n            const chordName = KEY12_SHARP_LIST[(87 + 9 - i) % 12];\r\n            const soundName = chordName + octave;\r\n            const isActive = curColumn && tuneState.isEdit ? curColumn.soundIndex === i : false;\r\n            intervalListJSX.push(\r\n                <_Interval key={i} isActive={isActive} onClick={() => {\r\n                    // instrument.stop();\r\n                    // instrument.play(soundName, 0, { duration: 0.5 });\r\n                    dispatcher.tune.playSoundFont(soundName, 0.5);\r\n                }}>\r\n                    <_Num>{num}</_Num> <_SoundName>{soundName}</_SoundName>\r\n                </_Interval>\r\n            );\r\n        }\r\n        return intervalListJSX;\r\n    }, [instrument, columnList, tuneState.isEdit, tuneState.columnIndex]);\r\n\r\n    const getSoundFontSelectorJsx = (): JSX.Element => {\r\n        const soundFontName = soundFont.name as Soundfont.InstrumentName;\r\n        return (\r\n            <>\r\n                <_SoundFont isEditable={!isLoad} value={soundFontName} onChange={(e) => {\r\n                    const name = e.target.value as Soundfont.InstrumentName;\r\n                    soundFont.name = name;\r\n                    dispatcher.tune.setSoundFont(soundFont);\r\n                }}>\r\n                    {FluidR3_GM.map((name, i) => {\r\n                        return <option key={i} value={name}>{name}</option>\r\n                    })}\r\n                </_SoundFont>\r\n                <_Gain isEditable={!isLoad} type=\"number\" min=\"1\" max=\"15\" step=\"0.2\" value={soundFont.gain} onChange={(e) => {\r\n                    soundFont.gain = Number(e.target.value);\r\n                    dispatcher.tune.setSoundFont(soundFont);\r\n                }} />\r\n            </>\r\n        );\r\n    }\r\n\r\n\r\n    const createSwitch = (name: string, isActive: boolean, callback: () => void): JSX.Element => {\r\n        return <_LenSwitch onClick={callback} isActive={isActive}>{name}</_LenSwitch>;\r\n    }\r\n    const createLenSwitch = (value: number): JSX.Element => {\r\n        // return createSwitch(String(value), len === value, () => setLen(value));\r\n        return createSwitch(String(value), tuneState.usingLen === value,\r\n            () => {\r\n                tuneState.usingLen = value;\r\n                dispatcher.tune.setState(tuneState);\r\n            }\r\n        );\r\n    }\r\n    const createExecuteButton = (name: string, callback: () => void): JSX.Element => {\r\n        return <_ExecuteButton onClick={callback}>{name}</_ExecuteButton>;\r\n    }\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Header>\r\n\r\n            </_Header>\r\n            <_Editor>\r\n                <_Operation>\r\n                    {getSoundFontSelectorJsx()}\r\n                    {createExecuteButton(isLoad ? 'del' : 'load', () => {\r\n                        if (!isLoad) {\r\n                            if (soundFont.name !== '') {\r\n                                Soundfont.instrument(new AudioContext(), soundFont.name, { gain: soundFont.gain, release: 0.5 }).then((instrument) => {\r\n                                    // alert('load')\r\n                                    dispatcher.setInstruments(instrument);\r\n                                });\r\n                            }\r\n                        } else {\r\n                            dispatcher.setInstruments(null);\r\n                        }\r\n                        setLoad(!isLoad);\r\n                    })}\r\n                    {createLenSwitch(16)}\r\n                    {createLenSwitch(8)}\r\n                    {createLenSwitch(4)}\r\n                    {/* {createSwitch('/3', tuneState.isDiv3, () => setDiv3(!isDiv3))} */}\r\n                    {createSwitch('/3', tuneState.isDiv3,\r\n                        () => {\r\n                            tuneState.isDiv3 = !tuneState.isDiv3;\r\n                            dispatcher.tune.setState(tuneState)\r\n                        }\r\n                    )}\r\n                    {createExecuteButton('add', () => {\r\n                        dispatcher.tune.addColumn();\r\n                    })}\r\n                    {createExecuteButton('del', () => {\r\n                        dispatcher.tune.remooveCur();\r\n                    })}\r\n                    {createExecuteButton('|->>', () => {\r\n                        dispatcher.tune.adjustWidth(true);\r\n                    })}\r\n                    {createExecuteButton('|<<-', () => {\r\n                        dispatcher.tune.adjustWidth(false);\r\n                    })}\r\n                    {createSwitch('scr', tuneState.isAutoScroll,\r\n                        () => {\r\n                            tuneState.isAutoScroll = !tuneState.isAutoScroll;\r\n                            dispatcher.tune.setState(tuneState);\r\n                        }\r\n                    )}\r\n                    {createSwitch(!tuneState.isPreview ? 'play' : 'stop', tuneState.isPreview,\r\n                        () => {\r\n                            if (!tuneState.isPreview) {\r\n                                dispatcher.tune.playPreview();\r\n                            } else {\r\n                                dispatcher.tune.stopPreview();\r\n                            }\r\n                            tuneState.isPreview = !tuneState.isPreview;\r\n                            dispatcher.tune.setState(tuneState);\r\n                        }\r\n                    )}\r\n                    {createExecuteButton('up', () => {\r\n                        dispatcher.tune.moveAll(-1);\r\n                    })}\r\n                    {createExecuteButton('down', () => {\r\n                        dispatcher.tune.moveAll(1);\r\n                    })}\r\n                </_Operation>\r\n\r\n                <_WrapInterval ref={intervalRef} onClick={() => {\r\n\r\n                }}>\r\n                    {intervalListJSX}\r\n                </_WrapInterval>\r\n                <_WrapTimeLine>\r\n                    <_Measure ref={measureRef}>\r\n                        {measureJsxList}\r\n                    </_Measure>\r\n                    <_BlockLine ref={BlocksRef}>\r\n                        {columnJsxList}\r\n                    </_BlockLine>\r\n                    <_TableWrap ref={tableRef} onScroll={() => {\r\n\r\n                        const scrollLeft = tableRef.current.scrollLeft;\r\n                        const scrollTop = tableRef.current.scrollTop;\r\n                        measureRef.current.scrollTo({ left: scrollLeft });\r\n                        BlocksRef.current.scrollTo({ left: scrollLeft });\r\n                        intervalRef.current.scrollTo({ top: scrollTop });\r\n                    }}>\r\n                        <_Table width={totalColumnSize * BEAT_WIDTH} >\r\n                            {boxJsxList}\r\n                        </_Table>\r\n                    </_TableWrap>\r\n                </_WrapTimeLine>\r\n            </_Editor>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ScoreContTuneTab;\r\n\r\nconst isScale = (key: number, soundIndex: number): boolean => {\r\n    switch (soundIndex) {\r\n        case 0 + key:\r\n        case 2 + key:\r\n        case 4 + key:\r\n        case 5 + key:\r\n        case 7 + key:\r\n        case 9 + key:\r\n        case 11 + key: return true;\r\n        default: return false;\r\n    }\r\n}\r\n\r\nconst getSoundName = (soundIndex: number) => {\r\n\r\n    const octave = Math.floor((87 + 9 - soundIndex) / 12);\r\n    const keyIndex = (87 + 9 - soundIndex) % 12;\r\n    const chordName = KEY12_SHARP_LIST[keyIndex];\r\n    return chordName + octave;\r\n}\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: white;\r\n`;\r\n\r\nconst _Header = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 40px;\r\n    background-color: #707070;\r\n`;\r\n\r\nconst _Editor = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - 40px);\r\n    background-color: #000000;\r\n`;\r\n\r\nconst _Operation = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 40px;\r\n    text-align: left;\r\n    background-color: #16213b;\r\n    & * {\r\n        display: inline-block;\r\n        vertical-align: top;\r\n        margin-left: 5px;\r\n        height: 30px;\r\n        margin-top: 5px;\r\n    }\r\n`;\r\n\r\nconst _SoundFont = styled.select<{\r\n    isEditable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 160px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: ${props => props.isEditable ? 'black' : 'blue'};\r\n    ${props => props.isEditable ? '' : 'pointer-events: none;'}\r\n    background-color: #8197a0;\r\n    border: solid 1px #e2e9ee;\r\n    border-radius: 2px;\r\n    & option {\r\n        /* width: 100%;\r\n        height: 30px; */\r\n        background-color: #97aec4;\r\n        color: red;\r\n    }\r\n`;\r\nconst _Gain = styled.input<{\r\n    isEditable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 60px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: ${props => props.isEditable ? 'black' : 'blue'};\r\n    ${props => props.isEditable ? '' : 'pointer-events: none;'}\r\n    background-color: #8197a0;\r\n    border: solid 1px #e2e9ee;\r\n    border-radius: 2px;\r\n`;\r\n\r\nconst _ButtonBase = styled.div`\r\n    display: inline-block;\r\n    padding: 0 10px 0 10px;\r\n    width: 80px;\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    line-height: 28px;\r\n    text-align: center;\r\n    border-radius: 4px;\r\n`;\r\n\r\nconst _LenSwitch = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    padding: 0 10px 0 10px;\r\n    width: 80px;\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    line-height: 28px;\r\n    text-align: center;\r\n    border-radius: 4px;\r\n    ${props => !props.isActive ?\r\n        css`\r\n            background-color: #5662a0;\r\n            color: #f5f5f5;\r\n            border: solid 1px #acc0d6;\r\n        ` :\r\n        css`\r\n            background-color: #f4ff5f;\r\n            color: #fa0000;\r\n            border: solid 1px #fa0000;\r\n        `\r\n    }\r\n    &:hover {\r\n        background-color: #7a88ca;\r\n    }\r\n`;\r\n\r\nconst _ExecuteButton = styled(_ButtonBase)`\r\n    background-color: #535353;\r\n    color: #f5f5f5;\r\n    border: solid 1px #ffffff;\r\n    &:hover {\r\n        background-color: #919191;\r\n    }\r\n`;\r\n\r\nconst _WrapInterval = styled.div`\r\n    display: inline-block;\r\n    background-color: #e7e7e7;\r\n    width: 80px;\r\n    height: calc(100% - 150px);\r\n    vertical-align: top;\r\n    margin-top: 100px;\r\n    overflow-y: hidden;\r\n`;\r\n\r\nconst _Interval = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    background-color: ${props => props.isActive ? '#568abb' : '#205f99'};\r\n    width: 100%;\r\n    height: 22px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    text-align: left;\r\n    border: solid 1px #0000003b;\r\n    padding-left: 5px;\r\n    box-sizing: border-box;\r\n`;\r\nconst _Num = styled.span`\r\n    color: #7a7a7a;\r\n`;\r\nconst _SoundName = styled.span`\r\n    color: #dbddff;\r\n`;\r\nconst _WrapTimeLine = styled.div`\r\n    display: inline-block;\r\n    background-color: black;\r\n    width: calc(100% - 80px);\r\n    height: calc(100% - 40px);\r\n    vertical-align: top;\r\n    text-align: left;\r\n`;\r\nconst _Measure = styled.div`\r\n    display: inline-block;\r\n    background: linear-gradient(to bottom, #ffffff, #808080);\r\n    width: calc(100% - 10px);\r\n    height: 40px;\r\n    text-align: left;\r\n    border-top: solid 2px #000;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n`;\r\nconst _Scale = styled.div<{\r\n    isHead: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    /* background-color: #ffffffbe; */\r\n    width: ${BEAT_WIDTH / 4}px;\r\n    vertical-align: bottom;\r\n    margin-top: 25px;\r\n    height: ${props => props.isHead ? '15px' : '10px'};\r\n    box-sizing: border-box;\r\n    border-left: solid ${props => props.isHead ? '2px' : '1px'} #000;\r\n`;\r\nconst _Bar = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #ec0000;\r\n    left: -5px;\r\n    top: -20px;\r\n`;\r\nconst _BlockLine = styled.div`\r\n    display: inline-block;\r\n    background-color: #6e639ea1;\r\n    width: calc(100% - 10px);\r\n    height: 60px;\r\n    position: relative;\r\n    overflow-x: hidden;\r\n`;\r\nconst _Block = styled.div<{\r\n    pos: number;\r\n    width: number;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    background-color: #0077ff67;\r\n    left: ${(props) => props.pos}px;\r\n    width: ${(props) => props.width}px;\r\n    height: 100%;\r\n    /* color: #002575d1; */\r\n    text-align: left;\r\n    padding-left: 5px;\r\n    border: ${props => !props.isActive ?\r\n        'solid 1px #ffffff4c' :\r\n        'solid 2px #ffffff4c'\r\n    };\r\n    opacity: ${(props) => props.isActive ? '1' : '0.5'};\r\n`;\r\nconst _Size = styled.span`\r\n    display: inline-block;\r\n    width: 100%;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    color: #ffffffd1;\r\n`;\r\n\r\n\r\nconst _TableWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - 100px);\r\n    overflow: scroll;\r\n    text-align: left;\r\n    -webkit-appearance: none;\r\n`;\r\n\r\nconst _Table = styled.div<{\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    background-color: #000000;\r\n    width: ${(props) => props.width}px;\r\n    /* height: 100%; */\r\n    /* text-align: left; */\r\n    position: relative;\r\n    white-space: nowrap;\r\n`;\r\n\r\nconst _Box = styled.div<{\r\n    isActive: boolean;\r\n    isEdit: boolean;\r\n    pos: number;\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: ${props => props.pos}px;\r\n    background-color: ${props => !props.isActive ? '#0000ff5c' : '#8787db76'};\r\n    border: ${props => !props.isActive ?\r\n        'solid 1px #ffffff4c' :\r\n        'solid 2px #ffffff4c'\r\n    };\r\n    box-sizing: border-box;\r\n    width: ${(props) => props.width}px;\r\n    height: ${NOTES_HEIGHT * 88}px;\r\n    opacity: ${(props) => props.isEdit ? '1' : '0.5'};\r\n`;\r\n\r\nconst _Line = styled.div<{\r\n    soundIndex: number;\r\n}>`\r\n    display: table;\r\n    position: relative;\r\n    width: 100%;\r\n    height: ${NOTES_HEIGHT}px;\r\n    background-color: ${(props) => {\r\n        switch (props.soundIndex) {\r\n            case 0: return '#ffffff57';\r\n            case 1: return '#b0b5bb56';\r\n            case 2: return '#e9e9e957';\r\n            case 3: return '#b0b5bb56';\r\n            case 4: return '#e9e9e957';\r\n            case 5: return '#dfdfdf57';\r\n            case 6: return '#b0b5bb56';\r\n            case 7: return '#e9e9e957';\r\n            case 8: return '#b0b5bb56';\r\n            case 9: return '#e9e9e957';\r\n            case 10: return '#b0b5bb56';\r\n            case 11: return '#e9e9e957';\r\n        }\r\n    }};\r\n    /* margin-bottom: 1px; */\r\n`;\r\nconst _Notes = styled.div<{\r\n    isScale: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: ${(props) => props.isScale ? '#eeff00fc' : '#ff1e00'};\r\n    box-shadow: 2px 2px 20px 4px ${(props) => props.isScale ? '#eeff00fc' : '#ff1e00'};\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n    font-size: 8px;\r\n    font-weight: 600;\r\n    padding-left: 2px;\r\n    color: #ff0000;\r\n    border-radius: 2px;\r\n    overflow-x: hidden;\r\n`;\r\n\r\nconst _Current = styled.div<{\r\n    pos: number\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: ${(props) => props.pos}px;\r\n    width: 2px;\r\n    height: 1056px;\r\n    background-color: red;\r\n        box-shadow: 2px 2px 15px 4px #ff727290;\r\n    z-index: 99;\r\n`;","import { DetailSection, CHORD_MODE, Store, TypeNoteElement, EditMode, DetailChord, BACKING_LEN_TYPE } from 'contents/redux/store';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport React, { useContext, KeyboardEvent, useEffect, useState, useRef, useMemo } from 'react';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport styled, { css } from \"styled-components\";\r\nimport { applyOnChord, getSymbolParams } from 'contents/common/utils';\r\nimport { KEY12_SHARP_LIST, SymbolParams } from 'contents/common/define';\r\n\r\ntype NotesInfo = {\r\n    pos: number,\r\n    width: number,\r\n    layer: 'left' | 'right',\r\n    soundName: string\r\n};\r\ntype BlockInfo = {\r\n    pos: number,\r\n    width: number,\r\n    sustain: number,\r\n    chordName: string\r\n};\r\n\r\nconst BEAT_WIDTH = 120;\r\nconst NOTES_HEIGHT = 22;\r\n\r\nconst ScoreContPreviewTab = () => {\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [notesTable, setNotesTable] = useState<NotesInfo[][][]>([]);\r\n    const [blocks, setBlocks] = useState<BlockInfo[]>([]);\r\n    const [barPos, setBarPos] = useState<number>(0);\r\n    const [curIndex, setCurIndex] = useState<number>(0);\r\n    const [isPlay, setPlay] = useState<boolean>(false);\r\n    const [bpm, setBpm] = useState<number>(0);\r\n\r\n    const [limit, setLimist] = useState<number>(0);\r\n\r\n    const tableRef = useRef({} as HTMLDivElement);\r\n    const intervalRef = useRef({} as HTMLDivElement);\r\n    const measureRef = useRef({} as HTMLDivElement);\r\n    const BlocksRef = useRef({} as HTMLDivElement);\r\n\r\n    useEffect(() => {\r\n        if (state.scoreTabIndex === 5) {\r\n\r\n            const notesTable: NotesInfo[][][] = [];\r\n            const blocks: BlockInfo[] = [];\r\n\r\n            let curPos = 0;\r\n            state.noteData.dataList.forEach((block, i) => {\r\n\r\n                const key = state.noteState.cacheList[i].init.keyIndex;\r\n                if (block.type === TypeNoteElement.Chord) {\r\n                    console.log(i);\r\n\r\n                    const table: NotesInfo[][] = [];\r\n                    for (let i = 0; i < 88; i++) {\r\n                        table.push([]);\r\n                    }\r\n                    // BPMの設定\r\n                    setBpm(state.noteState.cacheList[i].init.tempo);\r\n\r\n                    // フォーカスの設定\r\n                    if (state.noteState.focusIndex == i) {\r\n                        setCurIndex(blocks.length);\r\n                        setBarPos(curPos * BEAT_WIDTH);\r\n                    }\r\n\r\n                    const chord = block.detail as DetailChord;\r\n                    const sustain = chord.sustain + chord.headAdjust + chord.tailAdjust;\r\n                    const rootIndex = ((chord.molecule?.rootIndex as number) + key) % 12;\r\n                    let symbol = getSymbolParams(chord.symbolKey) as SymbolParams;\r\n                    if (chord.denominator != null) {\r\n                        symbol = { ...symbol };\r\n                        applyOnChord(symbol, rootIndex, chord.denominator.rootIndex)\r\n                    }\r\n                    blocks.push({\r\n                        pos: curPos * BEAT_WIDTH,\r\n                        width: sustain * BEAT_WIDTH,\r\n                        sustain: sustain,\r\n                        chordName: KEY12_SHARP_LIST[rootIndex] + symbol.name\r\n                    });\r\n                    //最終要素のみリミットの設定\r\n                    setLimist(curPos * BEAT_WIDTH + sustain * BEAT_WIDTH);\r\n\r\n                    const backing = chord.backing;\r\n                    backing.layers.forEach((layer, j) => {\r\n                        layer.table.forEach((tabY, k) => {\r\n                            let index = 0;\r\n                            if (backing.useChannels.length - 1 >= k) {\r\n                                const channel = backing.useChannels[k];\r\n                                index = rootIndex + channel.octave * 12 + symbol.intervals[channel.structIndex] - 9;\r\n                            }\r\n                            let pos = curPos;\r\n                            console.log(`index=${index}, lenSize=${layer.lens.length}, k=${k}, tableSize=${layer.table.length}`);\r\n                            tabY.forEach((notes, l) => {\r\n                                let width = 0;\r\n                                switch (layer.lens[l].len) {\r\n                                    case BACKING_LEN_TYPE.LEN1: width = 4; break;\r\n                                    case BACKING_LEN_TYPE.LEN2: width = 2; break;\r\n                                    case BACKING_LEN_TYPE.LEN4: width = 1; break;\r\n                                    case BACKING_LEN_TYPE.LEN8: width = 1 / 2; break;\r\n                                    case BACKING_LEN_TYPE.LEN16: width = 1 / 4; break;\r\n                                }\r\n                                if (layer.lens[l].isHalf) {\r\n                                    width *= 1.5;\r\n                                }\r\n                                if (!layer.lens[l].isDiv3) {\r\n                                    if (notes[0]) {\r\n                                        table[index].push({\r\n                                            pos: pos * BEAT_WIDTH,\r\n                                            width: width * BEAT_WIDTH,\r\n                                            layer: j == 0 ? 'left' : 'right',\r\n                                            soundName: KEY12_SHARP_LIST[(index + 9) % 12] + Math.floor((index + 9) / 12)\r\n                                        });\r\n                                    }\r\n                                } else {\r\n                                    console.log(JSON.stringify(notes));\r\n                                    notes.forEach((note, m) => {\r\n                                        if (note) {\r\n                                            const posAdjust = pos + width / 3 * m;\r\n                                            const widthAdjust = width / 3;\r\n                                            table[index].push({\r\n                                                pos: posAdjust * BEAT_WIDTH,\r\n                                                width: widthAdjust * BEAT_WIDTH,\r\n                                                layer: j == 0 ? 'left' : 'right',\r\n                                                soundName: KEY12_SHARP_LIST[index % 12] + Math.floor(index / 12)\r\n                                            });\r\n                                        }\r\n                                    });\r\n                                }\r\n                                pos += width;\r\n                            });\r\n                        });\r\n                    });\r\n                    curPos += sustain;\r\n                    notesTable.push(table.reverse());\r\n                }\r\n            });\r\n            setNotesTable(notesTable);\r\n            setBlocks(blocks);\r\n        }\r\n    }, [state.scoreTabIndex]);\r\n\r\n    useEffect(() => {\r\n        tableRef.current.scrollTo({ left: barPos - 400, behavior: 'smooth' });\r\n        BlocksRef.current.scrollTo({ left: barPos - 400, behavior: 'smooth' });\r\n\r\n    }, [curIndex]);\r\n    useEffect(() => {\r\n        if (\r\n            blocks.length > curIndex + 1 &&\r\n            (barPos >= blocks[curIndex + 1].pos)\r\n        ) {\r\n            setCurIndex(curIndex + 1);\r\n        }\r\n    }, [barPos]);\r\n\r\n    const blockListJsx: JSX.Element[] = useMemo(() => {\r\n        const blockListJsx: JSX.Element[] = [];\r\n        blocks.forEach((block, i) => {\r\n            const left = block.pos;\r\n            const right = left + block.width;\r\n            // if (\r\n            //     !isPlay ||\r\n            //     (barPos > left - 500 && barPos < right + 700)\r\n            // ) {\r\n            blockListJsx.push(\r\n                <_Block key={i} pos={block.pos} width={block.width} isActive={i === curIndex}\r\n                    onClick={() => {\r\n                        setCurIndex(i);\r\n                        setBarPos(block.pos);\r\n                    }}\r\n                >\r\n                    <_Sus>{block.sustain}</_Sus>\r\n                    <_ChordName>{block.chordName}</_ChordName>\r\n                </_Block>\r\n            );\r\n            // }\r\n        });\r\n        return blockListJsx;\r\n    }, [notesTable, curIndex]);\r\n\r\n    const boxListJsx: JSX.Element[] = useMemo(() => {\r\n        const boxListJsx: JSX.Element[] = [];\r\n        notesTable.forEach((box, i) => {\r\n            const left = blocks[i].pos;\r\n            const right = left + blocks[i].width;\r\n            if (\r\n                !isPlay ||\r\n                (barPos > left - 500 && barPos < right + 700)\r\n            ) {\r\n                const lineListJsx: JSX.Element[] = [];\r\n                box.forEach((line, j) => {\r\n                    const notesListJsx: JSX.Element[] = [];\r\n                    line.forEach((notes, k) => {\r\n                        const isActive = notes.pos <= barPos && notes.pos + notes.width >= barPos;\r\n                        // if (notes.pos + notes.width > pos && pos < notes.pos + 500) {\r\n                        notesListJsx.push(\r\n                            <_Notes key={k} pos={notes.pos - blocks[i].pos} width={notes.width} layer={notes.layer} isActive={isActive}>\r\n                                {notes.soundName}\r\n                            </_Notes>\r\n                        );\r\n                        // }\r\n                    });\r\n                    lineListJsx.push(\r\n                        <_Line key={j} soundIndex={j % 12}>\r\n                            {notesListJsx}\r\n                        </_Line>\r\n                    );\r\n                });\r\n                boxListJsx.push(\r\n                    <_Box\r\n                        key={i}\r\n                        isActive={barPos >= left && barPos < right}\r\n                        pos={left}\r\n                        width={blocks[i].width}\r\n                    >\r\n                        {lineListJsx}\r\n                    </_Box>\r\n                );\r\n            }\r\n        });\r\n        return boxListJsx;\r\n    }, [notesTable, barPos]);\r\n\r\n    const intervalListJSX: JSX.Element[] = useMemo(() => {\r\n        const intervalListJSX: JSX.Element[] = [];\r\n        for (let i = 0; i < 88; i++) {\r\n            const num = 88 - (i);\r\n            const octave = Math.floor((87 + 9 - i) / 12);\r\n            const chordName = KEY12_SHARP_LIST[(87 + 9 - i) % 12];\r\n            intervalListJSX.push(\r\n                <_Interval\r\n                    key={i}\r\n                >\r\n                    <_Num>{num}</_Num> <_SoundName>{chordName + octave}</_SoundName>\r\n                </_Interval>\r\n            );\r\n        }\r\n        return intervalListJSX;\r\n    }, []);\r\n    // console.log('intervalListJSX:' + intervalListJSX.length);\r\n    return (\r\n        <>\r\n            <_WrapInterval ref={intervalRef} onClick={() => {\r\n                setBarPos(barPos + 100);\r\n            }}>\r\n                {intervalListJSX}\r\n            </_WrapInterval>\r\n            <_WrapTimeLine>\r\n                <_Measure ref={measureRef}>\r\n\r\n                </_Measure>\r\n                <_BlockLine ref={BlocksRef}>\r\n                    {blockListJsx}\r\n                </_BlockLine>\r\n                <_TableWrap ref={tableRef} onScroll={() => {\r\n\r\n                    const scrollLeft = tableRef.current.scrollLeft;\r\n                    const scrollTop = tableRef.current.scrollTop;\r\n                    measureRef.current.scrollTo({ left: scrollLeft });\r\n                    BlocksRef.current.scrollTo({ left: scrollLeft });\r\n                    intervalRef.current.scrollTo({ top: scrollTop });\r\n                }}>\r\n                    <_Table width={limit} >\r\n                        {boxListJsx}\r\n                        <_Current pos={barPos} />\r\n                    </_Table>\r\n                </_TableWrap>\r\n            </_WrapTimeLine>\r\n            <_Button onClick={() => {\r\n                const taskList: NodeJS.Timeout[] = [];\r\n                if (!isPlay) {\r\n                    setPlay(true);\r\n                    dispatcher.preview.play();\r\n                    const progressValue = bpm * BEAT_WIDTH / 600;\r\n                    for (let i = 0; i < 900; i++) {\r\n                        const id = setTimeout(() => {\r\n                            setBarPos(progressValue * i);\r\n                            console.log('time: ' + barPos);\r\n                        }, i * 100);\r\n                        taskList.push(id);\r\n                    }\r\n                } else {\r\n                    setPlay(false);\r\n                    taskList.forEach((id) => {\r\n                        clearTimeout(id);\r\n                    });\r\n\r\n                    const threads = state.noteState.backingThreads;\r\n                    threads.forEach((thr) => {\r\n                        clearInterval(thr);\r\n                    });\r\n                    dispatcher.score.setNoteState({\r\n                        ...state.noteState,\r\n                        backingThreads: [], editMode: EditMode.NORMAL\r\n                    });\r\n                    state.sampler.releaseAll();\r\n                }\r\n            }}>{!isPlay ? 'Play' : 'Stop'}</_Button>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default ScoreContPreviewTab;\r\n\r\nconst _WrapInterval = styled.div`\r\n    display: inline-block;\r\n    background-color: #e7e7e7;\r\n    width: 80px;\r\n    height: calc(100% - 140px);\r\n    vertical-align: top;\r\n    margin-top: 100px;\r\n    overflow-y: hidden;\r\n`;\r\nconst _Interval = styled.div`\r\n    display: inline-block;\r\n    background-color: #205f99;\r\n    width: 100%;\r\n    height: ${NOTES_HEIGHT}px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    text-align: left;\r\n    border: solid 1px #0000003b;\r\n    padding-left: 5px;\r\n    box-sizing: border-box;\r\n`;\r\nconst _Num = styled.span`\r\n    color: #7a7a7a;\r\n`;\r\nconst _SoundName = styled.span`\r\n    color: #3740c0;\r\n`;\r\nconst _WrapTimeLine = styled.div`\r\n    display: inline-block;\r\n    background-color: black;\r\n    width: calc(100% - 80px);\r\n    height: calc(100% - 40px);\r\n    vertical-align: top;\r\n`;\r\nconst _Measure = styled.div`\r\n    display: inline-block;\r\n    background-color: #ffffffbe;\r\n    width: 100%;\r\n    height: 40px;\r\n`;\r\nconst _BlockLine = styled.div`\r\n    display: inline-block;\r\n    background-color: #9e6363a2;\r\n    width: 100%;\r\n    height: 60px;\r\n    position: relative;\r\n    overflow-x: hidden;\r\n`;\r\nconst _Block = styled.div<{\r\n    pos: number;\r\n    width: number;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    background-color: #0077ff67;\r\n    left: ${(props) => props.pos}px;\r\n    width: ${(props) => props.width}px;\r\n    height: 100%;\r\n    /* color: #002575d1; */\r\n    text-align: center;\r\n    border: solid 1px #0077ffd5;\r\n    opacity: ${(props) => props.isActive ? '1' : '0.5'};\r\n    & * {\r\n        display: inline-block;\r\n        width: 100%;\r\n        font-size: 25px;\r\n        font-weight: 600;\r\n    }\r\n`;\r\nconst _Sus = styled.span`\r\n    color: #ffffffd1;\r\n`;\r\nconst _ChordName = styled.span`\r\n    color: #002575d1;\r\n`;\r\n\r\n\r\nconst _TableWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - 100px);\r\n    overflow-x: auto;\r\n    overflow-y: auto;\r\n`;\r\n\r\nconst _Table = styled.div<{\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    background-color: #000000;\r\n    width: ${(props) => props.width}px;\r\n    /* height: 100%; */\r\n    text-align: left;\r\n    position: relative;\r\n    white-space: nowrap;\r\n`;\r\n\r\nconst _Box = styled.div<{\r\n    isActive: boolean;\r\n    pos: number;\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: ${props => props.pos}px;\r\n    background-color: #0000ff2d;\r\n    /* border-right: solid 3px #0004dfc1; */\r\n    box-sizing: border-box;\r\n    width: ${(props) => props.width}px;\r\n    height: ${NOTES_HEIGHT * 88}px;\r\n    opacity: ${(props) => props.isActive ? '1' : '0.5'};\r\n`;\r\n\r\nconst _Line = styled.div<{\r\n    soundIndex: number;\r\n}>`\r\n    display: table;\r\n    position: relative;\r\n    width: 100%;\r\n    height: ${NOTES_HEIGHT}px;\r\n    background-color: ${(props) => {\r\n        switch (props.soundIndex) {\r\n            case 0: return '#ffffff23';\r\n            case 1: return '#dadfe423';\r\n            case 2: return '#e9e9e923';\r\n            case 3: return '#dadfe423';\r\n            case 4: return '#e9e9e923';\r\n            case 5: return '#dfdfdf23';\r\n            case 6: return '#dadfe423';\r\n            case 7: return '#e9e9e923';\r\n            case 8: return '#dadfe423';\r\n            case 9: return '#e9e9e923';\r\n            case 10: return '#dadfe423';\r\n            case 11: return '#e9e9e923';\r\n        }\r\n        return '#a00';\r\n    }};\r\n    /* margin-bottom: 1px; */\r\n`;\r\nconst _Notes = styled.div<{\r\n    pos: number;\r\n    width: number;\r\n    layer: 'left' | 'right';\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: ${(props) => props.pos}px;\r\n    width: ${(props) => props.width}px;\r\n    height: 100%;\r\n    background-color: ${(props) => props.layer == 'left' ? '#e95500c8' : '#d6007dd3'};\r\n    ${(props) => props.isActive ? css`\r\n        background-color: #dddd00;\r\n        box-shadow: 2px 2px 25px 4px #ffe81b47;\r\n    ` : ''}\r\n    transition: background-color 200ms, box-shadow 1000ms;\r\n    border: solid 1px #666666;\r\n    box-sizing: border-box;\r\n    font-size: 8px;\r\n    font-weight: 600;\r\n    padding-left: 2px;\r\n    color: #ffffff;\r\n    border-radius: 2px;\r\n    /* &:hover {\r\n        background-color: #dddd00;\r\n        box-shadow: 2px 2px 15px 4px #ffe81b47;\r\n    } */\r\n`;\r\n\r\nconst _Current = styled.div<{\r\n    pos: number\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: ${(props) => props.pos}px;\r\n    width: 2px;\r\n    height: ${NOTES_HEIGHT * 88}px;\r\n    background-color: red;\r\n        box-shadow: 2px 2px 15px 4px #ff727290;\r\n    z-index: 99;\r\n`;\r\n\r\nconst _Button = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    padding: 0 10px 0 10px;\r\n    background-color: #808080;\r\n    min-width: 150px;\r\n    height: 35px;\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    line-height: 30px;\r\n    color: #4e4e4e;\r\n    text-align: center;\r\n    border: solid 1px #636363;\r\n    border-radius: 4px;\r\n    &:hover {\r\n        background-color: #afafaf;\r\n    }\r\n`","import './ScoreTab.css';\r\nimport React, { useState, useContext, useRef, useEffect } from 'react';\r\nimport TabbedPane from 'contents/common/TabbedPane';\r\n\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport ScoreContNoteTab from './contTabs/note/ScoreContNoteTab';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport ScoreContLiblaryTab from './contTabs/library/ScoreContLibraryTab';\r\nimport ScoreContThemaTab from './contTabs/thema/ScoreContThemaTab';\r\nimport ScoreContTuneTab from './contTabs/tune/ScoreContTuneTab';\r\nimport ScoreContPreviewTab from './contTabs/preview/ScoreContPreviewTab';\r\n\r\nconst ScoreTab = () => {\r\n\r\n    const { state, dispatch } = useContext(GlobalContext);\r\n\r\n    const isScoreEdit = state.noteData.dataList.length === 0;\r\n    return (\r\n        <div id=\"scoretab-root\">\r\n            <TabbedPane groupName=\"score-tabs\"\r\n                tabElements={[\r\n                    { name: 'Library', disable: false, cont: <ScoreContLiblaryTab /> },\r\n                    {\r\n                        name: 'Note', disable: isScoreEdit,\r\n                        cont: state.scoreTabIndex != 1 ? <></> : < ScoreContNoteTab />\r\n                    },\r\n                    { name: 'Tune', disable: isScoreEdit, cont: <ScoreContTuneTab /> },\r\n                    { name: 'Thema', disable: isScoreEdit, cont: <ScoreContThemaTab /> },\r\n                    { name: 'Sheet Music', disable: true, cont: <div></div> },\r\n                    { name: 'Preview', disable: isScoreEdit, cont: <ScoreContPreviewTab/> }\r\n                ]}\r\n                activeNo={state.scoreTabIndex}\r\n                selectTabIndex={(index: number) => dispatch(ActionType.SELECT_SCORETAB, { index: index })}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ScoreTab;","import { DIATONIC_MAJOR_SCALE_LIST, DIATONIC_MINOR_SCALE_LIST, KEY12_SHARP_LIST, SYMBOL_PARAMS_LIST } from \"contents/common/define\";\r\nimport { getSymbolParams } from \"contents/common/utils\";\r\nimport { Dispatcher } from \"contents/redux/dispatcher\";\r\nimport { ActionType } from \"contents/redux/reducer\";\r\nimport { BackingEditorState as BackingEditorState, BackingScript, BACKING_LEN_TYPE, BACKING_SIDE, ChordPaletteState, CHORD_MODE, DetailChange, DetailChord, DetailSection, EditMode, FloatWndState, NoteElement, Store, TypeNoteElement } from \"contents/redux/store\";\r\nimport { KeyboardEvent } from 'react';\r\nimport { keyboadNoteTabOperation } from \"./KeyboadNoteTabOperation\";\r\nimport { keyboadTuneTabOperation } from \"./KeyboadTuneTabOperation\";\r\n\r\n/**\r\n * 譜面編集時のキーボードショートカット\r\n * @param e キーボードイベント\r\n */\r\nexport const keyboardShortCutAction = (e: KeyboardEvent, state: Store, dispatch: Function, dispatcher: Dispatcher) => {\r\n\r\n    switch (state.scoreTabIndex) {\r\n        case 1: {\r\n            if (state.dialog.contents == null) {\r\n                keyboadNoteTabOperation(e, state, dispatch, dispatcher);\r\n            }\r\n            break;\r\n        }\r\n        case 2: {\r\n            if (state.dialog.contents == null) {\r\n                keyboadTuneTabOperation(e, state, dispatch, dispatcher);\r\n            }\r\n            break;\r\n        }\r\n    }\r\n};","import { Dispatcher } from \"contents/redux/dispatcher\";\r\nimport { BackingEditorState, BackingScript, BACKING_LEN_TYPE, ChordPaletteState, CHORD_MODE, DetailChange, DetailChord, DetailSection, EditMode, FloatWndState, Store, TypeNoteElement } from \"contents/redux/store\";\r\nimport { DIATONIC_MAJOR_SCALE_LIST, DIATONIC_MINOR_SCALE_LIST, KEY12_SHARP_LIST, SYMBOL_PARAMS_LIST } from \"contents/common/define\";\r\nimport { getSymbolParams } from \"contents/common/utils\";\r\nimport { ActionType } from \"contents/redux/reducer\";\r\nimport { KeyboardEvent } from 'react';\r\n\r\n/**\r\n * 譜面編集時のキーボードショートカット\r\n * @param e キーボードイベント\r\n */\r\nexport const keyboadNoteTabOperation = (e: KeyboardEvent, state: Store, dispatch: Function, dispatcher: Dispatcher) => {\r\n\r\n    const focusIndex = state.noteState.focusIndex;\r\n    const editMode = state.noteState.editMode;\r\n    const chordMode = state.noteData.chordMode;\r\n    const selectedData = state.noteData.dataList[focusIndex];\r\n    const selectedCache = state.noteState.cacheList[focusIndex];\r\n\r\n    switch (selectedData.type) {\r\n        case TypeNoteElement.Section: {\r\n            const detail = selectedData.detail as DetailSection;\r\n\r\n            switch (state.noteState.floatwndState) {\r\n                case FloatWndState.NONE: {\r\n\r\n                    if (editMode == EditMode.NORMAL) {\r\n                        switch (e.key) {\r\n                            case 'c': {\r\n                                dispatcher.score.callSectionEditor();\r\n                            }\r\n                                break;\r\n                        }\r\n                    }\r\n                }\r\n                    break;\r\n                case FloatWndState.SECTION_PALETTE: {\r\n                    switch (e.key) {\r\n                        case 'Escape':\r\n                        case 'c':\r\n                            dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                            break;\r\n                    }\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n            break;\r\n        case TypeNoteElement.Change: {\r\n            const detail = selectedData.detail as DetailChange;\r\n\r\n            switch (state.noteState.floatwndState) {\r\n                case FloatWndState.NONE: {\r\n\r\n                    if (editMode == EditMode.NORMAL) {\r\n                        switch (e.key) {\r\n                            case 'c': {\r\n                                dispatcher.score.callChangeEditor();\r\n                            }\r\n                                break;\r\n                        }\r\n                    }\r\n                }\r\n                    break;\r\n                case FloatWndState.CHANGE_PALETTE: {\r\n                    switch (e.key) {\r\n                        case 'Escape':\r\n                        case 'c':\r\n                            dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                            break;\r\n                    }\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n            break;\r\n        case TypeNoteElement.Chord: {\r\n            const detail = selectedData.detail as DetailChord;\r\n\r\n            switch (state.noteState.floatwndState) {\r\n                case FloatWndState.NONE: {\r\n\r\n                    if (editMode == EditMode.NORMAL) {\r\n                        switch (e.key) {\r\n                            case 'c': {\r\n                                dispatcher.score.callChordSelector();\r\n                            }\r\n                                break;\r\n                            case 'b': {\r\n                                if (detail.molecule != null) {\r\n                                    dispatcher.score.callBackingEditor();\r\n                                }\r\n                            }\r\n                                break;\r\n                            case 't': {\r\n                                dispatcher.score.callThemaAccessor();\r\n                            }\r\n                                break;\r\n                            case '1':\r\n                            case '2':\r\n                            case '3':\r\n                            case '4':\r\n                            case '5':\r\n                            case '6':\r\n                            case '7': {\r\n                                if (chordMode == CHORD_MODE.DIRECT) break;\r\n                                const scaleList = selectedCache.init.scale == 'major' ? DIATONIC_MAJOR_SCALE_LIST : DIATONIC_MINOR_SCALE_LIST;\r\n                                const diatonicChord = scaleList[Number(e.key) - 1];\r\n                                // dispatch(ActionType.SET_DEGREE_INDEX, { pos: focusIndex, degreeIndex: diatonicChord.degreeIndex });\r\n                                // dispatch(ActionType.SET_SYMBOL_KEY, { pos: focusIndex, symbolKey: diatonicChord.symbolKey });\r\n\r\n                                detail.molecule = { rootIndex: diatonicChord.degreeIndex, isFlat: diatonicChord.isFlat };\r\n                                const prevSymbolCategory = SYMBOL_PARAMS_LIST[detail.symbolKey].category;\r\n                                const newSymbolCategory = SYMBOL_PARAMS_LIST[diatonicChord.symbolKey].category;\r\n                                if (prevSymbolCategory !== newSymbolCategory) {\r\n                                    detail.backing.useChannels.length = 0;\r\n                                }\r\n                                detail.symbolKey = diatonicChord.symbolKey;\r\n                                dispatcher.score.setNoteData(state.noteData);\r\n                                dispatcher.score.apllyFlashCur();\r\n                            }\r\n                                break;\r\n                            case 'x': {\r\n                                dispatcher.score.setCriteria();\r\n                            }\r\n                                break;\r\n                            case 'q': {\r\n                                dispatcher.score.setCloneCriteria();\r\n                            }\r\n                                break;\r\n                            case 'z': {\r\n                            }\r\n                                break;\r\n                            case ' ': {\r\n                                dispatcher.backing.play(true);\r\n                            }\r\n                                break;\r\n                        }\r\n                    } else if (editMode == EditMode.TRANSPLANT) {\r\n\r\n                        switch (e.key) {\r\n                            case 'Escape':\r\n                            case 'x': {\r\n                                dispatcher.score.releaseCriteria();\r\n                            }\r\n                                break;\r\n                            case 'Enter': {\r\n                                const dataList = state.noteData.dataList;\r\n                                const baseBacking = (dataList[state.noteState.criteriaIndex].detail as DetailChord).backing;\r\n                                state.noteState.selectedList.forEach((index) => {\r\n                                    (dataList[index].detail as DetailChord).backing = JSON.parse(JSON.stringify(baseBacking));\r\n                                });\r\n                                dispatcher.score.setNoteData({ ...state.noteData, dataList });\r\n                                dispatcher.score.releaseCriteria();\r\n                                dispatcher.score.apllyFlashList();\r\n                            }\r\n                                break;\r\n                        }\r\n                    } else if (editMode == EditMode.CLONE) {\r\n\r\n                        switch (e.key) {\r\n                            case 'Escape':\r\n                            case 'q': {\r\n                                dispatcher.score.releaseCloneCriteria();\r\n                            }\r\n                                break;\r\n                            case 'Enter': {\r\n                                const dataList = state.noteData.dataList;\r\n                                const cloneDataList = state.noteState.cloneDataList;\r\n                                const cloneRange = state.noteState.cloneRange;\r\n                                const isReverse = cloneRange[0] > cloneRange[1];\r\n                                const start = cloneRange[isReverse ? 1 : 0];\r\n                                const end = cloneRange[isReverse ? 0 : 1];\r\n                                for (let i = start; i <= end; i++) {\r\n                                    //ディープコピー\r\n                                    cloneDataList.push(JSON.parse(JSON.stringify(dataList[i])));\r\n                                }\r\n                                dispatcher.score.setNoteState({ ...state.noteState, cloneDataList, editMode: EditMode.NORMAL });\r\n                            }\r\n                                break;\r\n                        }\r\n                    }\r\n                }\r\n                    break;\r\n                case FloatWndState.CHORD_PALETTE: {\r\n                    switch (e.key) {\r\n                        case 'Escape':\r\n                        case 'c':\r\n                            dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                            break;\r\n                        // case 'ArrowRight':\r\n                        //     dispatch(ActionType.SET_DEGREE_INDEX, { pos: focusIndex, degreeIndex: detail.molecule?.rootIndex + 1 });\r\n                        //     break;\r\n                        // case 'ArrowLeft':\r\n                        //     dispatch(ActionType.SET_DEGREE_INDEX, { pos: focusIndex, degreeIndex: detail.degreeIndex - 1 });\r\n                        //     break;\r\n                        // case '1':\r\n                        //     dispatch(ActionType.SET_DEGREE_INDEX, { pos: focusIndex, degreeIndex: detail.degreeIndex - 1 });\r\n                        //     break;\r\n                        case 'Enter': {\r\n                            dispatcher.chord.setCurChordParam();\r\n                        }\r\n                            break;\r\n                    }\r\n                }\r\n                    break;\r\n                case FloatWndState.BACKING_PALETTE: {\r\n                    const backing = state.noteState.backingPaletteState as BackingEditorState;\r\n                    const isCorrect = backing.isCorrect;\r\n                    switch (e.key) {\r\n                        case 'Escape':\r\n                        case 'b':\r\n                            if (editMode !== EditMode.PREVIEW) {\r\n                                dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n                            }\r\n                            break;\r\n                        case 'ArrowLeft': {\r\n                            if (!dispatcher.backing.isFirstCurLen()) {\r\n                                const cur = dispatcher.backing.getCurLenIndex();\r\n                                dispatcher.backing.updateLenIndex(cur - 1);\r\n                            }\r\n                        }\r\n                            break;\r\n                        case 'ArrowRight': {\r\n                            if (!dispatcher.backing.isLastCurLen()) {\r\n                                const cur = dispatcher.backing.getCurLenIndex();\r\n                                dispatcher.backing.updateLenIndex(cur + 1);\r\n                            }\r\n                        }\r\n                            break;\r\n                        case 'ArrowUp': {\r\n                            const curVolume = dispatcher.backing.getCurVelocity();\r\n                            if (curVolume < 10) {\r\n                                dispatcher.backing.updateCurVolume(curVolume + 1);\r\n                            }\r\n                        }\r\n                            break;\r\n                        case 'ArrowDown': {\r\n                            const curVolume = dispatcher.backing.getCurVelocity();\r\n                            if (curVolume > 1) {\r\n                                dispatcher.backing.updateCurVolume(curVolume - 1);\r\n                            }\r\n                        }\r\n                            break;\r\n                        case 'r': {\r\n                            dispatcher.backing.changeLayerIndex();\r\n                        }\r\n                            break;\r\n                        case '1': dispatcher.backing.setCurLen(BACKING_LEN_TYPE.LEN16); break;\r\n                        case '2': dispatcher.backing.setCurLen(BACKING_LEN_TYPE.LEN8); break;\r\n                        case '3': dispatcher.backing.setCurLen(BACKING_LEN_TYPE.LEN4); break;\r\n                        case '4': dispatcher.backing.setCurLen(BACKING_LEN_TYPE.LEN2); break;\r\n                        case '5': dispatcher.backing.setCurLen(BACKING_LEN_TYPE.LEN1); break;\r\n                        case '.': {\r\n                            if (dispatcher.backing.isAcceptHalf()) {\r\n                                const curLenBean = dispatcher.backing.getCurLenBean();\r\n                                curLenBean.isHalf = !curLenBean.isHalf;\r\n                                curLenBean.isDiv3 = false;\r\n                                dispatcher.backing.setCurrentLenBean(curLenBean);\r\n                            }\r\n                        }\r\n                            break;\r\n                        case '/': {\r\n                            if (dispatcher.backing.isAcceptDiv3()) {\r\n                                const curLenBean = dispatcher.backing.getCurLenBean();\r\n                                curLenBean.isDiv3 = !curLenBean.isDiv3;\r\n                                curLenBean.isHalf = false;\r\n                                dispatcher.backing.setCurrentLenBean(curLenBean);\r\n                            }\r\n                        }\r\n                            break;\r\n                        case 'a': {\r\n                            dispatcher.backing.addLen();\r\n                        }\r\n                            break;\r\n                        case 'Delete': {\r\n                            if (dispatcher.backing.getSideScript().lens.length > 1) {\r\n                                dispatcher.backing.delLen();\r\n                            }\r\n                        }\r\n                            break;\r\n\r\n                        case ' ': {\r\n                            if (isCorrect) {\r\n                                if (editMode !== EditMode.PREVIEW) {\r\n                                    dispatcher.backing.play(false);\r\n                                } else {\r\n                                    dispatcher.preview.stop();\r\n                                }\r\n                            }\r\n                        }\r\n                            break;\r\n                        // 設定を反映\r\n                        case 'Enter': {\r\n                            if (isCorrect) {\r\n                                dispatcher.backing.setCurBackingScript();\r\n                            }\r\n                        }\r\n                            break;\r\n                        // JSON取得（開発用）\r\n                        case 'z': {\r\n                            const script: BackingScript = {\r\n                                isUsePedal: backing.isUsePedal,\r\n                                layers: backing.layers,\r\n                                useChannels: backing.useChannels\r\n                            };\r\n                            alert(JSON.stringify(script));\r\n                        }\r\n                            break;\r\n                    }\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n            break;\r\n    }\r\n\r\n    if (state.noteState.floatwndState == FloatWndState.NONE &&\r\n        [TypeNoteElement.Chord, TypeNoteElement.Section, TypeNoteElement.Change].includes(selectedData.type)) {\r\n        if (editMode == EditMode.NORMAL) {\r\n            switch (e.key) {\r\n                case 'ArrowLeft': {\r\n                    dispatcher.score.focusPreviousElement();\r\n                }\r\n                    break;\r\n                case 'ArrowRight': {\r\n                    dispatcher.score.focusNextElement();\r\n                }\r\n                    break;\r\n                case 'ArrowUp': {\r\n                    dispatcher.score.focusPreviousSection();\r\n                }\r\n                    break;\r\n                case 'ArrowDown': {\r\n                    dispatcher.score.focusNextSection();\r\n                }\r\n                    break;\r\n                case 'Delete': {\r\n                    dispatcher.score.deleteCurElement();\r\n                }\r\n                    break;\r\n                case 'i': {\r\n                    dispatcher.score.focusInitElement();\r\n                }\r\n                    break;\r\n                case 'a':\r\n                    dispatcher.score.addChordElement();\r\n                    break;\r\n                case 's':\r\n                    dispatcher.score.addSectionElement();\r\n                    break;\r\n                case 'f':\r\n                    dispatcher.score.addChangeElement();\r\n                    break;\r\n                case 'v': {\r\n                    console.log(state.noteState.cloneDataList);\r\n                    dispatcher.score.insertCloneData();\r\n                }\r\n                    break;\r\n                case 'w': {\r\n                    dispatcher.score.addChordElement();\r\n                    dispatch(ActionType.SELECT_NOTE_ELEMENT, { index: state.noteState.focusIndex + 1 });\r\n                    dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.CHORD_PALETTE });\r\n                    dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                        params: {\r\n                            ...state.noteState.chordPaletteState,\r\n                            isAddition: true,\r\n                            molecule: { rootIndex: 0, isFlat: false },\r\n                            denominator: null,\r\n                            symbolKey: SYMBOL_PARAMS_LIST[0].key,\r\n                            sustain: state.noteState.defaultSustain,\r\n                        } as ChordPaletteState\r\n                    });\r\n                }\r\n                    break;\r\n            }\r\n        } else if (editMode == EditMode.PREVIEW) {\r\n\r\n            switch (e.key) {\r\n                case ' ': {\r\n                    dispatcher.preview.stop();\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}","import { Dispatcher } from \"contents/redux/dispatcher\";\r\nimport { BackingEditorState, BackingScript, BACKING_LEN_TYPE, ChordPaletteState, CHORD_MODE, DetailChange, DetailChord, DetailSection, EditMode, FloatWndState, Store, TypeNoteElement } from \"contents/redux/store\";\r\nimport { DIATONIC_MAJOR_SCALE_LIST, DIATONIC_MINOR_SCALE_LIST, KEY12_SHARP_LIST, SYMBOL_PARAMS_LIST } from \"contents/common/define\";\r\nimport { getSymbolParams } from \"contents/common/utils\";\r\nimport { ActionType } from \"contents/redux/reducer\";\r\nimport { KeyboardEvent } from 'react';\r\nimport { TuneDispatcher } from \"contents/redux/store/FormDispatcher\";\r\nimport { Player } from \"soundfont-player\";\r\n\r\n/**\r\n * 譜面編集時のキーボードショートカット\r\n * @param e キーボードイベント\r\n */\r\nexport const keyboadTuneTabOperation = (e: KeyboardEvent, state: Store, dispatch: Function, dispatcher: Dispatcher) => {\r\n\r\n    // const action = state.formDispatcher.tune as TuneDispatcher;\r\n    const tuneState = state.tuneState;\r\n    const columnList = state.noteData.columnList;\r\n    const curCache = tuneState.cacheList[tuneState.columnIndex];\r\n    const curColumn = columnList[tuneState.columnIndex];\r\n    const applyState = () => dispatcher.tune.setState({ ...tuneState });\r\n    const applyColumn = () => dispatcher.tune.setColumnList(columnList.slice());\r\n\r\n    const getSoundName = () => {\r\n        const octave = Math.floor((87 + 9 - curColumn.soundIndex) / 12);\r\n        const keyIndex = (87 + 9 - curColumn.soundIndex) % 12;\r\n        const chordName = KEY12_SHARP_LIST[keyIndex];\r\n        return chordName + octave;\r\n    }\r\n\r\n    switch (e.key) {\r\n        case '1': {\r\n            tuneState.usingLen = 16;\r\n            applyState();\r\n        }\r\n            break;\r\n        case '2': {\r\n            tuneState.usingLen = 8;\r\n            applyState();\r\n        }\r\n            break;\r\n        case '3': {\r\n            tuneState.usingLen = 4;\r\n            applyState();\r\n        }\r\n            break;\r\n        case '/': {\r\n            tuneState.isDiv3 = !tuneState.isDiv3;\r\n            applyState();\r\n        }\r\n            break;\r\n        case ' ': {\r\n            if (!tuneState.isPreview) {\r\n                dispatcher.tune.playPreview();\r\n                tuneState.isPreview = true;\r\n                applyState();\r\n            } else {\r\n                dispatcher.tune.stopPreview();\r\n                tuneState.isPreview = false;\r\n                applyState();\r\n            }\r\n        }\r\n            break;\r\n        case 'w': {\r\n            dispatcher.tune.adjustScrollX(tuneState.columnIndex);\r\n        }\r\n            break;\r\n    }\r\n    if (!tuneState.isEdit) {\r\n        switch (e.key) {\r\n            case 'ArrowLeft': {\r\n                if (tuneState.columnIndex > 0) {\r\n                    tuneState.columnIndex = tuneState.columnIndex -= 1;\r\n                    applyState();\r\n                    if (tuneState.isAutoScroll) {\r\n                        dispatcher.tune.adjustScrollX(tuneState.columnIndex);\r\n                        // dispatcher.tune.adjustScrollY(tuneState.columnIndex);\r\n                    }\r\n                }\r\n            }\r\n                break;\r\n            case 'ArrowRight': {\r\n                if (tuneState.columnIndex < columnList.length - 1) {\r\n                    tuneState.columnIndex = tuneState.columnIndex += 1;\r\n                    applyState();\r\n                    if (tuneState.isAutoScroll) {\r\n                        dispatcher.tune.adjustScrollX(tuneState.columnIndex);\r\n                        // dispatcher.tune.adjustScrollY(tuneState.columnIndex);\r\n                    }\r\n                }\r\n            }\r\n                break;\r\n            case 'Enter': {\r\n                tuneState.isEdit = true;\r\n                applyState();\r\n            }\r\n                break;\r\n            case 'a': {\r\n                dispatcher.tune.addColumn();\r\n            }\r\n                break;\r\n            case 'Delete': {\r\n                dispatcher.tune.remooveCur();\r\n            }\r\n                break;\r\n        }\r\n    } else {\r\n        switch (e.key) {\r\n            case 'ArrowUp': {\r\n                let newIndex = curColumn.soundIndex;\r\n                if (curColumn.soundIndex == -1) {\r\n                    if (tuneState.columnIndex > 0) {\r\n                        const prevSoundIndex = columnList[tuneState.columnIndex - 1].soundIndex;\r\n                        if (prevSoundIndex !== -1) curColumn.soundIndex = prevSoundIndex;\r\n                    } else {\r\n                        curColumn.soundIndex = 44;\r\n                    }\r\n                } else if (curColumn.soundIndex > 0) {\r\n                    do {\r\n                        newIndex -= 1;\r\n                        const isAccept = [0, 2, 4, 5, 7, 9, 11].includes((curCache.baseKey + newIndex + 4) % 12);\r\n                        if (isAccept) {\r\n                            curColumn.soundIndex = newIndex;\r\n                            break;\r\n                        }\r\n                    } while (newIndex > 0);\r\n                }\r\n                if (tuneState.isAutoScroll) {\r\n                    dispatcher.tune.adjustScrollY(tuneState.columnIndex);\r\n                }\r\n                applyColumn();\r\n                dispatcher.tune.playSoundFont(getSoundName(), 0.5);\r\n            }\r\n                break;\r\n            case 'ArrowDown': {\r\n                let newIndex = curColumn.soundIndex;\r\n                if (curColumn.soundIndex == -1) {\r\n                    if (tuneState.columnIndex > 0) {\r\n                        const prevSoundIndex = columnList[tuneState.columnIndex - 1].soundIndex;\r\n                        if (prevSoundIndex !== -1) curColumn.soundIndex = prevSoundIndex;\r\n                    } else {\r\n                        curColumn.soundIndex = 44;\r\n                    }\r\n                } else if (curColumn.soundIndex < 87) {\r\n                    do {\r\n                        newIndex += 1;\r\n                        const isAccept = [0, 2, 4, 5, 7, 9, 11].includes((curCache.baseKey + newIndex + 4) % 12);\r\n                        if (isAccept) {\r\n                            curColumn.soundIndex = newIndex;\r\n                            break;\r\n                        }\r\n                    } while (newIndex < 87);\r\n                }\r\n                if (tuneState.isAutoScroll) {\r\n                    dispatcher.tune.adjustScrollY(tuneState.columnIndex);\r\n                }\r\n                applyColumn();\r\n                dispatcher.tune.playSoundFont(getSoundName(), 0.5);\r\n            }\r\n                break;\r\n            case 'ArrowLeft': {\r\n                dispatcher.tune.adjustWidth(false);\r\n            }\r\n                break;\r\n            case 'ArrowRight': {\r\n                dispatcher.tune.adjustWidth(true);\r\n            }\r\n                break;\r\n            case 'Enter': {\r\n                tuneState.isEdit = false;\r\n                applyState();\r\n            }\r\n                break;\r\n            case 'Delete': {\r\n                curColumn.soundIndex = -1;\r\n                applyColumn();\r\n            }\r\n                break;\r\n            case 'a': {\r\n                dispatcher.tune.addColumn();\r\n                tuneState.columnIndex = tuneState.columnIndex += 1;\r\n                applyState();\r\n            }\r\n                break;\r\n        }\r\n\r\n    }\r\n}","import { BEAT_WIDTH, KEY12_SHARP_LIST, SymbolKey, SymbolParams, SymbolType, SYMBOL_PARAMS_LIST, TimeSignatures } from \"contents/common/define\";\r\nimport { applyOnChord, getSymbolParams, loadSampler } from \"contents/common/utils\";\r\nimport { ActionType } from \"./reducer\";\r\nimport { Action, BackingLen, BackingEditorState, BackingLayer, BACKING_LEN_TYPE, BACKING_SIDE, ChannelParam, DetailInit, NoteData, Store, TypeNoteElement, NoteState, NoteElement, FloatWndState, DetailChord, BackingScript, DetailSection, EditMode, ScoreCache, DetailChange, DetailFixed, LoginParams, ChordPaletteState, ChangeType, ModulateRelation, Key12Info, TempoRelation, ThemaIndexedElement, ThemaDataTree, ThemaState, BackingPattern, BackingVoicing, BTPattern, BTVoicing, BTSustain, VoicingTargetType, VoicingTargetCondition, Dialog, Column, SoundFontProp } from \"./store\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { FormDispatcher } from \"./store/FormDispatcher\";\r\nimport { TuneState } from \"./store/TuneState\";\r\n\r\n/**\r\n * ビジネスロジックからステートを更新するためのクラス。\r\n *\r\n * @export\r\n * @class Dispatcher\r\n */\r\nexport class Dispatcher {\r\n\r\n    private dispatchBase: React.Dispatch<Action>;\r\n    private dispatch: Function;\r\n    private state: Store;\r\n\r\n    /**\r\n     *Creates an instance of Dispatcher.\r\n     * @param {Store} state\r\n     * @param {React.Dispatch<Action>} dispatchBase\r\n     * @memberof Dispatcher\r\n     */\r\n    constructor(state: Store, dispatchBase: React.Dispatch<Action>) {\r\n        this.dispatchBase = dispatchBase;\r\n        this.state = state;\r\n        this.dispatch = (type: ActionType, payload: any) => dispatchBase({ type, payload });\r\n    }\r\n\r\n    public setLoginParams = (login: LoginParams) => {\r\n        this.dispatch(ActionType.SET_LOGIN, { login });\r\n    }\r\n\r\n    public callDialog = (left: number, top: number, contents: JSX.Element, arg?: object) => {\r\n        const dialog: Dialog = { left, top, contents, arg };\r\n        this.dispatch(ActionType.SET_DIALOG, { dialog });\r\n    }\r\n\r\n    public closeDialog = () => {\r\n        this.dispatch(ActionType.SET_DIALOG, { dialog: { ...this.state.dialog, contents: null } });\r\n    }\r\n\r\n    public setDinamicCache = (dinamicCache: null | object) => {\r\n        this.dispatch(ActionType.DINAMIC_CACHE, { dinamicCache });\r\n    }\r\n    public setFormDispatcher = (formDispatcher: FormDispatcher) => {\r\n        this.dispatch(ActionType.SET_FORM_DISPATCHER, { formDispatcher });\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param noteData \r\n     */\r\n    public setNoteData = (data: null | NoteData) => {\r\n        this.dispatchBase({ type: ActionType.SET_NOTE_DATA, payload: { data } });\r\n    }\r\n    public initBackingPalette = (backingPaletteState: BackingEditorState) => {\r\n        this.dispatchBase({ type: ActionType.INIT_BACKING_PALETTE, payload: { backingPaletteState } });\r\n    }\r\n\r\n    public setUseChannels = (useChannels: ChannelParam[]) => {\r\n        this.dispatchBase({ type: ActionType.SET_USE_CHANNELS, payload: { useChannels } });\r\n    }\r\n\r\n    public setSampler = (sample: object) => {\r\n        const sampler = loadSampler(sample);\r\n        this.dispatchBase({ type: ActionType.SET_SAMPLER, payload: { sampler } });\r\n    }\r\n    public setInstruments = (instrument: null | Soundfont.Player) => {\r\n        this.dispatchBase({ type: ActionType.SET_INSTRUMENT, payload: { instrument } });\r\n    }\r\n\r\n    public score = {\r\n\r\n        apllyFlasah: (index: number) => {\r\n            const reffer = this.state.noteState.cacheList[index].reffer as HTMLDivElement;\r\n            reffer.style.backgroundColor = '#ff0';\r\n            setTimeout(() => {\r\n                reffer.style.backgroundColor = '';\r\n                // reffer.style.width = 'inherit';\r\n            }, 350);\r\n        },\r\n        apllyFlashCur: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            this.score.apllyFlasah(focusIndex);\r\n        },\r\n        apllyFlashList: () => {\r\n            this.state.noteState.selectedList.forEach((index) => {\r\n                this.score.apllyFlasah(index);\r\n            });\r\n        },\r\n\r\n        setNoteState: (noteState: NoteState) => {\r\n            this.dispatch(ActionType.SET_NOTE_STATE, { noteState });\r\n        },\r\n        setCriteria: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                criteriaIndex: focusIndex, editMode: EditMode.TRANSPLANT\r\n            });\r\n        },\r\n        setCloneCriteria: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                cloneRange: [focusIndex, focusIndex], editMode: EditMode.CLONE, cloneDataList: []\r\n            });\r\n        },\r\n        setCloneRange: (index: number) => {\r\n            const cloneRange = this.state.noteState.cloneRange;\r\n            cloneRange[1] = index;\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                cloneRange\r\n            });\r\n        },\r\n        insertCloneData: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const dataList = this.state.noteData.dataList;\r\n            const cloneDataList = this.state.noteState.cloneDataList;\r\n            const cacheList = this.state.noteState.cacheList.slice();\r\n            cloneDataList.forEach((cloneData, i) => {\r\n                dataList.splice(focusIndex + 1 + i, 0, cloneData);\r\n                // cacheList.splice(focusIndex + 1, i, {} as ScoreCache);\r\n            });\r\n            this.score.setNoteData({\r\n                ...this.state.noteData,\r\n                dataList\r\n            });\r\n            // for(let i = focusIndex + 1; i < focusIndex + 1 + cloneDataList.length; i ++) {\r\n            //     this.score.apllyFlasah(i);\r\n            // }\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                cloneDataList: []\r\n            });\r\n        },\r\n        releaseCriteria: () => {\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                criteriaIndex: -1, editMode: EditMode.NORMAL, selectedList: []\r\n            });\r\n        },\r\n        releaseCloneCriteria: () => {\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                cloneRange: [], editMode: EditMode.NORMAL\r\n            });\r\n        },\r\n        setNoteData: (data: NoteData) => {\r\n            this.dispatch(ActionType.SET_NOTE_DATA, { data });\r\n        },\r\n        /**\r\n         * 初期値の要素を返す。\r\n         */\r\n        getInitElement: (): DetailInit => {\r\n            return this.state.noteData.dataList[0].detail as DetailInit;\r\n        },\r\n        setEditMode: (editMode: EditMode) => {\r\n            this.score.setNoteState({ ...this.state.noteState, editMode });\r\n        },\r\n\r\n        addNoteElement: (type: TypeNoteElement, detail: DetailSection | DetailChord | DetailChange) => {\r\n            const curIndex = this.state.noteState.focusIndex;\r\n            const dataList = this.state.noteData.dataList.slice();\r\n            dataList.splice(curIndex + 1, 0, { type, detail });\r\n            this.dispatch(ActionType.SET_DATA_LIST, { dataList });\r\n            const cacheList = this.state.noteState.cacheList.slice();\r\n            cacheList.splice(curIndex + 1, 0, {} as ScoreCache);\r\n            this.score.apllyFlasah(curIndex + 1);\r\n        },\r\n\r\n        addSectionElement: () => {\r\n            const curIndex = this.state.noteState.focusIndex;\r\n            const dataList = this.state.noteData.dataList.slice();\r\n            const detail = {} as DetailSection;\r\n            detail.labelName = 'Section';\r\n            dataList.splice(curIndex + 1, 0, {\r\n                type: TypeNoteElement.Section,\r\n                detail: detail\r\n            });\r\n            this.dispatch(ActionType.SET_DATA_LIST, { dataList });\r\n            const cacheList = this.state.noteState.cacheList.slice();\r\n            cacheList.splice(curIndex + 1, 0, {} as ScoreCache);\r\n            this.score.apllyFlasah(curIndex + 1);\r\n        },\r\n        addChangeElement: () => {\r\n            // const detail = { type: ChangeType.NONE } as DetailChange;\r\n            // const mod:ChangeModulation = {\r\n            //     relation: ModulateRelation.DOMINANT,\r\n            //     value: 0,\r\n            // }\r\n            const detail = {\r\n                changeType: null,\r\n                modulateRelation: null,\r\n                domminantValue: 0,\r\n                keyAdjust: 0,\r\n                tempoRelation: null,\r\n                tempoDiff: 0,\r\n                tempoRate: 0,\r\n                tempoAbsolute: 0,\r\n                beat: null\r\n            } as DetailChange;\r\n            this.score.addNoteElement(TypeNoteElement.Change, detail);\r\n        },\r\n        addChordElement: () => {\r\n            const noteState = this.state.noteState;\r\n            const curIndex = noteState.focusIndex;\r\n            const dataList = this.state.noteData.dataList.slice();\r\n            dataList.splice(curIndex + 1, 0, {\r\n                type: TypeNoteElement.Chord,\r\n                detail: {\r\n                    // degreeIndex: -1,\r\n                    // isFlat: false,\r\n                    molecule: null,\r\n                    denominator: null,\r\n                    symbolKey: SymbolKey.MAJOR,\r\n                    sustain: noteState.defaultSustain,\r\n                    headAdjust: 0,\r\n                    tailAdjust: 0,\r\n                    backing: {\r\n                        useChannels: [],\r\n                        layers: [\r\n                            {\r\n                                lens: [{\r\n                                    len: BACKING_LEN_TYPE.LEN4,\r\n                                    isDiv3: false,\r\n                                    isHalf: false\r\n                                }],\r\n                                side: BACKING_SIDE.LEFT,\r\n                                table: [[[false]]],\r\n                                vels: [5]\r\n                            },\r\n                            {\r\n                                lens: [{\r\n                                    len: BACKING_LEN_TYPE.LEN4,\r\n                                    isDiv3: false,\r\n                                    isHalf: false\r\n                                }],\r\n                                side: BACKING_SIDE.RIGHT,\r\n                                table: [[[false]]],\r\n                                vels: [5]\r\n                            }\r\n                        ],\r\n                        isUsePedal: false\r\n                    }\r\n                }\r\n            });\r\n            this.dispatch(ActionType.SET_DATA_LIST, { dataList });\r\n\r\n            const cacheList = this.state.noteState.cacheList.slice();\r\n            cacheList.splice(curIndex + 1, 0, {} as ScoreCache);\r\n            this.score.apllyFlasah(curIndex + 1);\r\n        },\r\n        deleteElement: (index: number) => {\r\n            const curIndex = this.state.noteState.focusIndex;\r\n            const curElement = this.state.noteData.dataList[index];\r\n            if (\r\n                // 対象の要素がコードorセクションである\r\n                [TypeNoteElement.Chord, TypeNoteElement.Section, TypeNoteElement.Change].includes(curElement.type) &&\r\n                // 先頭のセクションは削除できない\r\n                index != 2\r\n            ) {\r\n                const dataList: NoteElement[] = this.state.noteData.dataList.slice();\r\n                dataList.splice(index, 1);\r\n                this.dispatch(ActionType.SET_DATA_LIST, { dataList });\r\n                if (index <= curIndex) {\r\n                    this.state.noteState.focusIndex--;\r\n                    this.dispatch(ActionType.SET_NOTE_STATE, { noteState: this.state.noteState });\r\n                }\r\n            }\r\n        },\r\n        deleteCurElement: () => {\r\n            const curIndex = this.state.noteState.focusIndex;\r\n            this.score.deleteElement(curIndex);\r\n            // const box = this.state.noteData.dataList[curIndex];\r\n            // const ref = box.reffer as HTMLDivElement;\r\n            // // ref.style.width = '0';\r\n            // ref.style.opacity = '0';\r\n            // setTimeout(() => {\r\n            //     this.score.deleteElement(curIndex);\r\n            // }, 1);\r\n        },\r\n        focusPreviousElement: (): boolean => {\r\n            const curIndex = this.state.noteState.focusIndex;\r\n            const prev = this.state.noteData.dataList[curIndex - 1];\r\n            if (prev.type != TypeNoteElement.Fixed) {\r\n                this.state.noteState.focusIndex--;\r\n                this.dispatch(ActionType.SET_NOTE_STATE, { noteState: this.state.noteState });\r\n                return true;\r\n            }\r\n            return false;\r\n        },\r\n\r\n        focusNextElement: (): boolean => {\r\n            const curIndex = this.state.noteState.focusIndex;\r\n            const next = this.state.noteData.dataList[curIndex + 1];\r\n            if (next.type != TypeNoteElement.Fixed) {\r\n                // this.state.noteState.focusIndex++;\r\n                const focusIndex = curIndex + 1;\r\n                // this.dispatch(ActionType.SET_NOTE_STATE, { noteState: this.state.noteState });\r\n                this.score.setNoteState({ ...this.state.noteState, focusIndex });\r\n                return true;\r\n            }\r\n            return false;\r\n        },\r\n\r\n        focusPreviousSection: () => {\r\n            const dataList = this.state.noteData.dataList;\r\n            let curIndex = this.state.noteState.focusIndex;\r\n            do {\r\n                curIndex--;\r\n                if (dataList[curIndex].type == TypeNoteElement.Section) {\r\n                    this.state.noteState.focusIndex = curIndex;\r\n                    this.dispatch(ActionType.SET_NOTE_STATE, { noteState: this.state.noteState });\r\n                    break;\r\n                }\r\n            } while (curIndex > 0);\r\n        },\r\n\r\n        focusNextSection: () => {\r\n            const dataList = this.state.noteData.dataList;\r\n            let curIndex = this.state.noteState.focusIndex;\r\n            do {\r\n                curIndex++;\r\n                if (dataList[curIndex].type == TypeNoteElement.Section || curIndex == dataList.length - 2) {\r\n                    this.state.noteState.focusIndex = curIndex;\r\n                    this.dispatch(ActionType.SET_NOTE_STATE, { noteState: this.state.noteState });\r\n                    break;\r\n                }\r\n            } while (curIndex < dataList.length - 1);\r\n        },\r\n\r\n        focusInitElement: () => {\r\n            this.state.noteState.focusIndex = 0;\r\n            this.dispatch(ActionType.SET_NOTE_STATE, { noteState: this.state.noteState });\r\n        },\r\n\r\n        setSelectedList: (selectedList: number[]) => {\r\n            this.dispatch(ActionType.SET_NOTE_STATE, {\r\n                noteState: { ...this.state.noteState, selectedList }\r\n            });\r\n        },\r\n\r\n        callChordSelector: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const detail = this.state.noteData.dataList[focusIndex].detail as DetailChord;\r\n            // let degreeIndex = detail.degreeIndex;\r\n            // if (degreeIndex == -1) {\r\n            //     degreeIndex = 0;\r\n            // }\r\n            let molecule = detail.molecule;\r\n            if (molecule == null) {\r\n                molecule = { rootIndex: 0, isFlat: false };\r\n            }\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.CHORD_PALETTE });\r\n            this.dispatch(ActionType.CHORD_PALETTE_SETTER, {\r\n                params: {\r\n                    ...this.state.noteState.chordPaletteState,\r\n                    // rootIndex: degreeIndex,\r\n                    // isFlat: detail.isFlat,\r\n                    molecule,\r\n                    denominator: detail.denominator,\r\n                    symbolKey: detail.symbolKey,\r\n                    sustain: detail.sustain,\r\n                    headAdjust: detail.headAdjust,\r\n                    tailAdjust: detail.tailAdjust,\r\n                } as ChordPaletteState\r\n            });\r\n        },\r\n\r\n        callSectionEditor: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const detail = this.state.noteData.dataList[focusIndex].detail as DetailSection;\r\n            this.setDinamicCache(detail);\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.SECTION_PALETTE });\r\n        },\r\n\r\n        callChangeEditor: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const detail = this.state.noteData.dataList[focusIndex].detail as DetailChange;\r\n            this.setDinamicCache(detail);\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.CHANGE_PALETTE });\r\n        },\r\n\r\n        callBackingEditor: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const detail = this.state.noteData.dataList[focusIndex].detail as DetailChord;\r\n            const init = this.state.noteState.cacheList[focusIndex].init;\r\n            const backing = detail.backing;\r\n            const molecule = detail.molecule as Key12Info;\r\n            const backingState: BackingEditorState = {\r\n                target: \"note\",\r\n                isEditPattern: true,\r\n                isDispVoicing: true,\r\n                molecule: { rootIndex: molecule.rootIndex + init.keyIndex, isFlat: molecule.isFlat },\r\n                denominator: detail.denominator,\r\n                symbolKey: detail.symbolKey,\r\n                sustain: detail.sustain,\r\n                headAdjust: detail.headAdjust,\r\n                tailAdjust: detail.tailAdjust,\r\n                channelRowSize: backing.layers[0].table.length,\r\n                useChannels: JSON.parse(JSON.stringify(backing.useChannels)),\r\n                isUsePedal: backing.isUsePedal,\r\n                sideIndex: 0,\r\n                selectedLenIndex: 0,\r\n                selectedChannelIndex: -1,\r\n                layers: JSON.parse(JSON.stringify(backing.layers)),\r\n                isCorrect: true\r\n            };\r\n            this.initBackingPalette(backingState);\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.BACKING_PALETTE });\r\n        },\r\n\r\n        callThemaAccessor: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const detail = this.state.noteData.dataList[focusIndex].detail as DetailChord;\r\n            this.setDinamicCache(detail);\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.THEMA_ACCESSOR });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 初期値エディタ画面の操作に関連するメソッドを定義するオブジェクト。\r\n     *\r\n     * @memberof Dispatcher\r\n     */\r\n    public init = {\r\n        setInitParam: (tempo: number, rythm: string, keyIndex: number, scale: string) => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            // const detail = this.state.noteData.dataList[focusIndex].detail as DetailInit;\r\n            // const editorState = this.state.noteState.chordPaletteState;\r\n            this.dispatch(ActionType.DETAIL_PARAMS_SETTER, {\r\n                pos: focusIndex,\r\n                params: {\r\n                    tempo, rythm, keyIndex, scale\r\n                }\r\n            });\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            this.score.apllyFlashCur();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * セクションエディタ画面の操作に関連するメソッドを定義するオブジェクト。\r\n     *\r\n     * @memberof Dispatcher\r\n     */\r\n    public section = {\r\n        setSectionParam: (labelName: string) => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            this.dispatch(ActionType.DETAIL_PARAMS_SETTER, {\r\n                pos: focusIndex,\r\n                params: {\r\n                    labelName\r\n                }\r\n            });\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            this.score.apllyFlashCur();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * チェンジエディタ画面の操作に関連するメソッドを定義するオブジェクト。\r\n     *\r\n     * @memberof Dispatcher\r\n     */\r\n    public change = {\r\n        applyChangeParams: (changeType: ChangeType, modulateRelation: null | ModulateRelation, domminantValue: number, keyAdjust: number,\r\n            tempoRelation: null | TempoRelation, tempoDiff: number, tempoRate: number, tempoAbsolute: number, beat: null | TimeSignatures) => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            this.dispatch(ActionType.DETAIL_PARAMS_SETTER, {\r\n                pos: focusIndex,\r\n                params: {\r\n                    changeType,\r\n                    modulateRelation,\r\n                    domminantValue,\r\n                    keyAdjust,\r\n                    tempoRelation,\r\n                    tempoDiff,\r\n                    tempoRate,\r\n                    tempoAbsolute,\r\n                    beat\r\n                }\r\n            });\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            this.score.apllyFlashCur();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * コードエディタ画面の操作に関連するメソッドを定義するオブジェクト。\r\n     *\r\n     * @memberof Dispatcher\r\n     */\r\n    public chord = {\r\n        setCurChordParam: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const chordDetail = this.state.noteData.dataList[focusIndex].detail as DetailChord;\r\n            const editorState = this.state.noteState.chordPaletteState;\r\n            this.dispatch(ActionType.DETAIL_PARAMS_SETTER, {\r\n                pos: focusIndex,\r\n                params: {\r\n                    ...chordDetail,\r\n                    // degreeIndex: editorState.rootIndex,\r\n                    // isFlat: editorState.isFlat,\r\n                    molecule: editorState.molecule,\r\n                    denominator: editorState.denominator,\r\n                    symbolKey: editorState.symbolKey,\r\n                    sustain: editorState.sustain,\r\n                    headAdjust: editorState.headAdjust,\r\n                    tailAdjust: editorState.tailAdjust,\r\n                } as DetailChord\r\n            });\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            this.score.apllyFlashCur();\r\n            // const reffer = this.state.noteData.dataList[focusIndex].reffer as HTMLDivElement;\r\n            // reffer.style.backgroundColor = '#ff0';\r\n            // setTimeout(() => {\r\n            //     reffer.style.backgroundColor = '';\r\n            // }, 350);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * バッキングエディタ画面の操作に関連するメソッドを定義するオブジェクト。\r\n     *\r\n     * @memberof Dispatcher\r\n     */\r\n    public backing = {\r\n        setPaletteState: (paletteState: BackingEditorState) => {\r\n            const backing = this.state.noteState.backingPaletteState;\r\n            this.score.setNoteState({ ...this.state.noteState, backingPaletteState: backing });\r\n        },\r\n        toggleMatrix: (channelIndex: number, lenIndex: number, divIndex: number) => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const sideIndex = backing.sideIndex;\r\n            const isUse = !backing.layers[sideIndex].table[channelIndex][lenIndex][divIndex];\r\n            this.dispatch(ActionType.BACKING_TOGGLE_MATRIX, { sideIndex, channelIndex, lenIndex, divIndex, isUse });\r\n        },\r\n        addLen: () => {\r\n            // this.dispatch({ type: ActionType.ADD_LEN, payload: null });\r\n\r\n            const backingPaletteState = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const script = backingPaletteState.layers;\r\n            const sideIndex = backingPaletteState.sideIndex;\r\n            const curSideScript = script[sideIndex];\r\n            const selectedLenIndex = backingPaletteState.selectedLenIndex;\r\n            const table = curSideScript.table;\r\n            curSideScript.lens = [...curSideScript.lens];\r\n            // 選択中の要素の次に挿入する\r\n            curSideScript.lens.splice(\r\n                selectedLenIndex + 1, 0,\r\n                { len: BACKING_LEN_TYPE.LEN4, isHalf: false, isDiv3: false }\r\n            );\r\n            table.forEach((line) => {\r\n                line.splice(\r\n                    selectedLenIndex + 1, 0, [false]\r\n                );\r\n            });\r\n            curSideScript.vels.splice(\r\n                backingPaletteState.selectedLenIndex + 1, 0, 5\r\n            );\r\n            script[sideIndex] = curSideScript;\r\n\r\n            this.dispatch(ActionType.INIT_BACKING_PALETTE, { backingPaletteState });\r\n        },\r\n        delLen: () => {\r\n            // this.dispatch({ type: ActionType.ADD_LEN, payload: null });\r\n\r\n            const backingPaletteState = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const script = backingPaletteState.layers;\r\n            const sideIndex = backingPaletteState.sideIndex;\r\n            const curSideScript = script[sideIndex];\r\n            const selectedLenIndex = backingPaletteState.selectedLenIndex;\r\n            const table = curSideScript.table;\r\n            curSideScript.lens = [...curSideScript.lens];\r\n            // 選択中の要素を削除する\r\n            curSideScript.lens.splice(selectedLenIndex, 1);\r\n            table.forEach((line) => {\r\n                line.splice(selectedLenIndex, 1);\r\n            });\r\n            curSideScript.vels.splice(selectedLenIndex, 1);\r\n            script[sideIndex] = curSideScript;\r\n\r\n            if (selectedLenIndex > 0) {\r\n                backingPaletteState.selectedLenIndex--;\r\n            }\r\n            this.dispatch(ActionType.INIT_BACKING_PALETTE, { backingPaletteState });\r\n        },\r\n        updateLenIndex: (index: number) => {\r\n            const backingPaletteState = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            backingPaletteState.selectedLenIndex = index;\r\n            this.initBackingPalette(backingPaletteState);\r\n        },\r\n        getCurLenIndex: (): number => {\r\n            const backingPaletteState = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            return backingPaletteState.selectedLenIndex;\r\n        },\r\n        setChannelRowSize: (size: number) => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            backing.channelRowSize = size;\r\n            backing.layers.forEach((layer) => {\r\n                const table: boolean[][][] = new Array<boolean[][]>(size);\r\n                console.log('★★★' + table.length);\r\n                for (let i = 0; i < table.length; i++) {\r\n                    table[i] = new Array<boolean[]>(layer.lens.length);\r\n                    console.log('☆☆☆☆☆☆');\r\n                    for (let j = 0; j < table[i].length; j++) {\r\n                        table[i][j] = new Array<boolean>(1);\r\n                        table[i][j][0] = false;\r\n                    }\r\n                }\r\n                layer.table = table;\r\n            });\r\n            this.score.setNoteState({ ...this.state.noteState, backingPaletteState: backing });\r\n        },\r\n        isFirstCurLen: (): boolean => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            return backing.selectedLenIndex == 0;\r\n        },\r\n        isLastCurLen: (): boolean => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const sideScript = backing.layers[backing.sideIndex];\r\n            return backing.selectedLenIndex == sideScript.lens.length - 1;\r\n        },\r\n        getSideScript: (): BackingLayer => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            return backing.layers[backing.sideIndex];\r\n        },\r\n        getCurLenBean: (): BackingLen => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const sideScript = backing.layers[backing.sideIndex];\r\n            return sideScript.lens[backing.selectedLenIndex];\r\n        },\r\n\r\n        /**\r\n         * \r\n         * @param lenBean \r\n         */\r\n        setCurrentLenBean: (lenBean: BackingLen) => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const script = backing.layers;\r\n            const sideScript = script[backing.sideIndex];\r\n            sideScript.lens[backing.selectedLenIndex] = lenBean;\r\n            this.initBackingPalette({ ...backing, layers: script });\r\n        },\r\n\r\n        /**\r\n         * 選択中の列の長さを設定します。\r\n         * @param lenType 長さ\r\n         */\r\n        setCurLen: (lenType: BACKING_LEN_TYPE) => {\r\n            const curLenBean = this.backing.getCurLenBean();\r\n            curLenBean.len = lenType;\r\n            curLenBean.isHalf = false;\r\n            curLenBean.isDiv3 = false;\r\n            this.backing.setCurrentLenBean(curLenBean);\r\n        },\r\n\r\n        /**\r\n         * 選択中の列のベロシティ値を更新する。\r\n         * @param velocity 更新するベロシティ値（1～10）\r\n         */\r\n        updateCurVolume: (velocity: number) => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const script = backing.layers;\r\n            script[backing.sideIndex].vels[backing.selectedLenIndex] = velocity;\r\n            this.initBackingPalette({ ...backing, layers: script });\r\n        },\r\n\r\n        /**\r\n         * 選択中の列のベロシティ値を返す。\r\n         * @returns 選択中の列のベロシティ値\r\n         */\r\n        getCurVelocity: (): number => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const sideScript = backing.layers[backing.sideIndex];\r\n            return sideScript.vels[backing.selectedLenIndex];\r\n        },\r\n\r\n        /**\r\n         * 付点を設定できるか否かを判定する。\r\n         * @returns 付点を設定できるか否か\r\n         */\r\n        isAcceptHalf: (): boolean => {\r\n            return [\r\n                BACKING_LEN_TYPE.LEN2,\r\n                BACKING_LEN_TYPE.LEN4,\r\n                BACKING_LEN_TYPE.LEN8\r\n            ].includes(this.backing.getCurLenBean().len);\r\n        },\r\n\r\n        /**\r\n         * 3連符を設定できるか否かを判定する。\r\n         * @returns 3連符を設定できるか否か\r\n         */\r\n        isAcceptDiv3: (): boolean => {\r\n            return [\r\n                BACKING_LEN_TYPE.LEN4,\r\n                BACKING_LEN_TYPE.LEN8\r\n            ].includes(this.backing.getCurLenBean().len);\r\n        },\r\n\r\n        setLayerIndex: (index: number) => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            backing.sideIndex = index;\r\n            backing.selectedLenIndex = 0;\r\n            this.initBackingPalette(backing);\r\n        },\r\n        setUsePedal: (use: boolean) => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            backing.isUsePedal = use;\r\n            this.initBackingPalette(backing);\r\n        },\r\n        setCorrect: (isCorrect: boolean) => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            backing.isCorrect = isCorrect;\r\n            this.initBackingPalette(backing);\r\n        },\r\n\r\n        changeLayerIndex: () => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            backing.sideIndex = backing.sideIndex == 0 ? 1 : 0;\r\n            backing.selectedLenIndex = 0;\r\n            this.initBackingPalette(backing);\r\n        },\r\n\r\n        setUseChannels: (useChannels: ChannelParam) => {\r\n            const backing = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const baseLayers = backing.layers;\r\n            const layers: BackingLayer[] = new Array(2);\r\n            for (let i = 0; i < 2; i++) {\r\n                const channelCount = backing.useChannels.length;\r\n                const lensSplitCount = baseLayers[i].lens.length;\r\n                const baseTable = baseLayers[i].table;\r\n                const table: boolean[][][] = new Array(channelCount);\r\n\r\n                for (let y = 0; y < channelCount; y++) {\r\n                    if (y < baseTable.length) {\r\n                        table[y] = baseTable[y];\r\n                    } else {\r\n                        table[y] = new Array(lensSplitCount);\r\n                        for (let x = 0; x < lensSplitCount; x++) {\r\n                            table[y][x] = new Array(1);\r\n                            table[y][x][0] = false;\r\n                        }\r\n                    }\r\n                }\r\n                layers[i] = {\r\n                    ...baseLayers[i],\r\n                    table,\r\n                };\r\n            }\r\n        },\r\n\r\n        setCurBackingScript: () => {\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const chordDetail = this.state.noteData.dataList[focusIndex].detail as DetailChord;\r\n            const editorState = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const backing = {} as BackingScript;\r\n            backing.useChannels = editorState.useChannels;\r\n            backing.layers = editorState.layers;\r\n            backing.isUsePedal = editorState.isUsePedal;\r\n            this.dispatch(ActionType.DETAIL_PARAMS_SETTER, {\r\n                pos: focusIndex,\r\n                params: {\r\n                    ...chordDetail,\r\n                    backing\r\n                }\r\n            });\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n            this.score.apllyFlashCur();\r\n        },\r\n\r\n        getNotesCount: (backing: BackingScript): number => {\r\n\r\n            let count = 0;\r\n            backing.layers.forEach((layer) => {\r\n                layer.table.forEach((line) => {\r\n                    line.forEach((cell) => {\r\n                        if (cell[0]) {\r\n                            count++;\r\n                        }\r\n                    })\r\n                })\r\n            })\r\n            return count;\r\n        },\r\n\r\n        play: (isScore: boolean) => {\r\n            const curTime = new Date().getTime();\r\n\r\n            const threads = this.state.noteState.backingThreads;\r\n            const sampler = this.state.sampler;\r\n            const soundUseList: number[] = Array(88);\r\n            for (let i = 0; i < 88; i++) {\r\n                soundUseList[i] = 0;\r\n            }\r\n\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                editMode: EditMode.PREVIEW, backingThreads: threads\r\n            });\r\n            let totalTime = 0;\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const dataList = this.state.noteData.dataList;\r\n            // const curDetail  = dataList[focusIndex].detail as DetailChord;\r\n            const pastTime = this.state.noteState.cacheList[focusIndex].progress.headMSec;\r\n\r\n            // Audioファイルが指定されている場合のみ再生\r\n            // バッキングエディタでは鳴らさない\r\n            if (isScore && this.state.noteState.ensembleInfo.isLoad) {\r\n                const audioHead = this.state.noteState.ensembleInfo.startPosition;\r\n                const audio = this.state.noteState.ensembleInfo.audio;\r\n                const adjust = audioHead + pastTime;\r\n                audio.currentTime = 0;\r\n                if (adjust > 0) {\r\n                    audio.currentTime = adjust * 0.001;\r\n                    audio.play();\r\n                } else {\r\n                    setTimeout(() => {\r\n                        audio.play();\r\n                    }, (adjust * -1));\r\n                }\r\n            }\r\n            const limitIndex = isScore ? dataList.length : focusIndex + 1;\r\n            for (let i = focusIndex; i < limitIndex; i++) {\r\n                const data = dataList[i];\r\n\r\n\r\n                // フォーカスを更新\r\n                threads.push(\r\n                    setTimeout(() => {\r\n                        if (isScore && [TypeNoteElement.Chord, TypeNoteElement.Fixed].includes(data.type)) {\r\n                            // const hasNext = this.score.focusNextElement();\r\n                            // if (!hasNext) {\r\n                            //     this.score.setNoteState({ ...this.state.noteState, editMode: EditMode.NORMAL });\r\n                            // }\r\n                            const [editMode, next] =\r\n                                data.type == TypeNoteElement.Fixed ?\r\n                                    [EditMode.NORMAL, focusIndex] : [EditMode.PREVIEW, i];\r\n                            this.score.setNoteState({ ...this.state.noteState, focusIndex: next, editMode });\r\n                        }\r\n                    }, totalTime)\r\n                );\r\n                if (data.type == TypeNoteElement.Chord) {\r\n                    const detail = data.detail as DetailChord;\r\n\r\n                    const cache = this.state.noteState.cacheList[i];\r\n                    const symbol: SymbolParams = { ...(getSymbolParams(detail.symbolKey) as SymbolParams) };\r\n                    if (detail.molecule != null && detail.denominator != null) {\r\n                        applyOnChord(symbol, detail.molecule.rootIndex, detail.denominator.rootIndex);\r\n                    }\r\n                    const intervals = symbol?.intervals as number[];\r\n                    const editor = this.state.noteState.backingPaletteState as BackingEditorState;\r\n                    const backing: BackingScript = !isScore ? { layers: editor.layers, useChannels: editor.useChannels, isUsePedal: editor.isUsePedal }\r\n                        : detail.backing;\r\n                    const tempo = cache.init.tempo;\r\n                    // 1小節の長さミリ秒\r\n                    const barMs = 60000 / tempo * 4;\r\n                    const boxMs = 60000 / tempo * (detail.sustain + detail.headAdjust + detail.tailAdjust);\r\n                    // 次のコードと滑らかにつなぐための補正\r\n                    const adjustOverlap = barMs / 32;\r\n\r\n                    // バッキングエディタの場合は、1つの要素で止める\r\n                    if (!isScore) {\r\n                        threads.push(\r\n                            setTimeout(() => {\r\n                                this.score.setNoteState({ ...this.state.noteState, editMode: EditMode.NORMAL });\r\n\r\n                            }, totalTime + boxMs)\r\n                        )\r\n                    }\r\n                    for (let i = 0; i < 2; i++) {\r\n                        let headMs = 0;\r\n                        const layer = backing.layers[i];\r\n                        // 音価のループ\r\n                        layer.lens.forEach((lenBean, j) => {\r\n\r\n                            const lenValue = Number(lenBean.len.toString().replace('LEN', ''));\r\n                            let curLenMs = barMs / lenValue;\r\n                            if (lenBean.isHalf) {\r\n                                curLenMs *= 1.5;\r\n                            }\r\n                            backing.useChannels.forEach((channel, k) => {\r\n                                layer.table[k][j].forEach((notes, l) => {\r\n\r\n                                    if (notes && detail.molecule != null) {\r\n                                        const degreeIndex = detail.molecule.rootIndex;\r\n                                        const rootKeyIndex = (cache.init.keyIndex + degreeIndex) % 12;\r\n                                        const soundIndex = rootKeyIndex + intervals[channel.structIndex] + channel.octave * 12;\r\n                                        const octave = Math.floor(soundIndex / 12);\r\n                                        const root = KEY12_SHARP_LIST[soundIndex % 12];\r\n                                        const soundFullName = root + octave;\r\n                                        const velocity = 0.5 * layer.vels[j] / 10;\r\n                                        const head = headMs + curLenMs / 3 * l;\r\n                                        const tail = !backing.isUsePedal ?\r\n                                            //ペダル未使用時\r\n                                            head + curLenMs :\r\n                                            //ペダル使用時\r\n                                            boxMs + adjustOverlap\r\n                                            ;\r\n                                        const lag = new Date().getTime() - curTime;\r\n                                        threads.push(\r\n                                            setTimeout(() => {\r\n                                                sampler.triggerAttack(soundFullName, '+0', velocity);\r\n                                                soundUseList[soundIndex]++;\r\n                                            }, totalTime + head - lag)\r\n                                        );\r\n                                        threads.push(\r\n                                            setTimeout(() => {\r\n                                                soundUseList[soundIndex]--;\r\n                                                if (soundUseList[soundIndex] == 0) {\r\n                                                    sampler.triggerRelease(soundFullName);\r\n                                                }\r\n                                            }, totalTime + tail - lag)\r\n                                        );\r\n                                    }\r\n                                });\r\n                            });\r\n                            headMs += curLenMs;\r\n                        });\r\n                    }\r\n                    totalTime += boxMs;\r\n                }\r\n            }\r\n\r\n            if (isScore) {\r\n                const start = this.state.noteState.cacheList[focusIndex].progress.headMSec;\r\n                this.backing.playTune(curTime, start);\r\n            }\r\n        },\r\n        playTune: (curTime: number, start: number) => {\r\n            const columnList = this.state.noteData.columnList;\r\n            const threads = this.state.noteState.backingThreads;\r\n            const getSoundName = (soundIndex: number) => {\r\n\r\n                const octave = Math.floor((87 + 9 - soundIndex) / 12);\r\n                const keyIndex = (87 + 9 - soundIndex) % 12;\r\n                const chordName = KEY12_SHARP_LIST[keyIndex];\r\n                return chordName + octave;\r\n            }\r\n\r\n            let pastTime = 140 - start;\r\n            const bpm = this.state.noteState.cacheList[0].init.tempo;\r\n            for (let i = 0; i < columnList.length; i++) {\r\n                const column = columnList[i];\r\n\r\n                const total = column.len4 + column.len8 / 2 + column.len16 / 4 + column.len4div3 / 3 + column.len8div3 / 6;\r\n                const soundName = getSoundName(column.soundIndex);\r\n                const time = 60 / bpm * total;\r\n                if (pastTime > 0) {\r\n                    const lag = new Date().getTime() - curTime;\r\n                    if (column.soundIndex !== -1) {\r\n                        threads.push(\r\n                            setTimeout(() => {\r\n                                this.tune.playSoundFont(soundName, time);\r\n                            }, pastTime - lag)\r\n                        );\r\n                    }\r\n                }\r\n                pastTime += time * 1000;\r\n            }\r\n        }\r\n    }\r\n\r\n    public thema = {\r\n\r\n        setThemaeData: (data: ThemaDataTree) => {\r\n            this.dispatch(ActionType.SET_THEMA_DATA, { data: { ...data } });\r\n        },\r\n        setThemaState: (themaState: ThemaState) => {\r\n            this.dispatch(ActionType.SET_THEMA_STATE, { themaState });\r\n        },\r\n\r\n        callBackingPatternEditor: () => {\r\n            const cur = this.thema.getFocusElement();\r\n            const sustainEl = cur.parent as ThemaIndexedElement;\r\n            const sustain = sustainEl.reffer as BTSustain;\r\n            const form = this.state.themaState.form.pattern;\r\n            const patternDef: BackingPattern = form.src == '' ? {\r\n                layers: [\r\n                    {\r\n                        lens: [{\r\n                            len: BACKING_LEN_TYPE.LEN4,\r\n                            isDiv3: false,\r\n                            isHalf: false\r\n                        }],\r\n                        side: BACKING_SIDE.LEFT,\r\n                        table: [[[false]]],\r\n                        vels: [5]\r\n                    },\r\n                    {\r\n                        lens: [{\r\n                            len: BACKING_LEN_TYPE.LEN4,\r\n                            isDiv3: false,\r\n                            isHalf: false\r\n                        }],\r\n                        side: BACKING_SIDE.RIGHT,\r\n                        table: [[[false]]],\r\n                        vels: [5]\r\n                    }\r\n                ],\r\n                isUsePedal: false\r\n            } : JSON.parse(form.src);\r\n            const backingState: BackingEditorState = {\r\n                target: \"thema-pattern\",\r\n                isDispVoicing: false,\r\n                isEditPattern: true,\r\n                molecule: { rootIndex: 0, isFlat: false },\r\n                denominator: null,\r\n                symbolKey: SymbolKey.MAJOR,\r\n                sustain: sustain.beat,\r\n                headAdjust: sustain.headAdjust,\r\n                tailAdjust: sustain.tailAdjust,\r\n                channelRowSize: patternDef.layers[0].table.length,\r\n                isUsePedal: patternDef.isUsePedal,\r\n                sideIndex: 0,\r\n                selectedLenIndex: 0,\r\n                selectedChannelIndex: -1,\r\n                useChannels: [],\r\n                layers: patternDef.layers.slice(),\r\n                isCorrect: true\r\n            };\r\n            this.initBackingPalette(backingState);\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.BACKING_PALETTE });\r\n        },\r\n        callBackingVoicingEditor: () => {\r\n            const cur = this.thema.getFocusElement();\r\n            const patternEl = cur.parent?.parent?.parent as ThemaIndexedElement;\r\n            const sustainEl = patternEl.parent as ThemaIndexedElement;\r\n            const pattern = patternEl.reffer as BTPattern;\r\n            const sustain = sustainEl.reffer as BTSustain;\r\n            const patternDef = pattern.def as BackingPattern;\r\n            const form = this.state.themaState.form.voicing;\r\n            const VoicingDef: BackingVoicing = form.src == '' ? {\r\n                useChannels: []\r\n            } : JSON.parse(form.src);\r\n            const backingState: BackingEditorState = {\r\n                target: \"thema-voicing\",\r\n                isDispVoicing: true,\r\n                isEditPattern: false,\r\n                molecule: { rootIndex: 0, isFlat: false },\r\n                denominator: null,\r\n                symbolKey: SymbolKey.MAJOR,\r\n                sustain: sustain.beat,\r\n                headAdjust: sustain.headAdjust,\r\n                tailAdjust: sustain.tailAdjust,\r\n                channelRowSize: patternDef.layers[0].table.length,\r\n                isUsePedal: patternDef.isUsePedal,\r\n                sideIndex: 0,\r\n                selectedLenIndex: 0,\r\n                selectedChannelIndex: -1,\r\n                useChannels: VoicingDef.useChannels.slice(),\r\n                layers: patternDef.layers,\r\n                isCorrect: true\r\n            };\r\n            this.initBackingPalette(backingState);\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.BACKING_PALETTE });\r\n        },\r\n\r\n        buildIndex: () => {\r\n            const themaState = this.state.themaState;\r\n            const themaTree = this.state.themaDataTree;\r\n            const dataIndexies: ThemaIndexedElement[] = [];\r\n\r\n            const rootBean: ThemaIndexedElement = {\r\n                isClose: false,\r\n                ChildCnt: themaTree.sustains.length,\r\n                type: 'root',\r\n                reffer: themaTree,\r\n                parent: null\r\n            }\r\n            dataIndexies.push(rootBean);\r\n\r\n            // 拍リストを構成\r\n            themaTree.sustains.forEach((sustain) => {\r\n                const sustainBean: ThemaIndexedElement = {\r\n                    isClose: false,\r\n                    ChildCnt: sustain.patterns.length,\r\n                    type: 'sustain',\r\n                    reffer: sustain,\r\n                    parent: rootBean\r\n                };\r\n                dataIndexies.push(sustainBean);\r\n                sustain.patterns.forEach((pattern) => {\r\n                    const patternBean: ThemaIndexedElement = {\r\n                        isClose: false,\r\n                        ChildCnt: pattern.tgtTypes.length,\r\n                        type: 'pattern',\r\n                        reffer: pattern,\r\n                        parent: sustainBean\r\n                    };\r\n                    dataIndexies.push(patternBean);\r\n                    pattern.tgtTypes.forEach((category) => {\r\n                        const categoryBean: ThemaIndexedElement = {\r\n                            isClose: false,\r\n                            ChildCnt: category.conditions.length,\r\n                            type: 'category',\r\n                            reffer: category,\r\n                            parent: patternBean\r\n                        };\r\n                        dataIndexies.push(categoryBean);\r\n                        category.conditions.forEach((condition) => {\r\n                            const conditionBean: ThemaIndexedElement = {\r\n                                isClose: false,\r\n                                ChildCnt: condition.voicings.length,\r\n                                type: 'condition',\r\n                                reffer: condition,\r\n                                parent: categoryBean\r\n                            };\r\n                            dataIndexies.push(conditionBean);\r\n                            condition.voicings.forEach((voicing) => {\r\n                                const voicingBean: ThemaIndexedElement = {\r\n                                    isClose: false,\r\n                                    ChildCnt: 0,\r\n                                    type: 'voicing',\r\n                                    reffer: voicing,\r\n                                    parent: conditionBean\r\n                                };\r\n                                dataIndexies.push(voicingBean);\r\n                            });\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n\r\n            if (themaState.focusRef !== null) {\r\n                dataIndexies.forEach((data, i) => {\r\n                    if (data.reffer == themaState.focusRef) {\r\n                        themaState.focusIndex = i;\r\n                        themaState.focusRef = null;\r\n                        themaState.isCreate = true;\r\n                    }\r\n                });\r\n            }\r\n            this.thema.setThemaState({ ...themaState, themaCacheList: dataIndexies });\r\n        },\r\n        applyBackingPattern: () => {\r\n            const editor = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const form = this.state.themaState.form.pattern;\r\n            const def: BackingPattern = {\r\n                layers: editor.layers.slice(),\r\n                isUsePedal: editor.isUsePedal\r\n            }\r\n            form.src = JSON.stringify(def);\r\n            this.thema.setThemaState(this.state.themaState);\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n        },\r\n        applyBackingVoicing: () => {\r\n            const editor = this.state.noteState.backingPaletteState as BackingEditorState;\r\n            const form = this.state.themaState.form.voicing;\r\n            const def: BackingVoicing = {\r\n                useChannels: editor.useChannels\r\n            }\r\n            form.src = JSON.stringify(def);\r\n            this.thema.setThemaState(this.state.themaState);\r\n            this.dispatch(ActionType.FLOATWND_STATE, { state: FloatWndState.NONE });\r\n        },\r\n\r\n        getFocusElement: (): ThemaIndexedElement => {\r\n            return this.state.themaState.themaCacheList[this.state.themaState.focusIndex];\r\n        },\r\n\r\n        addChildSustain: () => {\r\n            const thema = this.state.themaDataTree;\r\n            const themaState = this.state.themaState;\r\n            const bean: BTSustain = {\r\n                beat: 1,\r\n                headAdjust: 0,\r\n                tailAdjust: 0,\r\n                patterns: []\r\n            };\r\n            themaState.focusRef = bean;\r\n            const form = themaState.form.sustain;\r\n            form.beat = null;\r\n            form.headAdjust = 0;\r\n            form.tailAdjust = 0;\r\n            this.thema.setThemaState(themaState);\r\n            thema.sustains.push(bean);\r\n            this.thema.setThemaeData(thema);\r\n        },\r\n\r\n        addChildPattern: (data: ThemaIndexedElement) => {\r\n            const thema = this.state.themaDataTree;\r\n            const themaState = this.state.themaState;\r\n            const reffer = data.reffer as BTSustain;\r\n            const bean: BTPattern = {\r\n                name: 'pattern1',\r\n                def: null,\r\n                tgtTypes: []\r\n            };\r\n            themaState.focusRef = bean;\r\n            const form = themaState.form.pattern;\r\n            form.name = '';\r\n            form.def = null;\r\n            form.src = '';\r\n            this.thema.setThemaState(themaState);\r\n            reffer.patterns.push(bean);\r\n            this.thema.setThemaeData(thema);\r\n        },\r\n\r\n        addChildCategory: (data: ThemaIndexedElement) => {\r\n            const thema = this.state.themaDataTree;\r\n            const themaState = this.state.themaState;\r\n            const reffer = data.reffer as BTPattern;\r\n            const bean: VoicingTargetType = {\r\n                symbolType: SymbolType.TRIAD,\r\n                conditions: []\r\n            };\r\n            themaState.focusRef = bean;\r\n            const form = themaState.form.category;\r\n            form.category = null;\r\n            this.thema.setThemaState(themaState);\r\n            reffer.tgtTypes.push(bean);\r\n            this.thema.setThemaeData(thema);\r\n        },\r\n\r\n        addChildCondition: (data: ThemaIndexedElement) => {\r\n            const thema = this.state.themaDataTree;\r\n            const themaState = this.state.themaState;\r\n            const reffer = data.reffer as VoicingTargetType;\r\n            const bean: VoicingTargetCondition = {\r\n                maxRootIndex: 11,\r\n                minRootIndex: 0,\r\n                tgtSymbols: [],\r\n                voicings: []\r\n            };\r\n            themaState.focusRef = bean;\r\n            const form = themaState.form.condition;\r\n            form.maxRootIndex = 0;\r\n            form.maxRootIndex = 11;\r\n            form.tgtSymbols = [];\r\n            this.thema.setThemaState(themaState);\r\n            reffer.conditions.push(bean);\r\n            this.thema.setThemaeData(thema);\r\n        },\r\n\r\n        addChildVoicing: (data: ThemaIndexedElement) => {\r\n            const thema = this.state.themaDataTree;\r\n            const themaState = this.state.themaState;\r\n            const reffer = data.reffer as VoicingTargetCondition;\r\n            const bean: BTVoicing = {\r\n                def: null\r\n            };\r\n            themaState.focusRef = bean;\r\n            const form = themaState.form.voicing;\r\n            form.def = null;\r\n            form.src = '';\r\n            this.thema.setThemaState(themaState);\r\n            reffer.voicings.push(bean);\r\n            this.thema.setThemaeData(thema);\r\n        }\r\n    }\r\n\r\n    public preview = {\r\n        play: () => {\r\n\r\n            const threads = this.state.noteState.backingThreads;\r\n            const soundUseList: number[] = Array(88);\r\n            for (let i = 0; i < 88; i++) {\r\n                soundUseList[i] = 0;\r\n            }\r\n\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                editMode: EditMode.PREVIEW, backingThreads: threads\r\n            });\r\n            let totalTime = 0;\r\n            const focusIndex = this.state.noteState.focusIndex;\r\n            const dataList = this.state.noteData.dataList;\r\n            const pastTime = 0;\r\n\r\n            const audioHead = this.state.noteState.ensembleInfo.startPosition;\r\n\r\n            // Audioファイルが指定されている場合のみ再生\r\n            if (this.state.noteState.ensembleInfo.fileURL !== '') {\r\n                const audio = this.state.noteState.ensembleInfo.audio;\r\n                audio.currentTime = (audioHead + pastTime) * 0.001;\r\n                audio.play();\r\n            }\r\n            const curTime = new Date().getTime();\r\n            const limitIndex = dataList.length;\r\n            for (let i = focusIndex; i < limitIndex; i++) {\r\n                const data = dataList[i];\r\n\r\n                if (data.type == TypeNoteElement.Chord) {\r\n                    const detail = data.detail as DetailChord;\r\n\r\n                    const cache = this.state.noteState.cacheList[i];\r\n                    const symbol: SymbolParams = { ...(getSymbolParams(detail.symbolKey) as SymbolParams) };\r\n                    if (detail.molecule != null && detail.denominator != null) {\r\n                        applyOnChord(symbol, detail.molecule.rootIndex, detail.denominator.rootIndex);\r\n                    }\r\n                    const intervals = symbol?.intervals as number[];\r\n                    const backing: BackingScript = detail.backing;\r\n                    const sampler = this.state.sampler;\r\n                    const tempo = cache.init.tempo;\r\n                    // 1小節の長さミリ秒\r\n                    const barMs = 60000 / tempo * 4;\r\n                    const boxMs = 60000 / tempo * (detail.sustain + detail.headAdjust + detail.tailAdjust);\r\n                    const adjustOverlap = barMs / 32;\r\n\r\n                    for (let i = 0; i < 2; i++) {\r\n                        let headMs = 0;\r\n                        const layer = backing.layers[i];\r\n                        // 音価のループ\r\n                        layer.lens.forEach((lenBean, j) => {\r\n\r\n                            const lenValue = Number(lenBean.len.toString().replace('LEN', ''));\r\n                            let curLenMs = barMs / lenValue;\r\n                            if (lenBean.isHalf) {\r\n                                curLenMs *= 1.5;\r\n                            }\r\n                            backing.useChannels.forEach((channel, k) => {\r\n                                layer.table[k][j].forEach((notes, l) => {\r\n\r\n                                    if (notes && detail.molecule != null) {\r\n                                        const degreeIndex = detail.molecule.rootIndex;\r\n                                        const rootKeyIndex = (cache.init.keyIndex + degreeIndex) % 12;\r\n                                        const soundIndex = rootKeyIndex + intervals[channel.structIndex] + channel.octave * 12;\r\n                                        const octave = Math.floor(soundIndex / 12);\r\n                                        const root = KEY12_SHARP_LIST[soundIndex % 12];\r\n                                        const soundFullName = root + octave;\r\n                                        const velocity = 0.5 * layer.vels[j] / 10;\r\n                                        const head = headMs + curLenMs / 3 * l;\r\n                                        const tail = !backing.isUsePedal ?\r\n                                            //ペダル未使用時\r\n                                            head + curLenMs :\r\n                                            //ペダル使用時\r\n                                            boxMs + adjustOverlap\r\n                                            ;\r\n                                        const lag = new Date().getTime() - curTime;\r\n                                        threads.push(\r\n                                            setTimeout(() => {\r\n                                                sampler.triggerAttack(soundFullName, '+0', velocity);\r\n                                                soundUseList[soundIndex]++;\r\n                                            }, totalTime + head - lag)\r\n                                        );\r\n                                        threads.push(\r\n                                            setTimeout(() => {\r\n                                                soundUseList[soundIndex]--;\r\n                                                if (soundUseList[soundIndex] == 0) {\r\n                                                    sampler.triggerRelease(soundFullName);\r\n                                                }\r\n                                            }, totalTime + tail - lag)\r\n                                        );\r\n                                    }\r\n                                });\r\n                            });\r\n                            headMs += curLenMs;\r\n                        });\r\n                    }\r\n                    totalTime += boxMs;\r\n                }\r\n            }\r\n        },\r\n        stop: () => {\r\n\r\n            // Audioファイルが指定されている場合のみ停止\r\n            if (this.state.noteState.ensembleInfo.isLoad) {\r\n                this.state.noteState.ensembleInfo.audio.pause();\r\n            }\r\n            const threads = this.state.noteState.backingThreads;\r\n            threads.forEach((thr) => {\r\n                clearInterval(thr);\r\n            });\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                backingThreads: [], editMode: EditMode.NORMAL\r\n            });\r\n            this.state.sampler.releaseAll();\r\n        }\r\n    }\r\n\r\n    public tune = {\r\n        setState: (tuneState: TuneState) => {\r\n            this.dispatchBase({ type: ActionType.SET_TUNE_STATE, payload: { tuneState } });\r\n        },\r\n        setSoundFont: (soundFont: SoundFontProp) => {\r\n            this.setNoteData({ ...this.state.noteData, soundFont: soundFont });\r\n        },\r\n\r\n        setColumnList: (columnList: Column[]) => {\r\n            this.setNoteData({ ...this.state.noteData, columnList });\r\n        },\r\n\r\n        addColumn: () => {\r\n            const tuneState = this.state.tuneState;\r\n            const len4 = tuneState.usingLen === 4 && !tuneState.isDiv3 ? 1 : 0;\r\n            const len8 = tuneState.usingLen === 8 && !tuneState.isDiv3 ? 1 : 0;\r\n            const len16 = tuneState.usingLen === 16 ? 1 : 0;\r\n            const len4div3 = tuneState.usingLen === 4 && tuneState.isDiv3 ? 1 : 0;\r\n            const len8div3 = tuneState.usingLen === 8 && tuneState.isDiv3 ? 1 : 0;\r\n            const columnList = this.state.noteData.columnList;\r\n            columnList.splice(tuneState.columnIndex + 1, 0, {\r\n                len4, len8, len16, len4div3, len8div3, soundIndex: -1\r\n            });\r\n            this.tune.setColumnList(columnList.slice());\r\n        },\r\n\r\n        remooveCur: () => {\r\n            const tuneState = this.state.tuneState;\r\n            const columnList = this.state.noteData.columnList;\r\n            columnList.splice(tuneState.columnIndex, 1);\r\n            this.tune.setColumnList(columnList.slice());\r\n        },\r\n\r\n        playSoundFont: (soundName: string, duration: number) => {\r\n            const instrument = this.state.instrument;\r\n            if (instrument != null) {\r\n                instrument.stop();\r\n                instrument.play(soundName, 0, { duration });\r\n            }\r\n        },\r\n\r\n        adjustWidth: (isAdd: boolean) => {\r\n            const tuneState = this.state.tuneState;\r\n            const columnList = this.state.noteData.columnList;\r\n            const column = { ...columnList[tuneState.columnIndex] };\r\n            if (isAdd) {\r\n                if (tuneState.usingLen === 4 && !tuneState.isDiv3) column.len4++;\r\n                else if (tuneState.usingLen === 8 && !tuneState.isDiv3) column.len8++;\r\n                else if (tuneState.usingLen === 16 && !tuneState.isDiv3) column.len16++;\r\n                else if (tuneState.usingLen === 4 && tuneState.isDiv3) column.len4div3++;\r\n                else if (tuneState.usingLen === 8 && tuneState.isDiv3) column.len8div3++;\r\n            } else {\r\n                if (tuneState.usingLen === 4 && !tuneState.isDiv3) column.len4--;\r\n                else if (tuneState.usingLen === 8 && !tuneState.isDiv3) column.len8--;\r\n                else if (tuneState.usingLen === 16 && !tuneState.isDiv3) column.len16--;\r\n                else if (tuneState.usingLen === 4 && tuneState.isDiv3) column.len4div3--;\r\n                else if (tuneState.usingLen === 8 && tuneState.isDiv3) column.len8div3--;\r\n            }\r\n            let total = column.len4 + column.len8 / 2 + column.len16 / 4;\r\n            let totalDiv3 = column.len4div3 / 3 + column.len8div3 / 6;\r\n            if (total + totalDiv3 > 0) {\r\n                column.len4 = Math.floor(total);\r\n                total -= column.len4;\r\n                total *= 2;\r\n                column.len8 = Math.floor(total);\r\n                total -= column.len8;\r\n                total *= 2;\r\n                column.len16 = Math.floor(total);\r\n\r\n                const subLen4 = Math.floor(totalDiv3);\r\n                totalDiv3 -= subLen4;\r\n                totalDiv3 *= 3;\r\n                column.len4div3 = Math.floor(totalDiv3);\r\n                totalDiv3 -= column.len4div3;\r\n                totalDiv3 *= 2;\r\n                const subLen8 = Math.floor(totalDiv3);\r\n                totalDiv3 -= subLen8;\r\n                totalDiv3 *= 3;\r\n                column.len8div3 = Math.floor(totalDiv3);\r\n                column.len4 += subLen4;\r\n                column.len8 += subLen8;\r\n                columnList[tuneState.columnIndex] = column;\r\n                this.tune.setColumnList(columnList.slice());\r\n            }\r\n        },\r\n\r\n        adjustScrollY: (columnIndex: number) => {\r\n\r\n            const tuneState = this.state.tuneState;\r\n            const columnList = this.state.noteData.columnList;\r\n            const column = columnList[columnIndex];\r\n            if (column.soundIndex !== -1) {\r\n                const top = 22 * column.soundIndex - 350;\r\n                tuneState.intervalRef.current.scrollTo({ top, behavior: 'smooth' });\r\n                tuneState.tableRef.current.scrollTo({ top, behavior: 'smooth' });\r\n            }\r\n        },\r\n        adjustScrollX: (columnIndex: number) => {\r\n            const tuneState = this.state.tuneState;\r\n            const pos = tuneState.cacheList[columnIndex].posX;\r\n            const left = pos * BEAT_WIDTH - 200;\r\n            tuneState.tableRef.current.scrollTo({ left, behavior: 'smooth' });\r\n            console.log('left: ' + left);\r\n        },\r\n\r\n        playPreview: () => {\r\n\r\n            const tuneState = this.state.tuneState;\r\n            const columnList = this.state.noteData.columnList;\r\n            const instrument = this.state.instrument as Soundfont.Player;\r\n            const threads = this.state.noteState.backingThreads;\r\n            const getSoundName = (soundIndex: number) => {\r\n\r\n                const octave = Math.floor((87 + 9 - soundIndex) / 12);\r\n                const keyIndex = (87 + 9 - soundIndex) % 12;\r\n                const chordName = KEY12_SHARP_LIST[keyIndex];\r\n                return chordName + octave;\r\n            }\r\n\r\n            let pastTime = 0;\r\n            const bpm = this.state.noteState.cacheList[0].init.tempo;\r\n            for (let i = tuneState.columnIndex; i < columnList.length; i++) {\r\n                const column = columnList[i];\r\n\r\n                const total = column.len4 + column.len8 / 2 + column.len16 / 4 + column.len4div3 / 3 + column.len8div3 / 6;\r\n                const time = 60 / bpm * total;\r\n                const soundName = getSoundName(column.soundIndex);\r\n                threads.push(\r\n                    setTimeout(() => {\r\n                        tuneState.columnIndex = i;\r\n                        tuneState.isEdit = true;\r\n                        this.tune.setState(tuneState);\r\n                        if (column.soundIndex !== -1) {\r\n                            this.tune.playSoundFont(soundName, time);\r\n                        }\r\n                    }, pastTime * 1000)\r\n                );\r\n                pastTime += time;\r\n            }\r\n            threads.push(\r\n                setTimeout(() => {\r\n                    tuneState.isPreview = false;\r\n                    this.tune.setState(tuneState);\r\n                }, pastTime * 1000)\r\n            );\r\n        },\r\n\r\n        stopPreview: () => {\r\n            const threads = this.state.noteState.backingThreads;\r\n            threads.forEach((thr) => {\r\n                clearInterval(thr);\r\n            });\r\n            this.score.setNoteState({\r\n                ...this.state.noteState,\r\n                backingThreads: []\r\n            });\r\n        },\r\n\r\n        moveAll: (value: number) => {\r\n            const columnList = this.state.noteData.columnList;\r\n            for (let i = 0; i < columnList.length; i++) {\r\n                const column = columnList[i];\r\n                if (column.soundIndex !== -1) {\r\n                    column.soundIndex += value;\r\n                }\r\n            }\r\n            this.tune.setColumnList(columnList.slice());\r\n        }\r\n    }\r\n}","import { API_DOMAIN } from 'contents/common/define';\r\nimport { sendQueryRequestToAPI } from 'contents/common/utils';\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { useContext, useEffect, useRef, useState } from 'react';\r\nimport './LoginFrame.css';\r\n\r\nconst LoginFrame = () => {\r\n\r\n    const ref = useRef({} as HTMLDivElement);\r\n\r\n    const [loginType, setLoginType] = useState<'guest' | 'login' | 'create'>('guest');\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n    const [userName, setUserName] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [passConfirm, setPassConfirm] = useState('');\r\n    const [message, setMessage] = useState(' ');\r\n    const [isError, setError] = useState(false);\r\n\r\n    const [isLoading, setLoading] = useState(false);\r\n\r\n    const enterDisable = (): boolean => {\r\n        switch (loginType) {\r\n            case 'guest': return false;\r\n            case 'login': {\r\n                return userName == '' || userName.length < 5 || userName.length > 15 || !isHanEisu(userName) ||\r\n                    password == '' || password.length < 5 || password.length > 15 || !isHanEisu(password);\r\n            }\r\n            case 'create': {\r\n                return userName.length < 5 || userName.length > 15 || !isHanEisu(userName) ||\r\n                    password.length < 5 || password.length > 15 || !isHanEisu(password) ||\r\n                    passConfirm.length < 5 || passConfirm.length > 15 || !isHanEisu(passConfirm);\r\n            }\r\n        }\r\n    }\r\n    return (<>\r\n        <div id=\"logo\"><span>Virtual Harmonizer</span></div>\r\n        <div id=\"login-frame\" ref={ref}>\r\n            <div className=\"guide\">\r\n                <span>Start to Virtual Harmonizer</span>\r\n            </div>\r\n            <div className=\"type\">\r\n                <LoginTypeSwitch\r\n                    curLoginType=\"guest\"\r\n                    name=\"guest\" loginType={loginType}\r\n                    setLoginType={setLoginType}\r\n                    resetError={() => setMessage('')}\r\n                />\r\n                <LoginTypeSwitch\r\n                    curLoginType=\"login\"\r\n                    name=\"login\" loginType={loginType}\r\n                    setLoginType={setLoginType}\r\n                    resetError={() => setMessage('')}\r\n                />\r\n                <LoginTypeSwitch\r\n                    curLoginType=\"create\"\r\n                    name=\"create account\" loginType={loginType}\r\n                    setLoginType={setLoginType}\r\n                    resetError={() => setMessage('')}\r\n                />\r\n            </div>\r\n            <div className=\"body\">\r\n                <TextForm\r\n                    label=\"user name\"\r\n                    stateValue={userName}\r\n                    stateSetter={setUserName}\r\n                    isMask={false}\r\n                    isDisable={!['login', 'create'].includes(loginType)}\r\n                />\r\n                <TextForm\r\n                    label=\"password\"\r\n                    stateValue={password}\r\n                    stateSetter={setPassword}\r\n                    isMask={true}\r\n                    isDisable={!['login', 'create'].includes(loginType)}\r\n                />\r\n                <TextForm\r\n                    label=\"password confirm\"\r\n                    stateValue={passConfirm}\r\n                    stateSetter={setPassConfirm}\r\n                    isMask={true}\r\n                    isDisable={!['create'].includes(loginType)}\r\n                />\r\n            </div>\r\n            <div className=\"message\">\r\n                <span className={isError ? 'error' : ''}>{message}</span>\r\n            </div>\r\n            <div\r\n                className={['opr', (enterDisable() || isLoading) ? 'disable' : ''].join(' ')}\r\n            >\r\n                <button\r\n                    onClick={() => {\r\n\r\n                        const login = (id: number, name: string) => {\r\n                            ref.current.style.opacity = '0';\r\n                            setTimeout(() => {\r\n                                dispatcher.setLoginParams({\r\n                                    ...state.login,\r\n                                    isLogin: true,\r\n                                    id,\r\n                                    name\r\n                                });\r\n                            }, 300);\r\n                        }\r\n                        setLoading(true);\r\n                        setError(false);\r\n                        setMessage('Connect to server...');\r\n                        switch (loginType) {\r\n                            case 'guest': {\r\n                                login(-1, 'Guest');\r\n                                setLoading(false);\r\n                            }\r\n                                break;\r\n                            case 'login': {\r\n\r\n                                sendQueryRequestToAPI('select', `SELECT * FROM user_tbl where name = '${userName}' and password = '${password}'`)\r\n                                    .then(response => {\r\n                                        return response.json();\r\n                                    })\r\n                                    .then(results => {\r\n                                        console.log(results.length);\r\n                                        const isExist = results.length > 0;\r\n                                        if (isExist) {\r\n                                            login(results[0].id, results[0].name);\r\n                                        } else {\r\n                                            setError(true);\r\n                                            setMessage('The login attempt failed. Either the user ID or password is invalid.');\r\n                                        }\r\n                                        setLoading(false);\r\n                                    })\r\n                                    .catch(error => {\r\n                                        console.log(error + \"失敗しました\");\r\n                                        setLoading(false);\r\n                                    });\r\n                            }\r\n                                break;\r\n                            case 'create': {\r\n\r\n                                if (password != passConfirm) {\r\n                                    setError(true);\r\n                                    setMessage(`Confirmation passwords don't match.`);\r\n                                    setLoading(false);\r\n                                    break;\r\n                                }\r\n\r\n                                (async () => {\r\n                                    let response = await sendQueryRequestToAPI('select', `SELECT count(*) as cnt FROM user_tbl where name = '${userName}'`);\r\n                                    let results = await response.json();\r\n                                    console.log(JSON.stringify(results[0].cnt));\r\n                                    const isExist = results[0].cnt > 0;\r\n                                    if (isExist) {\r\n                                        setError(true);\r\n                                        setMessage('That user id has already been recorded.');\r\n                                    } else {\r\n                                        response = await sendQueryRequestToAPI('update', `INSERT INTO user_tbl(name, password) VALUES('${userName}', '${password}')`);\r\n                                        results = await response.json();\r\n                                        setMessage('');\r\n                                        alert('You have successfully created an account!');\r\n                                        setLoginType('login');\r\n                                    }\r\n                                    setLoading(false);\r\n                                })();\r\n                            }\r\n                                break;\r\n                        }\r\n                    }}\r\n                >\r\n                    enter\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </>);\r\n}\r\n\r\nconst LoginTypeSwitch = (\r\n    props: {\r\n        name: string,\r\n        curLoginType: string,\r\n        loginType: string,\r\n        setLoginType: Function,\r\n        resetError: Function\r\n    }\r\n) => {\r\n    const isSelected = props.loginType == props.curLoginType;\r\n    return (\r\n        <button\r\n            className={isSelected ? 'active' : ''}\r\n            onClick={() => {\r\n                if (!isSelected) {\r\n                    props.setLoginType(props.curLoginType);\r\n                    props.resetError();\r\n                }\r\n            }}\r\n        >\r\n            {props.name}\r\n        </button>\r\n    );\r\n}\r\n\r\n\r\nconst TextForm = (\r\n    props: {\r\n        label: string,\r\n        stateValue: string,\r\n        stateSetter: Function,\r\n        isMask: boolean,\r\n        isDisable: boolean\r\n    }\r\n) => {\r\n    useEffect(() => {\r\n        if (props.isDisable) {\r\n            props.stateSetter('');\r\n        }\r\n    }, [props.isDisable]);\r\n    const strLen = props.stateValue.length;\r\n    return (\r\n        <div className={['form', props.isDisable ? 'disable' : ''].join(' ')}>\r\n            <span>{props.label}:</span>\r\n            <input\r\n                className={[\r\n                    !props.isDisable && strLen == 0 ? 'required' : '',\r\n                    !props.isDisable && (strLen < 5 || strLen > 15) ? 'range' : '',\r\n                    !props.isDisable && !isHanEisu(props.stateValue) ? 'ban' : ''\r\n                ].join(' ')}\r\n                type={props.isMask ? 'password' : 'text'}\r\n                value={props.stateValue}\r\n                onChange={(e) => props.stateSetter(e.target.value)}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nconst isHanEisu = (str: string) => {\r\n    str = (str == null) ? \"\" : str;\r\n    if (str.match(/^[A-Za-z0-9_!@]*$/)) {\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\nexport default LoginFrame;","import { GlobalContext } from 'contents/MainFrame';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport { useContext } from 'react';\r\nimport './UserPlate.css';\r\n\r\nconst UserPlate = (\r\n    props: {\r\n    }\r\n) => {\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n    return (\r\n        <div id=\"user-plate\" className={[''].join(' ')}>\r\n            <div className=\"user-name\">\r\n                <span>{state.login.name}</span>\r\n            </div>\r\n            <div\r\n                className=\"logout\"\r\n\r\n                onClick={() => {\r\n                    dispatcher.score.setNoteData({\r\n                        ...state.noteData,\r\n                        dataList: []\r\n                    });\r\n                    dispatcher.setLoginParams({\r\n                        ...state.login,\r\n                        isLogin: false,\r\n                        name: ''\r\n                    });\r\n                    dispatch(ActionType.SELECT_SCORETAB, { index: 0 });\r\n                }}>\r\n                <span>LOGOUT</span>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default UserPlate;","import { KEY12_SHARP_LIST } from \"contents/common/define\"\r\nimport { GlobalContext } from 'contents/MainFrame';\r\nimport { useContext, useEffect, useState } from 'react';\r\nimport './SamplerTab.css';\r\n\r\ntype SampleRecord = {\r\n    // 音名\r\n    soundName: string,\r\n    // レコードの利用有無\r\n    isUse: boolean,\r\n    // URL\r\n    url: string\r\n};\r\n\r\nconst SamplerTab = () => {\r\n    const { state, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [samples, setSamples] = useState<SampleRecord[]>();\r\n\r\n    useEffect(() => {\r\n\r\n        const samples: SampleRecord[] = [];\r\n\r\n        for (let i = 0; i <= 88; i++) {\r\n            samples.push(\r\n                {\r\n                    soundName: KEY12_SHARP_LIST[(i + 9) % 12] + Math.floor((i + 9) / 12),\r\n                    isUse: false,\r\n                    url: \"\"\r\n                },\r\n            );\r\n        }\r\n        setSamples(samples);\r\n    }, []);\r\n\r\n    const createRecoredJsxList = (): JSX.Element[] => {\r\n        const list: JSX.Element[] = [];\r\n        samples?.forEach((sample, i)=> {\r\n            list.push(\r\n                <div key={i} className=\"record\">\r\n                    <div className=\"label\"><span>{sample.soundName}</span></div>\r\n                    <input type=\"checkbox\"\r\n                        checked={sample.isUse}\r\n                        onChange={e => {\r\n                            sample.isUse = e.target.checked;\r\n                            setSamples(samples.slice());\r\n                        }}\r\n                    />\r\n                    <input\r\n                        type=\"text\"\r\n                        className={!sample.isUse ? 'disable' : ''}\r\n                        value={sample.url}\r\n                        onChange={e => {\r\n                            sample.url = e.target.value;\r\n                            setSamples(samples.slice());\r\n                        }} />\r\n                </div>\r\n            );\r\n        });\r\n        return list;\r\n    }\r\n\r\n    const getSamplesList = () => {\r\n        let samplesList = {};\r\n        for (let i = 0; i < 88; i++) {\r\n            if (samples && samples[i]) {\r\n                if (samples[i].isUse) {\r\n                    samplesList = { [samples[i].soundName]: samples[i].url };\r\n                }\r\n            }\r\n        }\r\n        return samplesList;\r\n    }\r\n\r\n    return (\r\n        <div id=\"samplertab-root\">\r\n            // サンプラーの読み込みdiv\r\n            <div className=\"loader\"></div>\r\n\r\n            // 音程リストdiv\r\n            <div className=\"list\">\r\n                {createRecoredJsxList()}\r\n            </div>\r\n\r\n            // 制御ボタンdiv\r\n            <div className=\"operation\">\r\n                <button\r\n                    className={[\r\n                        'disable'\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n\r\n                    }}>Save</button>\r\n\r\n                <button\r\n                    className={[\r\n                        'disable'\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n\r\n                    }}>Reset</button>\r\n\r\n                <button onClick={() => {\r\n                    dispatcher.setSampler(getSamplesList());\r\n                }}>Build</button>\r\n            </div>\r\n            <div className=\"keyboad\"></div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SamplerTab;","import { GlobalContext } from 'contents/MainFrame';\r\nimport { ActionType } from 'contents/redux/reducer';\r\nimport { useContext, useEffect } from 'react';\r\nimport styled from 'styled-components';\r\nimport { Helmet, HelmetProvider } from 'react-helmet-async'\r\nimport ScoreContPreviewTab from 'contents/systab/score/contTabs/preview/ScoreContPreviewTab';\r\nimport { sendQueryRequestToAPI } from 'contents/common/utils';\r\nimport { NoteElement } from 'contents/redux/store';\r\nimport { SclibEntity } from 'contents/common/Entity';\r\n\r\nconst Viewer = (\r\n    props: {\r\n        id: string\r\n    }\r\n) => {\r\n    const { state, dispatch, dispatcher } = useContext(GlobalContext);\r\n\r\n    useEffect(() => {\r\n        // alert('init');\r\n        let sclib: SclibEntity | null = null;\r\n        sendQueryRequestToAPI('select', `SELECT * FROM sclibtbl where id = ${props.id}`)\r\n            .then(response => {\r\n                return response.json();\r\n            })\r\n            .then(results => {\r\n                // console.log(results);\r\n                // console.log(`[${state.login.id}]score count: ` + results.length);\r\n                const isExist = results.length > 0;\r\n                if (isExist) {\r\n                    sclib = results[0];\r\n                    console.log(`data: ${sclib?.title}`);\r\n\r\n                    // (async () => {\r\n\r\n                    //     const noteData = state.noteData;\r\n                    //     const dataList: NoteElement[] = [];\r\n                    //     const response = await sendQueryRequestToAPI('select', `SELECT json from data_tbl where score = ${props.id} order by seq`);\r\n                    //     const results = await response.json();\r\n                    //     // alert(JSON.stringify(results));\r\n                    //     results.forEach((result: { json: string }) => {\r\n                    //         dataList.push(JSON.parse(result.json));\r\n                    //     });\r\n                    //     noteData.dataList = dataList;\r\n                    //     if (sclib != null) {\r\n                    //         noteData.scoreName = sclib.title;\r\n                    //         noteData.chordMode = sclib.chord_mode;\r\n                    //         if (sclib.tune != null) {\r\n                    //             noteData.columnList = JSON.parse(sclib.tune);\r\n                    //         }\r\n                    //     }\r\n\r\n                    //     // state.noteState.cuScoreId = props.id;\r\n                    //     // const soundFont = state.noteData.soundFont;\r\n                    //     // soundFont.name = selectedRecord.soundfont == null ? '' : selectedRecord.soundfont as Soundfont.InstrumentName;\r\n                    //     // soundFont.gain = selectedRecord.gain == null ? 1 : selectedRecord.gain;\r\n                    //     // state.noteData.columnList = selectedRecord.tune == null ? [] : JSON.parse(selectedRecord.tune);\r\n                    //     dispatcher.score.setNoteState({ ...state.noteState });\r\n                    //     dispatcher.score.setNoteData(noteData);\r\n                    //     // dispatch(ActionType.SELECT_NOTE_ELEMENT, { index: 2 });\r\n                    //     dispatch(ActionType.SELECT_SCORETAB, { index: 5 });\r\n                    // })();\r\n                } else {\r\n                }\r\n            })\r\n            .catch(error => {\r\n                console.log(error + \"失敗しました\");\r\n            });\r\n    }, []);\r\n    return (\r\n        <_Wrap>\r\n            {/* <HelmetProvider>\r\n                <Helmet\r\n                    title=\"VH Viewer\"\r\n                    meta={[\r\n                        { property: 'og:title', content: 'VH Viewer' },\r\n                        { property: 'og:type', content: 'website' },\r\n                        { property: 'og:url', content: 'http://path/to/this/url' },\r\n                        { property: 'og:image', content: 'https://www.uxpin.com/studio/wp-content/uploads/2020/12/The-Best-React-Design-Patterns-You-Should-Know-About-1-1024x512.png' },\r\n                        { property: 'og:description', content: `Viewer Title = ${props.id}` },\r\n                    ]}\r\n                />\r\n            </HelmetProvider>\r\n            <_Confirm>{`ID=${props.id}`}</_Confirm> */}\r\n            <ScoreContPreviewTab />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default Viewer;\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 20px);\r\n    height: calc(100% - 20px);\r\n    margin: 10px 0 0 10px;\r\n    background-color: #9e1717;\r\n`;\r\n\r\nconst _Confirm = styled.div`\r\n    display: inline-block;\r\n    font-size: 40px;\r\n    font-weight: 600;\r\n    color: white;\r\n`","import './MainFrame.css';\r\n\r\nimport TabbedPane from 'contents/common/TabbedPane';\r\nimport {\r\n    Route,\r\n    Link,\r\n    Switch,\r\n    useLocation,\r\n    useParams,\r\n    BrowserRouter,\r\n    HashRouter\r\n} from 'react-router-dom'\r\nimport ScoreTab from 'contents/systab/score/ScoreTab';\r\nimport { initialState, Store, Action } from 'contents/redux/store';\r\nimport { ActionType, reducer } from 'contents/redux/reducer';\r\nimport { createContext, useReducer, KeyboardEvent, useEffect } from 'react';\r\nimport { keyboardShortCutAction } from './keyboad/KeyboardShortCutAction';\r\nimport { Dispatcher } from './redux/dispatcher';\r\nimport LoginFrame from './login/LoginFrame';\r\nimport UserPlate from './user/UserPlate';\r\nimport SamplerTab from './systab/sampler/SamplerTab';\r\nimport Viewer from './viewer/Viewer';\r\n\r\n\r\ntype GlobalContextType = {\r\n    state: Store;\r\n    dispatch: Function;\r\n    dispatcher: Dispatcher;\r\n}\r\n\r\nexport const GlobalContext = createContext({} as GlobalContextType);\r\n\r\ninterface RouterParams {\r\n    id: string\r\n}\r\n\r\n\r\nconst MainFrame = () => {\r\n\r\n    const ROUTER_BASENAME = process.env.NODE_ENV === 'development' ? '/' : '/vh-react';\r\n    return (\r\n        // <BrowserRouter>\r\n        <HashRouter basename={process.env.PUBLIC_URL}>\r\n        {/* <BrowserRouter basename={ROUTER_BASENAME}> */}\r\n            <Router />\r\n        </HashRouter>\r\n    );\r\n}\r\n\r\nconst Router = () => {\r\n\r\n    const [state, dispatchBase] = useReducer(reducer, initialState);\r\n    const dispatch = (actionType: ActionType, payload: any) => dispatchBase({ type: actionType, payload: payload });\r\n    const dispatcher = new Dispatcher(state, dispatchBase);\r\n\r\n    const query = new URLSearchParams(useLocation().search);\r\n    \r\n    useEffect(()=> {\r\n        const userAgent = window.navigator.userAgent.toLowerCase();\r\n        alert(userAgent);\r\n    }, []);\r\n\r\n    return (\r\n        <div\r\n            id=\"main-frame\"\r\n            tabIndex={999}\r\n            onKeyDown={(e: KeyboardEvent) => keyboardShortCutAction(e, state, dispatch, dispatcher)}\r\n        >\r\n            <GlobalContext.Provider value={{ state, dispatch, dispatcher }}>\r\n\r\n                <Switch>\r\n                    <Route path=\"/\" exact>\r\n                        {\r\n                            !state.login.isLogin ?\r\n                                <LoginFrame />\r\n                                :\r\n                                <>\r\n                                    <UserPlate />\r\n                                    <TabbedPane groupName=\"system-tabs\"\r\n                                        tabElements={[\r\n                                            { name: 'Account', disable: true, cont: <div></div> },\r\n                                            { name: 'Palette', disable: true, cont: <div></div> },\r\n                                            { name: 'Score', disable: false, cont: <ScoreTab /> },\r\n                                            { name: 'Backing', disable: true, cont: <div></div> },\r\n                                            { name: 'Symbol', disable: true, cont: <div></div> },\r\n                                            { name: 'Sampler', disable: false, cont: <SamplerTab /> },\r\n                                            { name: 'Setting', disable: true, cont: <div></div> }\r\n                                        ]}\r\n                                        activeNo={2}\r\n                                    />\r\n                                </>\r\n                        }\r\n                        {((): JSX.Element => {\r\n                            const dialog = state.dialog;\r\n                            if (dialog.contents != null) {\r\n                                return (\r\n                                    <div className=\"dialog-cover\">\r\n                                        <div\r\n                                            className=\"dialog\"\r\n                                            style={{ left: dialog.left, top: dialog.top }}\r\n                                        >{dialog.contents}</div>\r\n                                    </div>\r\n                                )\r\n                            }\r\n                            return <></>;\r\n                        })()}\r\n                    </Route>\r\n                    <Route path=\"/test\" exact >\r\n                        <Viewer id={'aa'}/>\r\n                    </Route>\r\n                    <Route path=\"/viewer\" exact >\r\n                        <Viewer id={query.get('v') as string}/>\r\n                    </Route>\r\n                </Switch>\r\n            </GlobalContext.Provider>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default MainFrame;\r\n","import React, { useEffect } from 'react';\r\n\r\n// import Tone from 'lib/Tone.min.js';\r\n// import Tone from \"react-tone\";\r\nimport * as Tone from \"tone\";\r\n\r\nimport './desty.css';\r\nimport './App.css';\r\nimport MainFrame from 'contents/MainFrame';\r\n\r\nfunction App() {\r\n  useEffect(() => {\r\n    // 右クリック無効\r\n    document.oncontextmenu = function () { return false; }\r\n\r\n    window.addEventListener(\"keydown\", function (e) {\r\n      // space and arrow keys\r\n      if ([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {\r\n        e.preventDefault();\r\n      }\r\n    }, false);\r\n\r\n  }, []);\r\n  return (\r\n    <MainFrame />\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}