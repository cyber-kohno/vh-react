(this["webpackJsonpvh-react-ts"]=this["webpackJsonpvh-react-ts"]||[]).push([[0],Array(27).concat([function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n,c,s=a(4),i=a.n(s),l=a(18),r=a.n(l),o=(a(27),a(28),a(29),a(5)),d=(a(30),a(31),a(0)),u=function(e){var t=[];return t.push("tab-menu"),t.push(e.isActive?"active":""),t.push(e.isDisable?"tab-disable":""),Object(d.jsx)("div",{className:t.join(" "),onClick:function(){return e.selectTab()},children:Object(d.jsx)("span",{children:e.name})})},b=function(e){return Object(d.jsx)("div",{className:["tab-cont",e.isActive?"":"hidden"].join(" "),children:e.cont})},j=function(e){var t=Object(s.useState)(e.activeNo),a=Object(o.a)(t,2),n=a[0],c=a[1];return Object(s.useEffect)((function(){c(e.activeNo)}),[e.activeNo]),Object(d.jsxs)("div",{id:e.groupName,children:[Object(d.jsx)("div",{className:"tab-list",children:e.tabElements.map((function(t,a){return Object(d.jsx)(u,{name:t.name,isActive:a==n,isDisable:t.disable,selectTab:function(){return function(t){void 0!==e.selectTabIndex?e.selectTabIndex(t):c(t)}(a)}},a)}))}),Object(d.jsx)("div",{className:"cont-list",children:e.tabElements.map((function(e,t){return Object(d.jsx)(b,{cont:e.cont,isActive:t==n},t)}))})]})},h=(a(33),a(2)),O=(a(34),["\u2160","b\u2161","\u2161","b\u2162","\u2162","\u2163","b\u2164","\u2164","b\u2165","\u2165","b\u2166","\u2166"]),E=["\u2160","#\u2160","\u2161","#\u2161","\u2162","\u2163","#\u2163","\u2164","#\u2164","\u2165","#\u2165","\u2166"],f=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],m=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],x=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],T=["Cm","C#m","Dm","D#m","Em","Fm","F#m","Gm","G#m","Am","Bbm","Bm"],p=["major","minor"],v=["4/4","2/4","3/4","6/8","12/8"];!function(e){e.BEAT_4ON4="4/4",e.BEAT_2ON4="2/4",e.BEAT_3ON4="3/4",e.BEAT_6ON8="6/8",e.BEAT_12ON8="12/8"}(n||(n={})),function(e){e.C_DUR="0",e.DES_DUR="1"}(c||(c={}));var S,N,g=["\u2160","\u2160maj7","\u2161m","\u2161m7","\u2162m","\u2162m7","\u2163","\u2163maj7","\u2164","\u21647","\u2165m","\u2165m7","\u2166m(-5)","\u2166m7(-5)"],A=["\u2160m","\u2160m7","\u2161m(-5)","\u2161m7(-5)","b\u2162","b\u2162M7","\u2163m","\u2163m7","\u2164m","\u2164m7","b\u2165","b\u2165M7","b\u2166","b\u21667"];!function(e){e[e.MAJOR=0]="MAJOR",e[e.MINOR=1]="MINOR",e[e.SUS4=2]="SUS4",e[e.DIM=3]="DIM",e[e.AUG=4]="AUG",e[e.MAJ7=5]="MAJ7",e[e.SEVENTH=6]="SEVENTH",e[e.MIN7=7]="MIN7",e[e.MINOR_MAJ7=8]="MINOR_MAJ7",e[e.ADD9=9]="ADD9",e[e.MINOR_ADD9=10]="MINOR_ADD9",e[e.SIXTH_9TH=11]="SIXTH_9TH",e[e.MINOR_MINUS5=12]="MINOR_MINUS5"}(S||(S={})),function(e){e[e.TRIAD=0]="TRIAD",e[e.TETRAD7TH=1]="TETRAD7TH",e[e.TETRAD9TH=2]="TETRAD9TH",e[e.OTHER=3]="OTHER"}(N||(N={}));var L,y,C,I,k,_,D,R,F,P,M=[{key:S.MAJOR,category:N.TRIAD,name:"",struct:["p1","M3","p5"],intervals:[0,4,7]},{key:S.MINOR,category:N.TRIAD,name:"m",struct:["p1","m3","p5"],intervals:[0,3,7]},{key:S.SUS4,category:N.TRIAD,name:"sus4",struct:["p1","p4","p5"],intervals:[0,5,7]},{key:S.DIM,category:N.TRIAD,name:"dim",struct:["p1","m3","d5"],intervals:[0,3,6]},{key:S.AUG,category:N.TRIAD,name:"aug",struct:["p1","M3","a5"],intervals:[0,4,8]},{key:S.MAJ7,category:N.TETRAD7TH,name:"maj7",struct:["p1","M3","p5","M7"],intervals:[0,4,7,11]},{key:S.SEVENTH,category:N.TETRAD7TH,name:"7",struct:["p1","M3","p5","m7"],intervals:[0,4,7,10]},{key:S.MIN7,category:N.TETRAD7TH,name:"m7",struct:["p1","m3","p5","m7"],intervals:[0,3,7,10]},{key:S.MINOR_MAJ7,category:N.TETRAD7TH,name:"mmaj7",struct:["p1","m3","p5","M7"],intervals:[0,3,7,11]},{key:S.ADD9,category:N.TETRAD9TH,name:"add9",struct:["p1","M2","M3","p5"],intervals:[0,2,4,7]},{key:S.MINOR_ADD9,category:N.TETRAD9TH,name:"madd9",struct:["p1","M2","m3","p5"],intervals:[0,2,3,7]},{key:S.SIXTH_9TH,category:N.OTHER,name:"6(9)",struct:["p1","M2","M3","p5","M6"],intervals:[0,2,4,7,9]},{key:S.MINOR_MINUS5,category:N.TRIAD,name:"m(-5)",struct:["p1","m3","d5"],intervals:[0,3,6]}],w=(N.TRIAD,S.MAJOR,S.MINOR,S.SUS4,S.DIM,S.AUG,S.MINOR_MINUS5,N.TETRAD7TH,S.MAJ7,S.SEVENTH,S.MINOR_MAJ7,N.TETRAD9TH,S.ADD9,S.MINOR_ADD9,[{degreeIndex:0,symbolKey:S.MAJOR,isFlat:!1},{degreeIndex:2,symbolKey:S.MINOR,isFlat:!1},{degreeIndex:4,symbolKey:S.MINOR,isFlat:!1},{degreeIndex:5,symbolKey:S.MAJOR,isFlat:!1},{degreeIndex:7,symbolKey:S.MAJOR,isFlat:!1},{degreeIndex:9,symbolKey:S.MINOR,isFlat:!1},{degreeIndex:11,symbolKey:S.MINOR_MINUS5,isFlat:!1}]),B=[{degreeIndex:0,symbolKey:S.MINOR,isFlat:!1},{degreeIndex:2,symbolKey:S.MINOR_MINUS5,isFlat:!1},{degreeIndex:3,symbolKey:S.MAJOR,isFlat:!0},{degreeIndex:5,symbolKey:S.MINOR,isFlat:!1},{degreeIndex:7,symbolKey:S.MINOR,isFlat:!1},{degreeIndex:8,symbolKey:S.MAJOR,isFlat:!0},{degreeIndex:10,symbolKey:S.MAJOR,isFlat:!0}],G=a(22);!function(e){e[e.NONE=0]="NONE",e[e.CONTEXT_MENU=1]="CONTEXT_MENU",e[e.CHORD_PALETTE=2]="CHORD_PALETTE",e[e.SECTION_PALETTE=3]="SECTION_PALETTE",e[e.CHANGE_PALETTE=4]="CHANGE_PALETTE",e[e.INIT_PALETTE=5]="INIT_PALETTE",e[e.BACKING_PALETTE=6]="BACKING_PALETTE",e[e.SETTING_EDITOR=7]="SETTING_EDITOR"}(L||(L={})),function(e){e[e.Root=0]="Root",e[e.Symbol=1]="Symbol",e[e.Sustain=2]="Sustain",e[e.Adjuster=3]="Adjuster"}(y||(y={})),function(e){e.LEFT="LEFT",e.RIGHT="RIGHT"}(C||(C={})),function(e){e.LEN16="LEN16",e.LEN8="LEN8",e.LEN4="LEN4",e.LEN2="LEN2",e.LEN1="LEN1"}(I||(I={})),function(e){e.SCALE="SCALE",e.DIRECT="DIRECT"}(k||(k={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.BACKING=1]="BACKING",e[e.PREVIEW=2]="PREVIEW"}(_||(_={})),function(e){e.MODULATE="Modulate",e.TEMPO="Tempo",e.BEAT="Beat"}(D||(D={})),function(e){e.DOMINANT="Domminant",e.PARALLEL="Parallel",e.RELATIVE="Relative",e.KEY="Key"}(R||(R={})),function(e){e.DIFF="Diff",e.RATE="Rate",e.ABSOLUTE="Absolute"}(F||(F={})),function(e){e.Init="init",e.Section="section",e.Chord="chord",e.Change="Change",e.Fixed="fixed"}(P||(P={}));var H,K={login:{isLogin:!1,id:-1,name:""},scoreTabIndex:0,noteData:{scoreName:"",chordMode:k.SCALE,dataList:[]},noteState:{focusIndex:-1,cacheList:[],criteriaIndex:-1,editMode:_.NORMAL,selectedList:[],defaultSustain:2,floatwndState:L.NONE,chordPaletteState:{isAddition:!1,selectedLine:y.Root,molecule:{rootIndex:0,isFlat:!1},denominator:null,symbolKey:M[0].key,sustain:4,headAdjust:0,tailAdjust:0},backingPaletteState:null,backingThreads:[]},reffers:{},sampler:new G.a({E2:"https://dl.dropbox.com/s/0aghs80w9aggubw/KEPSREC040.mp3?dl=0",E3:"https://dl.dropbox.com/s/wxtf0u0ly03hu44/KEPSREC052.mp3?dl=0","A#3":"https://dl.dropbox.com/s/hbm9d1vo5tlxymk/KEPSREC058.mp3?dl=0",E4:"https://dl.dropbox.com/s/3qy88udfkzmzr13/KEPSREC064.mp3?dl=0",E5:"https://dl.dropbox.com/s/tdjp24r9pfoi2ff/KEPSREC076.mp3?dl=0",E6:"https://dl.dropbox.com/s/onp7h2vn2d6nhs7/KEPSREC088.mp3?dl=0"}).toDestination(),soundUseList:new Array(88)};!function(e){e[e.SET_LOGIN=0]="SET_LOGIN",e[e.SELECT_SCORETAB=1]="SELECT_SCORETAB",e[e.ADD_SECTION=2]="ADD_SECTION",e[e.SET_DEGREE_INDEX=3]="SET_DEGREE_INDEX",e[e.SET_SYMBOL_KEY=4]="SET_SYMBOL_KEY",e[e.DETAIL_PARAMS_SETTER=5]="DETAIL_PARAMS_SETTER",e[e.GET_ELEMENT_REFFER=6]="GET_ELEMENT_REFFER",e[e.INIT_DEFAULT_ELEMENTS=7]="INIT_DEFAULT_ELEMENTS",e[e.SELECT_NOTE_ELEMENT=8]="SELECT_NOTE_ELEMENT",e[e.GET_REFFER=9]="GET_REFFER",e[e.GET_REFFER_CONTEXT=10]="GET_REFFER_CONTEXT",e[e.GET_REFFER_CHORD_PALETTE=11]="GET_REFFER_CHORD_PALETTE",e[e.GET_REFFER_SECTION_PALETTE=12]="GET_REFFER_SECTION_PALETTE",e[e.GET_REFFER_BACKING_PALETTE=13]="GET_REFFER_BACKING_PALETTE",e[e.FLOATWND_STATE=14]="FLOATWND_STATE",e[e.CHORD_PALETTE_SETTER=15]="CHORD_PALETTE_SETTER",e[e.SET_NOTE_DATA=16]="SET_NOTE_DATA",e[e.SET_DATA_LIST=17]="SET_DATA_LIST",e[e.SET_NOTE_STATE=18]="SET_NOTE_STATE",e[e.INIT_BACKING_PALETTE=19]="INIT_BACKING_PALETTE",e[e.SET_USE_CHANNELS=20]="SET_USE_CHANNELS",e[e.BACKING_TOGGLE_MATRIX=21]="BACKING_TOGGLE_MATRIX"}(H||(H={}));var U=function(e,t){var a=t.type,n=t.payload;switch(a){case H.SET_LOGIN:return Object(h.a)(Object(h.a)({},e),{},{login:n.login});case H.SELECT_SCORETAB:return Object(h.a)(Object(h.a)({},e),{},{scoreTabIndex:n.index});case H.ADD_SECTION:var c=e.noteData.dataList.slice(),s={labelName:"Section"};return c.splice(n.index+1,0,{type:P.Section,detail:s}),Object(h.a)(Object(h.a)({},e),{},{noteData:Object(h.a)(Object(h.a)({},e.noteData),{},{dataList:c})});case H.SET_DEGREE_INDEX:var i=e.noteData.dataList[n.pos].detail;return null==i.molecule?i.molecule={rootIndex:n.degreeIndex,isFlat:!1}:i.molecule.rootIndex=n.degreeIndex,Object(h.a)(Object(h.a)({},e),{},{noteData:Object(h.a)(Object(h.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case H.SET_SYMBOL_KEY:return e.noteData.dataList[n.pos].detail.symbolKey=n.symbolKey,Object(h.a)(Object(h.a)({},e),{},{noteData:Object(h.a)(Object(h.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case H.INIT_DEFAULT_ELEMENTS:return Object(h.a)(Object(h.a)({},e),{},{noteData:Object(h.a)(Object(h.a)({},e.noteData),{},{dataList:[{type:P.Init,detail:{tempo:80,rythm:"4/4",keyIndex:0,scale:"major"}},{type:P.Fixed,detail:{label:"START"}},{type:P.Section,detail:{labelName:"Section"}},{type:P.Fixed,detail:{label:"END"}}]}),noteState:Object(h.a)(Object(h.a)({},e.noteState),{},{cacheList:[{},{},{},{}]})});case H.SELECT_NOTE_ELEMENT:return Object(h.a)(Object(h.a)({},e),{},{noteState:Object(h.a)(Object(h.a)({},e.noteState),{},{focusIndex:n.index})});case H.GET_REFFER_CONTEXT:return Object(h.a)(Object(h.a)({},e),{},{reffers:Object(h.a)(Object(h.a)({},e.reffers),{},{contextMneu:n.reffer})});case H.GET_REFFER_CHORD_PALETTE:return Object(h.a)(Object(h.a)({},e),{},{reffers:Object(h.a)(Object(h.a)({},e.reffers),{},{chordPalette:n.reffer})});case H.GET_REFFER_SECTION_PALETTE:return Object(h.a)(Object(h.a)({},e),{},{reffers:Object(h.a)(Object(h.a)({},e.reffers),{},{sectionPalette:n.reffer})});case H.GET_REFFER_BACKING_PALETTE:return Object(h.a)(Object(h.a)({},e),{},{reffers:Object(h.a)(Object(h.a)({},e.reffers),{},{backingPalette:n.reffer})});case H.FLOATWND_STATE:return Object(h.a)(Object(h.a)({},e),{},{noteState:Object(h.a)(Object(h.a)({},e.noteState),{},{floatwndState:n.state})});case H.CHORD_PALETTE_SETTER:return Object(h.a)(Object(h.a)({},e),{},{noteState:Object(h.a)(Object(h.a)({},e.noteState),{},{chordPaletteState:n.params})});case H.DETAIL_PARAMS_SETTER:var l=e.noteData.dataList.slice();return l[n.pos].detail=n.params,Object(h.a)(Object(h.a)({},e),{},{noteData:Object(h.a)(Object(h.a)({},e.noteData),{},{dataList:l})});case H.GET_REFFER:return Object(h.a)(Object(h.a)({},e),{},{reffers:n.reffers});case H.SET_NOTE_DATA:return Object(h.a)(Object(h.a)({},e),{},{noteData:n.data});case H.SET_DATA_LIST:return Object(h.a)(Object(h.a)({},e),{},{noteData:Object(h.a)(Object(h.a)({},e.noteData),{},{dataList:n.dataList})});case H.SET_NOTE_STATE:return Object(h.a)(Object(h.a)({},e),{},{noteState:n.noteState});case H.GET_ELEMENT_REFFER:return e.noteState.cacheList[n.pos].reffer=n.reffer,Object(h.a)(Object(h.a)({},e),{},{noteState:Object(h.a)(Object(h.a)({},e.noteState),{},{cacheList:e.noteState.cacheList})});case H.INIT_BACKING_PALETTE:return Object(h.a)(Object(h.a)({},e),{},{noteState:Object(h.a)(Object(h.a)({},e.noteState),{},{backingPaletteState:n.backingPaletteState})});case H.SET_USE_CHANNELS:var r=e.noteState.backingPaletteState,o=n.useChannels;return Object(h.a)(Object(h.a)({},e),{},{noteState:Object(h.a)(Object(h.a)({},e.noteState),{},{backingPaletteState:Object(h.a)(Object(h.a)({},r),{},{useChannels:o})})});case H.BACKING_TOGGLE_MATRIX:var d=e.noteState.backingPaletteState,u=n.sideIndex,b=n.lenIndex,j=n.channelIndex,O=n.divIndex,E=d.layers;return E[u].table[j][b][O]=n.isUse,Object(h.a)(Object(h.a)({},e),{},{noteState:Object(h.a)(Object(h.a)({},e.noteState),{},{backingPaletteState:Object(h.a)(Object(h.a)({},d),{},{layers:E})})})}};function W(e){var t=null;return M.forEach((function(a){a.key==e&&(t=a)})),t}var V,J,z,X=function(e){var t="";return 0!=e&&(t=e>0?"+"+e:e.toString()),t},Y=function(e,t){var a=null;null!=e&&(a=(e.isFlat?f:m)[(e.rootIndex+t)%12]);return a},q=function(e,t){return fetch("https://vh-sqlite.glitch.me/"+e,function(e){return{mode:"cors",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({sql:e})}}(t))},Z=function(e,t,a){var n=a-t;n<0&&(n+=12);var c=[],s=[],i=!1;e.intervals.forEach((function(t,a){a<e.intervals.length&&(!i&&n<t&&(c.push(n),s.push("den"),i=!0),n!=t&&(c.push(t),s.push(e.struct[a])))})),i||(c.push(n),s.push("den")),e.intervals=c,e.struct=s},$=function(e){var t=null;null!=e&&(t=(e.isFlat?O:E)[e.rootIndex]);return t},Q=function(e){var t=Object(s.useContext)($e),a=t.state,n=t.dispatcher,c=a.noteData.chordMode,i=a.noteState.cacheList[e.index];switch(e.noteElement.type){case P.Fixed:var l=e.noteElement.detail;return Object(d.jsx)("span",{children:l.label});case P.Init:var r=e.noteElement.detail,o=[];return o.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Tempo: "}),Object(d.jsx)("span",{children:r.tempo})]},o.length)),o.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Beat: "}),Object(d.jsx)("span",{children:r.rythm})]},o.length)),c==k.SCALE&&(o.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Scale: "}),Object(d.jsx)("span",{children:r.scale})]},o.length)),o.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Key: "}),Object(d.jsx)("span",{children:r.scale==p[0]?x[r.keyIndex]:T[r.keyIndex]})]},o.length))),Object(d.jsx)("div",{children:o});case P.Chord:var u=e.noteElement.detail,b=$(u.molecule),j=$(u.denominator),h=Y(u.molecule,i.init.keyIndex),O=Y(u.denominator,i.init.keyIndex),E="",f=!1,m="blank",v="-";if(null!=b)E=function(e){var t="";return M.forEach((function(a){a.key==e&&(t=a.name)})),t}(u.symbolKey),f=("major"==i.init.scale?g:A).includes(b+E),m="".concat(b).concat(E).concat(null==j?"":"/"+j),v="".concat(h).concat(E).concat(null==O?"":"/"+O);for(var S=[],N=0;N<u.sustain;N++)S.push(Object(d.jsx)("span",{},N));var L=i.progress.barCount,y=i.progress.remaindBeat,C=Math.round(i.progress.headMSec/1e3*10)/10,I=n.backing.getNotesCount(u.backing);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"degree"+(null==u.molecule?" blank":"")+(f?" diatonic":"")+(a.noteData.chordMode==k.DIRECT?" visible":""),children:Object(d.jsx)("span",{children:m})}),Object(d.jsx)("div",{className:a.noteData.chordMode==k.DIRECT?"degree":"chord",children:Object(d.jsx)("span",{children:v})}),Object(d.jsx)("div",{className:"sustain",children:S}),Object(d.jsxs)("div",{className:"progress-sustain",children:[Object(d.jsx)("span",{className:"bar",children:-1!=L?L:""}),Object(d.jsx)("span",{className:"beat",children:-1!=y?y:""})]}),Object(d.jsx)("div",{className:"progress-time",children:Object(d.jsxs)("span",{children:[C,"s"]})}),Object(d.jsx)("div",{className:"backing-script"+(0==I?" hidden":""),children:Object(d.jsxs)("span",{children:["notes: ",I]})})]});case P.Section:var _=e.noteElement.detail;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"name",children:Object(d.jsx)("span",{children:_.labelName})}),Object(d.jsx)("div",{className:"border"})]});case P.Change:var w=e.noteElement.detail,B=a.noteState.cacheList[e.index-1],G=Object(d.jsx)(d.Fragment,{});switch(w.changeType){case null:G=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:"No setting"})}),Object(d.jsxs)("div",{className:"result",children:[Object(d.jsx)("span",{children:"***"}),"]"]})]});break;case D.MODULATE:var H=null===w.modulateRelation?"None":w.modulateRelation.toString(),K=w.modulateRelation===R.DOMINANT||w.modulateRelation===R.KEY,U=0,W=B.init.keyIndex,V="minor"==B.init.scale,J=i.init.keyIndex,z="minor"==i.init.scale;switch(w.modulateRelation){case R.DOMINANT:U=w.domminantValue;break;case R.KEY:U=w.keyAdjust;break;case R.RELATIVE:case R.PARALLEL:}var X=(V?T:x)[W],q=(z?T:x)[J];G=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("div",{className:"value",children:[Object(d.jsx)("span",{children:H+(K?": ":"")}),K?Object(d.jsx)("span",{children:U}):Object(d.jsx)(d.Fragment,{})]}),Object(d.jsx)("div",{className:"result",children:Object(d.jsxs)("span",{children:[X," \u2192 ",q]})})]});break;case D.TEMPO:var Z=null===w.tempoRelation?"None":w.tempoRelation.toString(),Q=0,ee=B.init.tempo,te=i.init.tempo;switch(w.tempoRelation){case F.DIFF:Q=w.tempoDiff;break;case F.RATE:Q=w.tempoRate;break;case F.ABSOLUTE:Q=w.tempoAbsolute}G=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("div",{className:"value",children:[Object(d.jsx)("span",{children:Z+": "}),Object(d.jsx)("span",{children:Q})]}),Object(d.jsx)("div",{className:"result",children:Object(d.jsx)("span",{children:"".concat(ee," \u2192 ").concat(te)})})]});break;case D.BEAT:G=Object(d.jsx)(d.Fragment,{})}return k.SCALE,Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"change-type",children:Object(d.jsx)("span",{children:null===w.changeType?"Change":w.changeType.toString()})}),G]})}},ee=(a(44),function(e){var t=Object(s.useContext)($e),a=t.state,n=t.dispatch,c=t.dispatcher,i=e.index<a.noteData.dataList.length,l=Object(s.useRef)({});if(Object(s.useEffect)((function(){i&&n(H.GET_ELEMENT_REFFER,{pos:e.index,reffer:l.current})}),[a.noteData.dataList]),!i)return Object(d.jsx)(d.Fragment,{});var r=e.noteElement.type,o=a.noteState.editMode,u=a.noteData.chordMode,b=a.noteState.cacheList[e.index],j=a.noteState.focusIndex,O=j==e.index,E=a.noteState.criteriaIndex==e.index,f=function(){a.noteData.dataList[e.index].type!=P.Fixed&&n(H.SELECT_NOTE_ELEMENT,{index:e.index})},m=Object(d.jsx)(d.Fragment,{});return e.index==a.noteData.dataList.length-2&&(m=Object(d.jsx)("div",{className:"addition"+(o==_.NORMAL?"":" disable"),onClick:function(){n(H.SELECT_NOTE_ELEMENT,{index:e.index}),c.score.addChordElement(),n(H.SELECT_NOTE_ELEMENT,{index:e.index+1}),n(H.FLOATWND_STATE,{state:L.CHORD_PALETTE}),n(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},a.noteState.chordPaletteState),{},{isAddition:!0,rootIndex:0,isFlat:!1,symbolKey:M[0].key,sustain:4})})},children:Object(d.jsx)("span",{children:"+"})})),Object(d.jsxs)("div",{className:"box",children:[Object(d.jsxs)("div",{className:"info-base",children:[Object(d.jsx)("div",{className:"header",children:function(){var t=[];if([P.Chord,P.Section,P.Change].includes(r)){if(P.Chord==r){t.push(Object(d.jsx)("div",{className:"chord-no",children:Object(d.jsx)("span",{children:b.progress.no})},t.length));var a="major"==b.init.scale,n=(a?x:T)[b.init.keyIndex];u===k.SCALE&&t.push(Object(d.jsx)("div",{className:["scale",a?"maj":"min"].join(" "),children:Object(d.jsxs)("span",{children:["[",n,"]"]})},t.length))}t.push(Object(d.jsx)("div",{className:"del"+(o==_.NORMAL?"":" hidden"),onClick:function(){c.score.deleteElement(e.index)},children:Object(d.jsx)("span",{children:"\xd7"})},t.length))}return Object(d.jsx)(d.Fragment,{children:t})}()}),Object(d.jsx)("div",{className:["note-element",function(){switch(r){case P.Fixed:return"detail-fixed";case P.Init:return"detail-init";case P.Chord:return"detail-chord";case P.Section:return"detail-section";case P.Change:return"detail-change"}}(),O?"active":"",E?"criteria":"",[P.Init,P.Section,P.Chord,P.Change].includes(r)?"selectable":"",function(){var t=a.noteData.dataList,n=[t.length],c=-1,s=-1;return t.forEach((function(e,t){e.type==P.Section&&c++,n[t]=c,j==t&&(s=c)})),n[e.index]==s&&r!=P.Fixed}()?"current":"",o!=_.BACKING?"":r==P.Chord&&null!=e.noteElement.detail.molecule?a.noteState.selectedList.includes(e.index)?"copy-selected":"copy-tgt":"copy-no-tgt"].join(" "),onClick:function(){o==_.NORMAL?(f(),n(H.FLOATWND_STATE,{state:L.NONE})):function(){var t=a.noteState.selectedList;t.includes(e.index)?t.some((function(a,n){a==e.index&&t.splice(n,1)})):t.push(e.index),c.score.setSelectedList(t)}()},onContextMenu:function(t){if(o==_.NORMAL)switch(f(),a.noteData.dataList[e.index].type){case P.Init:n(H.FLOATWND_STATE,{state:L.INIT_PALETTE});break;case P.Section:case P.Chord:case P.Change:a.reffers.contextMneu.style.left=t.clientX+"px",a.reffers.contextMneu.style.top=t.clientY+"px",n(H.FLOATWND_STATE,{state:L.CONTEXT_MENU})}},ref:l,children:Object(d.jsx)(Q,{index:e.index,noteElement:e.noteElement})})]}),m]})}),te=function(e){var t=Object(s.useContext)($e),a=t.state;t.dispatch;return Object(d.jsx)("div",{className:function(){var t=a.noteData.dataList,n=a.noteState.focusIndex,c=-1,s=-1;return t.forEach((function(e,t){e.type==P.Section&&c++,n==t&&(s=c)})),s==e.index}()?"active":"",children:Object(d.jsx)("span",{children:e.label})})},ae=(a(45),function(e){return Object(d.jsxs)("div",{className:e.disable?"disable":"",onClick:function(){e.executer()},children:[Object(d.jsx)("span",{className:e.menuType,children:e.label}),Object(d.jsx)("span",{className:"key",children:"<".concat(e.keyName," key>")})]})}),ne=function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,n=e.dispatcher,c=function(){return a(H.FLOATWND_STATE,{state:L.NONE})},i=Object(s.useRef)({});Object(s.useEffect)((function(){a(H.GET_REFFER_CONTEXT,{reffer:i.current})}),[]);var l=[];if(t.noteState.floatwndState==L.CONTEXT_MENU){var r=t.noteData.dataList[t.noteState.focusIndex];switch(l.push({menuType:"order",label:"INSERT BLANK",keyName:"A",disable:!1,executer:function(){n.score.addChordElement(),c()}}),l.push({menuType:"call",label:"INSERT CHORD",keyName:"W",disable:!1,executer:function(){n.score.addChordElement(),a(H.SELECT_NOTE_ELEMENT,{index:t.noteState.focusIndex+1}),a(H.FLOATWND_STATE,{state:L.CHORD_PALETTE});r.detail;a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},t.noteState.chordPaletteState),{},{isAddition:!0,molecule:{rootIndex:0,isFlat:!1},denominator:null,symbolKey:M[0].key,sustain:t.noteState.defaultSustain})})}}),l.push({menuType:"order",label:"INSERT SECTION",keyName:"S",disable:!1,executer:function(){n.score.addSectionElement(),c()}}),l.push({menuType:"order",label:"INSERT CHANGE",keyName:"F",disable:!1,executer:function(){n.score.addChangeElement(),c()}}),r.type){case P.Chord:var o=r.detail;l.push({menuType:"order",label:"SET BLANK",keyName:"D",disable:null==o.molecule,executer:function(){var e=t.noteData,a=e.dataList[t.noteState.focusIndex].detail;a.molecule=null,a.denominator=null,n.score.setNoteData(e),c()}}),l.push({menuType:"call",label:"EDIT CHORD",keyName:"C",disable:!1,executer:function(){n.score.callChordSelector()}}),l.push({menuType:"call",label:"EDIT BACKING",keyName:"B",disable:null==o.molecule,executer:function(){n.score.callBackingEditor()}}),l.push({menuType:"order",label:"COPY BACKING",keyName:"X",disable:null==o.molecule,executer:function(){n.score.setCriteria(),a(H.FLOATWND_STATE,{state:L.NONE})}});break;case P.Section:l.push({menuType:"call",label:"EDIT SECTION",keyName:"C",disable:!1,executer:function(){n.score.callSectionEditor()}});break;case P.Change:l.push({menuType:"call",label:"EDIT CHANGE",keyName:"C",disable:!1,executer:function(){n.score.callChangeEditor()}})}l.push({menuType:"order",label:"REMOVE",keyName:"DEL",disable:!1,executer:function(){n.score.deleteCurElement(),a(H.FLOATWND_STATE,{state:L.NONE})}})}var u=[];return l.forEach((function(e,t){u.push(Object(d.jsx)(ae,{menuType:e.menuType,label:e.label,keyName:e.keyName,disable:e.disable,executer:e.executer},t))})),Object(d.jsx)("div",{ref:i,id:"note-contextmenu",className:"floatwnd"+(t.noteState.floatwndState==L.CONTEXT_MENU?" active":""),onClick:function(){},children:u})},ce=(a(46),function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)(null),i=Object(s.useRef)(null),l=t.noteState.chordPaletteState,r=t.noteState.focusIndex,u=(t.noteData.dataList[r].detail,t.noteState.cacheList[r]);Object(s.useEffect)((function(){a(H.GET_REFFER_CHORD_PALETTE,{reffer:c.current});var e=i.current;e.width=590,e.height=66}),[]),Object(s.useEffect)((function(){t.noteState.floatwndState==L.CHORD_PALETTE&&b(l.molecule.rootIndex,null==l.denominator?-1:l.denominator.rootIndex,l.symbolKey)}),[l,t.noteState.floatwndState]);var b=function(e,t,a){var n=i.current.getContext("2d"),c=(u.init.keyIndex+e)%12,s=W(a).intervals.map((function(e){return c+e})),l=-1;-1!=t&&(l=u.init.keyIndex+t),n.fillStyle="#008",n.fillRect(0,0,594,70);for(var r=34,o=0,d=[],b=0;b<27;b++){var j="#eee",h=r,O=60,E=[1,3,6,8,10].includes(b%12);switch(E&&(j="#111",h=17,O=36),s.includes(b)&&(j="#fa0"),l==b&&(j="#ff0000"),d.push({posX:15+o,fillStyle:j,width:h,height:O,isBlack:E}),b%12){case 0:case 2:case 5:case 7:case 9:o+=25.5;break;case 1:case 3:case 6:case 8:case 10:o+=9.5;break;default:o+=35}}d.forEach((function(e){e.isBlack||(n.fillStyle=e.fillStyle,n.fillRect(e.posX,3,e.width,e.height))})),d.forEach((function(e){e.isBlack&&(n.fillStyle=e.fillStyle,n.fillRect(e.posX,3,e.width,e.height),n.fillStyle="#f00",n.strokeRect(e.posX,3,e.width,e.height))})),n.save()},x=[],T=[],p=[],v=Object(d.jsx)(d.Fragment,{}),S=t.noteData.chordMode==k.DIRECT;if(t.noteState.floatwndState==L.CHORD_PALETTE){E.forEach((function(e,n){var c=(u.init.keyIndex+n)%12,s=O[n],i=m[c],r=f[c],o=[1,3,6,8,10].includes(n),b=l.molecule.rootIndex==n,j=(null==l.denominator?-1:l.denominator.rootIndex)==n,E=function(a){return t.noteData.chordMode==k.SCALE?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{className:"degree",children:a?s:e}),Object(d.jsx)("span",{children:"\xa0("}),Object(d.jsx)("span",{className:"chord",children:a?r:i}),Object(d.jsx)("span",{children:")"})]}):Object(d.jsx)(d.Fragment,{children:Object(d.jsx)("span",{className:"degree",children:a?r:i})})};x.push(Object(d.jsx)("div",{children:o?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:["half",b&&!l.molecule.isFlat?" active":"",j&&null!=l.denominator&&!l.denominator.isFlat?" denominator":""].join(" "),onClick:function(){var e=!j||null==l.denominator||l.denominator.isFlat?l.denominator:null;a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{selectedLine:y.Root,molecule:{rootIndex:n,isFlat:!1},denominator:e})})},onContextMenu:function(){if(!b||l.molecule.isFlat){var e=!j||null==l.denominator||l.denominator.isFlat?{rootIndex:n,isFlat:!1}:null;a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{selectedLine:y.Root,denominator:e})})}},children:E(!1)}),Object(d.jsx)("div",{className:["half",b&&l.molecule.isFlat?" active":"",j&&null!=l.denominator&&l.denominator.isFlat?" denominator":""].join(" "),onClick:function(){var e=j&&null!=l.denominator&&l.denominator.isFlat?null:l.denominator;a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{selectedLine:y.Root,molecule:{rootIndex:n,isFlat:!0},denominator:e})})},onContextMenu:function(){if(!b||!l.molecule.isFlat){var e=j&&null!=l.denominator&&l.denominator.isFlat?null:{rootIndex:n,isFlat:!0};a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{selectedLine:y.Root,denominator:e})})}},children:E(!0)})]}):Object(d.jsx)("div",{className:[b?"active":"",j?"denominator":""].join(" "),onClick:function(){var e=j?null:l.denominator;a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{selectedLine:y.Root,molecule:{rootIndex:n,isFlat:!1},denominator:e})})},onContextMenu:function(){if(!b){var e=j?null:{rootIndex:n,isFlat:!1};a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{selectedLine:y.Root,denominator:e})})}},children:E(!1)})},n))})),M.forEach((function(e,t){T.push(Object(d.jsx)("div",{className:e.key==l.symbolKey?"active":"",onClick:function(){a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{selectedLine:y.Symbol,symbolKey:e.key})})},children:Object(d.jsxs)("span",{children:["[",e.name,"]"]})},t))}));for(var N=function(e){p.push(Object(d.jsx)("div",{className:l.sustain>=e+1?"active":"",onClick:function(){a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{selectedLine:y.Sustain,sustain:e+1})})}},e))},g=0;g<8;g++)N(g);v=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(H.FLOATWND_STATE,{state:L.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){n.chord.setCurChordParam()},children:Object(d.jsx)("span",{children:"Enter"})})]})}var A=function(e,t){var n="h"==e?["h","head",l.headAdjust==t,function(){return a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{headAdjust:t})})}]:["t","tail",l.tailAdjust==t,function(){return a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},l),{},{tailAdjust:t})})}],c=Object(o.a)(n,4),s=c[0],i=c[1],r=c[2],u=c[3];return t>=0&&(s+=t>0?"+":"\xb1"),Object(d.jsx)("div",{className:[i,r?"active":""].join(" "),onClick:u,children:Object(d.jsx)("span",{children:s+t})})};return Object(d.jsxs)("div",{ref:c,id:"total-palette",className:"floatwnd"+(t.noteState.floatwndState==L.CHORD_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsx)(j,{groupName:"selector-tabs",tabElements:[{name:"Scale",disable:S,cont:Object(d.jsx)(d.Fragment,{})},{name:"Direct",disable:!1,cont:Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"chord-selector"+(l.selectedLine==y.Root?" active":""),children:x}),Object(d.jsx)("div",{className:"symbol-selector"+(l.selectedLine==y.Symbol?" active":""),children:T})]})}],activeNo:1}),Object(d.jsx)("div",{className:"piano-view",children:Object(d.jsx)("canvas",{ref:i})}),Object(d.jsx)("div",{className:"beat-selector"+(l.selectedLine==y.Sustain?" active":""),children:p}),Object(d.jsxs)("div",{className:"adjuster"+(l.selectedLine==y.Adjuster?" active":""),children:[A("h",-.5),A("h",-.25),A("h",0),A("h",.25),A("h",.5),A("t",-.5),A("t",-.25),A("t",0),A("t",.25),A("t",.5)]}),Object(d.jsx)("div",{className:"operation",children:v})]})}),se=(a(47),function(){var e=Object(s.useContext)($e),t=e.state,a=(e.dispatch,t.noteState.focusIndex);if(-1==a)return Object(d.jsx)(d.Fragment,{});var n=t.noteData.dataList[a],c=t.noteState.cacheList[a],i=Object(d.jsx)(d.Fragment,{});switch(n.type){case P.Chord:var l=n.detail,r="-";if(null!=l.molecule){var o=l.molecule.rootIndex,u=E[o],b=m[o];r="".concat(u," (").concat(b,")")}var j,h="-";if(null!=l.molecule)h="[".concat(null===(j=W(l.symbolKey))||void 0===j?void 0:j.name,"]");var O=ie("Base",[{title:"Tempo",value:""+c.init.tempo,disable:!1},{title:"Beat",value:c.init.rythm,disable:!1},{title:"Key",value:m[c.init.keyIndex],disable:!1},{title:"Scale",value:c.init.scale,disable:!1}]),f=ie("Chord",[{title:"Root",value:r,disable:"-"==r},{title:"Symbol",value:h,disable:"-"==h},{title:"On chord",value:"-",disable:!0},{title:"Sustain",value:String(l.sustain),disable:!1},{title:"Adjsut-H",value:X(l.headAdjust),disable:0==l.headAdjust},{title:"Adjsut-T",value:X(l.tailAdjust),disable:0==l.tailAdjust}]);i=Object(d.jsx)("div",{className:"chord",children:Object(d.jsxs)("div",{children:[O,f,function(){if(null!=l.molecule){for(var e=[],t=W(l.symbolKey),a=null===t||void 0===t?void 0:t.intervals,n=null===a||void 0===a?void 0:a.length,c=0;c<7;c++)if(c<n){var s=null===t||void 0===t?void 0:t.intervals[c],i=null===t||void 0===t?void 0:t.struct[c],r=m[(l.molecule.rootIndex+s)%12];e.push(Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"interval",children:Object(d.jsx)("span",{children:s})}),Object(d.jsx)("div",{className:"struct",children:Object(d.jsx)("span",{children:i})}),Object(d.jsx)("div",{className:"sound",children:Object(d.jsx)("span",{children:r})})]},c))}else e.push(Object(d.jsxs)("div",{className:"record disable",children:[Object(d.jsx)("div",{className:"interval"}),Object(d.jsx)("div",{className:"struct"}),Object(d.jsx)("div",{className:"sound"})]},c));return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Struct"})}),Object(d.jsx)("div",{className:"symbol-struct",children:e})]})}return Object(d.jsx)(d.Fragment,{})}()]})});break;case P.Section:var x=n.detail,T=ie("Section",[{title:"label",value:x.labelName,disable:!1},{title:"box count",value:"-",disable:!0},{title:"total bar",value:"-",disable:!0},{title:"total time",value:"-",disable:!0}]);i=Object(d.jsx)("div",{className:"chord",children:Object(d.jsx)("div",{children:T})})}return Object(d.jsx)("div",{id:"current-detail",children:i})}),ie=function(e,t){var a=[];return t.forEach((function(e,t){a.push(Object(d.jsxs)("div",{className:"record"+(e.disable?" disable":""),children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsxs)("span",{children:[e.title,":"]})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:e.value})})]},t))})),Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:e})}),Object(d.jsx)("div",{className:"current-state",children:a})]})},le=(a(48),function(e){var t=e.dispatcher,a=e.paletteState,n=a.sideIndex,c=a.layers[n],s=a.selectedLenIndex,i=c.lens[s],l=c.vels[s],r=function(e){var c=a.layers;c[n].lens[s]=e,t.initBackingPalette(Object(h.a)(Object(h.a)({},a),{},{layers:c}))},o=function(e){i.len=e,i.isHalf=!1,i.isDiv3=!1,r(i)},u=function(e){var c=a.layers,i=c[n].vels[s];c[n].vels[s]=i+e,t.initBackingPalette(Object(h.a)(Object(h.a)({},a),{},{layers:c}))},b=i.len,j=[{label:"16",isActive:b==I.LEN16,isDisable:!1,callback:function(){o(I.LEN16)}},{label:"8",isActive:b==I.LEN8,isDisable:!1,callback:function(){o(I.LEN8)}},{label:"4",isActive:b==I.LEN4,isDisable:!1,callback:function(){o(I.LEN4)}},{label:"2",isActive:b==I.LEN2,isDisable:!1,callback:function(){o(I.LEN2)}},{label:"1",isActive:b==I.LEN1,isDisable:!1,callback:function(){o(I.LEN1)}},{label:".",isActive:i.isHalf,isDisable:!t.backing.isAcceptHalf(),callback:function(){i.isHalf=!i.isHalf,i.isDiv3=!1,r(i)}},{label:"/ 3",isActive:i.isDiv3,isDisable:!t.backing.isAcceptDiv3(),callback:function(){i.isDiv3=!i.isDiv3,i.isHalf=!1,r(i)}},{label:"Add",isActive:!1,isDisable:!1,callback:function(){t.backing.addLen()}},{label:"Del",isActive:!1,isDisable:c.lens.length<=1,callback:function(){t.backing.delLen()}},{label:"vel-",isActive:!1,isDisable:l<=1,callback:function(){u(-1)}},{label:"vel+",isActive:!1,isDisable:l>=10,callback:function(){u(1)}}],O=[];return j.forEach((function(e,t){O.push(Object(d.jsx)("button",{className:(e.isActive?"active":"")+(e.isDisable?" disable":""),onClick:function(){return e.callback()},children:Object(d.jsx)("span",{children:e.label})},t))})),Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("select",{value:a.channelRowSize,onChange:function(a){var n=e.paletteState,c=parseInt(a.target.value),s=c-n.channelRowSize,i=n.layers;s>0?i.forEach((function(e){for(var t=0;t<s;t++){for(var a=[],c=0;c<e.lens.length;c++)a.push([!1]);e.table.splice(n.channelRowSize,0,a)}})):s<0&&i.forEach((function(e){e.table.splice(c,Math.abs(s))})),n.channelRowSize=c,t.backing.setPaletteState(e.paletteState)},children:function(){for(var e=[],t=0;t<12;t++){var n=t+1,c=n<a.channelRowSize;e.push(Object(d.jsx)("option",{value:n,className:c?"del":"",children:n},t))}return e}()}),O]})}),re=function(e,t,a,n,c){var s=e[0==t?0:1],i=e[1==t?0:1],l="";if(s.table[a][n][c]){l="active";var r=de(s.lens,n,c);i.lens.forEach((function(e,t){for(var n=0;n<(e.isDiv3?3:1);n++){var c=de(i.lens,t,n);i.table[a][t][n]&&(oe(r,c)||oe(c,r))&&(l="overlap")}}))}return l},oe=function(e,t){return e.head+e.width>t.head&&e.head+e.width<=t.head+t.width||e.head<t.head+t.width&&e.head>=t.head},de=function(e,t,a){for(var n=0,c=0;c<t;c++){var s=e[c];n+=ue(s)}var i=e[t],l=ue(i);return i.isDiv3&&(n+=l/3*a,l/=3),{head:n,width:l}},ue=function(e){var t=0;switch(e.len){case I.LEN1:t=16;break;case I.LEN2:t=8;break;case I.LEN4:t=4;break;case I.LEN8:t=2;break;case I.LEN16:t=1}return e.isHalf&&(t*=1.5),t},be=function(e){for(var t=e.paletteState,a=(e.channelList,e.dispatcher),n=[],c=function(e){for(var c=[],s=t.layers[e],i=t.sideIndex==e,l=function(n){var i=[];s.lens.forEach((function(c,s){var l="";switch(c.len){case I.LEN4:l+="len4","4";break;case I.LEN8:l+="len8","8";break;case I.LEN16:l+="len16","16";break;case I.LEN2:l+="len2","2";break;case I.LEN1:l+="len1","1"}c.isHalf&&(l+=" half");for(var r=[],o=c.isDiv3?3:1,u=function(i){var l=re(t.layers,e,n,s,i);"overlap"==l&&!0,r.push(Object(d.jsx)("div",{className:[l,c.isDiv3?"div3":""].join(" "),onClick:function(){a.backing.toggleMatrix(n,s,i)}},i))},b=0;b<o;b++)u(b);i.push(Object(d.jsx)("div",{className:l,children:r},s))})),c.push(Object(d.jsx)("div",{className:"line",children:i},n))},r=t.channelRowSize-1;r>=0;r--)l(r);n.push(Object(d.jsx)("div",{className:i?"cur":"back",children:c},e))},s=0;s<2;s++)c(s);return Object(d.jsx)("div",{className:"matrix",children:n})},je=function(e){var t=e.layer,a=e.paletteState,n=4*(a.sustain+a.headAdjust+a.tailAdjust),c=[],s=0;t.lens.forEach((function(e,t){var a=0;switch(e.len){case I.LEN1:a=16;break;case I.LEN2:a=8;break;case I.LEN4:a=4;break;case I.LEN8:a=2;break;case I.LEN16:a=1}e.isHalf&&(a*=1.5),s+=a}));var i=s>n;s=i?s:n;for(var l=function(e){var t=e+4*a.headAdjust;c.push(Object(d.jsx)("div",{className:t%2==0?t%4==0?"mem4":"mem8":"mem16"},e))},r=0;r<s;r++)l(r);var o=31*n,u=i?Object(d.jsx)("div",{style:{left:"".concat(o,"px"),width:"".concat(31*(s-n),"px")},className:"over"}):Object(d.jsx)("div",{style:{left:"".concat(o,"px"),width:"5px"},className:"safe"});return Object(d.jsxs)("div",{className:"measure",children:[c,u]})},he=function(e){for(var t=e.paletteState,a=t.sideIndex,n=t.layers[a],c=e.dispatcher,s=e.channelList,i=e.testPlaySound,l=[],r=t.channelRowSize-s.length,o=function(t){var a=t-r,n=a>=0,o="-";n&&(o=s[a].soundFullName),l.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{className:["channel",n?"":"blank"].join(" "),onClick:function(){n&&i(o)},children:Object(d.jsx)("span",{children:o})}),Object(d.jsx)("div",{className:["opr",1==e.paletteState.channelRowSize?"disable":""].join(" "),onClick:function(){var a=e.paletteState,n=a.layers,s=a.channelRowSize-(t+1);n.forEach((function(e){e.table.splice(s,1)})),a.channelRowSize=a.channelRowSize-1,c.backing.setPaletteState(e.paletteState)},children:Object(d.jsx)("span",{children:"-"})}),Object(d.jsx)("div",{className:["opr",12==e.paletteState.channelRowSize?"disable":""].join(" "),onClick:function(){var a=e.paletteState,n=a.layers,s=a.channelRowSize-(t+1);n.forEach((function(e){for(var t=[],a=0;a<e.lens.length;a++)t.push([!1]);e.table.splice(s,0,t)})),a.channelRowSize=a.channelRowSize+1,c.backing.setPaletteState(e.paletteState)},children:Object(d.jsx)("span",{children:"+"})})]},t))},u=0;u<t.channelRowSize;u++)o(u);var b=[],j=[];return n.lens.forEach((function(e,a){var s=t.selectedLenIndex==a?"active ":"",i="";switch(e.len){case I.LEN4:s+="len4",i="4";break;case I.LEN8:s+="len8",i="8";break;case I.LEN16:s+="len16",i="16";break;case I.LEN2:s+="len2",i="2";break;case I.LEN1:s+="len1",i="1"}e.isHalf&&(i+=" .",s+=" half"),e.isDiv3&&(i+=" /"),b.push(Object(d.jsx)("div",{className:s,onClick:function(){c.initBackingPalette(Object(h.a)(Object(h.a)({},t),{},{selectedLenIndex:a}))},children:Object(d.jsx)("span",{children:i})},a));var l=n.vels[a];j.push(Object(d.jsx)("div",{className:s,children:Object(d.jsx)("div",{style:{height:10*l+"%"}})},a))})),Object(d.jsxs)("div",{className:"backing-table",children:[Object(d.jsx)("div",{className:"switch",children:Object(d.jsx)(le,{dispatcher:c,paletteState:t})}),Object(d.jsxs)("div",{className:"fixed",children:[Object(d.jsxs)("div",{className:"layer",children:[Object(d.jsx)("button",{className:1==t.sideIndex?"active":"",onClick:function(){c.backing.setLayerIndex(1)},children:Object(d.jsx)("span",{children:"R-Layer"})}),Object(d.jsx)("button",{className:0==t.sideIndex?"active":"",onClick:function(){c.backing.setLayerIndex(0)},children:Object(d.jsx)("span",{children:"L-Layer"})})]}),Object(d.jsx)("div",{className:"matrix",children:l}),Object(d.jsx)("div",{className:"pedal",children:Object(d.jsx)("button",{className:t.isUsePedal?"active":"",onClick:function(){c.backing.setUsePedal(!t.isUsePedal)},children:Object(d.jsx)("span",{children:"Pedal"})})})]}),Object(d.jsxs)("div",{className:"main",children:[Object(d.jsx)("div",{className:"split",children:b}),Object(d.jsx)(je,{paletteState:t,layer:n}),Object(d.jsx)(be,{paletteState:t,channelList:s,dispatcher:c}),Object(d.jsx)("div",{className:"volume",children:j})]})]})},Oe=a(10),Ee=a(11);Ee.a.div(V||(V=Object(Oe.a)(["\n    display: inline-block;\n    background-color: ",";\n    width: 100%;\n    padding: ",";\n    margin: ",";\n    text-align: ",";\n    box-sizing: border-box;\n"])),(function(e){return e.backgroundColor}),(function(e){return e.padding}),(function(e){return e.margin}),(function(e){return e.textAlign})).defaultProps={backgroundColor:"inherit",textAlign:"inherit",padding:"0",margin:"0"};Ee.a.div(J||(J=Object(Oe.a)(["\n    opacity: ","\n"])),(function(e){return e.opacity}));var fe=Ee.a.span(z||(z=Object(Oe.a)(["\n    font-size: ",";\n    color: ",";\n    font-weight: ",";\n"])),(function(e){return e.fontSize}),(function(e){return e.color}),(function(e){return e.fontWeight}));fe.defaultProps={fontSize:"inherit",color:"inherit",fontWeight:"inherit"};var me,xe,Te=function(e){var t=e.paletteState.useChannels,a=[];t.sort((function(e,t){return 12*e.octave+e.structIndex-(12*t.octave+t.structIndex)}));for(var n=t.slice(e.paletteState.channelRowSize),c=function(c){var s=c<e.structs.length,i=[];if(s){var l=e.structs[c],r=e.structs.length-e.symbol.intervals.length==1?c-1:c,o=-1==r?-1:e.symbol.intervals[r],u=-1==r?"dom":e.symbol.struct[r];i.push(Object(d.jsx)("div",{className:"label",children:Object(d.jsxs)("span",{children:[u,"[",o,"]: ",Object(d.jsx)(fe,{color:"#000",children:l})]})},0));for(var b=function(a){var s=e.degreeIndex+o+12*a,r=Math.floor(s/12),u=l+r,b=s<9||s>=97,j=!1;t.forEach((function(e){e.octave==a&&e.structIndex==c&&(j=!0)}));var h=t.length>=12&&!j,O=!1;n.forEach((function(e){e.octave==a&&e.structIndex==c&&(O=!0)})),i.push(Object(d.jsx)("div",{className:["col",b||h?"disable":"",j?"active":"",O?"over":""].join(" "),onClick:function(){var t=e.paletteState.useChannels;if(j){var n=-1;t.forEach((function(e,t){e.octave==a&&e.structIndex==c&&(n=t)})),t.splice(n,1)}else t.push({octave:a,structIndex:c});t.sort((function(e,t){return 8*e.octave+e.structIndex-(8*t.octave+t.structIndex)})),e.paletteState.useChannels=t,e.setUseChannels(e.paletteState.useChannels)},onContextMenu:function(){e.testPlaySound(u)},children:Object(d.jsx)("span",{children:b?"-":u})},a+1))},j=0;j<8;j++)b(j)}else{i.push(Object(d.jsx)("div",{className:"label"},0));for(var h=0;h<8;h++)i.push(Object(d.jsx)("div",{className:"col"},h+1))}a.push(Object(d.jsx)("div",{className:"record"+(s?"":" disable"),children:i},c))},s=0;s<7;s++)c(s);return Object(d.jsx)("div",{className:"struct-table",children:a})},pe=Object(s.createContext)({}),ve=function(e,t,a,n){for(var c=[],s=function(s){for(var i=function(i){var l=t+a.intervals[s]+12*i,r=!1;e.forEach((function(e){e.octave==i&&e.structIndex==s&&(r=!0)}));var o=Math.floor(l/12),d=n[s]+o;r&&c.push({soundIndex:l,soundFullName:d})},l=0;l<8;l++)i(l)},i=0;i<a.intervals.length;i++)s(i);return c.sort((function(e,t){return t.soundIndex-e.soundIndex})),c},Se=function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)({});if(Object(s.useEffect)((function(){a(H.GET_REFFER_BACKING_PALETTE,{reffer:c.current})}),[]),t.noteState.floatwndState!=L.BACKING_PALETTE)return Object(d.jsx)(d.Fragment,{});var i=t.noteState.backingPaletteState,l=i.molecule,r=i.denominator,o=Object(h.a)({},W(i.symbolKey)),u=i.sustain,b=i.headAdjust,j=i.tailAdjust,O=m[l.rootIndex]+o.name,E=[];null!=r&&(O+="/".concat(Y(r,0)),Z(o,l.rootIndex,r.rootIndex)),o.intervals.forEach((function(e){E.push(m[(l.rootIndex+e)%12])}));var f=ve(i.useChannels,l.rootIndex,o,E),x=function(e){t.sampler.triggerAttack(e,"+0",.15),setTimeout((function(){t.sampler.triggerRelease(e)}),1e3)},T=d.Fragment;return T=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(H.FLOATWND_STATE,{state:L.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{className:[i.isCorrect?"":"disable"].join(" "),onClick:function(){n.backing.play(!1)},children:Object(d.jsx)("span",{children:"Play"})}),Object(d.jsx)("div",{className:[i.isCorrect?"":"disable"].join(" "),onClick:function(){n.backing.setCurBackingScript()},children:Object(d.jsx)("span",{children:"Update"})})]}),Object(d.jsx)(pe.Provider,{value:{editorState:i},children:Object(d.jsxs)("div",{ref:c,id:"backing-palette",className:"floatwnd"+(t.noteState.floatwndState==L.BACKING_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsxs)("div",{className:"base-info",children:[Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Chord:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:O})})]}),Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Category:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:o.category})})]}),Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Struct:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:E.join(", ")})})]}),Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Sustain:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:u+b+j})})]})]}),Object(d.jsx)(Te,{paletteState:i,structs:E,symbol:o,degreeIndex:l.rootIndex,testPlaySound:x,setUseChannels:function(e){return n.setUseChannels(e)}}),Object(d.jsx)(he,{channelList:f,paletteState:i,dispatcher:n,testPlaySound:x}),Object(d.jsx)("div",{className:"operation",children:T})]})})},Ne=(a(51),100),ge=(Ee.a.div(me||(me=Object(Oe.a)(["\n    font-size: 0;\n    display: inline-inline-block;\n"]))),function(e){var t="";return 0!=e&&(t=e>0?"aug":"dim"),t}),Ae=function(){var e=Object(s.useContext)($e),t=e.state,a=(e.dispatcher,t.noteData.dataList),n=t.noteState.focusIndex,c=t.noteData.dataList.length,i=Object(s.useRef)({}),l=Object(s.useState)([]),r=Object(o.a)(l,2),u=r[0],b=r[1],j=Object(s.useState)([]),h=Object(o.a)(j,2),O=h[0],E=h[1],f=Object(s.useState)(0),m=Object(o.a)(f,2),x=m[0],T=m[1],p=a[n].type==P.Chord?a[n].detail:null,v=null==p?0:p.sustain,S=null==p?0:p.headAdjust,N=null==p?0:p.tailAdjust;if(Object(s.useEffect)((function(){var e=0,a=[],c=[];t.noteData.dataList.forEach((function(t,c){if(t.type==P.Init&&a.push(Object(d.jsx)("div",{className:[].join(" "),style:{width:"".concat(Ne,"px")}},a.length)),t.type==P.Chord){var s=t.detail,l=s.sustain+s.headAdjust+s.tailAdjust,r=16*l*4,o=n==c,u=n==c-1||n==c+1;a.push(Object(d.jsxs)("div",{className:[o?"active":"",u?"near":""].join(" "),style:{width:"".concat(r-1,"px")},children:[Object(d.jsx)("div",{className:"sus",children:Object(d.jsx)("span",{children:s.sustain})}),Object(d.jsxs)("div",{className:"adjust",children:[Object(d.jsx)("span",{className:ge(s.headAdjust),children:X(s.headAdjust)}),Object(d.jsx)("span",{className:ge(s.tailAdjust),children:X(s.tailAdjust)})]})]},a.length)),o&&i.current.scrollTo({left:16*e-Ne,behavior:"smooth"}),e+=4*l}}));for(var s=0;s<e;s++){var l="",r=1+s/16;if(s%16==0)l="mem-bar";else switch(s%4){case 0:l="mem4";break;case 2:l="mem8";break;default:l="mem16"}c.push(Object(d.jsx)("div",{className:l,style:{left:"".concat(Ne+16*s,"px")},children:s%16==0?Object(d.jsx)("div",{className:"bar",style:{left:"".concat(-14,"px"),top:"24px"},children:r}):Object(d.jsx)(d.Fragment,{})},c.length))}b(a),E(c),T(e)}),[c,n,v,S,N]),null==p)return Object(d.jsx)(d.Fragment,{});var g=200+16*x;return Object(d.jsx)("div",{id:"footer-timing",className:"footer-child",children:Object(d.jsxs)("div",{className:"scroll",ref:i,children:[Object(d.jsx)("div",{className:"blocks",style:{width:"".concat(g,"px")},children:u}),Object(d.jsx)("div",{className:"measure",style:{width:"".concat(g,"px")},children:O})]})})},Le=(a(52),function(){var e=Object(s.useContext)($e),t=e.state;e.dispatcher,t.noteData.dataList,t.noteState.focusIndex,t.noteData.dataList.length;return Object(d.jsx)("div",{id:"footer-ensemble",className:"footer-child"})}),ye=function(){return Object(d.jsx)("div",{id:"score-footer",children:Object(d.jsx)(j,{groupName:"score-tabs",tabElements:[{name:"Progress",disable:!1,cont:Object(d.jsx)(Ae,{})},{name:"Target",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Ensemble",disable:!1,cont:Object(d.jsx)(Le,{})}],activeNo:0})})},Ce=(a(53),function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useState)(55),i=Object(o.a)(c,2),l=i[0],r=i[1],u=Object(s.useState)("4/4"),b=Object(o.a)(u,2),j=b[0],h=b[1],O=Object(s.useState)(0),E=Object(o.a)(O,2),f=E[0],m=E[1],S=Object(s.useState)("major"),N=Object(o.a)(S,2),g=N[0],A=N[1],y=Object(s.useRef)({});Object(s.useEffect)((function(){a(H.GET_REFFER_CHORD_PALETTE,{reffer:y.current})}),[]);var C=d.Fragment;C=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(H.FLOATWND_STATE,{state:L.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){n.init.setInitParam(l,j,f,g)},children:Object(d.jsx)("span",{children:"Enter"})})]});var I,_=function(e,t,a,n){var c=[];return n.forEach((function(e){c.push(Object(d.jsx)("option",{value:e.value,children:e.display},c.length))})),Object(d.jsxs)("div",{className:"item",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:e})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("select",{value:t,onChange:function(e){a(e.target.value)},children:c})})]})},D=t.noteData.chordMode==k.DIRECT;return Object(d.jsxs)("div",{id:"init-editor",className:"floatwnd"+(t.noteState.floatwndState==L.INIT_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsxs)("div",{className:"items",children:[(I="Tempo",Object(d.jsxs)("div",{className:"item",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:I})}),Object(d.jsxs)("div",{className:"value",children:[Object(d.jsx)("input",{type:"number",value:l,min:"30",max:"180",onChange:function(e){r(Number(e.target.value))}}),Object(d.jsx)("input",{type:"range",name:"speed",min:"30",max:"180",value:l,onChange:function(e){r(Number(e.target.value))}})]})]})),_("Beat",j,(function(e){h(e)}),v.map((function(e){return{value:e,display:e}}))),D?Object(d.jsx)(d.Fragment,{}):_("Scale",g,(function(e){A(e)}),p.map((function(e){return{value:e,display:e}}))),D?Object(d.jsx)(d.Fragment,{}):_("Key",String(f),(function(e){m(Number(e))}),g==p[0]?x.map((function(e,t){return{value:t.toString(),display:e}})):T.map((function(e,t){return{value:t.toString(),display:e}})))]}),Object(d.jsx)("div",{className:"operation",children:C})]})}),Ie=(Ee.a.span(xe||(xe=Object(Oe.a)(["\n  user-select: none;\n  cursor: pointer;\n  display: inline-block;\n  margin: 1em;\n  padding: 0.3em 0.5em;\n  border-radius: 0.2em;\n  border: solid 1px #3498db;\n  color: #fff;\n  background-color: #3498db;\n"]))),a(54),function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)({});Object(s.useEffect)((function(){a(H.GET_REFFER_SECTION_PALETTE,{reffer:c.current})}),[]);var i=Object(s.useState)("Section"),l=Object(o.a)(i,2),r=l[0],u=l[1],b=d.Fragment;b=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(H.FLOATWND_STATE,{state:L.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){n.section.setSectionParam(r)},children:Object(d.jsx)("span",{children:"Enter"})})]});var j,h,O;return Object(d.jsxs)("div",{id:"section-editor",className:"floatwnd"+(t.noteState.floatwndState==L.SECTION_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsx)("div",{className:"items",children:(j="Name",h=r,O=function(e){u(e)},Object(d.jsxs)("div",{className:"item",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:j})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("input",{type:"text",value:h,onChange:function(e){O(e.target.value)}})})]}))}),Object(d.jsx)("div",{className:"operation",children:b})]})}),ke=(a(55),function(){var e=Object(s.useContext)($e),t=e.state,a=(e.dispatch,e.dispatcher);if(t.noteState.floatwndState!=L.SETTING_EDITOR)return Object(d.jsx)(d.Fragment,{});for(var n=t.noteState.defaultSustain,c=[],i=function(e){c.push(Object(d.jsx)("div",{className:[e+1<=n?"active":""].join(" "),onClick:function(){a.score.setNoteState(Object(h.a)(Object(h.a)({},t.noteState),{},{defaultSustain:e+1}))}},c.length))},l=0;l<8;l++)i(l);return Object(d.jsx)("div",{id:"setting-editor",className:"floatwnd active",children:Object(d.jsx)("div",{className:"sustain",children:c})})}),_e=(a(56),function(e,t,a,n,c,s){var i=[];return c.forEach((function(e){i.push(Object(d.jsx)("option",{value:e.value,children:e.display},i.length))})),Object(d.jsxs)("div",{className:["record",s?"disable":""].join(" "),children:[Object(d.jsx)("div",{className:"label",children:t}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("select",{className:s||""!==a?"":"error",value:a,onChange:function(e){n(e.target.value)},children:i})})]},e)}),De=function(e,t,a,n,c,s,i){return Object(d.jsxs)("div",{className:["record",i?"disable":""].join(" "),children:[Object(d.jsx)("div",{className:"label",children:t}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("input",{type:"number",className:i||""!==a&&a>=n&&a<=c?"":"error",value:a,min:n,max:c,onChange:function(e){s(e.target.value)}})})]},e)},Re=function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,c=e.dispatcher;Object(s.useRef)({});Object(s.useEffect)((function(){}),[]);var i=Object(s.useState)(""),l=Object(o.a)(i,2),r=l[0],u=l[1],b=Object(s.useState)(""),j=Object(o.a)(b,2),h=j[0],O=j[1],E=Object(s.useState)(""),f=Object(o.a)(E,2),m=f[0],x=f[1],T=Object(s.useState)(""),p=Object(o.a)(T,2),v=p[0],S=p[1],N=Object(s.useState)(""),g=Object(o.a)(N,2),A=g[0],y=g[1],C=Object(s.useState)(""),I=Object(o.a)(C,2),_=I[0],P=I[1],M=Object(s.useState)(""),w=Object(o.a)(M,2),B=w[0],G=w[1],K=Object(s.useState)(""),U=Object(o.a)(K,2),W=U[0],V=U[1],J=Object(s.useState)(""),z=Object(o.a)(J,2),X=z[0],Y=z[1],q=Object(s.useState)(!1),Z=Object(o.a)(q,2),$=Z[0],Q=Z[1],ee=t.noteData.chordMode;Object(s.useEffect)((function(){!function(){switch(Q(!1),r){case D.MODULATE:switch(h){case R.DOMINANT:""!==m&&Q(!0);break;case R.KEY:""!==v&&Q(!0);break;case R.RELATIVE:case R.PARALLEL:Q(!0)}break;case D.TEMPO:switch(A){case F.DIFF:""!==B&&Q(!0);break;case F.RATE:""!==_&&Q(!0);break;case F.ABSOLUTE:""!==W&&Q(!0)}break;case D.BEAT:""!==X&&Q(!0)}}()}),[r,h,m,v,A,B,_,W,X]);var te=[];te.push(_e(te.length,"Change Type",r,(function(e){u(e),e!==D.MODULATE&&(O(""),x(""),S("")),e!==D.TEMPO&&(y(""),P(""),G(""),V("")),e!==D.BEAT&&Y("")}),[{value:"",display:""}].concat(Object.values(D).filter((function(e){return!(ee===k.DIRECT&&e===D.MODULATE)})).map((function(e){return{value:e.toString(),display:e.toString()}}))),!1)),ee===k.SCALE&&(te.push(_e(te.length,"Modulate Relation",h,(function(e){O(e),e!==R.KEY&&S(""),e!==R.DOMINANT&&x("")}),[{value:"",display:""}].concat(Object.values(R).map((function(e){var t=e.toString();return{value:t,display:t}}))),r!==D.MODULATE.toString())),te.push(De(te.length,"Domminant Value",m,-3,3,(function(e){x(e)}),h!==R.DOMINANT.toString())),te.push(De(te.length,"Key Adjust",v,-3,3,(function(e){S(e)}),h!==R.KEY.toString()))),te.push(_e(te.length,"Tempo Relation",A,(function(e){y(e),e!==F.RATE&&P(""),e!==F.DIFF&&G(""),e!==F.ABSOLUTE&&V("")}),[{value:"",display:""}].concat(Object.values(F).map((function(e){var t=e.toString();return{value:t,display:t}}))),r!==D.TEMPO.toString())),te.push(De(te.length,"Tempo Diff",B,-150,150,(function(e){G(e)}),A!==F.DIFF.toString())),te.push(De(te.length,"Tempo Rate",_,20,200,(function(e){P(e)}),A!==F.RATE.toString())),te.push(De(te.length,"Tempo Absolute",W,30,180,(function(e){V(e)}),A!==F.ABSOLUTE.toString())),te.push(_e(te.length,"Beat",X,(function(e){Y(e)}),[{value:"",display:""}].concat(Object.values(n).map((function(e){var t=e.toString();return{value:t,display:t}}))),r!==D.BEAT.toString()));var ae=d.Fragment;return ae=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(H.FLOATWND_STATE,{state:L.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{className:[$?"":"disable"].join(""),onClick:function(){c.change.applyChangeParams(r,""===h?null:h,""===m?0:m,""===v?0:v,""===A?null:A,""===B?0:B,""===_?0:_,""===W?0:W,""===X?null:X)},children:Object(d.jsx)("span",{children:"Enter"})})]}),Object(d.jsxs)("div",{id:"change-editor",className:["floatwnd",t.noteState.floatwndState==L.CHANGE_PALETTE?" active":""].join(" "),onClick:function(){},children:[Object(d.jsx)("div",{className:"items",children:te}),Object(d.jsx)("div",{className:"operation",children:ae})]})},Fe=function(){var e=Object(s.useContext)($e),t=e.state,a=(e.dispatch,t.noteState.editMode);return Object(d.jsxs)("div",{className:"mode",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:"MODE:"})}),Object(d.jsxs)("div",{className:"border",children:[Object(d.jsx)("button",{className:a==_.NORMAL?"active":"",children:Object(d.jsx)("span",{children:"NORMAL"})}),Object(d.jsx)("button",{className:a==_.BACKING?"active":"",children:Object(d.jsx)("span",{children:"CLONE"})}),Object(d.jsx)("button",{className:a==_.PREVIEW?"active":"",children:Object(d.jsx)("span",{children:"PREVIEW"})})]})]})},Pe=function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useState)([]),i=Object(o.a)(c,2),l=i[0],r=i[1],u=Object(s.useState)([]),b=Object(o.a)(u,2),j=b[0],O=b[1];Object(s.useEffect)((function(){console.log("create ScoreContNoteTab")}),[]),Object(s.useEffect)((function(){var e=t.noteData.dataList,a=0,c=[],s=[],i=t.noteState.cacheList,l={},o=1,u=0,b=0,j=-1;e.forEach((function(e,t){if(e.type==P.Init){var n=e.detail;l.init=Object(h.a)({},n)}var r=Math.floor(u/4)+1,O={};if(O.no=o,O.barCount=j!=r?r:-1,O.remaindBeat=u%4>0?u%4:-1,O.headMSec=b,c.push(Object(d.jsx)(ee,{index:t,noteElement:e},t)),e.type==P.Chord){j=r;var E=e.detail,f=l.init.tempo,m=E.sustain+E.headAdjust+E.tailAdjust;u+=m,b+=6e4/f*4/4*m,o++}else if(e.type==P.Change){var x=e.detail;switch(x.changeType){case D.MODULATE:var T=l.init.keyIndex,p="minor"==l.init.scale;switch(x.modulateRelation){case R.DOMINANT:T=(24+T+7*x.domminantValue)%12;break;case R.KEY:T=(12+T+Number(x.keyAdjust))%12;break;case R.RELATIVE:T=p?(12+T+3)%12:(12+T-3)%12,p=!p;break;case R.PARALLEL:p=!p}l.init.keyIndex=T,l.init.scale=p?"minor":"major";break;case D.TEMPO:var v=l.init.tempo;switch(x.tempoRelation){case F.DIFF:v+=Number(x.tempoDiff);break;case F.RATE:v=Math.floor(v*x.tempoRate/100);break;case F.ABSOLUTE:v=x.tempoAbsolute}l.init.tempo=v}}i[t]=Object(h.a)(Object(h.a)({},i[t]),{},{init:Object(h.a)({},l.init),progress:O}),e.type==P.Section&&(s.push(Object(d.jsx)(te,{index:a,label:e.detail.labelName},t)),a++)})),r(c),O(s),n.score.setNoteState(Object(h.a)(Object(h.a)({},t.noteState),{},{cacheList:i}))}),[t.noteData.dataList]);var E=t.noteState.editMode,f=!(t.noteState.floatwndState==L.NONE||t.noteState.floatwndState==L.CONTEXT_MENU);return Object(d.jsxs)("div",{id:"scorecont-notetab-root",children:[Object(d.jsxs)("div",{className:"left-cont",children:[Object(d.jsxs)("div",{id:"score-note",children:[Object(d.jsxs)("div",{id:"operation-header",className:E==_.BACKING?"mode-selector":"",children:[Object(d.jsx)("button",{className:"",onClick:function(){a(H.SELECT_SCORETAB,{index:0})},children:Object(d.jsx)("span",{children:"BACK"})}),Object(d.jsx)("button",{className:"disable",children:Object(d.jsx)("span",{children:"SAVE"})}),Object(d.jsx)("button",{className:"disable",children:Object(d.jsx)("span",{children:"RELOAD"})}),Object(d.jsxs)("button",{className:"",onClick:function(){a(H.FLOATWND_STATE,{state:L.SETTING_EDITOR})},children:[" ",Object(d.jsx)("span",{children:"SETTING"})]}),Object(d.jsx)(Fe,{})]}),Object(d.jsx)("div",{id:"section-list",className:E==_.BACKING?"mode-selector":"",children:j}),Object(d.jsx)("div",{id:"score-list-root",className:E==_.BACKING?"mode-selector":"",children:l}),Object(d.jsx)("div",{id:"modal-blind",className:f?"active":"",onClick:function(){a(H.FLOATWND_STATE,{state:L.NONE})}}),Object(d.jsx)(Ce,{}),Object(d.jsx)(ne,{}),Object(d.jsx)(Ie,{}),Object(d.jsx)(Re,{}),Object(d.jsx)(ce,{}),Object(d.jsx)(Se,{}),Object(d.jsx)(ke,{})]}),Object(d.jsx)(ye,{})]}),Object(d.jsx)("div",{className:"right-cont",children:Object(d.jsx)(se,{})})]})},Me=a(3),we=a.n(Me),Be=a(6),Ge=(a(57),function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useState)(-1),i=Object(o.a)(c,2),l=i[0],r=i[1],u=Object(s.useState)(""),b=Object(o.a)(u,2),j=b[0],O=b[1],E=Object(s.useState)([]),f=Object(o.a)(E,2),m=f[0],x=f[1],T=Object(s.useState)([]),p=Object(o.a)(T,2),v=p[0],S=p[1],N=Object(s.useState)(!1),g=Object(o.a)(N,2),A=g[0],L=g[1],y=Object(s.useState)(""),C=Object(o.a)(y,2),I=C[0],_=C[1],D=Object(s.useState)(""),R=Object(o.a)(D,2),F=R[0],P=R[1],M=Object(s.useState)(!1),w=Object(o.a)(M,2),B=w[0],G=w[1];Object(s.useEffect)((function(){console.log("create ScoreContLiblaryTab")}),[]);var K=function(e){G(!0),O("Now roading scores..."),q("select","SELECT s.*, (select count(*) from data_tbl where score = s.id) as data_cnt FROM sclibtbl s where user = ".concat(t.login.id)).then((function(e){return e.json()})).then((function(e){console.log("[".concat(t.login.id,"]score count: ")+e.length),e.length>0?(x(e),O("")):O("There is no musical score you manage yet."),G(!1)})).catch((function(e){console.log(e+"\u5931\u6557\u3057\u307e\u3057\u305f"),G(!1)}))};Object(s.useEffect)((function(){var e=[];m.forEach((function(t,a){e.push(Object(d.jsxs)("div",{className:["record",l==a?"focus":""].join(" "),onClick:function(){r(a)},children:[Object(d.jsxs)("span",{children:[t.id,":"]}),Object(d.jsx)("span",{className:"title",children:t.title}),Object(d.jsx)("span",{children:"["}),Object(d.jsx)("span",{className:"mode",children:t.chord_mode}),Object(d.jsx)("span",{children:"]"})]},a))})),S(e)}),[m,l]),Object(s.useEffect)((function(){A||K()}),[A]);var U=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object(d.jsx)("button",{className:[t?"disable":"",n?"active":""].join(" "),onClick:a,children:Object(d.jsx)("span",{children:e})})},W=function(e,t){return Object(d.jsxs)("div",{className:"info-record",children:[Object(d.jsx)("span",{children:e}),Object(d.jsx)("span",{children:": "}),t]})},V=""!=j,J=m[l];return Object(d.jsxs)("div",{id:"scorecont-listtab-root",children:[Object(d.jsxs)("div",{className:"left-cont",children:[Object(d.jsxs)("div",{className:"opr",children:[U("Create",A||B,(function(){O("Create..."),q("update","INSERT INTO sclibtbl(user, title, chord_mode) VALUES(".concat(t.login.id,", 'new_title', '')")).then((function(e){return K(m.length),e}))})),U("Update",-1==l||B,(function(){A||(L(!0),_(J.title),P(J.chord_mode))}),A),U("Delete",-1==l||A||B,(function(){Object(Be.a)(we.a.mark((function e(){return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O("Delete..."),console.log("----start----"),e.next=4,q("update","delete from data_tbl where score = ".concat(m[l].id));case 4:return e.next=6,q("update","delete from sclibtbl where id = ".concat(m[l].id));case 6:K(),r(-1),console.log("----end----");case 9:case"end":return e.stop()}}),e)})))()}))]}),Object(d.jsxs)("div",{className:["lib",A?"disable":""].join(" "),children:[Object(d.jsx)("div",{className:["message",V?"":"hidden"].join(" "),children:Object(d.jsx)("span",{children:j})}),Object(d.jsx)("div",{className:["list",V?"hidden":""].join(" "),children:v})]})]}),Object(d.jsxs)("div",{className:"right-cont",children:[Object(d.jsxs)("div",{className:"opr",children:[U("Cancel",!A||B,(function(){L(!1)})),U("Save",!A||""===F||B,(function(){G(!0),Object(Be.a)(we.a.mark((function e(){var a;return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("----start----"),a=[],e.next=4,q("update","update sclibtbl set title = '".concat(I,"', chord_mode = '").concat(F,"' where id = ").concat(J.id));case 4:if(!(t.noteData.dataList.length>0)){e.next=10;break}return t.noteData.dataList.forEach((function(e,t){a.push("(".concat(J.id,", ").concat(t,", '").concat(JSON.stringify(e),"')"))})),e.next=8,q("update","delete from data_tbl where score = ".concat(J.id));case 8:return e.next=10,q("update","insert into data_tbl values".concat(a.join(",")));case 10:console.log("----end----"),alert("The data was saved successfully!"),G(!1);case 13:case"end":return e.stop()}}),e)})))()})),U("Edit",!A||""===F||B,(function(){G(!0),Object(Be.a)(we.a.mark((function e(){var c,s,i;return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=J.data_cnt){e.next=4;break}a(H.INIT_DEFAULT_ELEMENTS,null),e.next=13;break;case 4:return e.next=6,q("select","SELECT json from data_tbl where score = ".concat(J.id," order by seq"));case 6:return c=e.sent,e.next=9,c.json();case 9:s=e.sent,i=[],s.forEach((function(e){i.push(JSON.parse(e.json))})),n.score.setNoteData(Object(h.a)(Object(h.a)({},t.noteData),{},{dataList:i,chordMode:F}));case 13:a(H.SELECT_NOTE_ELEMENT,{index:2}),a(H.SELECT_SCORETAB,{index:1}),G(!1);case 16:case"end":return e.stop()}}),e)})))()}))]}),A?Object(d.jsxs)("div",{className:"data",children:[W("Id",Object(d.jsx)("span",{className:"value",children:J.id})),W("Title",Object(d.jsx)("input",{type:"text",onChange:function(e){_(e.target.value)},value:I})),W("Mode",Object(d.jsxs)("select",{className:["value",J.data_cnt>0?"disable":""].join(" "),value:F,onChange:function(e){P(e.target.value)},children:[Object(d.jsx)("option",{value:""}),Object(d.jsx)("option",{value:k.SCALE,children:k.SCALE}),Object(d.jsx)("option",{value:k.DIRECT,children:k.DIRECT})]})),W("Show",Object(d.jsx)("span",{className:"value",children:"PRIVATE"})),W("Data",Object(d.jsx)("span",{className:"value",children:J.data_cnt}))]}):Object(d.jsx)(d.Fragment,{})]})]})}),He=(a(58),function(){var e=Object(s.useContext)($e);e.state,e.dispatch,e.dispatcher;return Object(d.jsx)(d.Fragment,{})}),Ke=(a(59),function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)({});return Object(s.useEffect)((function(){2==t.scoreTabIndex&&0!=t.noteData.dataList.length&&(c.current.value=JSON.stringify(t.noteData))}),[t.scoreTabIndex]),Object(d.jsxs)("div",{id:"scorecont-sourcetab-root",children:[Object(d.jsx)("textarea",{ref:c}),Object(d.jsx)("button",{onClick:function(){n.score.setNoteData(JSON.parse(c.current.value)),a(H.SELECT_NOTE_ELEMENT,{index:2}),a(H.SELECT_SCORETAB,{index:1})},children:"Load score data..."})]})}),Ue=function(){var e=Object(s.useContext)($e),t=e.state,a=e.dispatch;return Object(d.jsx)("div",{id:"scoretab-root",children:Object(d.jsx)(j,{groupName:"score-tabs",tabElements:[{name:"Library",disable:!0,cont:Object(d.jsx)(Ge,{})},{name:"Note",disable:0===t.noteData.dataList.length,cont:1!=t.scoreTabIndex?Object(d.jsx)(d.Fragment,{}):Object(d.jsx)(Pe,{})},{name:"Source",disable:!1,cont:Object(d.jsx)(Ke,{})},{name:"Thema",disable:!1,cont:Object(d.jsx)(He,{})},{name:"Sheet Music",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Preview",disable:!0,cont:Object(d.jsx)("div",{})}],activeNo:t.scoreTabIndex,selectTabIndex:function(e){return a(H.SELECT_SCORETAB,{index:e})}})})},We=a(7),Ve=a(1),Je=function e(t,a){var n=this;Object(Ve.a)(this,e),this.dispatchBase=void 0,this.dispatch=void 0,this.state=void 0,this.setLoginParams=function(e){n.dispatch(H.SET_LOGIN,{login:e})},this.setNoteData=function(e){n.dispatchBase({type:H.SET_NOTE_DATA,payload:{data:e}})},this.initBackingPalette=function(e){n.dispatchBase({type:H.INIT_BACKING_PALETTE,payload:{backingPaletteState:e}})},this.setUseChannels=function(e){n.dispatchBase({type:H.SET_USE_CHANNELS,payload:{useChannels:e}})},this.score={apllyFlasah:function(e){var t=n.state.noteState.cacheList[e].reffer;t.style.backgroundColor="#ff0",setTimeout((function(){t.style.backgroundColor=""}),350)},apllyFlashCur:function(){var e=n.state.noteState.focusIndex;n.score.apllyFlasah(e)},apllyFlashList:function(){n.state.noteState.selectedList.forEach((function(e){n.score.apllyFlasah(e)}))},setNoteState:function(e){n.dispatch(H.SET_NOTE_STATE,{noteState:e})},setCriteria:function(){var e=n.state.noteState.focusIndex;n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{criteriaIndex:e,editMode:_.BACKING}))},releaseCriteria:function(){n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{criteriaIndex:-1,editMode:_.NORMAL,selectedList:[]}))},setNoteData:function(e){n.dispatch(H.SET_NOTE_DATA,{data:e})},getInitElement:function(){return n.state.noteData.dataList[0].detail},setEditMode:function(e){n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{editMode:e}))},addNoteElement:function(e,t){var a=n.state.noteState.focusIndex,c=n.state.noteData.dataList.slice();c.splice(a+1,0,{type:e,detail:t}),n.dispatch(H.SET_DATA_LIST,{dataList:c}),n.state.noteState.cacheList.slice().splice(a+1,0,{}),n.score.apllyFlasah(a+1)},addSectionElement:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList.slice(),a={labelName:"Section"};t.splice(e+1,0,{type:P.Section,detail:a}),n.dispatch(H.SET_DATA_LIST,{dataList:t}),n.state.noteState.cacheList.slice().splice(e+1,0,{}),n.score.apllyFlasah(e+1)},addChangeElement:function(){n.score.addNoteElement(P.Change,{changeType:null,modulateRelation:null,domminantValue:0,keyAdjust:0,tempoRelation:null,tempoDiff:0,tempoRate:0,tempoAbsolute:0,beat:null})},addChordElement:function(){var e=n.state.noteState,t=e.focusIndex,a=n.state.noteData.dataList.slice();a.splice(t+1,0,{type:P.Chord,detail:{molecule:null,denominator:null,symbolKey:S.MAJOR,sustain:e.defaultSustain,headAdjust:0,tailAdjust:0,backing:{useChannels:[],layers:[{lens:[{len:I.LEN4,isDiv3:!1,isHalf:!1}],side:C.LEFT,table:[[[!1]]],vels:[5]},{lens:[{len:I.LEN4,isDiv3:!1,isHalf:!1}],side:C.RIGHT,table:[[[!1]]],vels:[5]}],isUsePedal:!1}}}),n.dispatch(H.SET_DATA_LIST,{dataList:a}),n.state.noteState.cacheList.slice().splice(t+1,0,{}),n.score.apllyFlasah(t+1)},deleteElement:function(e){var t=n.state.noteState.focusIndex,a=n.state.noteData.dataList[e];if([P.Chord,P.Section,P.Change].includes(a.type)&&2!=e){var c=n.state.noteData.dataList.slice();c.splice(e,1),n.dispatch(H.SET_DATA_LIST,{dataList:c}),e<=t&&(n.state.noteState.focusIndex--,n.dispatch(H.SET_NOTE_STATE,{noteState:n.state.noteState}))}},deleteCurElement:function(){var e=n.state.noteState.focusIndex;n.score.deleteElement(e)},focusPreviousElement:function(){var e=n.state.noteState.focusIndex;return n.state.noteData.dataList[e-1].type!=P.Fixed&&(n.state.noteState.focusIndex--,n.dispatch(H.SET_NOTE_STATE,{noteState:n.state.noteState}),!0)},focusNextElement:function(){var e=n.state.noteState.focusIndex;if(n.state.noteData.dataList[e+1].type!=P.Fixed){var t=e+1;return n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{focusIndex:t})),!0}return!1},focusPreviousSection:function(){var e=n.state.noteData.dataList,t=n.state.noteState.focusIndex;do{if(e[--t].type==P.Section){n.state.noteState.focusIndex=t,n.dispatch(H.SET_NOTE_STATE,{noteState:n.state.noteState});break}}while(t>0)},focusNextSection:function(){var e=n.state.noteData.dataList,t=n.state.noteState.focusIndex;do{if(e[++t].type==P.Section||t==e.length-2){n.state.noteState.focusIndex=t,n.dispatch(H.SET_NOTE_STATE,{noteState:n.state.noteState});break}}while(t<e.length-1)},focusInitElement:function(){n.state.noteState.focusIndex=0,n.dispatch(H.SET_NOTE_STATE,{noteState:n.state.noteState})},setSelectedList:function(e){n.dispatch(H.SET_NOTE_STATE,{noteState:Object(h.a)(Object(h.a)({},n.state.noteState),{},{selectedList:e})})},callChordSelector:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=t.molecule;null==a&&(a={rootIndex:0,isFlat:!1}),n.dispatch(H.FLOATWND_STATE,{state:L.CHORD_PALETTE}),n.dispatch(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},n.state.noteState.chordPaletteState),{},{molecule:a,denominator:t.denominator,symbolKey:t.symbolKey,sustain:t.sustain,headAdjust:t.headAdjust,tailAdjust:t.tailAdjust})})},callSectionEditor:function(){var e=n.state.noteState.focusIndex;n.state.noteData.dataList[e].detail;n.dispatch(H.FLOATWND_STATE,{state:L.SECTION_PALETTE})},callChangeEditor:function(){var e=n.state.noteState.focusIndex;n.state.noteData.dataList[e].detail;n.dispatch(H.FLOATWND_STATE,{state:L.CHANGE_PALETTE})},callBackingEditor:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=t.backing,c={molecule:t.molecule,denominator:t.denominator,symbolKey:t.symbolKey,sustain:t.sustain,headAdjust:t.headAdjust,tailAdjust:t.tailAdjust,channelRowSize:a.layers[0].table.length,useChannels:JSON.parse(JSON.stringify(a.useChannels)),isUsePedal:a.isUsePedal,sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,layers:JSON.parse(JSON.stringify(a.layers)),isCorrect:!0};n.initBackingPalette(c),n.dispatch(H.FLOATWND_STATE,{state:L.BACKING_PALETTE})}},this.init={setInitParam:function(e,t,a,c){var s=n.state.noteState.focusIndex;n.dispatch(H.DETAIL_PARAMS_SETTER,{pos:s,params:{tempo:e,rythm:t,keyIndex:a,scale:c}}),n.dispatch(H.FLOATWND_STATE,{state:L.NONE}),n.score.apllyFlashCur()}},this.section={setSectionParam:function(e){var t=n.state.noteState.focusIndex;n.dispatch(H.DETAIL_PARAMS_SETTER,{pos:t,params:{labelName:e}}),n.dispatch(H.FLOATWND_STATE,{state:L.NONE}),n.score.apllyFlashCur()}},this.change={applyChangeParams:function(e,t,a,c,s,i,l,r,o){var d=n.state.noteState.focusIndex;n.dispatch(H.DETAIL_PARAMS_SETTER,{pos:d,params:{changeType:e,modulateRelation:t,domminantValue:a,keyAdjust:c,tempoRelation:s,tempoDiff:i,tempoRate:l,tempoAbsolute:r,beat:o}}),n.dispatch(H.FLOATWND_STATE,{state:L.NONE}),n.score.apllyFlashCur()}},this.chord={setCurChordParam:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=n.state.noteState.chordPaletteState;n.dispatch(H.DETAIL_PARAMS_SETTER,{pos:e,params:Object(h.a)(Object(h.a)({},t),{},{molecule:a.molecule,denominator:a.denominator,symbolKey:a.symbolKey,sustain:a.sustain,headAdjust:a.headAdjust,tailAdjust:a.tailAdjust})}),n.dispatch(H.FLOATWND_STATE,{state:L.NONE}),n.score.apllyFlashCur()}},this.backing={setPaletteState:function(e){var t=n.state.noteState.backingPaletteState;n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{backingPaletteState:t}))},toggleMatrix:function(e,t,a){var c=n.state.noteState.backingPaletteState,s=c.sideIndex,i=!c.layers[s].table[e][t][a];n.dispatch(H.BACKING_TOGGLE_MATRIX,{sideIndex:s,channelIndex:e,lenIndex:t,divIndex:a,isUse:i})},addLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers,a=e.sideIndex,c=t[a],s=e.selectedLenIndex,i=c.table;c.lens=Object(We.a)(c.lens),c.lens.splice(s+1,0,{len:I.LEN4,isHalf:!1,isDiv3:!1}),i.forEach((function(e){e.splice(s+1,0,[!1])})),c.vels.splice(e.selectedLenIndex+1,0,5),t[a]=c,n.dispatch(H.INIT_BACKING_PALETTE,{backingPaletteState:e})},delLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers,a=e.sideIndex,c=t[a],s=e.selectedLenIndex,i=c.table;c.lens=Object(We.a)(c.lens),c.lens.splice(s,1),i.forEach((function(e){e.splice(s,1)})),c.vels.splice(s,1),t[a]=c,s>0&&e.selectedLenIndex--,n.dispatch(H.INIT_BACKING_PALETTE,{backingPaletteState:e})},updateLenIndex:function(e){var t=n.state.noteState.backingPaletteState;t.selectedLenIndex=e,n.initBackingPalette(t)},getCurLenIndex:function(){return n.state.noteState.backingPaletteState.selectedLenIndex},setChannelRowSize:function(e){var t=n.state.noteState.backingPaletteState;t.channelRowSize=e,t.layers.forEach((function(t){var a=new Array(e);console.log("\u2605\u2605\u2605"+a.length);for(var n=0;n<a.length;n++){a[n]=new Array(t.lens.length),console.log("\u2606\u2606\u2606\u2606\u2606\u2606");for(var c=0;c<a[n].length;c++)a[n][c]=new Array(1),a[n][c][0]=!1}t.table=a})),n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{backingPaletteState:t}))},isFirstCurLen:function(){return 0==n.state.noteState.backingPaletteState.selectedLenIndex},isLastCurLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers[e.sideIndex];return e.selectedLenIndex==t.lens.length-1},getSideScript:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex]},getCurLenBean:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex].lens[e.selectedLenIndex]},setCurrentLenBean:function(e){var t=n.state.noteState.backingPaletteState,a=t.layers;a[t.sideIndex].lens[t.selectedLenIndex]=e,n.initBackingPalette(Object(h.a)(Object(h.a)({},t),{},{layers:a}))},setCurLen:function(e){var t=n.backing.getCurLenBean();t.len=e,t.isHalf=!1,t.isDiv3=!1,n.backing.setCurrentLenBean(t)},updateCurVolume:function(e){var t=n.state.noteState.backingPaletteState,a=t.layers;a[t.sideIndex].vels[t.selectedLenIndex]=e,n.initBackingPalette(Object(h.a)(Object(h.a)({},t),{},{layers:a}))},getCurVelocity:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex].vels[e.selectedLenIndex]},isAcceptHalf:function(){return[I.LEN2,I.LEN4,I.LEN8].includes(n.backing.getCurLenBean().len)},isAcceptDiv3:function(){return[I.LEN4,I.LEN8].includes(n.backing.getCurLenBean().len)},setLayerIndex:function(e){var t=n.state.noteState.backingPaletteState;t.sideIndex=e,t.selectedLenIndex=0,n.initBackingPalette(t)},setUsePedal:function(e){var t=n.state.noteState.backingPaletteState;t.isUsePedal=e,n.initBackingPalette(t)},setCorrect:function(e){var t=n.state.noteState.backingPaletteState;t.isCorrect=e,n.initBackingPalette(t)},changeLayerIndex:function(){var e=n.state.noteState.backingPaletteState;e.sideIndex=0==e.sideIndex?1:0,e.selectedLenIndex=0,n.initBackingPalette(e)},setUseChannels:function(e){for(var t=n.state.noteState.backingPaletteState,a=t.layers,c=new Array(2),s=0;s<2;s++){for(var i=t.useChannels.length,l=a[s].lens.length,r=a[s].table,o=new Array(i),d=0;d<i;d++)if(d<r.length)o[d]=r[d];else{o[d]=new Array(l);for(var u=0;u<l;u++)o[d][u]=new Array(1),o[d][u][0]=!1}c[s]=Object(h.a)(Object(h.a)({},a[s]),{},{table:o})}},setCurBackingScript:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=n.state.noteState.backingPaletteState,c={};c.useChannels=a.useChannels,c.layers=a.layers,c.isUsePedal=a.isUsePedal,n.dispatch(H.DETAIL_PARAMS_SETTER,{pos:e,params:Object(h.a)(Object(h.a)({},t),{},{backing:c})}),n.dispatch(H.FLOATWND_STATE,{state:L.NONE}),n.score.apllyFlashCur()},getNotesCount:function(e){var t=0;return e.layers.forEach((function(e){e.table.forEach((function(e){e.forEach((function(e){e[0]&&t++}))}))})),t},play:function(e){for(var t=n.state.noteState.backingThreads,a=Array(88),c=0;c<88;c++)a[c]=0;n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{editMode:_.PREVIEW,backingThreads:t}));for(var s=0,i=n.state.noteState.focusIndex,l=n.state.noteData.dataList,r=(new Date).getTime(),d=function(c){var d=l[c];t.push(setTimeout((function(){if(e&&[P.Chord,P.Fixed].includes(d.type)){var t=d.type==P.Fixed?[_.NORMAL,i]:[_.PREVIEW,c],a=Object(o.a)(t,2),s=a[0],l=a[1];n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{focusIndex:l,editMode:s}))}}),s)),d.type==P.Chord&&function(){var i=d.detail,l=n.state.noteState.cacheList[c],o=Object(h.a)({},W(i.symbolKey));null!=i.molecule&&null!=i.denominator&&Z(o,i.molecule.rootIndex,i.denominator.rootIndex);var u=null===o||void 0===o?void 0:o.intervals,b=n.state.noteState.backingPaletteState,j=e?i.backing:{layers:b.layers,useChannels:b.useChannels,isUsePedal:b.isUsePedal},O=n.state.sampler,E=l.init.tempo,f=6e4/E*4,x=6e4/E*(i.sustain+i.headAdjust+i.tailAdjust),T=f/32;e||t.push(setTimeout((function(){n.score.setNoteState(Object(h.a)(Object(h.a)({},n.state.noteState),{},{editMode:_.NORMAL}))}),s+x));for(var p=function(e){var n=0,c=j.layers[e];c.lens.forEach((function(e,o){var d=Number(e.len.toString().replace("LEN","")),b=f/d;e.isHalf&&(b*=1.5),j.useChannels.forEach((function(e,d){c.table[d][o].forEach((function(d,h){if(d&&null!=i.molecule){var E=i.molecule.rootIndex,f=(l.init.keyIndex+E)%12+u[e.structIndex]+12*e.octave,p=Math.floor(f/12),v=m[f%12]+p,S=.7*c.vels[o]/10,N=n+b/3*h,g=j.isUsePedal?x+T:N+b,A=(new Date).getTime()-r;t.push(setTimeout((function(){O.triggerAttack(v,"+0",S),a[f]++}),s+N-A)),t.push(setTimeout((function(){a[f]--,0==a[f]&&O.triggerRelease(v)}),s+g-A))}}))})),n+=b}))},v=0;v<2;v++)p(v);s+=x}()},u=i;u<(e?l.length:i+1);u++)d(u)}},this.dispatchBase=a,this.state=t,this.dispatch=function(e,t){return a({type:e,payload:t})}},ze=(a(60),function(e){var t=e.loginType==e.curLoginType;return Object(d.jsx)("button",{className:t?"active":"",onClick:function(){t||(e.setLoginType(e.curLoginType),e.resetError())},children:e.name})}),Xe=function(e){Object(s.useEffect)((function(){e.isDisable&&e.stateSetter("")}),[e.isDisable]);var t=e.stateValue.length;return Object(d.jsxs)("div",{className:["form",e.isDisable?"disable":""].join(" "),children:[Object(d.jsxs)("span",{children:[e.label,":"]}),Object(d.jsx)("input",{className:[e.isDisable||0!=t?"":"required",!e.isDisable&&(t<5||t>15)?"range":"",e.isDisable||Ye(e.stateValue)?"":"ban"].join(" "),type:e.isMask?"password":"text",value:e.stateValue,onChange:function(t){return e.stateSetter(t.target.value)}})]})},Ye=function(e){return!!(e=null==e?"":e).match(/^[A-Za-z0-9_!@]*$/)},qe=function(){var e=Object(s.useRef)({}),t=Object(s.useState)("guest"),a=Object(o.a)(t,2),n=a[0],c=a[1],i=Object(s.useContext)($e),l=i.state,r=i.dispatcher,u=Object(s.useState)(""),b=Object(o.a)(u,2),j=b[0],O=b[1],E=Object(s.useState)(""),f=Object(o.a)(E,2),m=f[0],x=f[1],T=Object(s.useState)(""),p=Object(o.a)(T,2),v=p[0],S=p[1],N=Object(s.useState)(" "),g=Object(o.a)(N,2),A=g[0],L=g[1],y=Object(s.useState)(!1),C=Object(o.a)(y,2),I=C[0],k=C[1],_=Object(s.useState)(!1),D=Object(o.a)(_,2),R=D[0],F=D[1];return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{id:"logo",children:Object(d.jsx)("span",{children:"Virtual Harmonizer"})}),Object(d.jsxs)("div",{id:"login-frame",ref:e,children:[Object(d.jsx)("div",{className:"guide",children:Object(d.jsx)("span",{children:"Start to Virtual Harmonizer"})}),Object(d.jsxs)("div",{className:"type",children:[Object(d.jsx)(ze,{curLoginType:"guest",name:"guest",loginType:n,setLoginType:c,resetError:function(){return L("")}}),Object(d.jsx)(ze,{curLoginType:"login",name:"login",loginType:n,setLoginType:c,resetError:function(){return L("")}}),Object(d.jsx)(ze,{curLoginType:"create",name:"create account",loginType:n,setLoginType:c,resetError:function(){return L("")}})]}),Object(d.jsxs)("div",{className:"body",children:[Object(d.jsx)(Xe,{label:"user name",stateValue:j,stateSetter:O,isMask:!1,isDisable:!["login","create"].includes(n)}),Object(d.jsx)(Xe,{label:"password",stateValue:m,stateSetter:x,isMask:!0,isDisable:!["login","create"].includes(n)}),Object(d.jsx)(Xe,{label:"password confirm",stateValue:v,stateSetter:S,isMask:!0,isDisable:!["create"].includes(n)})]}),Object(d.jsx)("div",{className:"message",children:Object(d.jsx)("span",{className:I?"error":"",children:A})}),Object(d.jsx)("div",{className:["opr",function(){switch(n){case"guest":return!1;case"login":return""==j||j.length<5||j.length>15||!Ye(j)||""==m||m.length<5||m.length>15||!Ye(m);case"create":return j.length<5||j.length>15||!Ye(j)||m.length<5||m.length>15||!Ye(m)||v.length<5||v.length>15||!Ye(v)}}()||R?"disable":""].join(" "),children:Object(d.jsx)("button",{onClick:function(){var t=function(t,a){e.current.style.opacity="0",setTimeout((function(){r.setLoginParams(Object(h.a)(Object(h.a)({},l.login),{},{isLogin:!0,id:t,name:a}))}),300)};switch(F(!0),k(!1),L("Connect to server..."),n){case"guest":t(-1,"Guest"),F(!1);break;case"login":q("select","SELECT * FROM user_tbl where name = '".concat(j,"' and password = '").concat(m,"'")).then((function(e){return e.json()})).then((function(e){console.log(e.length),e.length>0?t(e[0].id,e[0].name):(k(!0),L("The login attempt failed. Either the user ID or password is invalid.")),F(!1)})).catch((function(e){console.log(e+"\u5931\u6557\u3057\u307e\u3057\u305f"),F(!1)}));break;case"create":if(m!=v){k(!0),L("Confirmation passwords don't match."),F(!1);break}Object(Be.a)(we.a.mark((function e(){var t,a;return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q("select","SELECT count(*) as cnt FROM user_tbl where name = '".concat(j,"'"));case 2:return t=e.sent,e.next=5,t.json();case 5:if(a=e.sent,console.log(JSON.stringify(a[0].cnt)),!(a[0].cnt>0)){e.next=13;break}k(!0),L("That user id has already been recorded."),e.next=22;break;case 13:return e.next=15,q("update","INSERT INTO user_tbl(name, password) VALUES('".concat(j,"', '").concat(m,"')"));case 15:return t=e.sent,e.next=18,t.json();case 18:a=e.sent,L(""),alert("You have successfully created an account!"),c("login");case 22:F(!1);case 23:case"end":return e.stop()}}),e)})))()}},children:"enter"})})]})]})},Ze=(a(61),function(e){var t=Object(s.useContext)($e),a=t.state,n=t.dispatch,c=t.dispatcher;return Object(d.jsxs)("div",{id:"user-plate",className:[""].join(" "),children:[Object(d.jsx)("div",{className:"user-name",children:Object(d.jsx)("span",{children:a.login.name})}),Object(d.jsx)("div",{className:"logout",onClick:function(){c.score.setNoteData(Object(h.a)(Object(h.a)({},a.noteData),{},{dataList:[]})),c.setLoginParams(Object(h.a)(Object(h.a)({},a.login),{},{isLogin:!1,name:""})),n(H.SELECT_SCORETAB,{index:0})},children:Object(d.jsx)("span",{children:"LOGOUT"})})]})}),$e=Object(s.createContext)({}),Qe=function(){var e=Object(s.useReducer)(U,K),t=Object(o.a)(e,2),a=t[0],n=t[1],c=function(e,t){return n({type:e,payload:t})},i=new Je(a,n);return Object(d.jsx)("div",{id:"main-frame",tabIndex:999,onKeyDown:function(e){return function(e,t,a,n){if(1==t.scoreTabIndex){var c=t.noteState.focusIndex,s=t.noteState.editMode,i=t.noteData.chordMode,l=t.noteData.dataList[c],r=t.noteState.cacheList[c];switch(l.type){case P.Section:switch(l.detail,t.noteState.floatwndState){case L.NONE:if(s==_.NORMAL)switch(e.key){case"c":n.score.callSectionEditor()}break;case L.SECTION_PALETTE:switch(e.key){case"Escape":case"c":a(H.FLOATWND_STATE,{state:L.NONE})}}break;case P.Change:switch(l.detail,t.noteState.floatwndState){case L.NONE:if(s==_.NORMAL)switch(e.key){case"c":n.score.callChangeEditor()}break;case L.CHANGE_PALETTE:switch(e.key){case"Escape":case"c":a(H.FLOATWND_STATE,{state:L.NONE})}}break;case P.Chord:var o=l.detail;switch(t.noteState.floatwndState){case L.NONE:if(s==_.NORMAL)switch(e.key){case"c":n.score.callChordSelector();break;case"b":null!=o.molecule&&n.score.callBackingEditor();break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":if(i==k.DIRECT)break;var d=("major"==r.init.scale?w:B)[Number(e.key)-1];o.molecule={rootIndex:d.degreeIndex,isFlat:d.isFlat},o.symbolKey=d.symbolKey,n.score.setNoteData(t.noteData),n.score.apllyFlashCur();break;case"x":n.score.setCriteria();break;case"z":fetch("https://vh-sqlite.glitch.me/select",{mode:"cors",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({sql:"SELECT * FROM data_tbl where pos = 8"})}).then((function(e){return e.json()})).then((function(e){console.log(JSON.stringify(e))})).catch((function(e){console.log(e+"\u5931\u6557\u3057\u307e\u3057\u305f")}));break;case"q":fetch("https://vh-sqlite.glitch.me/update",{mode:"cors",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({sql:"insert into data_tbl(pos, value) values(".concat(c,", '").concat(JSON.stringify(o),"')")})});break;case" ":n.backing.play(!0)}else if(s==_.BACKING)switch(e.key){case"Escape":case"x":n.score.releaseCriteria();break;case"Enter":var u=t.noteData.dataList,b=u[t.noteState.criteriaIndex].detail.backing;t.noteState.selectedList.forEach((function(e){u[e].detail.backing=JSON.parse(JSON.stringify(b))})),n.score.setNoteData(Object(h.a)(Object(h.a)({},t.noteData),{},{dataList:u})),n.score.releaseCriteria(),n.score.apllyFlashList()}break;case L.CHORD_PALETTE:switch(e.key){case"Escape":case"c":a(H.FLOATWND_STATE,{state:L.NONE});break;case"Enter":n.chord.setCurChordParam()}break;case L.BACKING_PALETTE:var j=t.noteState.backingPaletteState,O=j.isCorrect;switch(e.key){case"Escape":case"b":a(H.FLOATWND_STATE,{state:L.NONE});break;case"ArrowLeft":if(!n.backing.isFirstCurLen()){var E=n.backing.getCurLenIndex();n.backing.updateLenIndex(E-1)}break;case"ArrowRight":if(!n.backing.isLastCurLen()){var f=n.backing.getCurLenIndex();n.backing.updateLenIndex(f+1)}break;case"ArrowUp":var m=n.backing.getCurVelocity();m<10&&n.backing.updateCurVolume(m+1);break;case"ArrowDown":var x=n.backing.getCurVelocity();x>1&&n.backing.updateCurVolume(x-1);break;case"r":n.backing.changeLayerIndex();break;case"1":n.backing.setCurLen(I.LEN16);break;case"2":n.backing.setCurLen(I.LEN8);break;case"3":n.backing.setCurLen(I.LEN4);break;case"4":n.backing.setCurLen(I.LEN2);break;case"5":n.backing.setCurLen(I.LEN1);break;case".":if(n.backing.isAcceptHalf()){var T=n.backing.getCurLenBean();T.isHalf=!T.isHalf,T.isDiv3=!1,n.backing.setCurrentLenBean(T)}break;case"/":if(n.backing.isAcceptDiv3()){var p=n.backing.getCurLenBean();p.isDiv3=!p.isDiv3,p.isHalf=!1,n.backing.setCurrentLenBean(p)}break;case"a":n.backing.addLen();break;case"Delete":n.backing.getSideScript().lens.length>1&&n.backing.delLen();break;case" ":O&&n.backing.play(!1);break;case"Enter":O&&n.backing.setCurBackingScript();break;case"z":var v={isUsePedal:j.isUsePedal,layers:j.layers,useChannels:j.useChannels};alert(JSON.stringify(v))}}}if(t.noteState.floatwndState==L.NONE&&[P.Chord,P.Section,P.Change].includes(l.type))if(s==_.NORMAL)switch(e.key){case"ArrowLeft":n.score.focusPreviousElement();break;case"ArrowRight":n.score.focusNextElement();break;case"ArrowUp":n.score.focusPreviousSection();break;case"ArrowDown":n.score.focusNextSection();break;case"Delete":n.score.deleteCurElement();break;case"i":n.score.focusInitElement();break;case"a":n.score.addChordElement();break;case"s":n.score.addSectionElement();break;case"f":n.score.addChangeElement();break;case"w":var S=l.detail;a(H.FLOATWND_STATE,{state:L.CHORD_PALETTE}),a(H.CHORD_PALETTE_SETTER,{params:Object(h.a)(Object(h.a)({},t.noteState.chordPaletteState),{},{molecule:S.molecule,denominator:S.denominator,symbolKey:S.symbolKey,sustain:S.sustain})})}else if(s==_.PREVIEW)switch(e.key){case" ":t.noteState.backingThreads.forEach((function(e){clearInterval(e)})),n.score.setNoteState(Object(h.a)(Object(h.a)({},t.noteState),{},{backingThreads:[],editMode:_.NORMAL})),t.sampler.releaseAll()}}}(e,a,c,i)},children:Object(d.jsx)($e.Provider,{value:{state:a,dispatch:c,dispatcher:i},children:a.login.isLogin?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(Ze,{}),Object(d.jsx)(j,{groupName:"system-tabs",tabElements:[{name:"Account",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Palette",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Score",disable:!1,cont:Object(d.jsx)(Ue,{})},{name:"Backing",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Symbol",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Sampler",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Setting",disable:!0,cont:Object(d.jsx)("div",{})}],activeNo:2})]}):Object(d.jsx)(qe,{})})})};var et=function(){return Object(s.useEffect)((function(){document.oncontextmenu=function(){return!1},window.addEventListener("keydown",(function(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}),!1)}),[]),Object(d.jsx)(Qe,{})},tt=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,63)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),c(e),s(e),i(e)}))};r.a.render(Object(d.jsx)(i.a.StrictMode,{children:Object(d.jsx)(et,{})}),document.getElementById("root")),tt()}]),[[62,1,2]]]);
//# sourceMappingURL=main.44b45092.chunk.js.map