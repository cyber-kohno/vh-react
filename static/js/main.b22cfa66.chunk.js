(this["webpackJsonpvh-react-ts"]=this["webpackJsonpvh-react-ts"]||[]).push([[0],{40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},46:function(e,t,a){},48:function(e,t,a){},57:function(e,t,a){},58:function(e,t,a){},59:function(e,t,a){},60:function(e,t,a){},61:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},66:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){},69:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){},88:function(e,t,a){},89:function(e,t,a){},90:function(e,t,a){},95:function(e,t,a){"use strict";a.r(t);var n,c,s=a(3),i=a.n(s),o=a(30),l=a.n(o),r=(a(40),a(41),a(42),a(5)),d=(a(43),a(44),a(0)),u=function(e){var t=[];return t.push("tab-menu"),t.push(e.isActive?"active":""),t.push(e.isDisable?"tab-disable":""),Object(d.jsx)("div",{className:t.join(" "),onClick:function(){return e.selectTab()},children:Object(d.jsx)("span",{children:e.name})})},b=function(e){return Object(d.jsx)("div",{className:["tab-cont",e.isActive?"":"hidden"].join(" "),children:e.cont})},h=function(e){var t=Object(s.useState)(e.activeNo),a=Object(r.a)(t,2),n=a[0],c=a[1];return Object(s.useEffect)((function(){c(e.activeNo)}),[e.activeNo]),Object(d.jsxs)("div",{id:e.groupName,children:[Object(d.jsx)("div",{className:"tab-list",children:e.tabElements.map((function(t,a){return Object(d.jsx)(u,{name:t.name,isActive:a==n,isDisable:t.disable,selectTab:function(){return function(t){void 0!==e.selectTabIndex?e.selectTabIndex(t):c(t)}(a)}},a)}))}),Object(d.jsx)("div",{className:"cont-list",children:e.tabElements.map((function(e,t){return Object(d.jsx)(b,{cont:e.cont,isActive:t==n},t)}))})]})},j=a(34),f=a(11),m=(a(46),a(4)),O=a.n(m),p=a(6),x=a(1),v=(a(48),160),E=["\u2160","b\u2161","\u2161","b\u2162","\u2162","\u2163","b\u2164","\u2164","b\u2165","\u2165","b\u2166","\u2166"],S=["\u2160","#\u2160","\u2161","#\u2161","\u2162","\u2163","#\u2163","\u2164","#\u2164","\u2165","#\u2165","\u2166"],g=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],T=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],N=["C","Db","D","Eb","E","F","F#","G","Ab","A","Bb","B"],y=["Cm","C#m","Dm","D#m","Em","Fm","F#m","Gm","G#m","Am","Bbm","Bm"],A=["major","minor"],I=["4/4","2/4","3/4","6/8","12/8"];!function(e){e.BEAT_4ON4="4/4",e.BEAT_2ON4="2/4",e.BEAT_3ON4="3/4",e.BEAT_6ON8="6/8",e.BEAT_12ON8="12/8"}(n||(n={})),function(e){e.C_DUR="0",e.DES_DUR="1"}(c||(c={}));var C,L,k=["\u2160","\u2160maj7","\u2161m","\u2161m7","\u2162m","\u2162m7","\u2163","\u2163maj7","\u2164","\u21647","\u2165m","\u2165m7","\u2166m(-5)","\u2166m7(-5)"],_=["\u2160m","\u2160m7","\u2161m(-5)","\u2161m7(-5)","b\u2162","b\u2162M7","\u2163m","\u2163m7","\u2164m","\u2164m7","b\u2165","b\u2165M7","b\u2166","b\u21667"];!function(e){e[e.MAJOR=0]="MAJOR",e[e.MINOR=1]="MINOR",e[e.SUS4=2]="SUS4",e[e.DIM=3]="DIM",e[e.AUG=4]="AUG",e[e.MAJ7=5]="MAJ7",e[e.SEVENTH=6]="SEVENTH",e[e.MIN7=7]="MIN7",e[e.MINOR_MAJ7=8]="MINOR_MAJ7",e[e.ADD9=9]="ADD9",e[e.MINOR_ADD9=10]="MINOR_ADD9",e[e.SIXTH_9TH=11]="SIXTH_9TH",e[e.MINOR_MINUS5=12]="MINOR_MINUS5",e[e.MIN7_MINUS5=13]="MIN7_MINUS5"}(C||(C={})),function(e){e[e.TRIAD=0]="TRIAD",e[e.TETRAD7TH=1]="TETRAD7TH",e[e.TETRAD6TH=2]="TETRAD6TH",e[e.ADD9TH=3]="ADD9TH",e[e.SEVENTH_9TH=4]="SEVENTH_9TH",e[e.SIXTH_9TH=5]="SIXTH_9TH"}(L||(L={}));var D=[{key:C.MAJOR,category:L.TRIAD,name:"",struct:["p1","M3","p5"],intervals:[0,4,7]},{key:C.MINOR,category:L.TRIAD,name:"m",struct:["p1","m3","p5"],intervals:[0,3,7]},{key:C.SUS4,category:L.TRIAD,name:"sus4",struct:["p1","p4","p5"],intervals:[0,5,7]},{key:C.DIM,category:L.TRIAD,name:"dim",struct:["p1","m3","d5"],intervals:[0,3,6]},{key:C.AUG,category:L.TRIAD,name:"aug",struct:["p1","M3","a5"],intervals:[0,4,8]},{key:C.MAJ7,category:L.TETRAD7TH,name:"maj7",struct:["p1","M3","p5","M7"],intervals:[0,4,7,11]},{key:C.SEVENTH,category:L.TETRAD7TH,name:"7",struct:["p1","M3","p5","m7"],intervals:[0,4,7,10]},{key:C.MIN7,category:L.TETRAD7TH,name:"m7",struct:["p1","m3","p5","m7"],intervals:[0,3,7,10]},{key:C.MINOR_MAJ7,category:L.TETRAD7TH,name:"mmaj7",struct:["p1","m3","p5","M7"],intervals:[0,3,7,11]},{key:C.ADD9,category:L.ADD9TH,name:"add9",struct:["p1","M2","M3","p5"],intervals:[0,2,4,7]},{key:C.MINOR_ADD9,category:L.ADD9TH,name:"madd9",struct:["p1","M2","m3","p5"],intervals:[0,2,3,7]},{key:C.SIXTH_9TH,category:L.SIXTH_9TH,name:"6(9)",struct:["p1","M2","M3","p5","M6"],intervals:[0,2,4,7,9]},{key:C.MINOR_MINUS5,category:L.TRIAD,name:"m(-5)",struct:["p1","m3","d5"],intervals:[0,3,6]},{key:C.MIN7_MINUS5,category:L.TETRAD7TH,name:"m7(-5)",struct:["p1","m3","d5","m7"],intervals:[0,3,6,10]}],R=(L.TRIAD,C.MAJOR,C.MINOR,C.SUS4,C.DIM,C.AUG,C.MINOR_MINUS5,L.TETRAD7TH,C.MAJ7,C.SEVENTH,C.MINOR_MAJ7,L.ADD9TH,C.ADD9,C.MINOR_ADD9,[{degreeIndex:0,symbolKey:C.MAJOR,isFlat:!1},{degreeIndex:2,symbolKey:C.MINOR,isFlat:!1},{degreeIndex:4,symbolKey:C.MINOR,isFlat:!1},{degreeIndex:5,symbolKey:C.MAJOR,isFlat:!1},{degreeIndex:7,symbolKey:C.MAJOR,isFlat:!1},{degreeIndex:9,symbolKey:C.MINOR,isFlat:!1},{degreeIndex:11,symbolKey:C.MINOR_MINUS5,isFlat:!1}]),w=[{degreeIndex:0,symbolKey:C.MINOR,isFlat:!1},{degreeIndex:2,symbolKey:C.MINOR_MINUS5,isFlat:!1},{degreeIndex:3,symbolKey:C.MAJOR,isFlat:!0},{degreeIndex:5,symbolKey:C.MINOR,isFlat:!1},{degreeIndex:7,symbolKey:C.MINOR,isFlat:!1},{degreeIndex:8,symbolKey:C.MAJOR,isFlat:!0},{degreeIndex:10,symbolKey:C.MAJOR,isFlat:!0}],F=a(28),M=function(e){return function(){switch(e){case L.TRIAD:return"Triad";case L.TETRAD7TH:return"7th";case L.TETRAD6TH:return"6th";case L.ADD9TH:return"Add9th";case L.SIXTH_9TH:return"6th-9th";case L.SEVENTH_9TH:return"7th-9th"}}()};function P(e){var t=null;return D.forEach((function(a){a.key==e&&(t=a)})),t}var H,K,B,U,G,V,z,W,J,X,Y=function(e){var t="";return 0!=e&&(t=e>0?"+"+e:e.toString()),t},q=function(e,t){var a=null;null!=e&&(a=(e.isFlat?g:T)[(e.rootIndex+t)%12]);return a},Q=function(e){var t="";return D.forEach((function(a){a.key==e&&(t=a.name)})),t},Z=function(e,t){return fetch("https://vh-sqlite.glitch.me/"+e,function(e){return{mode:"cors",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({sql:e})}}(t))},$=function(e,t,a){var n=a-t;n<0&&(n+=12);var c=[],s=[],i=!1;e.intervals.forEach((function(t,a){a<e.intervals.length&&(!i&&n<t&&(c.push(n),s.push("den"),i=!0),n!=t&&(c.push(t),s.push(e.struct[a])))})),i||(c.push(n),s.push("den")),e.intervals=c,e.struct=s};!function(e){e[e.NONE=0]="NONE",e[e.CONTEXT_MENU=1]="CONTEXT_MENU",e[e.CHORD_PALETTE=2]="CHORD_PALETTE",e[e.SECTION_PALETTE=3]="SECTION_PALETTE",e[e.CHANGE_PALETTE=4]="CHANGE_PALETTE",e[e.INIT_PALETTE=5]="INIT_PALETTE",e[e.BACKING_PALETTE=6]="BACKING_PALETTE",e[e.SETTING_EDITOR=7]="SETTING_EDITOR",e[e.THEMA_ACCESSOR=8]="THEMA_ACCESSOR"}(H||(H={})),function(e){e[e.Root=0]="Root",e[e.Symbol=1]="Symbol",e[e.Sustain=2]="Sustain",e[e.Adjuster=3]="Adjuster"}(K||(K={})),function(e){e.LEFT="LEFT",e.RIGHT="RIGHT"}(B||(B={})),function(e){e.LEN16="LEN16",e.LEN8="LEN8",e.LEN4="LEN4",e.LEN2="LEN2",e.LEN1="LEN1"}(U||(U={})),function(e){e.SCALE="SCALE",e.DIRECT="DIRECT"}(G||(G={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.TRANSPLANT=1]="TRANSPLANT",e[e.CLONE=2]="CLONE",e[e.PREVIEW=3]="PREVIEW"}(V||(V={})),function(e){e.MODULATE="Modulate",e.TEMPO="Tempo",e.BEAT="Beat"}(z||(z={})),function(e){e.DOMINANT="Domminant",e.PARALLEL="Parallel",e.RELATIVE="Relative",e.KEY="Key"}(W||(W={})),function(e){e.DIFF="Diff",e.RATE="Rate",e.ABSOLUTE="Absolute"}(J||(J={})),function(e){e.Init="init",e.Section="section",e.Chord="chord",e.Change="Change",e.Fixed="fixed"}(X||(X={}));var ee,te={login:{isLogin:!1,id:-1,name:""},dialog:{left:0,top:0,contents:null},scoreTabIndex:0,noteData:{scoreName:"",chordMode:G.SCALE,soundFont:{name:"",gain:1},dataList:[],columnList:[]},noteState:{cuScoreId:-1,focusIndex:-1,cacheList:[],criteriaIndex:-1,editMode:V.NORMAL,selectedList:[],defaultSustain:2,floatwndState:H.NONE,chordPaletteState:{isAddition:!1,selectedLine:K.Root,molecule:{rootIndex:0,isFlat:!1},denominator:null,symbolKey:D[0].key,sustain:4,headAdjust:0,tailAdjust:0},backingPaletteState:null,backingThreads:[],ensembleInfo:{fileURL:"",audio:new Audio,startPosition:0,volume:3,isLoad:!1},cloneRange:[],cloneDataList:[]},tuneState:{usingLen:4,columnIndex:0,isDiv3:!1,isEdit:!1,isAutoScroll:!1,isPreview:!1,totalColumnWidth:0,cacheList:[],tableRef:{},intervalRef:{},measureRef:{},BlocksRef:{}},themaDataTree:{themaName:"thema001",sustains:[]},themaState:{focusIndex:0,focusRef:null,themaCacheList:[],form:{root:{themaName:"",src:""},sustain:{beat:null,headAdjust:0,tailAdjust:0},pattern:{name:"",def:null,src:""},category:{category:L.TRIAD},condition:{tgtSymbols:[],minRootIndex:0,maxRootIndex:11},voicing:{def:null,src:""}},isCreate:!1},reffers:{},sampler:new F.a({E2:"https://dl.dropbox.com/s/0aghs80w9aggubw/KEPSREC040.mp3?dl=0",E3:"https://dl.dropbox.com/s/wxtf0u0ly03hu44/KEPSREC052.mp3?dl=0","A#3":"https://dl.dropbox.com/s/hbm9d1vo5tlxymk/KEPSREC058.mp3?dl=0",E4:"https://dl.dropbox.com/s/3qy88udfkzmzr13/KEPSREC064.mp3?dl=0",E5:"https://dl.dropbox.com/s/tdjp24r9pfoi2ff/KEPSREC076.mp3?dl=0",E6:"https://dl.dropbox.com/s/onp7h2vn2d6nhs7/KEPSREC088.mp3?dl=0"}).toDestination(),instrument:null,soundUseList:new Array(88),dinamicCache:null,formDispatcher:{}};!function(e){e[e.SET_LOGIN=0]="SET_LOGIN",e[e.SET_DIALOG=1]="SET_DIALOG",e[e.SELECT_SCORETAB=2]="SELECT_SCORETAB",e[e.ADD_SECTION=3]="ADD_SECTION",e[e.SET_DEGREE_INDEX=4]="SET_DEGREE_INDEX",e[e.SET_SYMBOL_KEY=5]="SET_SYMBOL_KEY",e[e.DETAIL_PARAMS_SETTER=6]="DETAIL_PARAMS_SETTER",e[e.GET_ELEMENT_REFFER=7]="GET_ELEMENT_REFFER",e[e.INIT_DEFAULT_ELEMENTS=8]="INIT_DEFAULT_ELEMENTS",e[e.SELECT_NOTE_ELEMENT=9]="SELECT_NOTE_ELEMENT",e[e.GET_REFFER=10]="GET_REFFER",e[e.GET_REFFER_CONTEXT=11]="GET_REFFER_CONTEXT",e[e.GET_REFFER_CHORD_PALETTE=12]="GET_REFFER_CHORD_PALETTE",e[e.GET_REFFER_SECTION_PALETTE=13]="GET_REFFER_SECTION_PALETTE",e[e.GET_REFFER_BACKING_PALETTE=14]="GET_REFFER_BACKING_PALETTE",e[e.FLOATWND_STATE=15]="FLOATWND_STATE",e[e.CHORD_PALETTE_SETTER=16]="CHORD_PALETTE_SETTER",e[e.SET_NOTE_DATA=17]="SET_NOTE_DATA",e[e.SET_DATA_LIST=18]="SET_DATA_LIST",e[e.SET_NOTE_STATE=19]="SET_NOTE_STATE",e[e.SET_TUNE_STATE=20]="SET_TUNE_STATE",e[e.SET_THEMA_DATA=21]="SET_THEMA_DATA",e[e.SET_THEMA_STATE=22]="SET_THEMA_STATE",e[e.SET_SAMPLER=23]="SET_SAMPLER",e[e.SET_INSTRUMENT=24]="SET_INSTRUMENT",e[e.INIT_BACKING_PALETTE=25]="INIT_BACKING_PALETTE",e[e.SET_USE_CHANNELS=26]="SET_USE_CHANNELS",e[e.BACKING_TOGGLE_MATRIX=27]="BACKING_TOGGLE_MATRIX",e[e.DINAMIC_CACHE=28]="DINAMIC_CACHE",e[e.SET_FORM_DISPATCHER=29]="SET_FORM_DISPATCHER"}(ee||(ee={}));var ae,ne,ce,se=function(e,t){var a=t.type,n=t.payload;switch(a){case ee.SET_LOGIN:return Object(x.a)(Object(x.a)({},e),{},{login:n.login});case ee.SET_DIALOG:return Object(x.a)(Object(x.a)({},e),{},{dialog:n.dialog});case ee.SELECT_SCORETAB:return Object(x.a)(Object(x.a)({},e),{},{scoreTabIndex:n.index});case ee.ADD_SECTION:var c=e.noteData.dataList.slice(),s={labelName:"Section"};return c.splice(n.index+1,0,{type:X.Section,detail:s}),Object(x.a)(Object(x.a)({},e),{},{noteData:Object(x.a)(Object(x.a)({},e.noteData),{},{dataList:c})});case ee.SET_DEGREE_INDEX:var i=e.noteData.dataList[n.pos].detail;return null==i.molecule?i.molecule={rootIndex:n.degreeIndex,isFlat:!1}:i.molecule.rootIndex=n.degreeIndex,Object(x.a)(Object(x.a)({},e),{},{noteData:Object(x.a)(Object(x.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case ee.SET_SYMBOL_KEY:return e.noteData.dataList[n.pos].detail.symbolKey=n.symbolKey,Object(x.a)(Object(x.a)({},e),{},{noteData:Object(x.a)(Object(x.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case ee.INIT_DEFAULT_ELEMENTS:return Object(x.a)(Object(x.a)({},e),{},{noteData:Object(x.a)(Object(x.a)({},e.noteData),{},{dataList:[{type:X.Init,detail:{tempo:80,rythm:"4/4",keyIndex:0,scale:"major"}},{type:X.Fixed,detail:{label:"START"}},{type:X.Section,detail:{labelName:"Section"}},{type:X.Fixed,detail:{label:"END"}}]}),noteState:Object(x.a)(Object(x.a)({},e.noteState),{},{cacheList:[{},{},{},{}]})});case ee.SELECT_NOTE_ELEMENT:return Object(x.a)(Object(x.a)({},e),{},{noteState:Object(x.a)(Object(x.a)({},e.noteState),{},{focusIndex:n.index})});case ee.GET_REFFER_CONTEXT:return Object(x.a)(Object(x.a)({},e),{},{reffers:Object(x.a)(Object(x.a)({},e.reffers),{},{contextMneu:n.reffer})});case ee.GET_REFFER_CHORD_PALETTE:return Object(x.a)(Object(x.a)({},e),{},{reffers:Object(x.a)(Object(x.a)({},e.reffers),{},{chordPalette:n.reffer})});case ee.GET_REFFER_SECTION_PALETTE:return Object(x.a)(Object(x.a)({},e),{},{reffers:Object(x.a)(Object(x.a)({},e.reffers),{},{sectionPalette:n.reffer})});case ee.GET_REFFER_BACKING_PALETTE:return Object(x.a)(Object(x.a)({},e),{},{reffers:Object(x.a)(Object(x.a)({},e.reffers),{},{backingPalette:n.reffer})});case ee.FLOATWND_STATE:return Object(x.a)(Object(x.a)({},e),{},{noteState:Object(x.a)(Object(x.a)({},e.noteState),{},{floatwndState:n.state})});case ee.CHORD_PALETTE_SETTER:return Object(x.a)(Object(x.a)({},e),{},{noteState:Object(x.a)(Object(x.a)({},e.noteState),{},{chordPaletteState:n.params})});case ee.DETAIL_PARAMS_SETTER:var o=e.noteData.dataList.slice();return o[n.pos].detail=n.params,Object(x.a)(Object(x.a)({},e),{},{noteData:Object(x.a)(Object(x.a)({},e.noteData),{},{dataList:o})});case ee.GET_REFFER:return Object(x.a)(Object(x.a)({},e),{},{reffers:n.reffers});case ee.SET_NOTE_DATA:return Object(x.a)(Object(x.a)({},e),{},{noteData:n.data});case ee.SET_DATA_LIST:return Object(x.a)(Object(x.a)({},e),{},{noteData:Object(x.a)(Object(x.a)({},e.noteData),{},{dataList:n.dataList})});case ee.SET_NOTE_STATE:return Object(x.a)(Object(x.a)({},e),{},{noteState:n.noteState});case ee.SET_TUNE_STATE:return Object(x.a)(Object(x.a)({},e),{},{tuneState:n.tuneState});case ee.SET_THEMA_STATE:return Object(x.a)(Object(x.a)({},e),{},{themaState:n.themaState});case ee.SET_THEMA_DATA:return Object(x.a)(Object(x.a)({},e),{},{themaDataTree:n.data});case ee.SET_SAMPLER:return Object(x.a)(Object(x.a)({},e),{},{sampler:n.sampler});case ee.SET_INSTRUMENT:return Object(x.a)(Object(x.a)({},e),{},{instrument:n.instrument});case ee.GET_ELEMENT_REFFER:return e.noteState.cacheList[n.pos].reffer=n.reffer,Object(x.a)(Object(x.a)({},e),{},{noteState:Object(x.a)(Object(x.a)({},e.noteState),{},{cacheList:e.noteState.cacheList})});case ee.INIT_BACKING_PALETTE:return Object(x.a)(Object(x.a)({},e),{},{noteState:Object(x.a)(Object(x.a)({},e.noteState),{},{backingPaletteState:n.backingPaletteState})});case ee.SET_USE_CHANNELS:var l=e.noteState.backingPaletteState,r=n.useChannels;return Object(x.a)(Object(x.a)({},e),{},{noteState:Object(x.a)(Object(x.a)({},e.noteState),{},{backingPaletteState:Object(x.a)(Object(x.a)({},l),{},{useChannels:r})})});case ee.BACKING_TOGGLE_MATRIX:var d=e.noteState.backingPaletteState,u=n.sideIndex,b=n.lenIndex,h=n.channelIndex,j=n.divIndex,f=d.layers;return f[u].table[h][b][j]=n.isUse,Object(x.a)(Object(x.a)({},e),{},{noteState:Object(x.a)(Object(x.a)({},e.noteState),{},{backingPaletteState:Object(x.a)(Object(x.a)({},d),{},{layers:f})})});case ee.DINAMIC_CACHE:return Object(x.a)(Object(x.a)({},e),{},{dinamicCache:n.dinamicCache});case ee.SET_FORM_DISPATCHER:return Object(x.a)(Object(x.a)({},e),{},{formDispatcher:n.formDispatcher})}},ie=function(e){var t=null;null!=e&&(t=(e.isFlat?E:S)[e.rootIndex]);return t},oe=function(e){var t=Object(s.useContext)(Nn),a=t.state,n=t.dispatcher,c=a.noteData.chordMode,i=a.noteState.cacheList[e.index];switch(e.noteElement.type){case X.Fixed:var o=e.noteElement.detail;return Object(d.jsx)("span",{children:o.label});case X.Init:var l=e.noteElement.detail,r=[];return r.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Tempo: "}),Object(d.jsx)("span",{children:l.tempo})]},r.length)),r.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Beat: "}),Object(d.jsx)("span",{children:l.rythm})]},r.length)),c==G.SCALE&&(r.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Scale: "}),Object(d.jsx)("span",{children:l.scale})]},r.length)),r.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{children:"Key: "}),Object(d.jsx)("span",{children:l.scale==A[0]?N[l.keyIndex]:y[l.keyIndex]})]},r.length))),Object(d.jsx)("div",{children:r});case X.Chord:var u=e.noteElement.detail,b=ie(u.molecule),h=ie(u.denominator),j=q(u.molecule,i.init.keyIndex),f=q(u.denominator,i.init.keyIndex),m="",O=!1,p="blank",x="-";if(null!=b)m=Q(u.symbolKey),O=("major"==i.init.scale?k:_).includes(b+m),p="".concat(b).concat(m).concat(null==h?"":"/"+h),x="".concat(j).concat(m).concat(null==f?"":"/"+f);for(var v=[],E=0;E<u.sustain;E++)v.push(Object(d.jsx)("span",{},E));var S=i.progress.barCount,g=i.progress.remaindBeat,T=Math.round(i.progress.headMSec/1e3*10)/10,I=n.backing.getNotesCount(u.backing);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"degree"+(null==u.molecule?" blank":"")+(O?" diatonic":"")+(a.noteData.chordMode==G.DIRECT?" visible":""),children:Object(d.jsx)("span",{children:p})}),Object(d.jsx)("div",{className:a.noteData.chordMode==G.DIRECT?"degree":"chord",children:Object(d.jsx)("span",{children:x})}),Object(d.jsx)("div",{className:"sustain",children:v}),Object(d.jsxs)("div",{className:"progress-sustain",children:[Object(d.jsx)("span",{className:"bar",children:-1!=S?S:""}),Object(d.jsx)("span",{className:"beat",children:-1!=g?g:""})]}),Object(d.jsx)("div",{className:"progress-time",children:Object(d.jsxs)("span",{children:[T,"s"]})}),Object(d.jsx)("div",{className:"backing-script"+(0==I?" hidden":""),children:Object(d.jsxs)("span",{children:["notes: ",I]})})]});case X.Section:var C=e.noteElement.detail;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"name",children:Object(d.jsx)("span",{children:C.labelName})}),Object(d.jsx)("div",{className:"border"})]});case X.Change:var L=e.noteElement.detail,D=a.noteState.cacheList[e.index-1],R=Object(d.jsx)(d.Fragment,{});switch(L.changeType){case null:R=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:"No setting"})}),Object(d.jsxs)("div",{className:"result",children:[Object(d.jsx)("span",{children:"***"}),"]"]})]});break;case z.MODULATE:var w=null===L.modulateRelation?"None":L.modulateRelation.toString(),F=L.modulateRelation===W.DOMINANT||L.modulateRelation===W.KEY,M=0,P=D.init.keyIndex,H="minor"==D.init.scale,K=i.init.keyIndex,B="minor"==i.init.scale;switch(L.modulateRelation){case W.DOMINANT:M=L.domminantValue;break;case W.KEY:M=L.keyAdjust;break;case W.RELATIVE:case W.PARALLEL:}var U=(H?y:N)[P],V=(B?y:N)[K];R=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("div",{className:"value",children:[Object(d.jsx)("span",{children:w+(F?": ":"")}),F?Object(d.jsx)("span",{children:M}):Object(d.jsx)(d.Fragment,{})]}),Object(d.jsx)("div",{className:"result",children:Object(d.jsxs)("span",{children:[U," \u2192 ",V]})})]});break;case z.TEMPO:var Y=null===L.tempoRelation?"None":L.tempoRelation.toString(),Z=0,$=D.init.tempo,ee=i.init.tempo;switch(L.tempoRelation){case J.DIFF:Z=L.tempoDiff;break;case J.RATE:Z=L.tempoRate;break;case J.ABSOLUTE:Z=L.tempoAbsolute}R=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("div",{className:"value",children:[Object(d.jsx)("span",{children:Y+": "}),Object(d.jsx)("span",{children:Z})]}),Object(d.jsx)("div",{className:"result",children:Object(d.jsx)("span",{children:"".concat($," \u2192 ").concat(ee)})})]});break;case z.BEAT:R=Object(d.jsx)(d.Fragment,{})}return G.SCALE,Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"change-type",children:Object(d.jsx)("span",{children:null===L.changeType?"Change":L.changeType.toString()})}),R]})}},le=(a(57),function(e){var t=Object(s.useContext)(Nn),a=t.state,n=t.dispatch,c=t.dispatcher,i=e.index<a.noteData.dataList.length,o=Object(s.useRef)({});if(Object(s.useEffect)((function(){i&&n(ee.GET_ELEMENT_REFFER,{pos:e.index,reffer:o.current})}),[a.noteData.dataList]),!i)return Object(d.jsx)(d.Fragment,{});var l=e.noteElement.type,r=a.noteState.editMode,u=a.noteData.chordMode,b=a.noteState.cacheList[e.index],h=a.noteState.focusIndex,j=h==e.index,f=a.noteState.criteriaIndex==e.index,m=function(){a.noteData.dataList[e.index].type!=X.Fixed&&n(ee.SELECT_NOTE_ELEMENT,{index:e.index})},O=Object(d.jsx)(d.Fragment,{});return e.index==a.noteData.dataList.length-2&&(O=Object(d.jsx)("div",{className:"addition"+(r==V.NORMAL?"":" disable"),onClick:function(){n(ee.SELECT_NOTE_ELEMENT,{index:e.index}),c.score.addChordElement(),n(ee.SELECT_NOTE_ELEMENT,{index:e.index+1}),n(ee.FLOATWND_STATE,{state:H.CHORD_PALETTE}),n(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},a.noteState.chordPaletteState),{},{isAddition:!0,rootIndex:0,isFlat:!1,symbolKey:D[0].key,sustain:4})})},children:Object(d.jsx)("span",{children:"+"})})),Object(d.jsxs)("div",{className:"box",children:[Object(d.jsxs)("div",{className:"info-base",children:[Object(d.jsx)("div",{className:"header",children:function(){var t=[];if([X.Chord,X.Section,X.Change].includes(l)){if(X.Chord==l){t.push(Object(d.jsx)("div",{className:"chord-no",children:Object(d.jsx)("span",{children:b.progress.no})},t.length));var a="major"==b.init.scale,n=(a?N:y)[b.init.keyIndex];u===G.SCALE&&t.push(Object(d.jsx)("div",{className:["scale",a?"maj":"min"].join(" "),children:Object(d.jsxs)("span",{children:["[",n,"]"]})},t.length))}t.push(Object(d.jsx)("div",{className:"del"+(r==V.NORMAL?"":" hidden"),onClick:function(){c.score.deleteElement(e.index)},children:Object(d.jsx)("span",{children:"\xd7"})},t.length))}return Object(d.jsx)(d.Fragment,{children:t})}()}),Object(d.jsx)("div",{className:["note-element",function(){switch(l){case X.Fixed:return"detail-fixed";case X.Init:return"detail-init";case X.Chord:return"detail-chord";case X.Section:return"detail-section";case X.Change:return"detail-change"}}(),j?"active":"",f?"criteria":"",[X.Init,X.Section,X.Chord,X.Change].includes(l)?"selectable":"",function(){var t=a.noteData.dataList,n=[t.length],c=-1,s=-1;return t.forEach((function(e,t){e.type==X.Section&&c++,n[t]=c,h==t&&(s=c)})),n[e.index]==s&&l!=X.Fixed}()?"current":"",r!=V.TRANSPLANT?"":l==X.Chord&&null!=e.noteElement.detail.molecule?a.noteState.selectedList.includes(e.index)?"copy-selected":"copy-tgt":"copy-no-tgt",function(){if(r!=V.CLONE)return"";if([X.Fixed,X.Init].includes(l))return"copy-no-tgt";var t=a.noteState.cloneRange,n=t[0]>t[1],c=t[n?1:0],s=t[n?0:1];return e.index>=c&&e.index<=s?"copy-selected":"copy-tgt"}()].join(" "),onClick:function(){r==V.NORMAL?(m(),n(ee.FLOATWND_STATE,{state:H.NONE})):r==V.TRANSPLANT?function(){var t=a.noteState.selectedList;t.includes(e.index)?t.some((function(a,n){a==e.index&&t.splice(n,1)})):t.push(e.index),c.score.setSelectedList(t)}():r==V.CLONE&&c.score.setCloneRange(e.index)},onContextMenu:function(t){if(r==V.NORMAL)switch(m(),a.noteData.dataList[e.index].type){case X.Init:c.setDinamicCache(e.noteElement.detail),n(ee.FLOATWND_STATE,{state:H.INIT_PALETTE});break;case X.Section:case X.Chord:case X.Change:a.reffers.contextMneu.style.left=t.clientX+"px",a.reffers.contextMneu.style.top=t.clientY+"px",n(ee.FLOATWND_STATE,{state:H.CONTEXT_MENU})}},ref:o,children:Object(d.jsx)(oe,{index:e.index,noteElement:e.noteElement})})]}),O]})}),re=function(e){var t=Object(s.useContext)(Nn),a=t.state;t.dispatch;return Object(d.jsx)("div",{className:function(){var t=a.noteData.dataList,n=a.noteState.focusIndex,c=-1,s=-1;return t.forEach((function(e,t){e.type==X.Section&&c++,n==t&&(s=c)})),s==e.index}()?"active":"",children:Object(d.jsx)("span",{children:e.label})})},de=(a(58),function(e){return Object(d.jsxs)("div",{className:e.disable?"disable":"",onClick:function(){e.executer()},children:[Object(d.jsx)("span",{className:e.menuType,children:e.label}),Object(d.jsx)("span",{className:"key",children:"<".concat(e.keyName," key>")})]})}),ue=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=e.dispatcher,c=function(){return a(ee.FLOATWND_STATE,{state:H.NONE})},i=Object(s.useRef)({});Object(s.useEffect)((function(){a(ee.GET_REFFER_CONTEXT,{reffer:i.current})}),[]);var o=[];if(t.noteState.floatwndState==H.CONTEXT_MENU){var l=t.noteData.dataList[t.noteState.focusIndex];switch(o.push({menuType:"order",label:"INSERT BLANK",keyName:"A",disable:!1,executer:function(){n.score.addChordElement(),c()}}),o.push({menuType:"call",label:"INSERT CHORD",keyName:"W",disable:!1,executer:function(){n.score.addChordElement(),a(ee.SELECT_NOTE_ELEMENT,{index:t.noteState.focusIndex+1}),a(ee.FLOATWND_STATE,{state:H.CHORD_PALETTE});l.detail;a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},t.noteState.chordPaletteState),{},{isAddition:!0,molecule:{rootIndex:0,isFlat:!1},denominator:null,symbolKey:D[0].key,sustain:t.noteState.defaultSustain})})}}),o.push({menuType:"order",label:"INSERT SECTION",keyName:"S",disable:!1,executer:function(){n.score.addSectionElement(),c()}}),o.push({menuType:"order",label:"INSERT CHANGE",keyName:"F",disable:!1,executer:function(){n.score.addChangeElement(),c()}}),l.type){case X.Chord:var r=l.detail;o.push({menuType:"order",label:"SET BLANK",keyName:"D",disable:null==r.molecule,executer:function(){var e=t.noteData,a=e.dataList[t.noteState.focusIndex].detail;a.molecule=null,a.denominator=null,n.score.setNoteData(e),c()}}),o.push({menuType:"call",label:"EDIT CHORD",keyName:"C",disable:!1,executer:function(){n.score.callChordSelector()}}),o.push({menuType:"call",label:"EDIT BACKING",keyName:"B",disable:null==r.molecule,executer:function(){n.score.callBackingEditor()}}),o.push({menuType:"call",label:"THEMA",keyName:"T",disable:!1,executer:function(){n.score.callThemaAccessor()}}),o.push({menuType:"order",label:"COPY BACKING",keyName:"X",disable:null==r.molecule,executer:function(){n.score.setCriteria(),a(ee.FLOATWND_STATE,{state:H.NONE})}}),o.push({menuType:"order",label:"CLONE BLOCK",keyName:"Q",disable:!1,executer:function(){n.score.setCloneCriteria(),a(ee.FLOATWND_STATE,{state:H.NONE})}});break;case X.Section:o.push({menuType:"call",label:"EDIT SECTION",keyName:"C",disable:!1,executer:function(){n.score.callSectionEditor()}});break;case X.Change:o.push({menuType:"call",label:"EDIT CHANGE",keyName:"C",disable:!1,executer:function(){n.score.callChangeEditor()}})}o.push({menuType:"order",label:"REMOVE",keyName:"DEL",disable:!1,executer:function(){n.score.deleteCurElement(),a(ee.FLOATWND_STATE,{state:H.NONE})}})}var u=[];return o.forEach((function(e,t){u.push(Object(d.jsx)(de,{menuType:e.menuType,label:e.label,keyName:e.keyName,disable:e.disable,executer:e.executer},t))})),Object(d.jsx)("div",{ref:i,id:"note-contextmenu",className:"floatwnd"+(t.noteState.floatwndState==H.CONTEXT_MENU?" active":""),onClick:function(){},children:u})},be=(a(59),function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)(null),i=Object(s.useRef)(null),o=t.noteState.chordPaletteState,l=t.noteState.focusIndex,u=(t.noteData.dataList[l].detail,t.noteState.cacheList[l]);t.noteState.editMode,V.PREVIEW;Object(s.useEffect)((function(){a(ee.GET_REFFER_CHORD_PALETTE,{reffer:c.current});var e=i.current;e.width=590,e.height=66}),[]),Object(s.useEffect)((function(){t.noteState.floatwndState==H.CHORD_PALETTE&&b(o.molecule.rootIndex,null==o.denominator?-1:o.denominator.rootIndex,o.symbolKey)}),[o,t.noteState.floatwndState]);var b=function(e,t,a){var n=i.current.getContext("2d"),c=(u.init.keyIndex+e)%12,s=P(a).intervals.map((function(e){return c+e})),o=-1;-1!=t&&(o=u.init.keyIndex+t),n.fillStyle="#008",n.fillRect(0,0,594,70);for(var l=34,r=0,d=[],b=0;b<27;b++){var h="#eee",j=l,f=60,m=[1,3,6,8,10].includes(b%12);switch(m&&(h="#111",j=17,f=36),s.includes(b)&&(h="#fa0"),o==b&&(h="#ff0000"),d.push({posX:15+r,fillStyle:h,width:j,height:f,isBlack:m}),b%12){case 0:case 2:case 5:case 7:case 9:r+=25.5;break;case 1:case 3:case 6:case 8:case 10:r+=9.5;break;default:r+=35}}d.forEach((function(e){e.isBlack||(n.fillStyle=e.fillStyle,n.fillRect(e.posX,3,e.width,e.height))})),d.forEach((function(e){e.isBlack&&(n.fillStyle=e.fillStyle,n.fillRect(e.posX,3,e.width,e.height),n.fillStyle="#f00",n.strokeRect(e.posX,3,e.width,e.height))})),n.save()},j=[],f=[],m=[],O=Object(d.jsx)(d.Fragment,{}),p=t.noteData.chordMode==G.DIRECT;if(t.noteState.floatwndState==H.CHORD_PALETTE){S.forEach((function(e,n){var c=(u.init.keyIndex+n)%12,s=E[n],i=T[c],l=g[c],r=[1,3,6,8,10].includes(n),b=o.molecule.rootIndex==n,h=(null==o.denominator?-1:o.denominator.rootIndex)==n,f=function(a){return t.noteData.chordMode==G.SCALE?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{className:"degree",children:a?s:e}),Object(d.jsx)("span",{children:"\xa0("}),Object(d.jsx)("span",{className:"chord",children:a?l:i}),Object(d.jsx)("span",{children:")"})]}):Object(d.jsx)(d.Fragment,{children:Object(d.jsx)("span",{className:"degree",children:a?l:i})})};j.push(Object(d.jsx)("div",{children:r?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:["half",b&&!o.molecule.isFlat?" active":"",h&&null!=o.denominator&&!o.denominator.isFlat?" denominator":""].join(" "),onClick:function(){var e=!h||null==o.denominator||o.denominator.isFlat?o.denominator:null;a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{selectedLine:K.Root,molecule:{rootIndex:n,isFlat:!1},denominator:e})})},onContextMenu:function(){if(!b||o.molecule.isFlat){var e=!h||null==o.denominator||o.denominator.isFlat?{rootIndex:n,isFlat:!1}:null;a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{selectedLine:K.Root,denominator:e})})}},children:f(!1)}),Object(d.jsx)("div",{className:["half",b&&o.molecule.isFlat?" active":"",h&&null!=o.denominator&&o.denominator.isFlat?" denominator":""].join(" "),onClick:function(){var e=h&&null!=o.denominator&&o.denominator.isFlat?null:o.denominator;a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{selectedLine:K.Root,molecule:{rootIndex:n,isFlat:!0},denominator:e})})},onContextMenu:function(){if(!b||!o.molecule.isFlat){var e=h&&null!=o.denominator&&o.denominator.isFlat?null:{rootIndex:n,isFlat:!0};a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{selectedLine:K.Root,denominator:e})})}},children:f(!0)})]}):Object(d.jsx)("div",{className:[b?"active":"",h?"denominator":""].join(" "),onClick:function(){var e=h?null:o.denominator;a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{selectedLine:K.Root,molecule:{rootIndex:n,isFlat:!1},denominator:e})})},onContextMenu:function(){if(!b){var e=h?null:{rootIndex:n,isFlat:!1};a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{selectedLine:K.Root,denominator:e})})}},children:f(!1)})},n))})),D.forEach((function(e,t){f.push(Object(d.jsx)("div",{className:e.key==o.symbolKey?"active":"",onClick:function(){a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{selectedLine:K.Symbol,symbolKey:e.key})})},children:Object(d.jsxs)("span",{children:["[",e.name,"]"]})},t))}));for(var v=function(e){m.push(Object(d.jsx)("div",{className:o.sustain>=e+1?"active":"",onClick:function(){a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{selectedLine:K.Sustain,sustain:e+1})})}},e))},N=0;N<8;N++)v(N);O=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(ee.FLOATWND_STATE,{state:H.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){n.chord.setCurChordParam()},children:Object(d.jsx)("span",{children:"Enter"})})]})}var y=function(e,t){var n="h"==e?["h","head",o.headAdjust==t,function(){return a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{headAdjust:t})})}]:["t","tail",o.tailAdjust==t,function(){return a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{tailAdjust:t})})}],c=Object(r.a)(n,4),s=c[0],i=c[1],l=c[2],u=c[3];return t>=0&&(s+=t>0?"+":"\xb1"),Object(d.jsx)("div",{className:[i,l?"active":""].join(" "),onClick:u,children:Object(d.jsx)("span",{children:s+t})})},A=[],I=function(e,t){var n=[];return t.forEach((function(e,t){if(-1===e.rootIndex)n.push(Object(d.jsx)("div",{className:"box blank"},t));else{var c=e.isFlat?E:S,s=e.isFlat?g:T,i=c[e.rootIndex],l=s[e.rootIndex],r=P(e.symbolKey),u=e.rootIndex===o.molecule.rootIndex&&e.isFlat===o.molecule.isFlat&&e.symbolKey===o.symbolKey;n.push(Object(d.jsxs)("div",{className:["box",u?"active":""].join(" "),onClick:function(){u||a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},o),{},{molecule:{rootIndex:e.rootIndex,isFlat:e.isFlat},symbolKey:e.symbolKey})})},children:[Object(d.jsxs)("div",{className:"degree",children:[i,r.name]}),Object(d.jsxs)("div",{className:"chord",children:[l,r.name]})]},t))}})),Object(d.jsxs)("div",{className:"scale-row",children:[Object(d.jsx)("div",{className:"header",children:Object(d.jsx)("span",{children:e})}),n]},A.length)},L={rootIndex:-1,isFlat:!1,symbolKey:{}};return A.push(I(Object(d.jsxs)(d.Fragment,{children:["Diatonic",Object(d.jsx)("br",{}),"Triad"]}),[{rootIndex:0,isFlat:!1,symbolKey:C.MAJOR},{rootIndex:2,isFlat:!1,symbolKey:C.MINOR},{rootIndex:4,isFlat:!1,symbolKey:C.MINOR},{rootIndex:5,isFlat:!1,symbolKey:C.MAJOR},{rootIndex:7,isFlat:!1,symbolKey:C.MAJOR},{rootIndex:9,isFlat:!1,symbolKey:C.MINOR},{rootIndex:11,isFlat:!1,symbolKey:C.MINOR_MINUS5}])),A.push(I(Object(d.jsxs)(d.Fragment,{children:["Diatonic",Object(d.jsx)("br",{}),"Tetrad"]}),[{rootIndex:0,isFlat:!1,symbolKey:C.MAJ7},{rootIndex:2,isFlat:!1,symbolKey:C.MIN7},{rootIndex:4,isFlat:!1,symbolKey:C.MIN7},{rootIndex:5,isFlat:!1,symbolKey:C.MAJ7},{rootIndex:7,isFlat:!1,symbolKey:C.SEVENTH},{rootIndex:9,isFlat:!1,symbolKey:C.MIN7},{rootIndex:11,isFlat:!1,symbolKey:C.MIN7_MINUS5}])),A.push(I(Object(d.jsx)(d.Fragment,{children:"Sus4"}),[{rootIndex:0,isFlat:!1,symbolKey:C.SUS4},L,L,L,{rootIndex:7,isFlat:!1,symbolKey:C.SUS4},{rootIndex:9,isFlat:!1,symbolKey:C.SUS4},L])),A.push(I(Object(d.jsx)(d.Fragment,{children:"Parallel"}),[{rootIndex:0,isFlat:!0,symbolKey:C.MINOR},{rootIndex:2,isFlat:!0,symbolKey:C.MAJOR},{rootIndex:3,isFlat:!0,symbolKey:C.MAJOR},{rootIndex:5,isFlat:!0,symbolKey:C.MINOR},{rootIndex:7,isFlat:!0,symbolKey:C.MINOR},{rootIndex:8,isFlat:!0,symbolKey:C.MAJOR},{rootIndex:10,isFlat:!0,symbolKey:C.MAJOR}])),A.push(I(Object(d.jsxs)(d.Fragment,{children:["Secondary",Object(d.jsx)("br",{}),"Dominant"]}),[L,{rootIndex:9,isFlat:!1,symbolKey:C.SEVENTH},{rootIndex:11,isFlat:!1,symbolKey:C.SEVENTH},{rootIndex:0,isFlat:!1,symbolKey:C.SEVENTH},{rootIndex:2,isFlat:!1,symbolKey:C.SEVENTH},{rootIndex:4,isFlat:!1,symbolKey:C.SEVENTH},L])),A.push(I(Object(d.jsxs)(d.Fragment,{children:["Secondary",Object(d.jsx)("br",{}),"Non Root"]}),[L,{rootIndex:1,isFlat:!1,symbolKey:C.DIM},{rootIndex:3,isFlat:!1,symbolKey:C.DIM},{rootIndex:4,isFlat:!1,symbolKey:C.DIM},{rootIndex:6,isFlat:!1,symbolKey:C.DIM},{rootIndex:8,isFlat:!1,symbolKey:C.DIM},L])),Object(d.jsxs)("div",{ref:c,id:"total-palette",className:"floatwnd"+(t.noteState.floatwndState==H.CHORD_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsx)(h,{groupName:"selector-tabs",tabElements:[{name:"Scale",disable:p,cont:Object(d.jsx)(d.Fragment,{children:Object(d.jsx)("div",{className:"scale-matrix",children:A})})},{name:"Direct",disable:!1,cont:Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"chord-selector"+(o.selectedLine==K.Root?" active":""),children:j}),Object(d.jsx)("div",{className:"symbol-selector"+(o.selectedLine==K.Symbol?" active":""),children:f})]})}],activeNo:1}),Object(d.jsx)("div",{className:"piano-view",children:Object(d.jsx)("canvas",{ref:i})}),Object(d.jsx)("div",{className:"beat-selector"+(o.selectedLine==K.Sustain?" active":""),children:m}),Object(d.jsxs)("div",{className:"adjuster"+(o.selectedLine==K.Adjuster?" active":""),children:[y("h",-.5),y("h",-.25),y("h",0),y("h",.25),y("h",.5),y("t",-.5),y("t",-.25),y("t",0),y("t",.25),y("t",.5)]}),Object(d.jsx)("div",{className:"operation",children:O})]})}),he=(a(60),function(){var e=Object(s.useContext)(Nn),t=e.state,a=(e.dispatch,t.noteState.focusIndex);if(-1==a)return Object(d.jsx)(d.Fragment,{});var n=t.noteData.dataList[a],c=t.noteState.cacheList[a],i=Object(d.jsx)(d.Fragment,{});switch(n.type){case X.Chord:var o=n.detail,l="-";if(null!=o.molecule){var r=o.molecule.rootIndex,u=S[r],b=T[r];l="".concat(u," (").concat(b,")")}var h,j="-";if(null!=o.molecule)j="[".concat(null===(h=P(o.symbolKey))||void 0===h?void 0:h.name,"]");var f=je("Base",[{labelName:"Tempo",value:""+c.init.tempo,disable:!1},{labelName:"Beat",value:c.init.rythm,disable:!1},{labelName:"Key",value:T[c.init.keyIndex],disable:!1},{labelName:"Scale",value:c.init.scale,disable:!1}]),m=je("Chord",[{labelName:"Root",value:l,disable:"-"==l},{labelName:"Symbol",value:j,disable:"-"==j},{labelName:"On chord",value:"-",disable:!0},{labelName:"Sustain",value:String(o.sustain),disable:!1},{labelName:"Adjsut-H",value:Y(o.headAdjust),disable:0==o.headAdjust},{labelName:"Adjsut-T",value:Y(o.tailAdjust),disable:0==o.tailAdjust}]);i=Object(d.jsx)("div",{className:"block",children:Object(d.jsxs)("div",{children:[f,m,function(){if(null!=o.molecule){for(var e=[],t=P(o.symbolKey),a=null===t||void 0===t?void 0:t.intervals,n=null===a||void 0===a?void 0:a.length,c=0;c<7;c++)if(c<n){var s=null===t||void 0===t?void 0:t.intervals[c],i=null===t||void 0===t?void 0:t.struct[c],l=T[(o.molecule.rootIndex+s)%12];e.push(Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"interval",children:Object(d.jsx)("span",{children:s})}),Object(d.jsx)("div",{className:"struct",children:Object(d.jsx)("span",{children:i})}),Object(d.jsx)("div",{className:"sound",children:Object(d.jsx)("span",{children:l})})]},c))}else e.push(Object(d.jsxs)("div",{className:"record disable",children:[Object(d.jsx)("div",{className:"interval"}),Object(d.jsx)("div",{className:"struct"}),Object(d.jsx)("div",{className:"sound"})]},c));return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Struct"})}),Object(d.jsx)("div",{className:"symbol-struct",children:e})]})}return Object(d.jsx)(d.Fragment,{})}()]})});break;case X.Section:var O=n.detail,p=je("Section",[{labelName:"label",value:O.labelName,disable:!1},{labelName:"box count",value:"-",disable:!0},{labelName:"total bar",value:"-",disable:!0},{labelName:"total time",value:"-",disable:!0}]);i=Object(d.jsx)("div",{className:"block",children:Object(d.jsx)("div",{children:p})});break;case X.Change:var x=n.detail,v=["-","-","-","-","-","-","-","-","-"];null!=x.changeType&&(v[0]=String(x.changeType)),null!=x.modulateRelation&&(v[1]=String(x.modulateRelation)),0!=x.domminantValue&&(v[2]=String(x.domminantValue)),0!=x.keyAdjust&&(v[3]=String(x.keyAdjust)),null!=x.tempoRelation&&(v[4]=String(x.tempoRelation)),0!=x.tempoDiff&&(v[5]=String(x.tempoDiff)),0!=x.tempoRate&&(v[6]=String(x.tempoRate)),0!=x.tempoAbsolute&&(v[7]=String(x.tempoAbsolute)),null!=x.beat&&(v[8]=String(x.beat));var E=je("Change",[{labelName:"type",value:v[0],disable:"-"==v[0]},{labelName:"modulate",value:v[1],disable:"-"==v[1]},{labelName:"domm",value:v[2],disable:"-"==v[2]},{labelName:"key",value:v[3],disable:"-"==v[3]},{labelName:"tempo",value:v[4],disable:"-"==v[4]},{labelName:"diff",value:v[5],disable:"-"==v[5]},{labelName:"rate",value:v[6],disable:"-"==v[6]},{labelName:"absolute",value:v[7],disable:"-"==v[7]},{labelName:"beat",value:v[8],disable:"-"==v[8]}]);i=Object(d.jsx)("div",{className:"block",children:Object(d.jsx)("div",{children:E})})}return Object(d.jsx)("div",{id:"current-detail",children:i})}),je=function(e,t){var a=[];return t.forEach((function(e,t){a.push(Object(d.jsxs)("div",{className:"record"+(e.disable?" disable":""),children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsxs)("span",{children:[e.labelName,":"]})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:e.value})})]},t))})),Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:e})}),Object(d.jsx)("div",{className:"current-state",children:a})]})},fe=(a(61),function(e){var t=e.dispatcher,a=e.paletteState,n=a.sideIndex,c=a.layers[n],s=a.selectedLenIndex,i=c.lens[s],o=c.vels[s],l=function(e){var c=a.layers;c[n].lens[s]=e,t.initBackingPalette(Object(x.a)(Object(x.a)({},a),{},{layers:c}))},r=function(e){i.len=e,i.isHalf=!1,i.isDiv3=!1,l(i)},u=function(e){var c=a.layers,i=c[n].vels[s];c[n].vels[s]=i+e,t.initBackingPalette(Object(x.a)(Object(x.a)({},a),{},{layers:c}))},b=i.len,h=[{label:"16",isActive:b==U.LEN16,isDisable:!1,callback:function(){r(U.LEN16)}},{label:"8",isActive:b==U.LEN8,isDisable:!1,callback:function(){r(U.LEN8)}},{label:"4",isActive:b==U.LEN4,isDisable:!1,callback:function(){r(U.LEN4)}},{label:"2",isActive:b==U.LEN2,isDisable:!1,callback:function(){r(U.LEN2)}},{label:"1",isActive:b==U.LEN1,isDisable:!1,callback:function(){r(U.LEN1)}},{label:".",isActive:i.isHalf,isDisable:!t.backing.isAcceptHalf(),callback:function(){i.isHalf=!i.isHalf,i.isDiv3=!1,l(i)}},{label:"/ 3",isActive:i.isDiv3,isDisable:!t.backing.isAcceptDiv3(),callback:function(){i.isDiv3=!i.isDiv3,i.isHalf=!1,l(i)}},{label:"Add",isActive:!1,isDisable:!1,callback:function(){t.backing.addLen()}},{label:"Del",isActive:!1,isDisable:c.lens.length<=1,callback:function(){t.backing.delLen()}},{label:"vel-",isActive:!1,isDisable:o<=1,callback:function(){u(-1)}},{label:"vel+",isActive:!1,isDisable:o>=10,callback:function(){u(1)}}],j=[];return h.forEach((function(e,t){j.push(Object(d.jsx)("button",{className:(e.isActive?"active":"")+(e.isDisable?" disable":""),onClick:function(){return e.callback()},children:Object(d.jsx)("span",{children:e.label})},t))})),Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("select",{value:a.channelRowSize,onChange:function(a){var n=e.paletteState,c=parseInt(a.target.value),s=c-n.channelRowSize,i=n.layers;s>0?i.forEach((function(e){for(var t=0;t<s;t++){for(var a=[],c=0;c<e.lens.length;c++)a.push([!1]);e.table.splice(n.channelRowSize,0,a)}})):s<0&&i.forEach((function(e){e.table.splice(c,Math.abs(s))})),n.channelRowSize=c,t.backing.setPaletteState(e.paletteState)},children:function(){for(var e=[],t=0;t<12;t++){var n=t+1,c=n<a.channelRowSize;e.push(Object(d.jsx)("option",{value:n,className:c?"del":"",children:n},t))}return e}()}),j]})}),me=function(e,t,a,n,c){var s=e[0==t?0:1],i=e[1==t?0:1],o="";if(s.table[a][n][c]){o="active";var l=pe(s.lens,n,c);i.lens.forEach((function(e,t){for(var n=0;n<(e.isDiv3?3:1);n++){var c=pe(i.lens,t,n);i.table[a][t][n]&&(Oe(l,c)||Oe(c,l))&&(o="overlap")}}))}return o},Oe=function(e,t){return e.head+e.width>t.head&&e.head+e.width<=t.head+t.width||e.head<t.head+t.width&&e.head>=t.head},pe=function(e,t,a){for(var n=0,c=0;c<t;c++){var s=e[c];n+=xe(s)}var i=e[t],o=xe(i);return i.isDiv3&&(n+=o/3*a,o/=3),{head:n,width:o}},xe=function(e){var t=0;switch(e.len){case U.LEN1:t=16;break;case U.LEN2:t=8;break;case U.LEN4:t=4;break;case U.LEN8:t=2;break;case U.LEN16:t=1}return e.isHalf&&(t*=1.5),t},ve=function(e){for(var t=e.paletteState,a=(e.channelList,e.dispatcher),n=[],c=function(e){for(var c=[],s=t.layers[e],i=t.sideIndex==e,o=function(n){var i=[];s.lens.forEach((function(c,s){var o="";switch(c.len){case U.LEN4:o+="len4","4";break;case U.LEN8:o+="len8","8";break;case U.LEN16:o+="len16","16";break;case U.LEN2:o+="len2","2";break;case U.LEN1:o+="len1","1"}c.isHalf&&(o+=" half");for(var l=[],r=c.isDiv3?3:1,u=function(i){var o=me(t.layers,e,n,s,i);"overlap"==o&&!0,l.push(Object(d.jsx)("div",{className:[o,c.isDiv3?"div3":""].join(" "),onClick:function(){a.backing.toggleMatrix(n,s,i)}},i))},b=0;b<r;b++)u(b);i.push(Object(d.jsx)("div",{className:o,children:l},s))})),c.push(Object(d.jsx)("div",{className:"line",children:i},n))},l=t.channelRowSize-1;l>=0;l--)o(l);n.push(Object(d.jsx)("div",{className:i?"cur":"back",children:c},e))},s=0;s<2;s++)c(s);return Object(d.jsx)("div",{className:"matrix",children:n})},Ee=function(e){var t=e.layer,a=e.paletteState,n=4*(a.sustain+a.headAdjust+a.tailAdjust),c=[],s=0;t.lens.forEach((function(e,t){var a=0;switch(e.len){case U.LEN1:a=16;break;case U.LEN2:a=8;break;case U.LEN4:a=4;break;case U.LEN8:a=2;break;case U.LEN16:a=1}e.isHalf&&(a*=1.5),s+=a}));var i=s>n;s=i?s:n;for(var o=function(e){var t=e+4*a.headAdjust;c.push(Object(d.jsx)("div",{className:t%2==0?t%4==0?"mem4":"mem8":"mem16"},e))},l=0;l<s;l++)o(l);var r=31*n,u=i?Object(d.jsx)("div",{style:{left:"".concat(r,"px"),width:"".concat(31*(s-n),"px")},className:"over"}):Object(d.jsx)("div",{style:{left:"".concat(r,"px"),width:"5px"},className:"safe"});return Object(d.jsxs)("div",{className:"measure",children:[c,u]})},Se=function(e){for(var t=e.paletteState,a=t.sideIndex,n=t.layers[a],c=e.dispatcher,s=e.channelList,i=e.testPlaySound,o=[],l=t.channelRowSize-s.length,r=function(t){var a=t-l,n=a>=0,r="-";n&&(r=s[a].soundFullName),o.push(Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{className:["channel",n?"":"blank"].join(" "),onClick:function(){n&&i(r)},children:Object(d.jsx)("span",{children:r})}),Object(d.jsx)("div",{className:["opr",1==e.paletteState.channelRowSize?"disable":""].join(" "),onClick:function(){var a=e.paletteState,n=a.layers,s=a.channelRowSize-(t+1);n.forEach((function(e){e.table.splice(s,1)})),a.channelRowSize=a.channelRowSize-1,c.backing.setPaletteState(e.paletteState)},children:Object(d.jsx)("span",{children:"-"})}),Object(d.jsx)("div",{className:["opr",12==e.paletteState.channelRowSize?"disable":""].join(" "),onClick:function(){var a=e.paletteState,n=a.layers,s=a.channelRowSize-(t+1);n.forEach((function(e){for(var t=[],a=0;a<e.lens.length;a++)t.push([!1]);e.table.splice(s,0,t)})),a.channelRowSize=a.channelRowSize+1,c.backing.setPaletteState(e.paletteState)},children:Object(d.jsx)("span",{children:"+"})})]},t))},u=0;u<t.channelRowSize;u++)r(u);var b=[],h=[];return n.lens.forEach((function(e,a){var s=t.selectedLenIndex==a?"active ":"",i="";switch(e.len){case U.LEN4:s+="len4",i="4";break;case U.LEN8:s+="len8",i="8";break;case U.LEN16:s+="len16",i="16";break;case U.LEN2:s+="len2",i="2";break;case U.LEN1:s+="len1",i="1"}e.isHalf&&(i+=" .",s+=" half"),e.isDiv3&&(i+=" /"),b.push(Object(d.jsx)("div",{className:s,onClick:function(){c.initBackingPalette(Object(x.a)(Object(x.a)({},t),{},{selectedLenIndex:a}))},children:Object(d.jsx)("span",{children:i})},a));var o=n.vels[a];h.push(Object(d.jsx)("div",{className:s,children:Object(d.jsx)("div",{style:{height:10*o+"%"}})},a))})),Object(d.jsxs)("div",{className:["backing-table",t.isEditPattern?"":"disable"].join(" "),children:[Object(d.jsx)("div",{className:"switch",children:Object(d.jsx)(fe,{dispatcher:c,paletteState:t})}),Object(d.jsxs)("div",{className:"fixed",children:[Object(d.jsxs)("div",{className:"layer",children:[Object(d.jsx)("button",{className:1==t.sideIndex?"active":"",onClick:function(){c.backing.setLayerIndex(1)},children:Object(d.jsx)("span",{children:"R-Layer"})}),Object(d.jsx)("button",{className:0==t.sideIndex?"active":"",onClick:function(){c.backing.setLayerIndex(0)},children:Object(d.jsx)("span",{children:"L-Layer"})})]}),Object(d.jsx)("div",{className:"matrix",children:o}),Object(d.jsx)("div",{className:"pedal",children:Object(d.jsx)("button",{className:t.isUsePedal?"active":"",onClick:function(){c.backing.setUsePedal(!t.isUsePedal)},children:Object(d.jsx)("span",{children:"Pedal"})})})]}),Object(d.jsxs)("div",{className:"main",children:[Object(d.jsx)("div",{className:"split",children:b}),Object(d.jsx)(Ee,{paletteState:t,layer:n}),Object(d.jsx)(ve,{paletteState:t,channelList:s,dispatcher:c}),Object(d.jsx)("div",{className:"volume",children:h})]})]})},ge=a(7),Te=a(8);Te.b.div(ae||(ae=Object(ge.a)(["\n    display: inline-block;\n    background-color: ",";\n    width: 100%;\n    padding: ",";\n    margin: ",";\n    text-align: ",";\n    box-sizing: border-box;\n"])),(function(e){return e.backgroundColor}),(function(e){return e.padding}),(function(e){return e.margin}),(function(e){return e.textAlign})).defaultProps={backgroundColor:"inherit",textAlign:"inherit",padding:"0",margin:"0"};Te.b.div(ne||(ne=Object(ge.a)(["\n    opacity: ","\n"])),(function(e){return e.opacity}));var Ne=Te.b.span(ce||(ce=Object(ge.a)(["\n    font-size: ",";\n    color: ",";\n    font-weight: ",";\n"])),(function(e){return e.fontSize}),(function(e){return e.color}),(function(e){return e.fontWeight}));Ne.defaultProps={fontSize:"inherit",color:"inherit",fontWeight:"inherit"};var ye,Ae,Ie,Ce,Le,ke,_e,De,Re,we,Fe,Me,Pe,He,Ke,Be,Ue,Ge,Ve,ze,We,Je,Xe,Ye,qe,Qe,Ze,$e,et,tt,at,nt,ct,st,it,ot,lt,rt,dt,ut,bt,ht,jt,ft,mt,Ot,pt,xt,vt,Et,St,gt,Tt,Nt,yt,At,It=function(e){if(!e.paletteState.isDispVoicing)return Object(d.jsx)(d.Fragment,{});var t=e.paletteState.useChannels,a=[];t.sort((function(e,t){return 12*e.octave+e.structIndex-(12*t.octave+t.structIndex)}));for(var n=t.slice(e.paletteState.channelRowSize),c=function(c){var s=c<e.structs.length,i=[];if(s){var o=e.structs[c],l=e.structs.length-e.symbol.intervals.length==1?c-1:c,r=-1==l?-1:e.symbol.intervals[l],u=-1==l?"dom":e.symbol.struct[l];i.push(Object(d.jsx)("div",{className:"label",children:Object(d.jsxs)("span",{children:[u,"[",r,"]: ",Object(d.jsx)(Ne,{color:"#000",children:o})]})},0));for(var b=function(a){var s=e.degreeIndex+r+12*a,l=Math.floor(s/12),u=o+l,b=s<9||s>=97,h=!1;t.forEach((function(e){e.octave==a&&e.structIndex==c&&(h=!0)}));var j=t.length>=12&&!h,f=!1;n.forEach((function(e){e.octave==a&&e.structIndex==c&&(f=!0)})),i.push(Object(d.jsx)("div",{className:["col",b||j?"disable":"",h?"active":"",f?"over":""].join(" "),onClick:function(){var t=e.paletteState.useChannels;if(h){var n=-1;t.forEach((function(e,t){e.octave==a&&e.structIndex==c&&(n=t)})),t.splice(n,1)}else t.push({octave:a,structIndex:c});t.sort((function(e,t){return 8*e.octave+e.structIndex-(8*t.octave+t.structIndex)})),e.paletteState.useChannels=t,e.setUseChannels(e.paletteState.useChannels)},onContextMenu:function(){e.testPlaySound(u)},children:Object(d.jsx)("span",{children:b?"-":u})},a+1))},h=0;h<8;h++)b(h)}else{i.push(Object(d.jsx)("div",{className:"label"},0));for(var j=0;j<8;j++)i.push(Object(d.jsx)("div",{className:"col"},j+1))}a.push(Object(d.jsx)("div",{className:"record"+(s?"":" disable"),children:i},c))},s=0;s<7;s++)c(s);return Object(d.jsx)("div",{className:"struct-table",children:a})},Ct=Object(s.createContext)({}),Lt=function(e,t,a,n){for(var c=[],s=function(s){for(var i=function(i){var o=t+a.intervals[s]+12*i,l=!1;e.forEach((function(e){e.octave==i&&e.structIndex==s&&(l=!0)}));var r=Math.floor(o/12),d=n[s]+r;l&&c.push({soundIndex:o,soundFullName:d})},o=0;o<8;o++)i(o)},i=0;i<a.intervals.length;i++)s(i);return c.sort((function(e,t){return t.soundIndex-e.soundIndex})),c},kt=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)({});if(Object(s.useEffect)((function(){a(ee.GET_REFFER_BACKING_PALETTE,{reffer:c.current})}),[]),t.noteState.floatwndState!=H.BACKING_PALETTE)return Object(d.jsx)(d.Fragment,{});var i=t.noteState.editMode===V.PREVIEW,o=t.noteState.backingPaletteState,l=o.molecule,r=o.denominator,u=Object(x.a)({},P(o.symbolKey)),b=o.sustain,h=o.headAdjust,j=o.tailAdjust,f=T[l.rootIndex]+u.name,m=[];null!=r&&(f+="/".concat(q(r,0)),$(u,l.rootIndex,r.rootIndex)),u.intervals.forEach((function(e){m.push(T[(l.rootIndex+e)%12])}));var O=Lt(o.useChannels,l.rootIndex,u,m),p=function(e){t.sampler.triggerAttack(e,"+0",.15),setTimeout((function(){t.sampler.triggerRelease(e)}),1e3)},v=d.Fragment;return v=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:[i?"disable":""].join(" "),onClick:function(){a(ee.FLOATWND_STATE,{state:H.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{className:[o.isCorrect?"":"disable"].join(" "),onClick:function(){i?n.preview.stop():n.backing.play(!1)},children:Object(d.jsx)("span",{children:i?"Stop":"Play"})}),Object(d.jsx)("div",{className:[i||!o.isCorrect?"disable":""].join(" "),onClick:function(){switch(o.target){case"note":n.backing.setCurBackingScript();break;case"thema-pattern":n.thema.applyBackingPattern();break;case"thema-voicing":n.thema.applyBackingVoicing()}},children:Object(d.jsx)("span",{children:"Update"})})]}),Object(d.jsx)(Ct.Provider,{value:{editorState:o},children:Object(d.jsxs)("div",{ref:c,className:["backing-palette","floatwnd",t.noteState.floatwndState==H.BACKING_PALETTE?" active":""].join(" "),onClick:function(){},children:[Object(d.jsxs)("div",{className:"base-info",children:[Object(d.jsxs)("div",{className:["record",o.isDispVoicing?"":"hidden"].join(" "),children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Chord:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:f})})]}),Object(d.jsxs)("div",{className:["record",o.isDispVoicing?"":"hidden"].join(" "),children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Category:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:M(u.category)})})]}),Object(d.jsxs)("div",{className:["record",o.isDispVoicing?"":"hidden"].join(" "),children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Struct:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:m.join(", ")})})]}),Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"title",children:Object(d.jsx)("span",{children:"Sustain:"})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("span",{children:b+h+j})})]})]}),Object(d.jsx)(It,{paletteState:o,structs:m,symbol:u,degreeIndex:l.rootIndex,testPlaySound:p,setUseChannels:function(e){return n.setUseChannels(e)}}),Object(d.jsx)(Se,{channelList:O,paletteState:o,dispatcher:n,testPlaySound:p}),Object(d.jsx)("div",{className:"operation",children:v})]})})},_t=(a(64),100),Dt=(Te.b.div(ye||(ye=Object(ge.a)(["\n    font-size: 0;\n    display: inline-inline-block;\n"]))),function(e){var t="";return 0!=e&&(t=e>0?"aug":"dim"),t}),Rt=function(){var e=Object(s.useContext)(Nn),t=e.state,a=(e.dispatcher,t.noteData.dataList),n=t.noteState.focusIndex,c=t.noteData.dataList.length,i=Object(s.useRef)({}),o=Object(s.useState)([]),l=Object(r.a)(o,2),u=l[0],b=l[1],h=Object(s.useState)([]),j=Object(r.a)(h,2),f=j[0],m=j[1],O=Object(s.useState)(0),p=Object(r.a)(O,2),x=p[0],v=p[1],E=a[n].type==X.Chord?a[n].detail:null,S=null==E?0:E.sustain,g=null==E?0:E.headAdjust,T=null==E?0:E.tailAdjust;if(Object(s.useEffect)((function(){var e=0,a=[],c=[];t.noteData.dataList.forEach((function(t,c){if(t.type==X.Init&&a.push(Object(d.jsx)("div",{className:[].join(" "),style:{width:"".concat(_t,"px")}},a.length)),t.type==X.Chord){var s=t.detail,o=s.sustain+s.headAdjust+s.tailAdjust,l=16*o*4,r=n==c,u=n==c-1||n==c+1;a.push(Object(d.jsxs)("div",{className:[r?"active":"",u?"near":""].join(" "),style:{width:"".concat(l-1,"px")},children:[Object(d.jsx)("div",{className:"sus",children:Object(d.jsx)("span",{children:s.sustain})}),Object(d.jsxs)("div",{className:"adjust",children:[Object(d.jsx)("span",{className:Dt(s.headAdjust),children:Y(s.headAdjust)}),Object(d.jsx)("span",{className:Dt(s.tailAdjust),children:Y(s.tailAdjust)})]})]},a.length)),r&&i.current.scrollTo({left:16*e-_t,behavior:"smooth"}),e+=4*o}}));for(var s=0;s<e;s++){var o="",l=1+s/16;if(s%16==0)o="mem-bar";else switch(s%4){case 0:o="mem4";break;case 2:o="mem8";break;default:o="mem16"}c.push(Object(d.jsx)("div",{className:o,style:{left:"".concat(_t+16*s,"px")},children:s%16==0?Object(d.jsx)("div",{className:"bar",style:{left:"".concat(-14,"px"),top:"24px"},children:l}):Object(d.jsx)(d.Fragment,{})},c.length))}b(a),m(c),v(e)}),[c,n,S,g,T]),null==E)return Object(d.jsx)(d.Fragment,{});var N=200+16*x;return Object(d.jsx)("div",{id:"footer-timing",className:"footer-child",children:Object(d.jsxs)("div",{className:"scroll",ref:i,children:[Object(d.jsx)("div",{className:"blocks",style:{width:"".concat(N,"px")},children:u}),Object(d.jsx)("div",{className:"measure",style:{width:"".concat(N,"px")},children:f})]})})},wt=(a(65),function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatcher,n=Object(s.useState)(!1),c=Object(r.a)(n,2),i=c[0],o=c[1],l=Object(s.useState)("0"),u=Object(r.a)(l,2),b=u[0],h=u[1],j=(t.noteData.dataList,t.noteState.focusIndex,t.noteData.dataList.length,t.noteState.ensembleInfo);return Object(s.useEffect)((function(){o(!j.audio.paused)}),[j.audio.paused]),Object(d.jsxs)("div",{id:"footer-ensemble",className:"footer-child",children:[Object(d.jsxs)("div",{className:["record data",j.isLoad?"disable":""].join(" "),children:[Object(d.jsx)("input",{type:"text",value:j.fileURL,onChange:function(e){j.fileURL=e.target.value,a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{ensembleInfo:j}))}}),Object(d.jsx)("input",{type:"file",onChange:function(e){if(null!=e.target.files&&null!=e.target.files[0]){var n=window.URL.createObjectURL(e.target.files[0]);j.fileURL=n,a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{ensembleInfo:j}))}}})]}),Object(d.jsxs)("div",{className:["record adjust",j.isLoad?"disable":""].join(" "),children:[Object(d.jsx)("input",{type:"text",value:b,onChange:function(e){h(e.target.value)}}),Object(d.jsx)("input",{type:"range",min:1,max:100,value:j.volume,onChange:function(e){j.volume=Number(e.target.value),a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{ensembleInfo:j}))}}),Object(d.jsx)("button",{className:[i?"disable":""].join(" "),onClick:function(){if(""!==b)try{j.startPosition=Number(b),j.isLoad=!0;var e=new Audio;e.onerror=function(){j.isLoad=!1,a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{ensembleInfo:j}))},e.src=j.fileURL,e.currentTime=.001*j.startPosition,e.volume=.01*j.volume,j.audio=e,a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{ensembleInfo:j}))}catch(n){j.isLoad=!1,a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{ensembleInfo:j}))}},children:"Aplly"})]}),Object(d.jsxs)("div",{className:["record",j.isLoad?"":"disable"].join(" "),children:[Object(d.jsx)("button",{className:[i?"disable":""].join(" "),onClick:function(){j.audio=new Audio,j.isLoad=!1,a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{ensembleInfo:j}))},children:"Remove"}),Object(d.jsx)("button",{className:[i?"disable":""].join(" "),onClick:function(){j.audio.play(),o(!0)},children:"Play"}),Object(d.jsx)("button",{className:[i?"":"disable"].join(" "),onClick:function(){j.audio.pause(),o(!1)},children:"Stop"}),Object(d.jsx)("button",{className:[].join(" "),onClick:function(){j.audio.currentTime=.001*j.startPosition},children:"Reset"})]})]})}),Ft=function(){var e=Object(s.useContext)(Nn),t=e.state,a=(e.dispatcher,t.noteData.dataList[t.noteState.focusIndex].type),n=Object(s.useState)(0),c=Object(r.a)(n,2),i=c[0],o=c[1];return Object(s.useEffect)((function(){a&&o(a!==X.Init?0:2)}),[t.noteState.focusIndex]),Object(d.jsx)("div",{id:"score-footer",children:Object(d.jsx)(h,{groupName:"score-tabs",tabElements:[{name:"Progress",disable:!0,cont:Object(d.jsx)(Rt,{})},{name:"Target",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Ensemble",disable:!0,cont:Object(d.jsx)(wt,{})}],activeNo:i})})},Mt=(a(66),function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useState)(55),i=Object(r.a)(c,2),o=i[0],l=i[1],u=Object(s.useState)("4/4"),b=Object(r.a)(u,2),h=b[0],j=b[1],f=Object(s.useState)(0),m=Object(r.a)(f,2),O=m[0],p=m[1],x=Object(s.useState)("major"),v=Object(r.a)(x,2),E=v[0],S=v[1],g=Object(s.useRef)({});Object(s.useEffect)((function(){a(ee.GET_REFFER_CHORD_PALETTE,{reffer:g.current})}),[]),Object(s.useEffect)((function(){if(t.noteState.floatwndState===H.INIT_PALETTE){var e=t.dinamicCache;n.setDinamicCache(null),l(e.tempo),j(e.rythm),p(e.keyIndex),S(e.scale)}}),[t.noteState.floatwndState]);var T=d.Fragment;T=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(ee.FLOATWND_STATE,{state:H.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){n.init.setInitParam(o,h,O,E)},children:Object(d.jsx)("span",{children:"Enter"})})]});var C,L=function(e,t,a,n){var c=[];return n.forEach((function(e){c.push(Object(d.jsx)("option",{value:e.value,children:e.display},c.length))})),Object(d.jsxs)("div",{className:"item",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:e})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("select",{value:t,onChange:function(e){a(e.target.value)},children:c})})]})},k=t.noteData.chordMode==G.DIRECT;return Object(d.jsxs)("div",{id:"init-editor",className:"floatwnd"+(t.noteState.floatwndState==H.INIT_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsxs)("div",{className:"items",children:[(C="Tempo",Object(d.jsxs)("div",{className:"item",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:C})}),Object(d.jsxs)("div",{className:"value",children:[Object(d.jsx)("input",{type:"number",value:o,min:"30",max:"180",onChange:function(e){l(Number(e.target.value))}}),Object(d.jsx)("input",{type:"range",name:"speed",min:"30",max:"180",value:o,onChange:function(e){l(Number(e.target.value))}})]})]})),L("Beat",h,(function(e){j(e)}),I.map((function(e){return{value:e,display:e}}))),k?Object(d.jsx)(d.Fragment,{}):L("Scale",E,(function(e){S(e)}),A.map((function(e){return{value:e,display:e}}))),k?Object(d.jsx)(d.Fragment,{}):L("Key",String(O),(function(e){p(Number(e))}),E==A[0]?N.map((function(e,t){return{value:t.toString(),display:e}})):y.map((function(e,t){return{value:t.toString(),display:e}})))]}),Object(d.jsx)("div",{className:"operation",children:T})]})}),Pt=(a(67),function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useRef)({});Object(s.useEffect)((function(){a(ee.GET_REFFER_SECTION_PALETTE,{reffer:c.current})}),[]);var i=Object(s.useState)("Section"),o=Object(r.a)(i,2),l=o[0],u=o[1];Object(s.useEffect)((function(){if(t.noteState.floatwndState===H.SECTION_PALETTE){var e=t.dinamicCache;u(e.labelName)}}),[t.noteState.floatwndState]);var b=d.Fragment;b=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(ee.FLOATWND_STATE,{state:H.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){n.section.setSectionParam(l)},children:Object(d.jsx)("span",{children:"Enter"})})]});var h,j,f;return Object(d.jsxs)("div",{id:"section-editor",className:"floatwnd"+(t.noteState.floatwndState==H.SECTION_PALETTE?" active":""),onClick:function(){},children:[Object(d.jsx)("div",{className:"items",children:(h="Name",j=l,f=function(e){u(e)},Object(d.jsxs)("div",{className:"item",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:h})}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("input",{type:"text",value:j,onChange:function(e){f(e.target.value)}})})]}))}),Object(d.jsx)("div",{className:"operation",children:b})]})}),Ht=(a(68),function(){var e=Object(s.useContext)(Nn),t=e.state,a=(e.dispatch,e.dispatcher);if(t.noteState.floatwndState!=H.SETTING_EDITOR)return Object(d.jsx)(d.Fragment,{});for(var n=t.noteState.defaultSustain,c=[],i=function(e){c.push(Object(d.jsx)("div",{className:[e+1<=n?"active":""].join(" "),onClick:function(){a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{defaultSustain:e+1}))}},c.length))},o=0;o<8;o++)i(o);return Object(d.jsx)("div",{id:"setting-editor",className:"floatwnd active",children:Object(d.jsx)("div",{className:"sustain",children:c})})}),Kt=(a(69),function(e,t,a,n,c,s){var i=[];return c.forEach((function(e){i.push(Object(d.jsx)("option",{value:e.value,children:e.display},i.length))})),Object(d.jsxs)("div",{className:["record",s?"disable":""].join(" "),children:[Object(d.jsx)("div",{className:"label",children:t}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("select",{className:s||""!==a?"":"error",value:a,onChange:function(e){n(e.target.value)},children:i})})]},e)}),Bt=function(e,t,a,n,c,s,i){return Object(d.jsxs)("div",{className:["record",i?"disable":""].join(" "),children:[Object(d.jsx)("div",{className:"label",children:t}),Object(d.jsx)("div",{className:"value",children:Object(d.jsx)("input",{type:"number",className:i||""!==a&&a>=n&&a<=c?"":"error",value:a,min:n,max:c,onChange:function(e){s(e.target.value)}})})]},e)},Ut=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,c=e.dispatcher;Object(s.useRef)({});Object(s.useEffect)((function(){}),[]);var i=Object(s.useState)(""),o=Object(r.a)(i,2),l=o[0],u=o[1],b=Object(s.useState)(""),h=Object(r.a)(b,2),j=h[0],f=h[1],m=Object(s.useState)(""),O=Object(r.a)(m,2),p=O[0],x=O[1],v=Object(s.useState)(""),E=Object(r.a)(v,2),S=E[0],g=E[1],T=Object(s.useState)(""),N=Object(r.a)(T,2),y=N[0],A=N[1],I=Object(s.useState)(""),C=Object(r.a)(I,2),L=C[0],k=C[1],_=Object(s.useState)(""),D=Object(r.a)(_,2),R=D[0],w=D[1],F=Object(s.useState)(""),M=Object(r.a)(F,2),P=M[0],K=M[1],B=Object(s.useState)(""),U=Object(r.a)(B,2),V=U[0],X=U[1],Y=Object(s.useState)(!1),q=Object(r.a)(Y,2),Q=q[0],Z=q[1],$=t.noteData.chordMode;Object(s.useEffect)((function(){if(t.noteState.floatwndState===H.CHANGE_PALETTE){var e,a=t.dinamicCache;u(null==a.changeType?"":a.changeType),f(null==a.modulateRelation?"":a.modulateRelation),x(a.domminantValue),g(a.keyAdjust),A(null==a.tempoRelation?"":null===(e=a.tempoRelation)||void 0===e?void 0:e.toString()),k(a.tempoRate),w(a.tempoDiff),K(a.tempoAbsolute),X(null==a.beat?"":a.beat)}}),[t.noteState.floatwndState]),Object(s.useEffect)((function(){!function(){switch(Z(!1),l){case z.MODULATE:switch(j){case W.DOMINANT:""!==p&&Z(!0);break;case W.KEY:""!==S&&Z(!0);break;case W.RELATIVE:case W.PARALLEL:Z(!0)}break;case z.TEMPO:switch(y){case J.DIFF:""!==R&&Z(!0);break;case J.RATE:""!==L&&Z(!0);break;case J.ABSOLUTE:""!==P&&Z(!0)}break;case z.BEAT:""!==V&&Z(!0)}}()}),[l,j,p,S,y,R,L,P,V]);var te=[];te.push(Kt(te.length,"Change Type",l,(function(e){u(e),e!==z.MODULATE&&(f(""),x(""),g("")),e!==z.TEMPO&&(A(""),k(""),w(""),K("")),e!==z.BEAT&&X("")}),[{value:"",display:""}].concat(Object.values(z).filter((function(e){return!($===G.DIRECT&&e===z.MODULATE)})).map((function(e){return{value:e.toString(),display:e.toString()}}))),!1)),$===G.SCALE&&(te.push(Kt(te.length,"Modulate Relation",j,(function(e){f(e),e!==W.KEY&&g(""),e!==W.DOMINANT&&x("")}),[{value:"",display:""}].concat(Object.values(W).map((function(e){var t=e.toString();return{value:t,display:t}}))),l!==z.MODULATE.toString())),te.push(Bt(te.length,"Domminant Value",p,-3,3,(function(e){x(e)}),j!==W.DOMINANT.toString())),te.push(Bt(te.length,"Key Adjust",S,-3,3,(function(e){g(e)}),j!==W.KEY.toString()))),te.push(Kt(te.length,"Tempo Relation",y,(function(e){A(e),e!==J.RATE&&k(""),e!==J.DIFF&&w(""),e!==J.ABSOLUTE&&K("")}),[{value:"",display:""}].concat(Object.values(J).map((function(e){var t=e.toString();return{value:t,display:t}}))),l!==z.TEMPO.toString())),te.push(Bt(te.length,"Tempo Diff",R,-150,150,(function(e){w(e)}),y!==J.DIFF.toString())),te.push(Bt(te.length,"Tempo Rate",L,20,200,(function(e){k(e)}),y!==J.RATE.toString())),te.push(Bt(te.length,"Tempo Absolute",P,30,180,(function(e){K(e)}),y!==J.ABSOLUTE.toString())),te.push(Kt(te.length,"Beat",V,(function(e){X(e)}),[{value:"",display:""}].concat(Object.values(n).map((function(e){var t=e.toString();return{value:t,display:t}}))),l!==z.BEAT.toString()));var ae=d.Fragment;return ae=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(ee.FLOATWND_STATE,{state:H.NONE})},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{className:[Q?"":"disable"].join(""),onClick:function(){c.change.applyChangeParams(l,""===j?null:j,""===p?0:p,""===S?0:S,""===y?null:y,""===R?0:R,""===L?0:L,""===P?0:P,""===V?null:V)},children:Object(d.jsx)("span",{children:"Enter"})})]}),Object(d.jsxs)("div",{id:"change-editor",className:["floatwnd",t.noteState.floatwndState==H.CHANGE_PALETTE?" active":""].join(" "),onClick:function(){},children:[Object(d.jsx)("div",{className:"items",children:te}),Object(d.jsx)("div",{className:"operation",children:ae})]})},Gt=a(10),Vt=a(24),zt=a.n(Vt),Wt=(a(84),function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useState)([]),i=Object(r.a)(c,2),o=i[0],l=i[1];Object(s.useEffect)((function(){var e=[];if(t.noteState.floatwndState===H.THEMA_ACCESSOR){var a,c=t.dinamicCache,s=Object(Gt.a)(t.themaDataTree.sustains);try{for(s.s();!(a=s.n()).done;){var i=a.value;if(i.beat===c.sustain&&i.headAdjust===c.headAdjust&&i.tailAdjust===c.tailAdjust){i.patterns.forEach((function(t){e.push({name:t.name})}));break}}}catch(o){s.e(o)}finally{s.f()}l(e),zt.a.instrument(new AudioContext,"violin",{gain:4,release:.5}).then((function(e){n.setInstruments(e)}))}}),[t.noteState.floatwndState]);var u=t.instrument,b=d.Fragment;b=Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{onClick:function(){a(ee.FLOATWND_STATE,{state:H.NONE}),u.stop()},children:Object(d.jsx)("span",{children:"Cancel"})}),Object(d.jsx)("div",{onClick:function(){u.schedule(0,[{time:0,note:60,duration:2},{time:2.5,note:63,duration:2}])},children:Object(d.jsx)("span",{children:"Enter"})})]});var h=[];return o.forEach((function(e,t){h.push(Object(d.jsx)(Yt,{children:e.name},t))})),Object(d.jsxs)("div",{id:"thema-accessor",className:"floatwnd"+(t.noteState.floatwndState==H.THEMA_ACCESSOR?" active":""),onClick:function(){},children:[Object(d.jsxs)(Jt,{children:[Object(d.jsx)(Xt,{children:h}),Object(d.jsx)(qt,{})]}),Object(d.jsx)("div",{className:"operation",children:b})]})}),Jt=Te.b.div(Ae||(Ae=Object(ge.a)(["\n    display: inline-block;\n    height: 250px;\n"]))),Xt=Te.b.div(Ie||(Ie=Object(ge.a)(["\n    display: inline-block;\n    width: 280px;\n    height: 100%;\n    background-color: #000000;\n    vertical-align: top;\n    overflow-y: auto;\n"]))),Yt=Te.b.div(Ce||(Ce=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    height: 30px;\n    background-color: #272727;\n    overflow-x: hidden;\n    border: solid 1px #b4b4b4;\n    font-size: 20px;\n    font-weight: 600;\n    color: #ffffff;\n    line-height: 25px;\n    padding-left: 10px;\n    box-sizing: border-box;\n"]))),qt=Te.b.div(Le||(Le=Object(ge.a)(["\n    display: inline-block;\n    width: 280px;\n    height: 100%;\n    background-color: #868686;\n    vertical-align: top;\n    overflow-y: auto;\n"]))),Qt=(a(85),function(e){var t=Object(s.useContext)(Nn),a=t.state,n=(t.dispatch,t.dispatcher),c=Object(s.useState)(JSON.stringify(a.noteData)),i=Object(r.a)(c,2),o=i[0],l=i[1];return Object(d.jsxs)("div",{className:"source-dialog",children:[Object(d.jsx)("textarea",{value:o,onChange:function(e){l(e.target.value)}}),Object(d.jsx)("button",{onClick:function(){n.closeDialog()},children:"Cancel"}),Object(d.jsx)("button",{onClick:function(){switch(e.target){case"score":case"backing":n.score.setNoteData(JSON.parse(o))}n.closeDialog()},children:"Aplly"})]})}),Zt=function(e){var t=Object(s.useContext)(Nn),a=(t.state,t.dispatch,t.dispatcher);return Object(d.jsxs)($t,{children:[Object(d.jsx)(ea,{children:e.message}),Object(d.jsx)(ta,{onClick:function(){a.closeDialog()},children:"No"}),Object(d.jsx)(ta,{onClick:function(){e.callback()},children:"Yes"})]})},$t=Te.b.div(ke||(ke=Object(ge.a)(["\n    display: inline-block;\n    width: 250px;\n    height: 100px;\n    background-color: rgba(0, 0, 0, 0.842);\n    border: solid 2px white;\n"]))),ea=Te.b.div(_e||(_e=Object(ge.a)(["\n    display:  inline-block;\n    width: 100%;\n    height: 50px;\n    padding: 5px;\n    font-size: 18px;\n    font-weight: 600;\n    /* line-height: -10px; */\n    color: rgba(255, 255, 255, 0.856);\n    text-align: left;\n"]))),ta=Te.b.div(De||(De=Object(ge.a)(["\n    display:  inline-block;\n    width: 70px;\n    height: 28px;\n    margin: 4px 0 0 4px;\n    background-color: rgb(180, 180, 180);\n    border: solid 1px rgb(85, 85, 85);\n    border-radius: 3px;\n    font-size: 18px;\n    font-weight: 600;\n    line-height: 25px;\n    color: rgba(0, 0, 0, 0.685);\n    text-align: center;\n\n    &:hover {\n        background-color: rgb(139, 139, 139);\n    }\n"]))),aa=function(){var e=Object(s.useContext)(Nn),t=e.state,a=(e.dispatch,t.noteState.editMode);return Object(d.jsxs)("div",{className:"mode",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:"MODE:"})}),Object(d.jsxs)("div",{className:"border",children:[Object(d.jsx)("button",{className:a==V.NORMAL?"active":"",children:Object(d.jsx)("span",{children:"NORMAL"})}),Object(d.jsx)("button",{className:a==V.TRANSPLANT?"active":"",children:Object(d.jsx)("span",{children:"TRANSPLANT"})}),Object(d.jsx)("button",{className:a==V.CLONE?"active":"",children:Object(d.jsx)("span",{children:"CLONE"})}),Object(d.jsx)("button",{className:a==V.PREVIEW?"active":"",children:Object(d.jsx)("span",{children:"PREVIEW"})})]})]})},na=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useState)([]),i=Object(r.a)(c,2),o=i[0],l=i[1],u=Object(s.useState)([]),b=Object(r.a)(u,2),h=b[0],j=b[1];Object(s.useEffect)((function(){var e=t.noteData.dataList,a=0,c=[],s=[],i=t.noteState.cacheList,o={},r=1,u=0,b=0,h=-1;e.forEach((function(e,t){if(e.type==X.Init){var n=e.detail;o.init=Object(x.a)({},n)}var l=Math.floor(u/4)+1,j={};if(j.no=r,j.barCount=h!=l?l:-1,j.remaindBeat=u%4>0?u%4:-1,j.headMSec=b,c.push(Object(d.jsx)(le,{index:t,noteElement:e},t)),e.type==X.Chord){h=l;var f=e.detail,m=o.init.tempo,O=f.sustain+f.headAdjust+f.tailAdjust;u+=O,b+=6e4/m*4/4*O,r++}else if(e.type==X.Change){var p=e.detail;switch(p.changeType){case z.MODULATE:var v=o.init.keyIndex,E="minor"==o.init.scale;switch(p.modulateRelation){case W.DOMINANT:v=(24+v+7*p.domminantValue)%12;break;case W.KEY:v=(12+v+Number(p.keyAdjust))%12;break;case W.RELATIVE:v=E?(12+v+3)%12:(12+v-3)%12,E=!E;break;case W.PARALLEL:E=!E}o.init.keyIndex=v,o.init.scale=E?"minor":"major";break;case z.TEMPO:var S=o.init.tempo;switch(p.tempoRelation){case J.DIFF:S+=Number(p.tempoDiff);break;case J.RATE:S=Math.floor(S*p.tempoRate/100);break;case J.ABSOLUTE:S=p.tempoAbsolute}o.init.tempo=S}}i[t]=Object(x.a)(Object(x.a)({},i[t]),{},{init:Object(x.a)({},o.init),progress:j}),e.type==X.Section&&(s.push(Object(d.jsx)(re,{index:a,label:e.detail.labelName},t)),a++)})),l(c),j(s),n.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{cacheList:i}))}),[t.noteData.dataList,t.noteData.dataList.length]);var f=t.noteState.editMode,m=!(t.noteState.floatwndState==H.NONE||t.noteState.floatwndState==H.CONTEXT_MENU);return Object(d.jsxs)("div",{id:"scorecont-notetab-root",children:[Object(d.jsxs)("div",{className:"left-cont",children:[Object(d.jsxs)("div",{id:"score-note",children:[Object(d.jsxs)("div",{id:"operation-header",className:[[V.TRANSPLANT,V.CLONE].includes(f)?"mode-selector":"",[V.PREVIEW].includes(f)?"mode-preview":""].join(" "),children:[Object(d.jsx)("button",{className:"",onClick:function(){n.callDialog(50,50,Object(d.jsx)(Zt,{message:"Do you want to save it?",callback:function(){Object(p.a)(O.a.mark((function e(){var a,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.noteState.cuScoreId,console.log("----start----"),c=[],t.noteData.dataList.forEach((function(e,t){c.push("(".concat(a,", ").concat(t,", '").concat(JSON.stringify(e),"')"))})),e.next=6,Z("update","delete from data_tbl where score = ".concat(a));case 6:return e.next=8,Z("update","insert into data_tbl values".concat(c.join(",")));case 8:console.log("----end----"),alert("The data was saved successfully!"),n.closeDialog();case 11:case"end":return e.stop()}}),e)})))()}}))},children:Object(d.jsx)("span",{children:"SAVE"})}),Object(d.jsx)("button",{className:"",onClick:function(){n.callDialog(50,50,Object(d.jsx)(Qt,{target:"score"}))},children:Object(d.jsx)("span",{children:"SOURCE"})}),Object(d.jsxs)("button",{className:"",onClick:function(){a(ee.FLOATWND_STATE,{state:H.SETTING_EDITOR})},children:[" ",Object(d.jsx)("span",{children:"SETTING"})]}),Object(d.jsx)("button",{className:"disable",children:Object(d.jsx)("span",{children:"Help"})}),Object(d.jsx)(aa,{})]}),Object(d.jsx)("div",{id:"section-list",className:[[V.TRANSPLANT,V.CLONE].includes(f)?"mode-selector":"",[V.PREVIEW].includes(f)?"mode-preview":""].join(" "),children:h}),Object(d.jsx)("div",{id:"score-list-root",className:[[V.TRANSPLANT,V.CLONE].includes(f)?"mode-selector":"",[V.PREVIEW].includes(f)?"mode-preview":""].join(" "),children:o}),Object(d.jsx)("div",{id:"modal-blind",className:m?"active":"",onClick:function(){t.noteState.editMode!==V.PREVIEW&&a(ee.FLOATWND_STATE,{state:H.NONE})}}),Object(d.jsx)(Mt,{}),Object(d.jsx)(ue,{}),Object(d.jsx)(Pt,{}),Object(d.jsx)(Ut,{}),Object(d.jsx)(be,{}),Object(d.jsx)(kt,{}),Object(d.jsx)(Ht,{}),Object(d.jsx)(Wt,{})]}),Object(d.jsx)(Ft,{})]}),Object(d.jsx)("div",{className:"right-cont",children:Object(d.jsx)(he,{})})]})},ca=(a(86),function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=e.dispatcher,c=Object(s.useState)(-1),i=Object(r.a)(c,2),o=i[0],l=i[1],u=Object(s.useState)(""),b=Object(r.a)(u,2),h=b[0],j=b[1],f=Object(s.useState)([]),m=Object(r.a)(f,2),v=m[0],E=m[1],S=Object(s.useState)([]),g=Object(r.a)(S,2),T=g[0],N=g[1],y=Object(s.useState)(!1),A=Object(r.a)(y,2),I=A[0],C=A[1],L=Object(s.useState)(""),k=Object(r.a)(L,2),_=k[0],D=k[1],R=Object(s.useState)(""),w=Object(r.a)(R,2),F=w[0],M=w[1],P=Object(s.useState)(!1),H=Object(r.a)(P,2),K=H[0],B=H[1];Object(s.useEffect)((function(){console.log("create ScoreContLiblaryTab")}),[]);var U=function(e){B(!0),j("Now roading scores..."),Z("select","SELECT s.*, (select count(*) from data_tbl where score = s.id) as data_cnt FROM sclibtbl s where user = ".concat(t.login.id)).then((function(e){return e.json()})).then((function(e){console.log(e),console.log("[".concat(t.login.id,"]score count: ")+e.length),e.length>0?(E(e),j("")):j("There is no musical score you manage yet."),B(!1)})).catch((function(e){console.log(e+"\u5931\u6557\u3057\u307e\u3057\u305f"),B(!1)}))};Object(s.useEffect)((function(){var e=[];v.forEach((function(t,a){e.push(Object(d.jsxs)("div",{className:["record",o==a?"focus":""].join(" "),onClick:function(){l(a)},children:[Object(d.jsxs)("span",{children:[t.id,":"]}),Object(d.jsx)("span",{className:"title",children:t.title}),Object(d.jsx)("span",{children:"["}),Object(d.jsx)("span",{className:"mode",children:t.chord_mode}),Object(d.jsx)("span",{children:"]"})]},a))})),N(e)}),[v,o]),Object(s.useEffect)((function(){I||U()}),[I]);var V=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object(d.jsx)("button",{className:[t?"disable":"",n?"active":""].join(" "),onClick:a,children:Object(d.jsx)("span",{children:e})})},z=function(e,t){return Object(d.jsxs)("div",{className:"info-record",children:[Object(d.jsx)("span",{children:e}),Object(d.jsx)("span",{children:": "}),t]})},W=""!=h,J=v[o];return Object(d.jsxs)("div",{id:"scorecont-listtab-root",children:[Object(d.jsxs)("div",{className:"left-cont",children:[Object(d.jsxs)("div",{className:"opr",children:[V("Create",I||K,(function(){j("Create..."),Z("update","INSERT INTO sclibtbl(user, title, chord_mode) VALUES(".concat(t.login.id,", 'new_title', '')")).then((function(e){return U(v.length),e}))})),V("Update",-1==o||K,(function(){I||(C(!0),D(J.title),M(J.chord_mode))}),I),V("Delete",-1==o||I||K,(function(){Object(p.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j("Delete..."),console.log("----start----"),e.next=4,Z("update","delete from data_tbl where score = ".concat(v[o].id));case 4:return e.next=6,Z("update","delete from sclibtbl where id = ".concat(v[o].id));case 6:U(),l(-1),console.log("----end----");case 9:case"end":return e.stop()}}),e)})))()}))]}),Object(d.jsxs)("div",{className:["lib",I?"disable":""].join(" "),children:[Object(d.jsx)("div",{className:["message",W?"":"hidden"].join(" "),children:Object(d.jsx)("span",{children:h})}),Object(d.jsx)("div",{className:["list",W?"hidden":""].join(" "),children:T})]})]}),Object(d.jsxs)("div",{className:"right-cont",children:[Object(d.jsxs)("div",{className:"opr",children:[V("Cancel",!I||K,(function(){n.score.setNoteData(Object(x.a)(Object(x.a)({},t.noteData),{},{dataList:[]})),C(!1),n.setInstruments(null)})),V("Save",!I||""===F||K,(function(){B(!0),Object(p.a)(O.a.mark((function e(){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("----start----"),a=[],e.next=4,Z("update","\n                                update sclibtbl set\n                                title = '".concat(_,"',\n                                chord_mode = '").concat(F,"',\n                                soundfont = '").concat(t.noteData.soundFont.name,"',\n                                gain = ").concat(t.noteData.soundFont.gain,",\n                                tune = '").concat(JSON.stringify(t.noteData.columnList),"'\n                                where id = ").concat(J.id,"\n                            "));case 4:if(!(t.noteData.dataList.length>0)){e.next=10;break}return t.noteData.dataList.forEach((function(e,t){a.push("(".concat(J.id,", ").concat(t,", '").concat(JSON.stringify(e),"')"))})),e.next=8,Z("update","delete from data_tbl where score = ".concat(J.id));case 8:return e.next=10,Z("update","insert into data_tbl values".concat(a.join(",")));case 10:console.log("----end----"),alert("The data was saved successfully!"),B(!1);case 13:case"end":return e.stop()}}),e)})))()})),V("Edit",!I||""===F||K,(function(){B(!0),Object(p.a)(O.a.mark((function e(){var c,s,i,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((c=t.noteData).chordMode=F,0!=J.data_cnt){e.next=6;break}c.dataList=[{type:X.Init,detail:{tempo:80,rythm:"4/4",keyIndex:0,scale:"major"}},{type:X.Fixed,detail:{label:"START"}},{type:X.Section,detail:{labelName:"Section"}},{type:X.Fixed,detail:{label:"END"}}],e.next=15;break;case 6:return s=[],e.next=9,Z("select","SELECT json from data_tbl where score = ".concat(J.id," order by seq"));case 9:return i=e.sent,e.next=12,i.json();case 12:e.sent.forEach((function(e){s.push(JSON.parse(e.json))})),c.dataList=s;case 15:t.noteState.cuScoreId=J.id,(o=t.noteData.soundFont).name=null==J.soundfont?"":J.soundfont,o.gain=null==J.gain?1:J.gain,t.noteData.columnList=null==J.tune?[]:JSON.parse(J.tune),n.score.setNoteState(Object(x.a)({},t.noteState)),n.score.setNoteData(c),a(ee.SELECT_NOTE_ELEMENT,{index:2}),a(ee.SELECT_SCORETAB,{index:1}),B(!1);case 25:case"end":return e.stop()}}),e)})))()}))]}),I?Object(d.jsxs)("div",{className:"data",children:[z("Id",Object(d.jsx)("span",{className:"value",children:J.id})),z("Title",Object(d.jsx)("input",{type:"text",onChange:function(e){D(e.target.value)},value:_})),z("Mode",Object(d.jsxs)("select",{className:["value",J.data_cnt>0?"disable":""].join(" "),value:F,onChange:function(e){M(e.target.value)},children:[Object(d.jsx)("option",{value:""}),Object(d.jsx)("option",{value:G.SCALE,children:G.SCALE}),Object(d.jsx)("option",{value:G.DIRECT,children:G.DIRECT})]})),z("Show",Object(d.jsx)("span",{className:"value",children:"PRIVATE"})),z("Data",Object(d.jsx)("span",{className:"value",children:J.data_cnt})),z("URL",Object(d.jsx)("span",{className:"url",children:"".concat("https://cyber-kohno.github.io/vh-react/","#/viewer?v=").concat(J.id)}))]}):Object(d.jsx)(d.Fragment,{})]})]})}),sa=(a(87),function(e,t){return Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"label",children:e}),Object(d.jsx)("div",{className:"fixed",children:t})]})}),ia=function(e,t,a){return Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"label",children:e}),Object(d.jsx)("input",{type:"text",value:t,onChange:function(e){return a(e)}})]})},oa=function(e,t,a,n){var c=[];return a.forEach((function(e,t){c.push(Object(d.jsx)("option",{value:e.value,children:e.display},t))})),Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"label",children:e}),Object(d.jsx)("select",{value:t,onChange:function(e){return n(e)},children:c})]})},la=function(e){var t=[];return e.forEach((function(e,a){t.push(Object(d.jsx)("button",{className:[e.disabled?"disable":""].join(" "),onClick:function(){return e.callback()},children:e.label},a))})),Object(d.jsx)("div",{className:"record",children:t})},ra=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatcher,n=t.themaDataTree,c=t.themaState.form.root;if("root"!==a.thema.getFocusElement().type)return Object(d.jsx)(d.Fragment,{});var i=a.thema.getFocusElement().reffer;return Object(d.jsxs)("div",{className:"thematab-detail",children:[ia("Name",c.themaName,(function(e){c.themaName=e.target.value,a.thema.setThemaState(t.themaState)})),sa("Children",String(i.sustains.length)),la([{label:"Cancel",disabled:!1,callback:function(){c.themaName=i.themaName,a.thema.setThemaState(t.themaState)}},{label:"Update",disabled:!1,callback:function(){i.themaName=c.themaName,a.thema.setThemaeData(n)}},{label:"Delete",disabled:!1,callback:function(){}}]),la([{label:"Add Sustain",disabled:!1,callback:function(){a.thema.addChildSustain()}}]),Object(d.jsx)("div",{className:"src",children:Object(d.jsx)("textarea",{value:c.src,onChange:function(e){c.src=e.target.value,a.thema.setThemaState(t.themaState)}})}),la([{label:"Sync",disabled:!1,callback:function(){a.thema.setThemaeData(JSON.parse(c.src))}}])]})},da=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatcher,n=t.themaDataTree,c=t.themaState.form.sustain,i=a.thema.getFocusElement();if("sustain"!==i.type)return Object(d.jsx)(d.Fragment,{});var o=a.thema.getFocusElement().reffer,l="-";null!=c.beat&&(l=String(c.beat+c.headAdjust+c.tailAdjust));var r=null!=c.beat;return Object(d.jsxs)("div",{className:"thematab-detail",children:[oa("Beat",c.beat?String(c.beat):"",[{value:"",display:""},{value:String(1),display:String(1)},{value:String(2),display:String(2)},{value:String(3),display:String(3)},{value:String(4),display:String(4)}],(function(e){c.beat=Number(e.target.value),a.thema.setThemaState(t.themaState)})),oa("Head",String(c.headAdjust),[{value:String(-.5),display:String(-.5)},{value:String(-.25),display:String(-.25)},{value:String(0),display:String(0)},{value:String(.25),display:String(.25)},{value:String(.5),display:String(.5)}],(function(e){c.headAdjust=Number(e.target.value),a.thema.setThemaState(t.themaState)})),oa("Tail",String(c.tailAdjust),[{value:String(-.5),display:String(-.5)},{value:String(-.25),display:String(-.25)},{value:String(0),display:String(0)},{value:String(.25),display:String(.25)},{value:String(.5),display:String(.5)}],(function(e){c.tailAdjust=Number(e.target.value),a.thema.setThemaState(t.themaState)})),sa("Sustain",l),sa("Children",String(o.patterns.length)),la([{label:"Cancel",disabled:t.themaState.isCreate,callback:function(){}},{label:"Update",disabled:!r,callback:function(){o.beat=c.beat,o.headAdjust=c.headAdjust,o.tailAdjust=c.tailAdjust,a.thema.setThemaeData(n),t.themaState.isCreate=!1,a.thema.setThemaState(t.themaState)}},{label:"Delete",disabled:!1,callback:function(){}}]),la([{label:"Add Pattern",disabled:!1,callback:function(){a.thema.addChildPattern(i)}}])]})},ua=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatcher,n=t.themaDataTree,c=t.themaState.form.voicing,i=a.thema.getFocusElement();if(Object(s.useEffect)((function(){try{c.def=JSON.parse(c.src)}catch(e){c.def=null}}),[c.src]),"voicing"!==i.type)return Object(d.jsx)(d.Fragment,{});var o=a.thema.getFocusElement().reffer;return Object(d.jsxs)("div",{className:"thematab-detail",children:[sa("Channel",function(){var e=[];return null!=c.def&&c.def.useChannels.forEach((function(t){e.push("".concat(t.octave,"-").concat(t.structIndex))})),e.join(" ")}()),Object(d.jsx)("div",{className:"src",children:Object(d.jsx)("textarea",{value:c.src,onChange:function(e){c.src=e.target.value,a.thema.setThemaState(t.themaState)}})}),la([{label:"Edit",disabled:!1,callback:function(){a.thema.callBackingVoicingEditor()}}]),la([{label:"Cancel",disabled:t.themaState.isCreate,callback:function(){}},{label:"Update",disabled:!1,callback:function(){o.def=JSON.parse(c.src),a.thema.setThemaeData(n),t.themaState.isCreate=!1,a.thema.setThemaState(t.themaState)}},{label:"Delete",disabled:!1,callback:function(){}}])]})},ba=function(){var e,t=Object(s.useContext)(Nn),a=t.state,n=t.dispatcher,c=a.themaDataTree,i=a.themaState.form.condition,o=n.thema.getFocusElement();if("condition"!==o.type)return Object(d.jsx)(d.Fragment,{});var l=o.reffer,r=null===(e=o.parent)||void 0===e?void 0:e.reffer;return Object(d.jsxs)("div",{className:"thematab-detail",children:[sa("Category",M(r.symbolType)),oa("Root Min",i.minRootIndex.toString(),function(){for(var e=[],t=0;t<12;t++)e.push({value:String(t),display:T[t]});return e}(),(function(e){i.minRootIndex=Number(e.target.value),n.thema.setThemaState(a.themaState)})),oa("Root Max",i.maxRootIndex.toString(),function(){for(var e=[],t=0;t<12;t++)e.push({value:String(t),display:T[t]});return e}(),(function(e){i.maxRootIndex=Number(e.target.value),n.thema.setThemaState(a.themaState)})),Object(d.jsx)("div",{className:["selector"].join(" "),children:function(){var e,t,c=(null===(e=o.parent)||void 0===e?void 0:e.reffer).symbolType;return(t=c,D.filter((function(e){return t===e.category})).map((function(e){return e.key}))).map((function(e,t){return Object(d.jsxs)("div",{className:["item",i.tgtSymbols.includes(e)?"active":""].join(" "),onClick:function(){i.tgtSymbols.includes(e)?i.tgtSymbols=i.tgtSymbols.filter((function(t){return t!==e})):i.tgtSymbols.push(e),n.thema.setThemaState(a.themaState)},children:["[",Q(e),"]"]},t)}))}()}),sa("Children",String(l.voicings.length)),la([{label:"Cancel",disabled:a.themaState.isCreate,callback:function(){}},{label:"Update",disabled:!1,callback:function(){l.minRootIndex=i.minRootIndex,l.maxRootIndex=i.maxRootIndex,l.tgtSymbols=i.tgtSymbols,n.thema.setThemaeData(c),a.themaState.isCreate=!1,n.thema.setThemaState(a.themaState)}},{label:"Delete",disabled:!1,callback:function(){}}]),la([{label:"Add Voicing",disabled:!1,callback:function(){n.thema.addChildVoicing(o)}}])]})},ha=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatcher,n=t.themaDataTree,c=t.themaState.form.category,i=a.thema.getFocusElement();if("category"!==i.type)return Object(d.jsx)(d.Fragment,{});var o=a.thema.getFocusElement().reffer;return Object(d.jsxs)("div",{className:"thematab-detail",children:[oa("Category",null==c.category?"":c.category.toString(),function(){var e=[];return e.push({value:"",display:""}),Object.values(L).filter((function(e){return!isNaN(Number(e))})).forEach((function(t,a){e.push({value:String(t),display:M(Number(t))})})),e}(),(function(e){c.category=Number(e.target.value),a.thema.setThemaState(t.themaState)})),la([{label:"Cancel",disabled:t.themaState.isCreate,callback:function(){}},{label:"Update",disabled:!1,callback:function(){o.symbolType=c.category,a.thema.setThemaeData(n),t.themaState.isCreate=!1,a.thema.setThemaState(t.themaState)}},{label:"Delete",disabled:!1,callback:function(){}}]),la([{label:"Add Condition",disabled:!1,callback:function(){a.thema.addChildCondition(i)}}])]})},ja=function(){var e,t=Object(s.useContext)(Nn),a=t.state,n=t.dispatcher,c=a.themaDataTree,i=a.themaState.form.pattern,o=n.thema.getFocusElement();if(Object(s.useEffect)((function(){try{i.def=JSON.parse(i.src)}catch(e){i.def=null}}),[i.src]),"pattern"!==o.type)return Object(d.jsx)(d.Fragment,{});var l=o.reffer,r=null===(e=o.parent)||void 0===e?void 0:e.reffer;return Object(d.jsxs)("div",{className:"thematab-detail",children:[sa("Beat",String(r.beat)),sa("Head",String(r.headAdjust)),sa("Tail",String(r.tailAdjust)),sa("Sustain",String(r.beat+r.headAdjust+r.tailAdjust)),ia("Name",i.name,(function(e){i.name=e.target.value,n.thema.setThemaState(a.themaState)})),sa("Channel",function(){var e="-";return null!=i.def&&(e=String(i.def.layers[0].table.length)),e}()),sa("Notes",function(){var e="-";if(null!=i.def){var t=JSON.parse(i.src),a=0;t.layers.forEach((function(e){e.table.forEach((function(e){e.forEach((function(e){e.forEach((function(e){e&&a++}))}))}))})),e=String(a)}return e}()),Object(d.jsx)("div",{className:"src",children:Object(d.jsx)("textarea",{value:i.src,onChange:function(e){i.src=e.target.value,n.thema.setThemaState(a.themaState)}})}),la([{label:"Edit",disabled:!1,callback:function(){n.thema.callBackingPatternEditor()}}]),sa("Children",String(l.tgtTypes.length)),la([{label:"Cancel",disabled:a.themaState.isCreate,callback:function(){}},{label:"Update",disabled:!(""!=i.name&&null!=i.def),callback:function(){l.name=i.name,l.def=JSON.parse(i.src),n.thema.setThemaeData(c),a.themaState.isCreate=!1,n.thema.setThemaState(a.themaState)}},{label:"Delete",disabled:!1,callback:function(){}}]),la([{label:"Add Category",disabled:!1,callback:function(){n.thema.addChildCategory(o)}}])]})},fa=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatcher,n=t.themaDataTree,c=t.themaState,i=c.themaCacheList,o=Object(s.useState)([]),l=Object(r.a)(o,2),u=l[0],b=l[1];if(Object(s.useEffect)((function(){a.thema.buildIndex()}),[n]),Object(s.useEffect)((function(){for(var e=[],t=[],s=i[c.focusIndex];null!=s;)t.push(s),s=s.parent;i.forEach((function(s){e.push(function(t,s){var o=e.length,l=function(){switch(t.type){case"root":return 0;case"sustain":return 1;case"pattern":return 2;case"category":return 3;case"condition":return 4;case"voicing":return 5}}(),r=c.isCreate&&o===c.focusIndex?Object(d.jsx)("span",{className:"create",children:"Creating..."}):function(){switch(t.type){case"root":var e=t.reffer;return Object(d.jsx)("span",{className:"value",children:e.themaName});case"sustain":var a=t.reffer;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{children:"beat: "}),Object(d.jsx)("span",{className:"value",children:a.beat}),Object(d.jsx)("span",{children:"[head: "}),Object(d.jsx)("span",{className:"value",children:a.headAdjust}),Object(d.jsx)("span",{children:", tail: "}),Object(d.jsx)("span",{className:"value",children:a.tailAdjust}),Object(d.jsx)("span",{children:"]"})]});case"pattern":var n=t.reffer;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{className:"value",children:n.name}),Object(d.jsx)("span",{children:" [channel: "}),Object(d.jsx)("span",{className:"value",children:"0"}),Object(d.jsx)("span",{children:", notes: "}),Object(d.jsx)("span",{className:"value",children:"0"}),Object(d.jsx)("span",{children:"]"})]});case"category":var c=t.reffer;return Object(d.jsx)(d.Fragment,{children:Object(d.jsx)("span",{className:"value",children:M(c.symbolType)})});case"condition":var s=t.reffer,i=T[s.minRootIndex],o=T[s.maxRootIndex],l=s.tgtSymbols.map((function(e){return"[".concat(Q(e),"]")})).join(", ");return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{className:"value",children:i}),Object(d.jsx)("span",{children:"\uff5e"}),Object(d.jsx)("span",{className:"value",children:o}),Object(d.jsxs)("span",{children:[" ","{"]}),Object(d.jsx)("span",{className:"value",children:l}),Object(d.jsx)("span",{children:"}"})]});case"voicing":var r=t.reffer,u="";return null!==r.def&&(u=r.def.useChannels.map((function(e){return"".concat(e.octave,"-").concat(e.structIndex)})).join(", ")),Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{children:"["}),Object(d.jsx)("span",{className:"value",children:u}),Object(d.jsx)("span",{children:"]"})]})}}(),u=function(){switch(t.type){case"root":return function(){return a.thema.addChildSustain()};case"sustain":return function(){return a.thema.addChildPattern(t)};case"pattern":return function(){return a.thema.addChildCategory(t)};case"category":return function(){return a.thema.addChildCondition(t)};case"condition":return function(){return a.thema.addChildVoicing(t)}}return function(){}}(),b=10+50*l;return Object(d.jsxs)("div",{className:["item",s?"active":"",c.isCreate&&c.focusIndex!==o?"lock":""].join(" "),children:[Object(d.jsx)("div",{className:"indent",style:{width:b+"px"}}),Object(d.jsx)("div",{className:["opener",0==t.ChildCnt?"hidden":""].join(" "),onClick:function(){t.isClose=!t.isClose,c.themaCacheList=i.slice(),a.thema.setThemaState(c)},children:Object(d.jsx)("span",{children:t.isClose?"\uff0b":"\uff0d"})}),function(){switch(t.type){case"root":return Object(d.jsx)("div",{className:"type root",children:Object(d.jsx)("span",{children:"ROOT"})});case"sustain":return Object(d.jsx)("div",{className:"type sustain",children:Object(d.jsx)("span",{children:"SUSTAIN"})});case"pattern":return Object(d.jsx)("div",{className:"type pattern",children:Object(d.jsx)("span",{children:"PATTERN"})});case"category":return Object(d.jsx)("div",{className:"type category",children:Object(d.jsx)("span",{children:"CATEGORY"})});case"condition":return Object(d.jsx)("div",{className:"type condition",children:Object(d.jsx)("span",{children:"CONDITION"})});case"voicing":return Object(d.jsx)("div",{className:"type voicing",children:Object(d.jsx)("span",{children:"VOICING"})})}}(),Object(d.jsx)("div",{className:["label",c.focusIndex===o?"active":""].join(" "),onClick:function(){c.focusIndex=o;var e=c.themaCacheList[c.focusIndex];switch(e.type){case"root":var t=e.reffer,s=c.form.root;s.themaName=t.themaName,s.src=JSON.stringify(n);break;case"sustain":var i=e.reffer,l=c.form.sustain;l.beat=i.beat,l.headAdjust=i.headAdjust,l.tailAdjust=i.tailAdjust;break;case"pattern":var r=e.reffer,d=c.form.pattern;d.name=r.name,d.def=null,d.src=JSON.stringify(r.def);break;case"category":var u=e.reffer;c.form.category.category=u.symbolType;break;case"condition":var b=e.reffer,h=c.form.condition;h.tgtSymbols=b.tgtSymbols,h.minRootIndex=b.minRootIndex,h.maxRootIndex=b.maxRootIndex;break;case"voicing":var j=e.reffer,f=c.form.voicing;f.def=null,f.src=JSON.stringify(j.def)}a.thema.setThemaState(c)},onContextMenu:function(){return u()},children:r})]},o)}(s,t.includes(s)))})),b(e)}),[i,c.focusIndex]),0===i.length)return Object(d.jsx)(d.Fragment,{});var j=i[c.focusIndex];return Object(d.jsxs)("div",{id:"scorecont-thematab-root",children:[Object(d.jsx)(kt,{}),Object(d.jsxs)("div",{className:"cont left",children:[Object(d.jsx)("div",{className:"loader"}),Object(d.jsx)("div",{className:["tree",c.isCreate?"lock":""].join(" "),children:u}),Object(d.jsx)("div",{className:"operation"})]}),Object(d.jsx)("div",{className:"cont right",children:Object(d.jsx)("div",{id:"themainfotab-root",children:Object(d.jsx)(h,{groupName:"themainfo-tabs",tabElements:[{name:"Root",disable:!0,cont:Object(d.jsx)(ra,{})},{name:"Sustain",disable:!0,cont:Object(d.jsx)(da,{})},{name:"Pattern",disable:!0,cont:Object(d.jsx)(ja,{})},{name:"Type",disable:!0,cont:Object(d.jsx)(ha,{})},{name:"Condition",disable:!0,cont:Object(d.jsx)(ba,{})},{name:"Voicing",disable:!0,cont:Object(d.jsx)(ua,{})}],activeNo:function(){switch(j.type){case"root":return 0;case"sustain":return 1;case"pattern":return 2;case"category":return 3;case"condition":return 4;case"voicing":return 5}}()})})})]})},ma=["","accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","percussion","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],Oa=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatcher,n=Object(s.useState)(!1),c=Object(r.a)(n,2),i=c[0],o=c[1],l=Object(s.useState)([]),u=Object(r.a)(l,2),b=u[0],h=u[1],j=Object(s.useState)([]),f=Object(r.a)(j,2),m=f[0],O=f[1],p=Object(s.useRef)({}),E=Object(s.useRef)({}),S=Object(s.useRef)({}),g=Object(s.useRef)({}),N=t.instrument,y=t.tuneState,A=t.noteData.columnList,I=A[y.columnIndex],C=t.noteData.soundFont,L=y.totalColumnWidth;Object(s.useEffect)((function(){var e=[];e.push({len4:1,len8:0,len16:0,len4div3:0,len8div3:0,soundIndex:-1}),a.tune.setColumnList(e),y.tableRef=p,y.intervalRef=E,y.BlocksRef=g,y.measureRef=S,a.tune.setState(y)}),[]),Object(s.useEffect)((function(){var e=0,n=[],c=0;t.noteState.cacheList.length>0&&(c=t.noteState.cacheList[0].init.keyIndex),A.forEach((function(t){var a={posX:e,baseKey:c};n.push(a),e+=t.len4,e+=t.len8/2,e+=t.len16/4,e+=t.len4div3/3,e+=t.len8div3/6})),y.totalColumnWidth=e,y.cacheList=n,a.tune.setState(y)}),[A]);var k=Object(s.useMemo)((function(){for(var e=[],t=0;t<=4*L;t++){var a=Object(d.jsx)(d.Fragment,{});t%16==0&&(a=Object(d.jsx)(Fa,{children:Math.floor(t/16)+1})),e.push(Object(d.jsx)(wa,{isHead:t%4===0,children:a},t))}return e}),[L]);Object(s.useEffect)((function(){var e=[],n=[],c=0;t.noteData.columnList.forEach((function(t,s){var i=(t.len4+t.len8/2+t.len16/4+t.len4div3/3+t.len8div3/6)*v,o=s===y.columnIndex,l=y.cacheList[s];e.push(Object(d.jsxs)(Pa,{pos:c,width:i,isActive:o,onClick:function(){a.tune.setState(Object(x.a)(Object(x.a)({},y),{},{columnIndex:s,isEdit:!1}))},children:[Object(d.jsx)(Ha,{children:t.len4}),Object(d.jsx)(Ha,{children:t.len8}),Object(d.jsx)(Ha,{children:t.len16})]},s));for(var r=[],u=function(e){var n=Math.floor((96-e)/12),c=(96-e)%12,i=(12-l.baseKey+87+9-e)%12,o=T[c]+n,u=e===t.soundIndex;r.push(Object(d.jsx)(Ga,{soundIndex:i,onClick:function(){a.tune.setState(Object(x.a)(Object(x.a)({},y),{},{columnIndex:s,isEdit:!0})),A[s].soundIndex===e?A[s].soundIndex=-1:(A[s].soundIndex=e,a.tune.playSoundFont(o,.5)),a.tune.setColumnList(A.slice()),y.isAutoScroll&&(a.tune.adjustScrollX(s),a.tune.adjustScrollY(s))},onContextMenu:function(){a.tune.setState(Object(x.a)(Object(x.a)({},y),{},{columnIndex:s,isEdit:!0}));var e=A[s].soundIndex;-1!==e&&a.tune.playSoundFont(xa(e),.5),y.isAutoScroll&&a.tune.adjustScrollY(s)},children:u?Object(d.jsx)(Va,{isScale:pa(0,i),children:o}):""},e))},b=0;b<88;b++)u(b);n.push(Object(d.jsx)(Ua,{isActive:o,isEdit:o&&y.isEdit,pos:c,width:i,children:r},s)),c+=i,h(e),O(n)}))}),[N,A,y.columnIndex,y.isEdit]);var _=Object(s.useMemo)((function(){for(var e=[],t=function(t){var n=88-t,c=Math.floor((96-t)/12),s=T[(96-t)%12]+c,i=!(!I||!y.isEdit)&&I.soundIndex===t;e.push(Object(d.jsxs)(La,{isActive:i,onClick:function(){a.tune.playSoundFont(s,.5)},children:[Object(d.jsx)(ka,{children:n})," ",Object(d.jsx)(_a,{children:s})]},t))},n=0;n<88;n++)t(n);return e}),[N,A,y.isEdit,y.columnIndex]),D=function(e,t,a){return Object(d.jsx)(Aa,{onClick:a,isActive:t,children:e})},R=function(e){return D(String(e),y.usingLen===e,(function(){y.usingLen=e,a.tune.setState(y)}))},w=function(e,t){return Object(d.jsx)(Ia,{onClick:t,children:e})};return Object(d.jsxs)(va,{children:[Object(d.jsx)(Ea,{}),Object(d.jsxs)(Sa,{children:[Object(d.jsxs)(ga,{children:[function(){var e=C.name;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(Ta,{isEditable:!i,value:e,onChange:function(e){var t=e.target.value;C.name=t,a.tune.setSoundFont(C)},children:ma.map((function(e,t){return Object(d.jsx)("option",{value:e,children:e},t)}))}),Object(d.jsx)(Na,{isEditable:!i,type:"number",min:"1",max:"15",step:"0.2",value:C.gain,onChange:function(e){C.gain=Number(e.target.value),a.tune.setSoundFont(C)}})]})}(),w(i?"del":"load",(function(){i?a.setInstruments(null):""!==C.name&&zt.a.instrument(new AudioContext,C.name,{gain:C.gain,release:.5}).then((function(e){a.setInstruments(e)})),o(!i)})),R(16),R(8),R(4),D("/3",y.isDiv3,(function(){y.isDiv3=!y.isDiv3,a.tune.setState(y)})),w("add",(function(){a.tune.addColumn()})),w("del",(function(){a.tune.remooveCur()})),w("|->>",(function(){a.tune.adjustWidth(!0)})),w("|<<-",(function(){a.tune.adjustWidth(!1)})),D("scr",y.isAutoScroll,(function(){y.isAutoScroll=!y.isAutoScroll,a.tune.setState(y)})),D(y.isPreview?"stop":"play",y.isPreview,(function(){y.isPreview?a.tune.stopPreview():a.tune.playPreview(),y.isPreview=!y.isPreview,a.tune.setState(y)})),w("up",(function(){a.tune.moveAll(-1)})),w("down",(function(){a.tune.moveAll(1)}))]}),Object(d.jsx)(Ca,{ref:E,onClick:function(){},children:_}),Object(d.jsxs)(Da,{children:[Object(d.jsx)(Ra,{ref:S,children:k}),Object(d.jsx)(Ma,{ref:g,children:b}),Object(d.jsx)(Ka,{ref:p,onScroll:function(){var e=p.current.scrollLeft,t=p.current.scrollTop;S.current.scrollTo({left:e}),g.current.scrollTo({left:e}),E.current.scrollTo({top:t})},children:Object(d.jsx)(Ba,{width:L*v,children:m})})]})]})]})},pa=function(e,t){switch(t){case 0+e:case 2+e:case 4+e:case 5+e:case 7+e:case 9+e:case 11+e:return!0;default:return!1}},xa=function(e){var t=Math.floor((96-e)/12);return T[(96-e)%12]+t},va=Te.b.div(Re||(Re=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    background-color: white;\n"]))),Ea=Te.b.div(we||(we=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    height: 40px;\n    background-color: #707070;\n"]))),Sa=Te.b.div(Fe||(Fe=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    height: calc(100% - 40px);\n    background-color: #000000;\n"]))),ga=Te.b.div(Me||(Me=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    height: 40px;\n    text-align: left;\n    background-color: #16213b;\n    & * {\n        display: inline-block;\n        vertical-align: top;\n        margin-left: 5px;\n        height: 30px;\n        margin-top: 5px;\n    }\n"]))),Ta=Te.b.select(Pe||(Pe=Object(ge.a)(["\n    display: inline-block;\n    width: 160px;\n    font-size: 16px;\n    font-weight: 600;\n    color: ",";\n    ","\n    background-color: #8197a0;\n    border: solid 1px #e2e9ee;\n    border-radius: 2px;\n    & option {\n        /* width: 100%;\n        height: 30px; */\n        background-color: #97aec4;\n        color: red;\n    }\n"])),(function(e){return e.isEditable?"black":"blue"}),(function(e){return e.isEditable?"":"pointer-events: none;"})),Na=Te.b.input(He||(He=Object(ge.a)(["\n    display: inline-block;\n    width: 60px;\n    font-size: 16px;\n    font-weight: 600;\n    color: ",";\n    ","\n    background-color: #8197a0;\n    border: solid 1px #e2e9ee;\n    border-radius: 2px;\n"])),(function(e){return e.isEditable?"black":"blue"}),(function(e){return e.isEditable?"":"pointer-events: none;"})),ya=Te.b.div(Ke||(Ke=Object(ge.a)(["\n    display: inline-block;\n    padding: 0 10px 0 10px;\n    width: 80px;\n    font-size: 22px;\n    font-weight: 600;\n    line-height: 28px;\n    text-align: center;\n    border-radius: 4px;\n"]))),Aa=Te.b.div(Be||(Be=Object(ge.a)(["\n    display: inline-block;\n    padding: 0 10px 0 10px;\n    width: 80px;\n    font-size: 22px;\n    font-weight: 600;\n    line-height: 28px;\n    text-align: center;\n    border-radius: 4px;\n    ","\n    &:hover {\n        background-color: #7a88ca;\n    }\n"])),(function(e){return e.isActive?Object(Te.a)(Ge||(Ge=Object(ge.a)(["\n            background-color: #f4ff5f;\n            color: #fa0000;\n            border: solid 1px #fa0000;\n        "]))):Object(Te.a)(Ue||(Ue=Object(ge.a)(["\n            background-color: #5662a0;\n            color: #f5f5f5;\n            border: solid 1px #acc0d6;\n        "])))})),Ia=Object(Te.b)(ya)(Ve||(Ve=Object(ge.a)(["\n    background-color: #535353;\n    color: #f5f5f5;\n    border: solid 1px #ffffff;\n    &:hover {\n        background-color: #919191;\n    }\n"]))),Ca=Te.b.div(ze||(ze=Object(ge.a)(["\n    display: inline-block;\n    background-color: #e7e7e7;\n    width: 80px;\n    height: calc(100% - 150px);\n    vertical-align: top;\n    margin-top: 100px;\n    overflow-y: hidden;\n"]))),La=Te.b.div(We||(We=Object(ge.a)(["\n    display: inline-block;\n    background-color: ",";\n    width: 100%;\n    height: 22px;\n    font-size: 16px;\n    font-weight: 600;\n    text-align: left;\n    border: solid 1px #0000003b;\n    padding-left: 5px;\n    box-sizing: border-box;\n"])),(function(e){return e.isActive?"#568abb":"#205f99"})),ka=Te.b.span(Je||(Je=Object(ge.a)(["\n    color: #7a7a7a;\n"]))),_a=Te.b.span(Xe||(Xe=Object(ge.a)(["\n    color: #dbddff;\n"]))),Da=Te.b.div(Ye||(Ye=Object(ge.a)(["\n    display: inline-block;\n    background-color: black;\n    width: calc(100% - 80px);\n    height: calc(100% - 40px);\n    vertical-align: top;\n    text-align: left;\n"]))),Ra=Te.b.div(qe||(qe=Object(ge.a)(["\n    display: inline-block;\n    background: linear-gradient(to bottom, #ffffff, #808080);\n    width: calc(100% - 10px);\n    height: 40px;\n    text-align: left;\n    border-top: solid 2px #000;\n    white-space: nowrap;\n    overflow: hidden;\n"]))),wa=Te.b.div(Qe||(Qe=Object(ge.a)(["\n    display: inline-block;\n    position: relative;\n    /* background-color: #ffffffbe; */\n    width: ","px;\n    vertical-align: bottom;\n    margin-top: 25px;\n    height: ",";\n    box-sizing: border-box;\n    border-left: solid "," #000;\n"])),40,(function(e){return e.isHead?"15px":"10px"}),(function(e){return e.isHead?"2px":"1px"})),Fa=Te.b.div(Ze||(Ze=Object(ge.a)(["\n    display: inline-block;\n    position: absolute;\n    font-size: 16px;\n    font-weight: 600;\n    color: #ec0000;\n    left: -5px;\n    top: -20px;\n"]))),Ma=Te.b.div($e||($e=Object(ge.a)(["\n    display: inline-block;\n    background-color: #6e639ea1;\n    width: calc(100% - 10px);\n    height: 60px;\n    position: relative;\n    overflow-x: hidden;\n"]))),Pa=Te.b.div(et||(et=Object(ge.a)(["\n    display: inline-block;\n    position: absolute;\n    background-color: #0077ff67;\n    left: ","px;\n    width: ","px;\n    height: 100%;\n    /* color: #002575d1; */\n    text-align: left;\n    padding-left: 5px;\n    border: ",";\n    opacity: ",";\n"])),(function(e){return e.pos}),(function(e){return e.width}),(function(e){return e.isActive?"solid 2px #ffffff4c":"solid 1px #ffffff4c"}),(function(e){return e.isActive?"1":"0.5"})),Ha=Te.b.span(tt||(tt=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    font-size: 14px;\n    font-weight: 600;\n    color: #ffffffd1;\n"]))),Ka=Te.b.div(at||(at=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    height: calc(100% - 100px);\n    overflow: scroll;\n    text-align: left;\n    -webkit-appearance: none;\n"]))),Ba=Te.b.div(nt||(nt=Object(ge.a)(["\n    display: inline-block;\n    background-color: #000000;\n    width: ","px;\n    /* height: 100%; */\n    /* text-align: left; */\n    position: relative;\n    white-space: nowrap;\n"])),(function(e){return e.width})),Ua=Te.b.div(ct||(ct=Object(ge.a)(["\n    display: inline-block;\n    position: absolute;\n    top: 0;\n    left: ","px;\n    background-color: ",";\n    border: ",";\n    box-sizing: border-box;\n    width: ","px;\n    height: ","px;\n    opacity: ",";\n"])),(function(e){return e.pos}),(function(e){return e.isActive?"#8787db76":"#0000ff5c"}),(function(e){return e.isActive?"solid 2px #ffffff4c":"solid 1px #ffffff4c"}),(function(e){return e.width}),1936,(function(e){return e.isEdit?"1":"0.5"})),Ga=Te.b.div(st||(st=Object(ge.a)(["\n    display: table;\n    position: relative;\n    width: 100%;\n    height: ","px;\n    background-color: ",";\n    /* margin-bottom: 1px; */\n"])),22,(function(e){switch(e.soundIndex){case 0:return"#ffffff57";case 1:return"#b0b5bb56";case 2:return"#e9e9e957";case 3:return"#b0b5bb56";case 4:return"#e9e9e957";case 5:return"#dfdfdf57";case 6:return"#b0b5bb56";case 7:return"#e9e9e957";case 8:return"#b0b5bb56";case 9:return"#e9e9e957";case 10:return"#b0b5bb56";case 11:return"#e9e9e957"}})),Va=Te.b.div(it||(it=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    background-color: ",";\n    box-shadow: 2px 2px 20px 4px ",";\n    border: solid 1px #ffffff;\n    box-sizing: border-box;\n    font-size: 8px;\n    font-weight: 600;\n    padding-left: 2px;\n    color: #ff0000;\n    border-radius: 2px;\n    overflow-x: hidden;\n"])),(function(e){return e.isScale?"#eeff00fc":"#ff1e00"}),(function(e){return e.isScale?"#eeff00fc":"#ff1e00"})),za=(Te.b.div(ot||(ot=Object(ge.a)(["\n    display: inline-block;\n    position: absolute;\n    top: 0;\n    left: ","px;\n    width: 2px;\n    height: 1056px;\n    background-color: red;\n        box-shadow: 2px 2px 15px 4px #ff727290;\n    z-index: 99;\n"])),(function(e){return e.pos})),120),Wa=function(){var e=Object(s.useContext)(Nn),t=e.state,a=(e.dispatch,e.dispatcher),n=Object(s.useState)([]),c=Object(r.a)(n,2),i=c[0],o=c[1],l=Object(s.useState)([]),u=Object(r.a)(l,2),b=u[0],h=u[1],j=Object(s.useState)(0),f=Object(r.a)(j,2),m=f[0],O=f[1],p=Object(s.useState)(0),v=Object(r.a)(p,2),E=v[0],S=v[1],g=Object(s.useState)(!1),N=Object(r.a)(g,2),y=N[0],A=N[1],I=Object(s.useState)(0),C=Object(r.a)(I,2),L=C[0],k=C[1],_=Object(s.useState)(0),D=Object(r.a)(_,2),R=D[0],w=D[1],F=Object(s.useRef)({}),M=Object(s.useRef)({}),H=Object(s.useRef)({}),K=Object(s.useRef)({});Object(s.useEffect)((function(){if(5===t.scoreTabIndex){var e=[],a=[],n=0;t.noteData.dataList.forEach((function(c,s){var i=t.noteState.cacheList[s].init.keyIndex;if(c.type===X.Chord){var o;console.log(s);for(var l=[],r=0;r<88;r++)l.push([]);k(t.noteState.cacheList[s].init.tempo),t.noteState.focusIndex==s&&(S(a.length),O(n*za));var d=c.detail,u=d.sustain+d.headAdjust+d.tailAdjust,b=((null===(o=d.molecule)||void 0===o?void 0:o.rootIndex)+i)%12,h=P(d.symbolKey);null!=d.denominator&&(h=Object(x.a)({},h),$(h,b,d.denominator.rootIndex)),a.push({pos:n*za,width:u*za,sustain:u,chordName:T[b]+h.name}),w(n*za+u*za);var j=d.backing;j.layers.forEach((function(e,t){e.table.forEach((function(a,c){var s=0;if(j.useChannels.length-1>=c){var i=j.useChannels[c];s=b+12*i.octave+h.intervals[i.structIndex]-9}var o=n;console.log("index=".concat(s,", lenSize=").concat(e.lens.length,", k=").concat(c,", tableSize=").concat(e.table.length)),a.forEach((function(a,n){var c=0;switch(e.lens[n].len){case U.LEN1:c=4;break;case U.LEN2:c=2;break;case U.LEN4:c=1;break;case U.LEN8:c=.5;break;case U.LEN16:c=1/4}e.lens[n].isHalf&&(c*=1.5),e.lens[n].isDiv3?(console.log(JSON.stringify(a)),a.forEach((function(e,a){if(e){var n=o+c/3*a,i=c/3;l[s].push({pos:n*za,width:i*za,layer:0==t?"left":"right",soundName:T[s%12]+Math.floor(s/12)})}}))):a[0]&&l[s].push({pos:o*za,width:c*za,layer:0==t?"left":"right",soundName:T[(s+9)%12]+Math.floor((s+9)/12)}),o+=c}))}))})),n+=u,e.push(l.reverse())}})),o(e),h(a)}}),[t.scoreTabIndex]),Object(s.useEffect)((function(){F.current.scrollTo({left:m-400,behavior:"smooth"}),K.current.scrollTo({left:m-400,behavior:"smooth"})}),[E]),Object(s.useEffect)((function(){b.length>E+1&&m>=b[E+1].pos&&S(E+1)}),[m]);var B=Object(s.useMemo)((function(){var e=[];return b.forEach((function(t,a){t.pos,t.width;e.push(Object(d.jsxs)(en,{pos:t.pos,width:t.width,isActive:a===E,onClick:function(){S(a),O(t.pos)},children:[Object(d.jsx)(tn,{children:t.sustain}),Object(d.jsx)(an,{children:t.chordName})]},a))})),e}),[i,E]),G=Object(s.useMemo)((function(){var e=[];return i.forEach((function(t,a){var n=b[a].pos,c=n+b[a].width;if(!y||m>n-500&&m<c+700){var s=[];t.forEach((function(e,t){var n=[];e.forEach((function(e,t){var c=e.pos<=m&&e.pos+e.width>=m;n.push(Object(d.jsx)(ln,{pos:e.pos-b[a].pos,width:e.width,layer:e.layer,isActive:c,children:e.soundName},t))})),s.push(Object(d.jsx)(on,{soundIndex:t%12,children:n},t))})),e.push(Object(d.jsx)(sn,{isActive:m>=n&&m<c,pos:n,width:b[a].width,children:s},a))}})),e}),[i,m]),z=Object(s.useMemo)((function(){for(var e=[],t=0;t<88;t++){var a=88-t,n=Math.floor((96-t)/12),c=T[(96-t)%12];e.push(Object(d.jsxs)(Xa,{children:[Object(d.jsx)(Ya,{children:a})," ",Object(d.jsx)(qa,{children:c+n})]},t))}return e}),[]);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(Ja,{ref:M,onClick:function(){O(m+100)},children:z}),Object(d.jsxs)(Qa,{children:[Object(d.jsx)(Za,{ref:H}),Object(d.jsx)($a,{ref:K,children:B}),Object(d.jsx)(nn,{ref:F,onScroll:function(){var e=F.current.scrollLeft,t=F.current.scrollTop;H.current.scrollTo({left:e}),K.current.scrollTo({left:e}),M.current.scrollTo({top:t})},children:Object(d.jsxs)(cn,{width:R,children:[G,Object(d.jsx)(rn,{pos:m})]})})]}),Object(d.jsx)(dn,{onClick:function(){var e=[];y?(A(!1),e.forEach((function(e){clearTimeout(e)})),t.noteState.backingThreads.forEach((function(e){clearInterval(e)})),a.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{backingThreads:[],editMode:V.NORMAL})),t.sampler.releaseAll()):function(){A(!0),a.preview.play();for(var t=L*za/600,n=function(a){var n=setTimeout((function(){O(t*a),console.log("time: "+m)}),100*a);e.push(n)},c=0;c<900;c++)n(c)}()},children:y?"Stop":"Play"})]})},Ja=Te.b.div(lt||(lt=Object(ge.a)(["\n    display: inline-block;\n    background-color: #e7e7e7;\n    width: 80px;\n    height: calc(100% - 140px);\n    vertical-align: top;\n    margin-top: 100px;\n    overflow-y: hidden;\n"]))),Xa=Te.b.div(rt||(rt=Object(ge.a)(["\n    display: inline-block;\n    background-color: #205f99;\n    width: 100%;\n    height: ","px;\n    font-size: 16px;\n    font-weight: 600;\n    text-align: left;\n    border: solid 1px #0000003b;\n    padding-left: 5px;\n    box-sizing: border-box;\n"])),22),Ya=Te.b.span(dt||(dt=Object(ge.a)(["\n    color: #7a7a7a;\n"]))),qa=Te.b.span(ut||(ut=Object(ge.a)(["\n    color: #3740c0;\n"]))),Qa=Te.b.div(bt||(bt=Object(ge.a)(["\n    display: inline-block;\n    background-color: black;\n    width: calc(100% - 80px);\n    height: calc(100% - 40px);\n    vertical-align: top;\n"]))),Za=Te.b.div(ht||(ht=Object(ge.a)(["\n    display: inline-block;\n    background-color: #ffffffbe;\n    width: 100%;\n    height: 40px;\n"]))),$a=Te.b.div(jt||(jt=Object(ge.a)(["\n    display: inline-block;\n    background-color: #9e6363a2;\n    width: 100%;\n    height: 60px;\n    position: relative;\n    overflow-x: hidden;\n"]))),en=Te.b.div(ft||(ft=Object(ge.a)(["\n    display: inline-block;\n    position: absolute;\n    background-color: #0077ff67;\n    left: ","px;\n    width: ","px;\n    height: 100%;\n    /* color: #002575d1; */\n    text-align: center;\n    border: solid 1px #0077ffd5;\n    opacity: ",";\n    & * {\n        display: inline-block;\n        width: 100%;\n        font-size: 25px;\n        font-weight: 600;\n    }\n"])),(function(e){return e.pos}),(function(e){return e.width}),(function(e){return e.isActive?"1":"0.5"})),tn=Te.b.span(mt||(mt=Object(ge.a)(["\n    color: #ffffffd1;\n"]))),an=Te.b.span(Ot||(Ot=Object(ge.a)(["\n    color: #002575d1;\n"]))),nn=Te.b.div(pt||(pt=Object(ge.a)(["\n    display: inline-block;\n    width: 100%;\n    height: calc(100% - 100px);\n    overflow-x: auto;\n    overflow-y: auto;\n"]))),cn=Te.b.div(xt||(xt=Object(ge.a)(["\n    display: inline-block;\n    background-color: #000000;\n    width: ","px;\n    /* height: 100%; */\n    text-align: left;\n    position: relative;\n    white-space: nowrap;\n"])),(function(e){return e.width})),sn=Te.b.div(vt||(vt=Object(ge.a)(["\n    display: inline-block;\n    position: absolute;\n    top: 0;\n    left: ","px;\n    background-color: #0000ff2d;\n    /* border-right: solid 3px #0004dfc1; */\n    box-sizing: border-box;\n    width: ","px;\n    height: ","px;\n    opacity: ",";\n"])),(function(e){return e.pos}),(function(e){return e.width}),1936,(function(e){return e.isActive?"1":"0.5"})),on=Te.b.div(Et||(Et=Object(ge.a)(["\n    display: table;\n    position: relative;\n    width: 100%;\n    height: ","px;\n    background-color: ",";\n    /* margin-bottom: 1px; */\n"])),22,(function(e){switch(e.soundIndex){case 0:return"#ffffff23";case 1:return"#dadfe423";case 2:return"#e9e9e923";case 3:return"#dadfe423";case 4:return"#e9e9e923";case 5:return"#dfdfdf23";case 6:return"#dadfe423";case 7:return"#e9e9e923";case 8:return"#dadfe423";case 9:return"#e9e9e923";case 10:return"#dadfe423";case 11:return"#e9e9e923"}return"#a00"})),ln=Te.b.div(St||(St=Object(ge.a)(["\n    display: inline-block;\n    position: absolute;\n    top: 0;\n    left: ","px;\n    width: ","px;\n    height: 100%;\n    background-color: ",";\n    ","\n    transition: background-color 200ms, box-shadow 1000ms;\n    border: solid 1px #666666;\n    box-sizing: border-box;\n    font-size: 8px;\n    font-weight: 600;\n    padding-left: 2px;\n    color: #ffffff;\n    border-radius: 2px;\n    /* &:hover {\n        background-color: #dddd00;\n        box-shadow: 2px 2px 15px 4px #ffe81b47;\n    } */\n"])),(function(e){return e.pos}),(function(e){return e.width}),(function(e){return"left"==e.layer?"#e95500c8":"#d6007dd3"}),(function(e){return e.isActive?Object(Te.a)(gt||(gt=Object(ge.a)(["\n        background-color: #dddd00;\n        box-shadow: 2px 2px 25px 4px #ffe81b47;\n    "]))):""})),rn=Te.b.div(Tt||(Tt=Object(ge.a)(["\n    display: inline-block;\n    position: absolute;\n    top: 0;\n    left: ","px;\n    width: 2px;\n    height: ","px;\n    background-color: red;\n        box-shadow: 2px 2px 15px 4px #ff727290;\n    z-index: 99;\n"])),(function(e){return e.pos}),1936),dn=Te.b.div(Nt||(Nt=Object(ge.a)(["\n    display: inline-block;\n    padding: 0 10px 0 10px;\n    background-color: #808080;\n    min-width: 150px;\n    height: 35px;\n    font-size: 22px;\n    font-weight: 600;\n    line-height: 30px;\n    color: #4e4e4e;\n    text-align: center;\n    border: solid 1px #636363;\n    border-radius: 4px;\n    &:hover {\n        background-color: #afafaf;\n    }\n"]))),un=function(){var e=Object(s.useContext)(Nn),t=e.state,a=e.dispatch,n=0===t.noteData.dataList.length;return Object(d.jsx)("div",{id:"scoretab-root",children:Object(d.jsx)(h,{groupName:"score-tabs",tabElements:[{name:"Library",disable:!1,cont:Object(d.jsx)(ca,{})},{name:"Note",disable:n,cont:1!=t.scoreTabIndex?Object(d.jsx)(d.Fragment,{}):Object(d.jsx)(na,{})},{name:"Tune",disable:n,cont:Object(d.jsx)(Oa,{})},{name:"Thema",disable:n,cont:Object(d.jsx)(fa,{})},{name:"Sheet Music",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Preview",disable:n,cont:Object(d.jsx)(Wa,{})}],activeNo:t.scoreTabIndex,selectTabIndex:function(e){return a(ee.SELECT_SCORETAB,{index:e})}})})},bn=function(e,t,a,n){switch(t.scoreTabIndex){case 1:null==t.dialog.contents&&function(e,t,a,n){var c=t.noteState.focusIndex,s=t.noteState.editMode,i=t.noteData.chordMode,o=t.noteData.dataList[c],l=t.noteState.cacheList[c];switch(o.type){case X.Section:switch(o.detail,t.noteState.floatwndState){case H.NONE:if(s==V.NORMAL)switch(e.key){case"c":n.score.callSectionEditor()}break;case H.SECTION_PALETTE:switch(e.key){case"Escape":case"c":a(ee.FLOATWND_STATE,{state:H.NONE})}}break;case X.Change:switch(o.detail,t.noteState.floatwndState){case H.NONE:if(s==V.NORMAL)switch(e.key){case"c":n.score.callChangeEditor()}break;case H.CHANGE_PALETTE:switch(e.key){case"Escape":case"c":a(ee.FLOATWND_STATE,{state:H.NONE})}}break;case X.Chord:var r=o.detail;switch(t.noteState.floatwndState){case H.NONE:if(s==V.NORMAL)switch(e.key){case"c":n.score.callChordSelector();break;case"b":null!=r.molecule&&n.score.callBackingEditor();break;case"t":n.score.callThemaAccessor();break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":if(i==G.DIRECT)break;var d=("major"==l.init.scale?R:w)[Number(e.key)-1];r.molecule={rootIndex:d.degreeIndex,isFlat:d.isFlat},D[r.symbolKey].category!==D[d.symbolKey].category&&(r.backing.useChannels.length=0),r.symbolKey=d.symbolKey,n.score.setNoteData(t.noteData),n.score.apllyFlashCur();break;case"x":n.score.setCriteria();break;case"q":n.score.setCloneCriteria();break;case"z":break;case" ":n.backing.play(!0)}else if(s==V.TRANSPLANT)switch(e.key){case"Escape":case"x":n.score.releaseCriteria();break;case"Enter":var u=t.noteData.dataList,b=u[t.noteState.criteriaIndex].detail.backing;t.noteState.selectedList.forEach((function(e){u[e].detail.backing=JSON.parse(JSON.stringify(b))})),n.score.setNoteData(Object(x.a)(Object(x.a)({},t.noteData),{},{dataList:u})),n.score.releaseCriteria(),n.score.apllyFlashList()}else if(s==V.CLONE)switch(e.key){case"Escape":case"q":n.score.releaseCloneCriteria();break;case"Enter":for(var h=t.noteData.dataList,j=t.noteState.cloneDataList,f=t.noteState.cloneRange,m=f[0]>f[1],O=f[m?1:0],p=f[m?0:1],v=O;v<=p;v++)j.push(JSON.parse(JSON.stringify(h[v])));n.score.setNoteState(Object(x.a)(Object(x.a)({},t.noteState),{},{cloneDataList:j,editMode:V.NORMAL}))}break;case H.CHORD_PALETTE:switch(e.key){case"Escape":case"c":a(ee.FLOATWND_STATE,{state:H.NONE});break;case"Enter":n.chord.setCurChordParam()}break;case H.BACKING_PALETTE:var E=t.noteState.backingPaletteState,S=E.isCorrect;switch(e.key){case"Escape":case"b":s!==V.PREVIEW&&a(ee.FLOATWND_STATE,{state:H.NONE});break;case"ArrowLeft":if(!n.backing.isFirstCurLen()){var g=n.backing.getCurLenIndex();n.backing.updateLenIndex(g-1)}break;case"ArrowRight":if(!n.backing.isLastCurLen()){var T=n.backing.getCurLenIndex();n.backing.updateLenIndex(T+1)}break;case"ArrowUp":var N=n.backing.getCurVelocity();N<10&&n.backing.updateCurVolume(N+1);break;case"ArrowDown":var y=n.backing.getCurVelocity();y>1&&n.backing.updateCurVolume(y-1);break;case"r":n.backing.changeLayerIndex();break;case"1":n.backing.setCurLen(U.LEN16);break;case"2":n.backing.setCurLen(U.LEN8);break;case"3":n.backing.setCurLen(U.LEN4);break;case"4":n.backing.setCurLen(U.LEN2);break;case"5":n.backing.setCurLen(U.LEN1);break;case".":if(n.backing.isAcceptHalf()){var A=n.backing.getCurLenBean();A.isHalf=!A.isHalf,A.isDiv3=!1,n.backing.setCurrentLenBean(A)}break;case"/":if(n.backing.isAcceptDiv3()){var I=n.backing.getCurLenBean();I.isDiv3=!I.isDiv3,I.isHalf=!1,n.backing.setCurrentLenBean(I)}break;case"a":n.backing.addLen();break;case"Delete":n.backing.getSideScript().lens.length>1&&n.backing.delLen();break;case" ":S&&(s!==V.PREVIEW?n.backing.play(!1):n.preview.stop());break;case"Enter":S&&n.backing.setCurBackingScript();break;case"z":var C={isUsePedal:E.isUsePedal,layers:E.layers,useChannels:E.useChannels};alert(JSON.stringify(C))}}}if(t.noteState.floatwndState==H.NONE&&[X.Chord,X.Section,X.Change].includes(o.type))if(s==V.NORMAL)switch(e.key){case"ArrowLeft":n.score.focusPreviousElement();break;case"ArrowRight":n.score.focusNextElement();break;case"ArrowUp":n.score.focusPreviousSection();break;case"ArrowDown":n.score.focusNextSection();break;case"Delete":n.score.deleteCurElement();break;case"i":n.score.focusInitElement();break;case"a":n.score.addChordElement();break;case"s":n.score.addSectionElement();break;case"f":n.score.addChangeElement();break;case"v":console.log(t.noteState.cloneDataList),n.score.insertCloneData();break;case"w":n.score.addChordElement(),a(ee.SELECT_NOTE_ELEMENT,{index:t.noteState.focusIndex+1}),a(ee.FLOATWND_STATE,{state:H.CHORD_PALETTE}),a(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},t.noteState.chordPaletteState),{},{isAddition:!0,molecule:{rootIndex:0,isFlat:!1},denominator:null,symbolKey:D[0].key,sustain:t.noteState.defaultSustain})})}else if(s==V.PREVIEW)switch(e.key){case" ":n.preview.stop()}}(e,t,a,n);break;case 2:null==t.dialog.contents&&function(e,t,a,n){var c=t.tuneState,s=t.noteData.columnList,i=c.cacheList[c.columnIndex],o=s[c.columnIndex],l=function(){return n.tune.setState(Object(x.a)({},c))},r=function(){return n.tune.setColumnList(s.slice())},d=function(){var e=Math.floor((96-o.soundIndex)/12),t=(96-o.soundIndex)%12;return T[t]+e};switch(e.key){case"1":c.usingLen=16,l();break;case"2":c.usingLen=8,l();break;case"3":c.usingLen=4,l();break;case"/":c.isDiv3=!c.isDiv3,l();break;case" ":c.isPreview?(n.tune.stopPreview(),c.isPreview=!1,l()):(n.tune.playPreview(),c.isPreview=!0,l());break;case"w":n.tune.adjustScrollX(c.columnIndex)}if(c.isEdit)switch(e.key){case"ArrowUp":var u=o.soundIndex;if(-1==o.soundIndex)if(c.columnIndex>0){var b=s[c.columnIndex-1].soundIndex;-1!==b&&(o.soundIndex=b)}else o.soundIndex=44;else if(o.soundIndex>0)do{if(u-=1,[0,2,4,5,7,9,11].includes((i.baseKey+u+4)%12)){o.soundIndex=u;break}}while(u>0);c.isAutoScroll&&n.tune.adjustScrollY(c.columnIndex),r(),n.tune.playSoundFont(d(),.5);break;case"ArrowDown":var h=o.soundIndex;if(-1==o.soundIndex)if(c.columnIndex>0){var j=s[c.columnIndex-1].soundIndex;-1!==j&&(o.soundIndex=j)}else o.soundIndex=44;else if(o.soundIndex<87)do{if(h+=1,[0,2,4,5,7,9,11].includes((i.baseKey+h+4)%12)){o.soundIndex=h;break}}while(h<87);c.isAutoScroll&&n.tune.adjustScrollY(c.columnIndex),r(),n.tune.playSoundFont(d(),.5);break;case"ArrowLeft":n.tune.adjustWidth(!1);break;case"ArrowRight":n.tune.adjustWidth(!0);break;case"Enter":c.isEdit=!1,l();break;case"Delete":o.soundIndex=-1,r();break;case"a":n.tune.addColumn(),c.columnIndex=c.columnIndex+=1,l()}else switch(e.key){case"ArrowLeft":c.columnIndex>0&&(c.columnIndex=c.columnIndex-=1,l(),c.isAutoScroll&&n.tune.adjustScrollX(c.columnIndex));break;case"ArrowRight":c.columnIndex<s.length-1&&(c.columnIndex=c.columnIndex+=1,l(),c.isAutoScroll&&n.tune.adjustScrollX(c.columnIndex));break;case"Enter":c.isEdit=!0,l();break;case"a":n.tune.addColumn();break;case"Delete":n.tune.remooveCur()}}(e,t,0,n)}},hn=a(9),jn=a(2),fn=function e(t,a){var n=this;Object(jn.a)(this,e),this.dispatchBase=void 0,this.dispatch=void 0,this.state=void 0,this.setLoginParams=function(e){n.dispatch(ee.SET_LOGIN,{login:e})},this.callDialog=function(e,t,a,c){var s={left:e,top:t,contents:a,arg:c};n.dispatch(ee.SET_DIALOG,{dialog:s})},this.closeDialog=function(){n.dispatch(ee.SET_DIALOG,{dialog:Object(x.a)(Object(x.a)({},n.state.dialog),{},{contents:null})})},this.setDinamicCache=function(e){n.dispatch(ee.DINAMIC_CACHE,{dinamicCache:e})},this.setFormDispatcher=function(e){n.dispatch(ee.SET_FORM_DISPATCHER,{formDispatcher:e})},this.setNoteData=function(e){n.dispatchBase({type:ee.SET_NOTE_DATA,payload:{data:e}})},this.initBackingPalette=function(e){n.dispatchBase({type:ee.INIT_BACKING_PALETTE,payload:{backingPaletteState:e}})},this.setUseChannels=function(e){n.dispatchBase({type:ee.SET_USE_CHANNELS,payload:{useChannels:e}})},this.setSampler=function(e){var t=function(e){return new F.a(e).toDestination()}(e);n.dispatchBase({type:ee.SET_SAMPLER,payload:{sampler:t}})},this.setInstruments=function(e){n.dispatchBase({type:ee.SET_INSTRUMENT,payload:{instrument:e}})},this.score={apllyFlasah:function(e){var t=n.state.noteState.cacheList[e].reffer;t.style.backgroundColor="#ff0",setTimeout((function(){t.style.backgroundColor=""}),350)},apllyFlashCur:function(){var e=n.state.noteState.focusIndex;n.score.apllyFlasah(e)},apllyFlashList:function(){n.state.noteState.selectedList.forEach((function(e){n.score.apllyFlasah(e)}))},setNoteState:function(e){n.dispatch(ee.SET_NOTE_STATE,{noteState:e})},setCriteria:function(){var e=n.state.noteState.focusIndex;n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{criteriaIndex:e,editMode:V.TRANSPLANT}))},setCloneCriteria:function(){var e=n.state.noteState.focusIndex;n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{cloneRange:[e,e],editMode:V.CLONE,cloneDataList:[]}))},setCloneRange:function(e){var t=n.state.noteState.cloneRange;t[1]=e,n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{cloneRange:t}))},insertCloneData:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList,a=n.state.noteState.cloneDataList;n.state.noteState.cacheList.slice();a.forEach((function(a,n){t.splice(e+1+n,0,a)})),n.score.setNoteData(Object(x.a)(Object(x.a)({},n.state.noteData),{},{dataList:t})),n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{cloneDataList:[]}))},releaseCriteria:function(){n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{criteriaIndex:-1,editMode:V.NORMAL,selectedList:[]}))},releaseCloneCriteria:function(){n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{cloneRange:[],editMode:V.NORMAL}))},setNoteData:function(e){n.dispatch(ee.SET_NOTE_DATA,{data:e})},getInitElement:function(){return n.state.noteData.dataList[0].detail},setEditMode:function(e){n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{editMode:e}))},addNoteElement:function(e,t){var a=n.state.noteState.focusIndex,c=n.state.noteData.dataList.slice();c.splice(a+1,0,{type:e,detail:t}),n.dispatch(ee.SET_DATA_LIST,{dataList:c}),n.state.noteState.cacheList.slice().splice(a+1,0,{}),n.score.apllyFlasah(a+1)},addSectionElement:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList.slice(),a={labelName:"Section"};t.splice(e+1,0,{type:X.Section,detail:a}),n.dispatch(ee.SET_DATA_LIST,{dataList:t}),n.state.noteState.cacheList.slice().splice(e+1,0,{}),n.score.apllyFlasah(e+1)},addChangeElement:function(){n.score.addNoteElement(X.Change,{changeType:null,modulateRelation:null,domminantValue:0,keyAdjust:0,tempoRelation:null,tempoDiff:0,tempoRate:0,tempoAbsolute:0,beat:null})},addChordElement:function(){var e=n.state.noteState,t=e.focusIndex,a=n.state.noteData.dataList.slice();a.splice(t+1,0,{type:X.Chord,detail:{molecule:null,denominator:null,symbolKey:C.MAJOR,sustain:e.defaultSustain,headAdjust:0,tailAdjust:0,backing:{useChannels:[],layers:[{lens:[{len:U.LEN4,isDiv3:!1,isHalf:!1}],side:B.LEFT,table:[[[!1]]],vels:[5]},{lens:[{len:U.LEN4,isDiv3:!1,isHalf:!1}],side:B.RIGHT,table:[[[!1]]],vels:[5]}],isUsePedal:!1}}}),n.dispatch(ee.SET_DATA_LIST,{dataList:a}),n.state.noteState.cacheList.slice().splice(t+1,0,{}),n.score.apllyFlasah(t+1)},deleteElement:function(e){var t=n.state.noteState.focusIndex,a=n.state.noteData.dataList[e];if([X.Chord,X.Section,X.Change].includes(a.type)&&2!=e){var c=n.state.noteData.dataList.slice();c.splice(e,1),n.dispatch(ee.SET_DATA_LIST,{dataList:c}),e<=t&&(n.state.noteState.focusIndex--,n.dispatch(ee.SET_NOTE_STATE,{noteState:n.state.noteState}))}},deleteCurElement:function(){var e=n.state.noteState.focusIndex;n.score.deleteElement(e)},focusPreviousElement:function(){var e=n.state.noteState.focusIndex;return n.state.noteData.dataList[e-1].type!=X.Fixed&&(n.state.noteState.focusIndex--,n.dispatch(ee.SET_NOTE_STATE,{noteState:n.state.noteState}),!0)},focusNextElement:function(){var e=n.state.noteState.focusIndex;if(n.state.noteData.dataList[e+1].type!=X.Fixed){var t=e+1;return n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{focusIndex:t})),!0}return!1},focusPreviousSection:function(){var e=n.state.noteData.dataList,t=n.state.noteState.focusIndex;do{if(e[--t].type==X.Section){n.state.noteState.focusIndex=t,n.dispatch(ee.SET_NOTE_STATE,{noteState:n.state.noteState});break}}while(t>0)},focusNextSection:function(){var e=n.state.noteData.dataList,t=n.state.noteState.focusIndex;do{if(e[++t].type==X.Section||t==e.length-2){n.state.noteState.focusIndex=t,n.dispatch(ee.SET_NOTE_STATE,{noteState:n.state.noteState});break}}while(t<e.length-1)},focusInitElement:function(){n.state.noteState.focusIndex=0,n.dispatch(ee.SET_NOTE_STATE,{noteState:n.state.noteState})},setSelectedList:function(e){n.dispatch(ee.SET_NOTE_STATE,{noteState:Object(x.a)(Object(x.a)({},n.state.noteState),{},{selectedList:e})})},callChordSelector:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=t.molecule;null==a&&(a={rootIndex:0,isFlat:!1}),n.dispatch(ee.FLOATWND_STATE,{state:H.CHORD_PALETTE}),n.dispatch(ee.CHORD_PALETTE_SETTER,{params:Object(x.a)(Object(x.a)({},n.state.noteState.chordPaletteState),{},{molecule:a,denominator:t.denominator,symbolKey:t.symbolKey,sustain:t.sustain,headAdjust:t.headAdjust,tailAdjust:t.tailAdjust})})},callSectionEditor:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail;n.setDinamicCache(t),n.dispatch(ee.FLOATWND_STATE,{state:H.SECTION_PALETTE})},callChangeEditor:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail;n.setDinamicCache(t),n.dispatch(ee.FLOATWND_STATE,{state:H.CHANGE_PALETTE})},callBackingEditor:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=n.state.noteState.cacheList[e].init,c=t.backing,s=t.molecule,i={target:"note",isEditPattern:!0,isDispVoicing:!0,molecule:{rootIndex:s.rootIndex+a.keyIndex,isFlat:s.isFlat},denominator:t.denominator,symbolKey:t.symbolKey,sustain:t.sustain,headAdjust:t.headAdjust,tailAdjust:t.tailAdjust,channelRowSize:c.layers[0].table.length,useChannels:JSON.parse(JSON.stringify(c.useChannels)),isUsePedal:c.isUsePedal,sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,layers:JSON.parse(JSON.stringify(c.layers)),isCorrect:!0};n.initBackingPalette(i),n.dispatch(ee.FLOATWND_STATE,{state:H.BACKING_PALETTE})},callThemaAccessor:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail;n.setDinamicCache(t),n.dispatch(ee.FLOATWND_STATE,{state:H.THEMA_ACCESSOR})}},this.init={setInitParam:function(e,t,a,c){var s=n.state.noteState.focusIndex;n.dispatch(ee.DETAIL_PARAMS_SETTER,{pos:s,params:{tempo:e,rythm:t,keyIndex:a,scale:c}}),n.dispatch(ee.FLOATWND_STATE,{state:H.NONE}),n.score.apllyFlashCur()}},this.section={setSectionParam:function(e){var t=n.state.noteState.focusIndex;n.dispatch(ee.DETAIL_PARAMS_SETTER,{pos:t,params:{labelName:e}}),n.dispatch(ee.FLOATWND_STATE,{state:H.NONE}),n.score.apllyFlashCur()}},this.change={applyChangeParams:function(e,t,a,c,s,i,o,l,r){var d=n.state.noteState.focusIndex;n.dispatch(ee.DETAIL_PARAMS_SETTER,{pos:d,params:{changeType:e,modulateRelation:t,domminantValue:a,keyAdjust:c,tempoRelation:s,tempoDiff:i,tempoRate:o,tempoAbsolute:l,beat:r}}),n.dispatch(ee.FLOATWND_STATE,{state:H.NONE}),n.score.apllyFlashCur()}},this.chord={setCurChordParam:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=n.state.noteState.chordPaletteState;n.dispatch(ee.DETAIL_PARAMS_SETTER,{pos:e,params:Object(x.a)(Object(x.a)({},t),{},{molecule:a.molecule,denominator:a.denominator,symbolKey:a.symbolKey,sustain:a.sustain,headAdjust:a.headAdjust,tailAdjust:a.tailAdjust})}),n.dispatch(ee.FLOATWND_STATE,{state:H.NONE}),n.score.apllyFlashCur()}},this.backing={setPaletteState:function(e){var t=n.state.noteState.backingPaletteState;n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{backingPaletteState:t}))},toggleMatrix:function(e,t,a){var c=n.state.noteState.backingPaletteState,s=c.sideIndex,i=!c.layers[s].table[e][t][a];n.dispatch(ee.BACKING_TOGGLE_MATRIX,{sideIndex:s,channelIndex:e,lenIndex:t,divIndex:a,isUse:i})},addLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers,a=e.sideIndex,c=t[a],s=e.selectedLenIndex,i=c.table;c.lens=Object(hn.a)(c.lens),c.lens.splice(s+1,0,{len:U.LEN4,isHalf:!1,isDiv3:!1}),i.forEach((function(e){e.splice(s+1,0,[!1])})),c.vels.splice(e.selectedLenIndex+1,0,5),t[a]=c,n.dispatch(ee.INIT_BACKING_PALETTE,{backingPaletteState:e})},delLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers,a=e.sideIndex,c=t[a],s=e.selectedLenIndex,i=c.table;c.lens=Object(hn.a)(c.lens),c.lens.splice(s,1),i.forEach((function(e){e.splice(s,1)})),c.vels.splice(s,1),t[a]=c,s>0&&e.selectedLenIndex--,n.dispatch(ee.INIT_BACKING_PALETTE,{backingPaletteState:e})},updateLenIndex:function(e){var t=n.state.noteState.backingPaletteState;t.selectedLenIndex=e,n.initBackingPalette(t)},getCurLenIndex:function(){return n.state.noteState.backingPaletteState.selectedLenIndex},setChannelRowSize:function(e){var t=n.state.noteState.backingPaletteState;t.channelRowSize=e,t.layers.forEach((function(t){var a=new Array(e);console.log("\u2605\u2605\u2605"+a.length);for(var n=0;n<a.length;n++){a[n]=new Array(t.lens.length),console.log("\u2606\u2606\u2606\u2606\u2606\u2606");for(var c=0;c<a[n].length;c++)a[n][c]=new Array(1),a[n][c][0]=!1}t.table=a})),n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{backingPaletteState:t}))},isFirstCurLen:function(){return 0==n.state.noteState.backingPaletteState.selectedLenIndex},isLastCurLen:function(){var e=n.state.noteState.backingPaletteState,t=e.layers[e.sideIndex];return e.selectedLenIndex==t.lens.length-1},getSideScript:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex]},getCurLenBean:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex].lens[e.selectedLenIndex]},setCurrentLenBean:function(e){var t=n.state.noteState.backingPaletteState,a=t.layers;a[t.sideIndex].lens[t.selectedLenIndex]=e,n.initBackingPalette(Object(x.a)(Object(x.a)({},t),{},{layers:a}))},setCurLen:function(e){var t=n.backing.getCurLenBean();t.len=e,t.isHalf=!1,t.isDiv3=!1,n.backing.setCurrentLenBean(t)},updateCurVolume:function(e){var t=n.state.noteState.backingPaletteState,a=t.layers;a[t.sideIndex].vels[t.selectedLenIndex]=e,n.initBackingPalette(Object(x.a)(Object(x.a)({},t),{},{layers:a}))},getCurVelocity:function(){var e=n.state.noteState.backingPaletteState;return e.layers[e.sideIndex].vels[e.selectedLenIndex]},isAcceptHalf:function(){return[U.LEN2,U.LEN4,U.LEN8].includes(n.backing.getCurLenBean().len)},isAcceptDiv3:function(){return[U.LEN4,U.LEN8].includes(n.backing.getCurLenBean().len)},setLayerIndex:function(e){var t=n.state.noteState.backingPaletteState;t.sideIndex=e,t.selectedLenIndex=0,n.initBackingPalette(t)},setUsePedal:function(e){var t=n.state.noteState.backingPaletteState;t.isUsePedal=e,n.initBackingPalette(t)},setCorrect:function(e){var t=n.state.noteState.backingPaletteState;t.isCorrect=e,n.initBackingPalette(t)},changeLayerIndex:function(){var e=n.state.noteState.backingPaletteState;e.sideIndex=0==e.sideIndex?1:0,e.selectedLenIndex=0,n.initBackingPalette(e)},setUseChannels:function(e){for(var t=n.state.noteState.backingPaletteState,a=t.layers,c=new Array(2),s=0;s<2;s++){for(var i=t.useChannels.length,o=a[s].lens.length,l=a[s].table,r=new Array(i),d=0;d<i;d++)if(d<l.length)r[d]=l[d];else{r[d]=new Array(o);for(var u=0;u<o;u++)r[d][u]=new Array(1),r[d][u][0]=!1}c[s]=Object(x.a)(Object(x.a)({},a[s]),{},{table:r})}},setCurBackingScript:function(){var e=n.state.noteState.focusIndex,t=n.state.noteData.dataList[e].detail,a=n.state.noteState.backingPaletteState,c={};c.useChannels=a.useChannels,c.layers=a.layers,c.isUsePedal=a.isUsePedal,n.dispatch(ee.DETAIL_PARAMS_SETTER,{pos:e,params:Object(x.a)(Object(x.a)({},t),{},{backing:c})}),n.dispatch(ee.FLOATWND_STATE,{state:H.NONE}),n.score.apllyFlashCur()},getNotesCount:function(e){var t=0;return e.layers.forEach((function(e){e.table.forEach((function(e){e.forEach((function(e){e[0]&&t++}))}))})),t},play:function(e){for(var t=(new Date).getTime(),a=n.state.noteState.backingThreads,c=n.state.sampler,s=Array(88),i=0;i<88;i++)s[i]=0;n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{editMode:V.PREVIEW,backingThreads:a}));var o=0,l=n.state.noteState.focusIndex,d=n.state.noteData.dataList,u=n.state.noteState.cacheList[l].progress.headMSec;if(e&&n.state.noteState.ensembleInfo.isLoad){var b=n.state.noteState.ensembleInfo.startPosition,h=n.state.noteState.ensembleInfo.audio,j=b+u;h.currentTime=0,j>0?(h.currentTime=.001*j,h.play()):setTimeout((function(){h.play()}),-1*j)}for(var f=e?d.length:l+1,m=function(i){var u=d[i];a.push(setTimeout((function(){if(e&&[X.Chord,X.Fixed].includes(u.type)){var t=u.type==X.Fixed?[V.NORMAL,l]:[V.PREVIEW,i],a=Object(r.a)(t,2),c=a[0],s=a[1];n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{focusIndex:s,editMode:c}))}}),o)),u.type==X.Chord&&function(){var l=u.detail,r=n.state.noteState.cacheList[i],d=Object(x.a)({},P(l.symbolKey));null!=l.molecule&&null!=l.denominator&&$(d,l.molecule.rootIndex,l.denominator.rootIndex);var b=null===d||void 0===d?void 0:d.intervals,h=n.state.noteState.backingPaletteState,j=e?l.backing:{layers:h.layers,useChannels:h.useChannels,isUsePedal:h.isUsePedal},f=r.init.tempo,m=6e4/f*4,O=6e4/f*(l.sustain+l.headAdjust+l.tailAdjust),p=m/32;e||a.push(setTimeout((function(){n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{editMode:V.NORMAL}))}),o+O));for(var v=function(e){var n=0,i=j.layers[e];i.lens.forEach((function(e,d){var u=Number(e.len.toString().replace("LEN","")),h=m/u;e.isHalf&&(h*=1.5),j.useChannels.forEach((function(e,u){i.table[u][d].forEach((function(u,f){if(u&&null!=l.molecule){var m=l.molecule.rootIndex,x=(r.init.keyIndex+m)%12+b[e.structIndex]+12*e.octave,v=Math.floor(x/12),E=T[x%12]+v,S=.5*i.vels[d]/10,g=n+h/3*f,N=j.isUsePedal?O+p:g+h,y=(new Date).getTime()-t;a.push(setTimeout((function(){c.triggerAttack(E,"+0",S),s[x]++}),o+g-y)),a.push(setTimeout((function(){s[x]--,0==s[x]&&c.triggerRelease(E)}),o+N-y))}}))})),n+=h}))},E=0;E<2;E++)v(E);o+=O}()},O=l;O<f;O++)m(O);if(e){var p=n.state.noteState.cacheList[l].progress.headMSec;n.backing.playTune(t,p)}},playTune:function(e,t){for(var a=n.state.noteData.columnList,c=n.state.noteState.backingThreads,s=140-t,i=n.state.noteState.cacheList[0].init.tempo,o=function(t){var o=a[t],l=o.len4+o.len8/2+o.len16/4+o.len4div3/3+o.len8div3/6,r=function(e){var t=Math.floor((96-e)/12);return T[(96-e)%12]+t}(o.soundIndex),d=60/i*l;if(s>0){var u=(new Date).getTime()-e;-1!==o.soundIndex&&c.push(setTimeout((function(){n.tune.playSoundFont(r,d)}),s-u))}s+=1e3*d},l=0;l<a.length;l++)o(l)}},this.thema={setThemaeData:function(e){n.dispatch(ee.SET_THEMA_DATA,{data:Object(x.a)({},e)})},setThemaState:function(e){n.dispatch(ee.SET_THEMA_STATE,{themaState:e})},callBackingPatternEditor:function(){var e=n.thema.getFocusElement().parent.reffer,t=n.state.themaState.form.pattern,a=""==t.src?{layers:[{lens:[{len:U.LEN4,isDiv3:!1,isHalf:!1}],side:B.LEFT,table:[[[!1]]],vels:[5]},{lens:[{len:U.LEN4,isDiv3:!1,isHalf:!1}],side:B.RIGHT,table:[[[!1]]],vels:[5]}],isUsePedal:!1}:JSON.parse(t.src),c={target:"thema-pattern",isDispVoicing:!1,isEditPattern:!0,molecule:{rootIndex:0,isFlat:!1},denominator:null,symbolKey:C.MAJOR,sustain:e.beat,headAdjust:e.headAdjust,tailAdjust:e.tailAdjust,channelRowSize:a.layers[0].table.length,isUsePedal:a.isUsePedal,sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,useChannels:[],layers:a.layers.slice(),isCorrect:!0};n.initBackingPalette(c),n.dispatch(ee.FLOATWND_STATE,{state:H.BACKING_PALETTE})},callBackingVoicingEditor:function(){var e,t,a=null===(e=n.thema.getFocusElement().parent)||void 0===e||null===(t=e.parent)||void 0===t?void 0:t.parent,c=a.parent,s=a.reffer,i=c.reffer,o=s.def,l=n.state.themaState.form.voicing,r=""==l.src?{useChannels:[]}:JSON.parse(l.src),d={target:"thema-voicing",isDispVoicing:!0,isEditPattern:!1,molecule:{rootIndex:0,isFlat:!1},denominator:null,symbolKey:C.MAJOR,sustain:i.beat,headAdjust:i.headAdjust,tailAdjust:i.tailAdjust,channelRowSize:o.layers[0].table.length,isUsePedal:o.isUsePedal,sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,useChannels:r.useChannels.slice(),layers:o.layers,isCorrect:!0};n.initBackingPalette(d),n.dispatch(ee.FLOATWND_STATE,{state:H.BACKING_PALETTE})},buildIndex:function(){var e=n.state.themaState,t=n.state.themaDataTree,a=[],c={isClose:!1,ChildCnt:t.sustains.length,type:"root",reffer:t,parent:null};a.push(c),t.sustains.forEach((function(e){var t={isClose:!1,ChildCnt:e.patterns.length,type:"sustain",reffer:e,parent:c};a.push(t),e.patterns.forEach((function(e){var n={isClose:!1,ChildCnt:e.tgtTypes.length,type:"pattern",reffer:e,parent:t};a.push(n),e.tgtTypes.forEach((function(e){var t={isClose:!1,ChildCnt:e.conditions.length,type:"category",reffer:e,parent:n};a.push(t),e.conditions.forEach((function(e){var n={isClose:!1,ChildCnt:e.voicings.length,type:"condition",reffer:e,parent:t};a.push(n),e.voicings.forEach((function(e){var t={isClose:!1,ChildCnt:0,type:"voicing",reffer:e,parent:n};a.push(t)}))}))}))}))})),null!==e.focusRef&&a.forEach((function(t,a){t.reffer==e.focusRef&&(e.focusIndex=a,e.focusRef=null,e.isCreate=!0)})),n.thema.setThemaState(Object(x.a)(Object(x.a)({},e),{},{themaCacheList:a}))},applyBackingPattern:function(){var e=n.state.noteState.backingPaletteState,t=n.state.themaState.form.pattern,a={layers:e.layers.slice(),isUsePedal:e.isUsePedal};t.src=JSON.stringify(a),n.thema.setThemaState(n.state.themaState),n.dispatch(ee.FLOATWND_STATE,{state:H.NONE})},applyBackingVoicing:function(){var e=n.state.noteState.backingPaletteState,t=n.state.themaState.form.voicing,a={useChannels:e.useChannels};t.src=JSON.stringify(a),n.thema.setThemaState(n.state.themaState),n.dispatch(ee.FLOATWND_STATE,{state:H.NONE})},getFocusElement:function(){return n.state.themaState.themaCacheList[n.state.themaState.focusIndex]},addChildSustain:function(){var e=n.state.themaDataTree,t=n.state.themaState,a={beat:1,headAdjust:0,tailAdjust:0,patterns:[]};t.focusRef=a;var c=t.form.sustain;c.beat=null,c.headAdjust=0,c.tailAdjust=0,n.thema.setThemaState(t),e.sustains.push(a),n.thema.setThemaeData(e)},addChildPattern:function(e){var t=n.state.themaDataTree,a=n.state.themaState,c=e.reffer,s={name:"pattern1",def:null,tgtTypes:[]};a.focusRef=s;var i=a.form.pattern;i.name="",i.def=null,i.src="",n.thema.setThemaState(a),c.patterns.push(s),n.thema.setThemaeData(t)},addChildCategory:function(e){var t=n.state.themaDataTree,a=n.state.themaState,c=e.reffer,s={symbolType:L.TRIAD,conditions:[]};a.focusRef=s,a.form.category.category=null,n.thema.setThemaState(a),c.tgtTypes.push(s),n.thema.setThemaeData(t)},addChildCondition:function(e){var t=n.state.themaDataTree,a=n.state.themaState,c=e.reffer,s={maxRootIndex:11,minRootIndex:0,tgtSymbols:[],voicings:[]};a.focusRef=s;var i=a.form.condition;i.maxRootIndex=0,i.maxRootIndex=11,i.tgtSymbols=[],n.thema.setThemaState(a),c.conditions.push(s),n.thema.setThemaeData(t)},addChildVoicing:function(e){var t=n.state.themaDataTree,a=n.state.themaState,c=e.reffer,s={def:null};a.focusRef=s;var i=a.form.voicing;i.def=null,i.src="",n.thema.setThemaState(a),c.voicings.push(s),n.thema.setThemaeData(t)}},this.preview={play:function(){for(var e=n.state.noteState.backingThreads,t=Array(88),a=0;a<88;a++)t[a]=0;n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{editMode:V.PREVIEW,backingThreads:e}));var c=0,s=n.state.noteState.focusIndex,i=n.state.noteData.dataList,o=n.state.noteState.ensembleInfo.startPosition;if(""!==n.state.noteState.ensembleInfo.fileURL){var l=n.state.noteState.ensembleInfo.audio;l.currentTime=.001*(o+0),l.play()}for(var r=(new Date).getTime(),d=i.length,u=s;u<d;u++){var b=i[u];b.type==X.Chord&&function(){var a=b.detail,s=n.state.noteState.cacheList[u],i=Object(x.a)({},P(a.symbolKey));null!=a.molecule&&null!=a.denominator&&$(i,a.molecule.rootIndex,a.denominator.rootIndex);for(var o=null===i||void 0===i?void 0:i.intervals,l=a.backing,d=n.state.sampler,h=s.init.tempo,j=6e4/h*4,f=6e4/h*(a.sustain+a.headAdjust+a.tailAdjust),m=j/32,O=function(n){var i=0,u=l.layers[n];u.lens.forEach((function(n,b){var h=Number(n.len.toString().replace("LEN","")),O=j/h;n.isHalf&&(O*=1.5),l.useChannels.forEach((function(n,h){u.table[h][b].forEach((function(h,j){if(h&&null!=a.molecule){var p=a.molecule.rootIndex,x=(s.init.keyIndex+p)%12+o[n.structIndex]+12*n.octave,v=Math.floor(x/12),E=T[x%12]+v,S=.5*u.vels[b]/10,g=i+O/3*j,N=l.isUsePedal?f+m:g+O,y=(new Date).getTime()-r;e.push(setTimeout((function(){d.triggerAttack(E,"+0",S),t[x]++}),c+g-y)),e.push(setTimeout((function(){t[x]--,0==t[x]&&d.triggerRelease(E)}),c+N-y))}}))})),i+=O}))},p=0;p<2;p++)O(p);c+=f}()}},stop:function(){n.state.noteState.ensembleInfo.isLoad&&n.state.noteState.ensembleInfo.audio.pause(),n.state.noteState.backingThreads.forEach((function(e){clearInterval(e)})),n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{backingThreads:[],editMode:V.NORMAL})),n.state.sampler.releaseAll()}},this.tune={setState:function(e){n.dispatchBase({type:ee.SET_TUNE_STATE,payload:{tuneState:e}})},setSoundFont:function(e){n.setNoteData(Object(x.a)(Object(x.a)({},n.state.noteData),{},{soundFont:e}))},setColumnList:function(e){n.setNoteData(Object(x.a)(Object(x.a)({},n.state.noteData),{},{columnList:e}))},addColumn:function(){var e=n.state.tuneState,t=4!==e.usingLen||e.isDiv3?0:1,a=8!==e.usingLen||e.isDiv3?0:1,c=16===e.usingLen?1:0,s=4===e.usingLen&&e.isDiv3?1:0,i=8===e.usingLen&&e.isDiv3?1:0,o=n.state.noteData.columnList;o.splice(e.columnIndex+1,0,{len4:t,len8:a,len16:c,len4div3:s,len8div3:i,soundIndex:-1}),n.tune.setColumnList(o.slice())},remooveCur:function(){var e=n.state.tuneState,t=n.state.noteData.columnList;t.splice(e.columnIndex,1),n.tune.setColumnList(t.slice())},playSoundFont:function(e,t){var a=n.state.instrument;null!=a&&(a.stop(),a.play(e,0,{duration:t}))},adjustWidth:function(e){var t=n.state.tuneState,a=n.state.noteData.columnList,c=Object(x.a)({},a[t.columnIndex]);e?4!==t.usingLen||t.isDiv3?8!==t.usingLen||t.isDiv3?16!==t.usingLen||t.isDiv3?4===t.usingLen&&t.isDiv3?c.len4div3++:8===t.usingLen&&t.isDiv3&&c.len8div3++:c.len16++:c.len8++:c.len4++:4!==t.usingLen||t.isDiv3?8!==t.usingLen||t.isDiv3?16!==t.usingLen||t.isDiv3?4===t.usingLen&&t.isDiv3?c.len4div3--:8===t.usingLen&&t.isDiv3&&c.len8div3--:c.len16--:c.len8--:c.len4--;var s=c.len4+c.len8/2+c.len16/4,i=c.len4div3/3+c.len8div3/6;if(s+i>0){c.len4=Math.floor(s),s-=c.len4,s*=2,c.len8=Math.floor(s),s-=c.len8,s*=2,c.len16=Math.floor(s);var o=Math.floor(i);i-=o,i*=3,c.len4div3=Math.floor(i),i-=c.len4div3,i*=2;var l=Math.floor(i);i-=l,i*=3,c.len8div3=Math.floor(i),c.len4+=o,c.len8+=l,a[t.columnIndex]=c,n.tune.setColumnList(a.slice())}},adjustScrollY:function(e){var t=n.state.tuneState,a=n.state.noteData.columnList[e];if(-1!==a.soundIndex){var c=22*a.soundIndex-350;t.intervalRef.current.scrollTo({top:c,behavior:"smooth"}),t.tableRef.current.scrollTo({top:c,behavior:"smooth"})}},adjustScrollX:function(e){var t=n.state.tuneState,a=t.cacheList[e].posX*v-200;t.tableRef.current.scrollTo({left:a,behavior:"smooth"}),console.log("left: "+a)},playPreview:function(){for(var e=n.state.tuneState,t=n.state.noteData.columnList,a=(n.state.instrument,n.state.noteState.backingThreads),c=0,s=n.state.noteState.cacheList[0].init.tempo,i=function(i){var o=t[i],l=o.len4+o.len8/2+o.len16/4+o.len4div3/3+o.len8div3/6,r=60/s*l,d=function(e){var t=Math.floor((96-e)/12);return T[(96-e)%12]+t}(o.soundIndex);a.push(setTimeout((function(){e.columnIndex=i,e.isEdit=!0,n.tune.setState(e),-1!==o.soundIndex&&n.tune.playSoundFont(d,r)}),1e3*c)),c+=r},o=e.columnIndex;o<t.length;o++)i(o);a.push(setTimeout((function(){e.isPreview=!1,n.tune.setState(e)}),1e3*c))},stopPreview:function(){n.state.noteState.backingThreads.forEach((function(e){clearInterval(e)})),n.score.setNoteState(Object(x.a)(Object(x.a)({},n.state.noteState),{},{backingThreads:[]}))},moveAll:function(e){for(var t=n.state.noteData.columnList,a=0;a<t.length;a++){var c=t[a];-1!==c.soundIndex&&(c.soundIndex+=e)}n.tune.setColumnList(t.slice())}},this.dispatchBase=a,this.state=t,this.dispatch=function(e,t){return a({type:e,payload:t})}},mn=(a(88),function(e){var t=e.loginType==e.curLoginType;return Object(d.jsx)("button",{className:t?"active":"",onClick:function(){t||(e.setLoginType(e.curLoginType),e.resetError())},children:e.name})}),On=function(e){Object(s.useEffect)((function(){e.isDisable&&e.stateSetter("")}),[e.isDisable]);var t=e.stateValue.length;return Object(d.jsxs)("div",{className:["form",e.isDisable?"disable":""].join(" "),children:[Object(d.jsxs)("span",{children:[e.label,":"]}),Object(d.jsx)("input",{className:[e.isDisable||0!=t?"":"required",!e.isDisable&&(t<5||t>15)?"range":"",e.isDisable||pn(e.stateValue)?"":"ban"].join(" "),type:e.isMask?"password":"text",value:e.stateValue,onChange:function(t){return e.stateSetter(t.target.value)}})]})},pn=function(e){return!!(e=null==e?"":e).match(/^[A-Za-z0-9_!@]*$/)},xn=function(){var e=Object(s.useRef)({}),t=Object(s.useState)("guest"),a=Object(r.a)(t,2),n=a[0],c=a[1],i=Object(s.useContext)(Nn),o=i.state,l=i.dispatcher,u=Object(s.useState)(""),b=Object(r.a)(u,2),h=b[0],j=b[1],f=Object(s.useState)(""),m=Object(r.a)(f,2),v=m[0],E=m[1],S=Object(s.useState)(""),g=Object(r.a)(S,2),T=g[0],N=g[1],y=Object(s.useState)(" "),A=Object(r.a)(y,2),I=A[0],C=A[1],L=Object(s.useState)(!1),k=Object(r.a)(L,2),_=k[0],D=k[1],R=Object(s.useState)(!1),w=Object(r.a)(R,2),F=w[0],M=w[1];return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{id:"logo",children:Object(d.jsx)("span",{children:"Virtual Harmonizer"})}),Object(d.jsxs)("div",{id:"login-frame",ref:e,children:[Object(d.jsx)("div",{className:"guide",children:Object(d.jsx)("span",{children:"Start to Virtual Harmonizer"})}),Object(d.jsxs)("div",{className:"type",children:[Object(d.jsx)(mn,{curLoginType:"guest",name:"guest",loginType:n,setLoginType:c,resetError:function(){return C("")}}),Object(d.jsx)(mn,{curLoginType:"login",name:"login",loginType:n,setLoginType:c,resetError:function(){return C("")}}),Object(d.jsx)(mn,{curLoginType:"create",name:"create account",loginType:n,setLoginType:c,resetError:function(){return C("")}})]}),Object(d.jsxs)("div",{className:"body",children:[Object(d.jsx)(On,{label:"user name",stateValue:h,stateSetter:j,isMask:!1,isDisable:!["login","create"].includes(n)}),Object(d.jsx)(On,{label:"password",stateValue:v,stateSetter:E,isMask:!0,isDisable:!["login","create"].includes(n)}),Object(d.jsx)(On,{label:"password confirm",stateValue:T,stateSetter:N,isMask:!0,isDisable:!["create"].includes(n)})]}),Object(d.jsx)("div",{className:"message",children:Object(d.jsx)("span",{className:_?"error":"",children:I})}),Object(d.jsx)("div",{className:["opr",function(){switch(n){case"guest":return!1;case"login":return""==h||h.length<5||h.length>15||!pn(h)||""==v||v.length<5||v.length>15||!pn(v);case"create":return h.length<5||h.length>15||!pn(h)||v.length<5||v.length>15||!pn(v)||T.length<5||T.length>15||!pn(T)}}()||F?"disable":""].join(" "),children:Object(d.jsx)("button",{onClick:function(){var t=function(t,a){e.current.style.opacity="0",setTimeout((function(){l.setLoginParams(Object(x.a)(Object(x.a)({},o.login),{},{isLogin:!0,id:t,name:a}))}),300)};switch(M(!0),D(!1),C("Connect to server..."),n){case"guest":t(-1,"Guest"),M(!1);break;case"login":Z("select","SELECT * FROM user_tbl where name = '".concat(h,"' and password = '").concat(v,"'")).then((function(e){return e.json()})).then((function(e){console.log(e.length),e.length>0?t(e[0].id,e[0].name):(D(!0),C("The login attempt failed. Either the user ID or password is invalid.")),M(!1)})).catch((function(e){console.log(e+"\u5931\u6557\u3057\u307e\u3057\u305f"),M(!1)}));break;case"create":if(v!=T){D(!0),C("Confirmation passwords don't match."),M(!1);break}Object(p.a)(O.a.mark((function e(){var t,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z("select","SELECT count(*) as cnt FROM user_tbl where name = '".concat(h,"'"));case 2:return t=e.sent,e.next=5,t.json();case 5:if(a=e.sent,console.log(JSON.stringify(a[0].cnt)),!(a[0].cnt>0)){e.next=13;break}D(!0),C("That user id has already been recorded."),e.next=22;break;case 13:return e.next=15,Z("update","INSERT INTO user_tbl(name, password) VALUES('".concat(h,"', '").concat(v,"')"));case 15:return t=e.sent,e.next=18,t.json();case 18:a=e.sent,C(""),alert("You have successfully created an account!"),c("login");case 22:M(!1);case 23:case"end":return e.stop()}}),e)})))()}},children:"enter"})})]})]})},vn=(a(89),function(e){var t=Object(s.useContext)(Nn),a=t.state,n=t.dispatch,c=t.dispatcher;return Object(d.jsxs)("div",{id:"user-plate",className:[""].join(" "),children:[Object(d.jsx)("div",{className:"user-name",children:Object(d.jsx)("span",{children:a.login.name})}),Object(d.jsx)("div",{className:"logout",onClick:function(){c.score.setNoteData(Object(x.a)(Object(x.a)({},a.noteData),{},{dataList:[]})),c.setLoginParams(Object(x.a)(Object(x.a)({},a.login),{},{isLogin:!1,name:""})),n(ee.SELECT_SCORETAB,{index:0})},children:Object(d.jsx)("span",{children:"LOGOUT"})})]})}),En=a(16),Sn=(a(90),function(){var e=Object(s.useContext)(Nn),t=(e.state,e.dispatcher),a=Object(s.useState)(),n=Object(r.a)(a,2),c=n[0],i=n[1];Object(s.useEffect)((function(){for(var e=[],t=0;t<=88;t++)e.push({soundName:T[(t+9)%12]+Math.floor((t+9)/12),isUse:!1,url:""});i(e)}),[]);return Object(d.jsxs)("div",{id:"samplertab-root",children:["// \u30b5\u30f3\u30d7\u30e9\u30fc\u306e\u8aad\u307f\u8fbc\u307fdiv",Object(d.jsx)("div",{className:"loader"}),"// \u97f3\u7a0b\u30ea\u30b9\u30c8div",Object(d.jsx)("div",{className:"list",children:function(){var e=[];return null===c||void 0===c||c.forEach((function(t,a){e.push(Object(d.jsxs)("div",{className:"record",children:[Object(d.jsx)("div",{className:"label",children:Object(d.jsx)("span",{children:t.soundName})}),Object(d.jsx)("input",{type:"checkbox",checked:t.isUse,onChange:function(e){t.isUse=e.target.checked,i(c.slice())}}),Object(d.jsx)("input",{type:"text",className:t.isUse?"":"disable",value:t.url,onChange:function(e){t.url=e.target.value,i(c.slice())}})]},a))})),e}()}),"// \u5236\u5fa1\u30dc\u30bf\u30f3div",Object(d.jsxs)("div",{className:"operation",children:[Object(d.jsx)("button",{className:["disable"].join(" "),onClick:function(){},children:"Save"}),Object(d.jsx)("button",{className:["disable"].join(" "),onClick:function(){},children:"Reset"}),Object(d.jsx)("button",{onClick:function(){t.setSampler(function(){for(var e={},t=0;t<88;t++)c&&c[t]&&c[t].isUse&&(e=Object(En.a)({},c[t].soundName,c[t].url));return e}())},children:"Build"})]}),Object(d.jsx)("div",{className:"keyboad"})]})}),gn=function(e){var t=Object(s.useContext)(Nn);t.state,t.dispatch,t.dispatcher;return Object(s.useEffect)((function(){var t=null;Z("select","SELECT * FROM sclibtbl where id = ".concat(e.id)).then((function(e){return e.json()})).then((function(e){var a;e.length>0&&(t=e[0],console.log("data: ".concat(null===(a=t)||void 0===a?void 0:a.title)))})).catch((function(e){console.log(e+"\u5931\u6557\u3057\u307e\u3057\u305f")}))}),[]),Object(d.jsx)(Tn,{children:Object(d.jsx)(Wa,{})})},Tn=Te.b.div(yt||(yt=Object(ge.a)(["\n    display: inline-block;\n    width: calc(100% - 20px);\n    height: calc(100% - 20px);\n    margin: 10px 0 0 10px;\n    background-color: #9e1717;\n"]))),Nn=(Te.b.div(At||(At=Object(ge.a)(["\n    display: inline-block;\n    font-size: 40px;\n    font-weight: 600;\n    color: white;\n"]))),Object(s.createContext)({})),yn=function(){var e=Object(s.useReducer)(se,te),t=Object(r.a)(e,2),a=t[0],n=t[1],c=function(e,t){return n({type:e,payload:t})},i=new fn(a,n),o=new URLSearchParams(Object(f.f)().search);return Object(s.useEffect)((function(){var e=window.navigator.userAgent.toLowerCase();alert(e)}),[]),Object(d.jsx)("div",{id:"main-frame",tabIndex:999,onKeyDown:function(e){return bn(e,a,c,i)},children:Object(d.jsx)(Nn.Provider,{value:{state:a,dispatch:c,dispatcher:i},children:Object(d.jsxs)(f.c,{children:[Object(d.jsxs)(f.a,{path:"/",exact:!0,children:[a.login.isLogin?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(vn,{}),Object(d.jsx)(h,{groupName:"system-tabs",tabElements:[{name:"Account",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Palette",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Score",disable:!1,cont:Object(d.jsx)(un,{})},{name:"Backing",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Symbol",disable:!0,cont:Object(d.jsx)("div",{})},{name:"Sampler",disable:!1,cont:Object(d.jsx)(Sn,{})},{name:"Setting",disable:!0,cont:Object(d.jsx)("div",{})}],activeNo:2})]}):Object(d.jsx)(xn,{}),function(){var e=a.dialog;return null!=e.contents?Object(d.jsx)("div",{className:"dialog-cover",children:Object(d.jsx)("div",{className:"dialog",style:{left:e.left,top:e.top},children:e.contents})}):Object(d.jsx)(d.Fragment,{})}()]}),Object(d.jsx)(f.a,{path:"/test",exact:!0,children:Object(d.jsx)(gn,{id:"aa"})}),Object(d.jsx)(f.a,{path:"/viewer",exact:!0,children:Object(d.jsx)(gn,{id:o.get("v")})})]})})})},An=function(){return Object(d.jsx)(j.a,{basename:"/vh-react",children:Object(d.jsx)(yn,{})})};var In=function(){return Object(s.useEffect)((function(){document.oncontextmenu=function(){return!1},window.addEventListener("keydown",(function(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}),!1)}),[]),Object(d.jsx)(An,{})},Cn=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,96)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),c(e),s(e),i(e)}))};l.a.render(Object(d.jsx)(i.a.StrictMode,{children:Object(d.jsx)(In,{})}),document.getElementById("root")),Cn()}},[[95,1,2]]]);
//# sourceMappingURL=main.b22cfa66.chunk.js.map