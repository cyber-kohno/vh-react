(this["webpackJsonpvh-react-ts"]=this["webpackJsonpvh-react-ts"]||[]).push([[0],{18:function(e,t,a){},19:function(e,t,a){},20:function(e,t,a){},21:function(e,t,a){},22:function(e,t,a){},24:function(e,t,a){},25:function(e,t,a){},35:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){"use strict";a.r(t);var n,s,c,i,r,l,d=a(6),o=a.n(d),b=a(12),u=a.n(b),j=(a(18),a(19),a(20),a(4)),E=(a(21),a(22),a(2)),O=function(e){var t=[];return t.push("tab-menu"),t.push(e.isActive?"active":""),t.push(e.isDisable?"disable":""),Object(E.jsx)("div",{className:t.join(" "),onClick:function(){return e.selectTab()},children:Object(E.jsx)("span",{children:e.name})})},h=function(e){return e.isActive?Object(E.jsx)("div",{className:"tab-cont",children:e.cont}):Object(E.jsx)(E.Fragment,{})},x=function(e){var t=Object(d.useState)(e.activeNo),a=Object(j.a)(t,2),n=a[0],s=a[1];Object(d.useEffect)((function(){s(e.activeNo)}),[e.activeNo]);var c=[],i=[];return e.tabElements.forEach((function(t,a){c.push(Object(E.jsx)(O,{name:t.name,isActive:a==n,isDisable:t.disable,selectTab:function(){return function(t){void 0!==e.selectTabIndex?e.selectTabIndex(t):s(t)}(a)}},a)),i.push(Object(E.jsx)(h,{cont:t.cont,isActive:a==n},a))})),Object(E.jsxs)("div",{id:e.groupName,children:[Object(E.jsx)("div",{className:"tab-list",children:c}),Object(E.jsx)("div",{className:"cont-list",children:i})]})},f=(a(24),a(25),["\u2160","b\u2161","\u2161","b\u2162","\u2162","\u2163","b\u2164","\u2164","b\u2165","\u2165","b\u2166","\u2166"]),T=["\u2160","#\u2160","\u2161","#\u2161","\u2162","\u2163","#\u2163","\u2164","#\u2164","\u2165","#\u2165","\u2166"],v=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],p=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],N=[{degreeIndex:0,symbolKey:"major"},{degreeIndex:2,symbolKey:"minor"},{degreeIndex:4,symbolKey:"minor"},{degreeIndex:5,symbolKey:"major"},{degreeIndex:7,symbolKey:"major"},{degreeIndex:9,symbolKey:"minor"},{degreeIndex:11,symbolKey:"minorMinus5"}],m=["\u2160","\u2160maj7","\u2161m","\u2161m7","\u2162m","\u2162m7","\u2163","\u2163maj7","\u2164","\u21647","\u2165m","\u2165m7","\u2166m(-5)","\u2166m7(-5)"],S=[{key:"major",sortNo:1,parentNo:0,depth:1,name:"",struct:["p1","M3","p5"],fixed:["p1"],intervals:[0,4,7]},{key:"minor",sortNo:2,parentNo:0,depth:1,name:"m",struct:["p1","m3","p5"],fixed:["p1"],intervals:[0,3,7]},{key:"sus4",sortNo:3,parentNo:0,depth:1,name:"sus4",struct:["p1","p4","p5"],fixed:["p1"],intervals:[0,5,7]},{key:"dim",sortNo:4,parentNo:0,depth:1,name:"dim",struct:["p1","m3","d5"],fixed:["p1"],intervals:[0,3,6]},{key:"aug",sortNo:5,parentNo:0,depth:1,name:"aug",struct:["p1","M3","a5"],fixed:["p1"],intervals:[0,4,8]},{key:"maj7",sortNo:6,parentNo:0,depth:1,name:"maj7",struct:["p1","M3","p5","M7"],fixed:["p1"],intervals:[0,4,7,11]},{key:"seventh",sortNo:7,parentNo:0,depth:1,name:"7",struct:["p1","M3","p5","m7"],fixed:["p1"],intervals:[0,4,7,10]},{key:"m7",sortNo:8,parentNo:0,depth:1,name:"m7",struct:["p1","m3","p5","m7"],fixed:["p1"],intervals:[0,3,7,10]},{key:"mmaj7",sortNo:9,parentNo:0,depth:1,name:"mmaj7",struct:["p1","m3","p5","M7"],fixed:["p1"],intervals:[0,3,7,11]},{key:"add9",sortNo:10,parentNo:0,depth:1,name:"add9",struct:["p1","M2","M3","p5"],fixed:["p1"],intervals:[0,2,4,7]},{key:"minorAdd9",sortNo:11,parentNo:0,depth:1,name:"madd9",struct:["p1","M2","m3","p5"],fixed:["p1"],intervals:[0,2,3,7]},{key:"sixthNinth",sortNo:12,parentNo:0,depth:1,name:"6(9)",struct:["p1","M2","M3","p5","M6"],fixed:["p1"],intervals:[0,2,4,7,9]},{key:"minorMinus5",sortNo:13,parentNo:0,depth:1,name:"m(-5)",struct:["p1","m3","d5"],fixed:["p1"],intervals:[0,3,6]}],L=a(13);!function(e){e.NONE="NONE",e.CONTEXT_MENU="CONTEXT_MENU",e.CHORD_PALETTE="CHORD_PALETTE",e.SECTION_PALETTE="SECTION_PALETTE",e.INIT_PALETTE="INIT_PALETTE",e.BACKING_PALETTE="BACKING_PALETTE"}(n||(n={})),function(e){e[e.Root=0]="Root",e[e.Symbol=1]="Symbol",e[e.Sustain=2]="Sustain"}(s||(s={})),function(e){e.LEFT="LEFT",e.RIGHT="RIGHT"}(c||(c={})),function(e){e.LEN16="LEN16",e.LEN8="LEN8",e.LEN4="LEN4",e.LEN2="LEN2",e.LEN1="LEN1"}(i||(i={})),function(e){e.SCALE="SCALE",e.DIRECT="DIRECT"}(r||(r={})),function(e){e.Init="init",e.Section="section",e.Chord="chord",e.Modulation="modulation",e.Fixed="fixed"}(l||(l={}));var C={scoreTabIndex:0,noteData:{scoreName:"",editMode:r.SCALE,dataList:[]},noteState:{focusIndex:-1,floatwndState:n.NONE,chordPaletteState:{isAddition:!1,selectedLine:s.Root,rootIndex:0,isFlat:!1,symbolKey:S[0].key,sustain:4},backingPaletteState:{useChannels:[],sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,layers:[]}},reffers:{},sampler:new L.a({E2:"https://dl.dropbox.com/s/0aghs80w9aggubw/KEPSREC040.mp3?dl=0",E3:"https://dl.dropbox.com/s/wxtf0u0ly03hu44/KEPSREC052.mp3?dl=0","A#3":"https://dl.dropbox.com/s/hbm9d1vo5tlxymk/KEPSREC058.mp3?dl=0",E4:"https://dl.dropbox.com/s/3qy88udfkzmzr13/KEPSREC064.mp3?dl=0",E5:"https://dl.dropbox.com/s/tdjp24r9pfoi2ff/KEPSREC076.mp3?dl=0",E6:"https://dl.dropbox.com/s/onp7h2vn2d6nhs7/KEPSREC088.mp3?dl=0"}).toDestination()};var I,_=a(1);!function(e){e.SELECT_SCORETAB="SELECT_SCORETAB",e.ADD_CHORD="ADD_CHORD",e.ADD_SECTION="ADD_SECTION",e.SET_DEGREE_INDEX="SET_DEGREE_INDEX",e.SET_SYMBOL_KEY="SET_SYMBOL_KEY",e.DETAIL_PARAMS_SETTER="DETAIL_PARAMS_SETTER",e.GET_ELEMENT_REFFER="GET_ELEMENT_REFFER",e.INIT_DEFAULT_ELEMENTS="INIT_DEFAULT_ELEMENTS",e.SELECT_NOTE_ELEMENT="SELECT_NOTE_ELEMENT",e.GET_REFFER="GET_REFFER",e.GET_REFFER_CONTEXT="GET_REFFER_CONTEXT",e.GET_REFFER_CHORD_PALETTE="GET_REFFER_CHORD_PALETTE",e.GET_REFFER_SECTION_PALETTE="GET_REFFER_SECTION_PALETTE",e.GET_REFFER_BACKING_PALETTE="GET_REFFER_BACKING_PALETTE",e.FLOATWND_STATE="FLOATWND_STATE",e.CHORD_PALETTE_SETTER="CHORD_PALETTE_SETTER",e.SET_NOTE_DATA="SET_NOTE_DATA",e.SET_DATA_LIST="SET_DATA_LIST",e.SET_NOTE_STATE="SET_NOTE_STATE",e.INIT_BACKING_PALETTE="INIT_BACKING_PALETTE",e.SET_USE_CHANNELS="SET_USE_CHANNELS",e.BACKING_TOGGLE_MATRIX="BACKING_TOGGLE_MATRIX"}(I||(I={}));var y=function(e,t){var a=t.type,n=t.payload;switch(a){case I.SELECT_SCORETAB:return Object(_.a)(Object(_.a)({},e),{},{scoreTabIndex:n.index});case I.ADD_CHORD:var s=e.noteData.dataList.slice();return s.splice(n.index+1,0,{type:l.Chord,detail:{degreeIndex:-1,isFlat:!1,symbolKey:null,sustain:4}}),Object(_.a)(Object(_.a)({},e),{},{noteData:Object(_.a)(Object(_.a)({},e.noteData),{},{dataList:s})});case I.ADD_SECTION:var c=e.noteData.dataList.slice(),i={label:"Section"};return c.splice(n.index+1,0,{type:l.Section,detail:i}),Object(_.a)(Object(_.a)({},e),{},{noteData:Object(_.a)(Object(_.a)({},e.noteData),{},{dataList:c})});case I.SET_DEGREE_INDEX:return e.noteData.dataList[n.pos].detail.degreeIndex=n.degreeIndex,Object(_.a)(Object(_.a)({},e),{},{noteData:Object(_.a)(Object(_.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case I.SET_SYMBOL_KEY:return e.noteData.dataList[n.pos].detail.symbolKey=n.symbolKey,Object(_.a)(Object(_.a)({},e),{},{noteData:Object(_.a)(Object(_.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case I.INIT_DEFAULT_ELEMENTS:return Object(_.a)(Object(_.a)({},e),{},{noteData:Object(_.a)(Object(_.a)({},e.noteData),{},{dataList:[{type:l.Init,detail:{tempo:100,rythm:"4/4",key:0,scale:"major"}},{type:l.Fixed,detail:{label:"START"}},{type:l.Section,detail:{label:"Section"}},{type:l.Fixed,detail:{label:"END"}}]})});case I.SELECT_NOTE_ELEMENT:return Object(_.a)(Object(_.a)({},e),{},{noteState:Object(_.a)(Object(_.a)({},e.noteState),{},{focusIndex:n.index})});case I.GET_REFFER_CONTEXT:return Object(_.a)(Object(_.a)({},e),{},{reffers:Object(_.a)(Object(_.a)({},e.reffers),{},{contextMneu:n.reffer})});case I.GET_REFFER_CHORD_PALETTE:return Object(_.a)(Object(_.a)({},e),{},{reffers:Object(_.a)(Object(_.a)({},e.reffers),{},{chordPalette:n.reffer})});case I.GET_REFFER_SECTION_PALETTE:return Object(_.a)(Object(_.a)({},e),{},{reffers:Object(_.a)(Object(_.a)({},e.reffers),{},{sectionPalette:n.reffer})});case I.GET_REFFER_BACKING_PALETTE:return Object(_.a)(Object(_.a)({},e),{},{reffers:Object(_.a)(Object(_.a)({},e.reffers),{},{backingPalette:n.reffer})});case I.FLOATWND_STATE:return Object(_.a)(Object(_.a)({},e),{},{noteState:Object(_.a)(Object(_.a)({},e.noteState),{},{floatwndState:n.state})});case I.CHORD_PALETTE_SETTER:return Object(_.a)(Object(_.a)({},e),{},{noteState:Object(_.a)(Object(_.a)({},e.noteState),{},{chordPaletteState:n.params})});case I.DETAIL_PARAMS_SETTER:var r=e.noteData.dataList.slice();return r[n.pos].detail=n.params,Object(_.a)(Object(_.a)({},e),{},{noteData:Object(_.a)(Object(_.a)({},e.noteData),{},{dataList:r})});case I.GET_REFFER:return Object(_.a)(Object(_.a)({},e),{},{reffers:n.reffers});case I.SET_NOTE_DATA:return Object(_.a)(Object(_.a)({},e),{},{noteData:n.data});case I.SET_DATA_LIST:return Object(_.a)(Object(_.a)({},e),{},{noteData:Object(_.a)(Object(_.a)({},e.noteData),{},{dataList:n.dataList})});case I.SET_NOTE_STATE:return Object(_.a)(Object(_.a)({},e),{},{noteState:n.noteState});case I.GET_ELEMENT_REFFER:return e.noteData.dataList[n.pos].reffer=n.reffer,Object(_.a)(Object(_.a)({},e),{},{noteData:Object(_.a)(Object(_.a)({},e.noteData),{},{dataList:e.noteData.dataList})});case I.INIT_BACKING_PALETTE:return Object(_.a)(Object(_.a)({},e),{},{noteState:Object(_.a)(Object(_.a)({},e.noteState),{},{backingPaletteState:n.backingPaletteState})});case I.SET_USE_CHANNELS:for(var d=e.noteState.backingPaletteState,o=d.layers,b=n.useChannels,u=new Array(2),j=0;j<2;j++){for(var E=d.useChannels.length,O=o[j].lens.length,h=o[j].table,x=new Array(E),f=0;f<E;f++)if(f<h.length)x[f]=h[f];else{x[f]=new Array(O);for(var T=0;T<O;T++)x[f][T]=new Array(1),x[f][T][0]=!1}u[j]=Object(_.a)(Object(_.a)({},o[j]),{},{table:x})}return Object(_.a)(Object(_.a)({},e),{},{noteState:Object(_.a)(Object(_.a)({},e.noteState),{},{backingPaletteState:Object(_.a)(Object(_.a)({},e.noteState.backingPaletteState),{},{useChannels:b,layers:u})})});case I.BACKING_TOGGLE_MATRIX:var v=n.sideIndex,p=n.lenIndex,N=n.channelIndex,m=e.noteState.backingPaletteState.layers;return m[v].table[N][p][0]=n.isUse,Object(_.a)(Object(_.a)({},e),{},{noteState:Object(_.a)(Object(_.a)({},e.noteState),{},{backingPaletteState:Object(_.a)(Object(_.a)({},e.noteState.backingPaletteState),{},{layers:m})})})}},A=function(e){var t=Object(d.useContext)(ae),a=t.state,n=(t.dispatch,t.dispatcher);switch(e.noteElement.type){case l.Fixed:var s=e.noteElement.detail;return Object(E.jsx)("span",{children:s.label});case l.Init:var c=e.noteElement.detail,i=[];return i.push(Object(E.jsxs)("div",{children:[Object(E.jsx)("span",{children:"tempo: "}),Object(E.jsx)("span",{children:c.tempo})]})),i.push(Object(E.jsxs)("div",{children:[Object(E.jsx)("span",{children:"rythm: "}),Object(E.jsx)("span",{children:c.rythm})]})),a.noteData.editMode==r.SCALE&&(i.push(Object(E.jsxs)("div",{children:[Object(E.jsx)("span",{children:"key: "}),Object(E.jsx)("span",{children:c.key})]})),i.push(Object(E.jsxs)("div",{children:[Object(E.jsx)("span",{children:"scale: "}),Object(E.jsx)("span",{children:c.scale})]}))),Object(E.jsx)("div",{children:i});case l.Chord:for(var o=e.noteElement.detail,b=function(e){var t="blank";-1!=e&&(t=(o.isFlat?f:T)[e]);return t}(o.degreeIndex),u=function(e){var t="-";-1!=e&&(t=(o.isFlat?v:p)[e]);return t}(o.degreeIndex),j=function(e,t){var a="";return-1!=e&&S.forEach((function(e,n){e.key==t&&(a=e.name)})),a}(o.degreeIndex,o.symbolKey),O=m.includes(b+j),h=[],x=0;x<o.sustain;x++)h.push(Object(E.jsx)("span",{},x));var N=e.progress.barCount,L=e.progress.remaindBeat,C=Math.round(e.progress.headMSec/1e3*10)/10,I=n.backing.getNotesCount(o.backing);return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{className:"degree"+(-1==o.degreeIndex?" blank":"")+(O?" diatonic":"")+(a.noteData.editMode==r.DIRECT?" visible":""),children:Object(E.jsxs)("span",{children:[b,j]})}),Object(E.jsx)("div",{className:a.noteData.editMode==r.DIRECT?"degree":"chord",children:Object(E.jsxs)("span",{children:[u,j]})}),Object(E.jsx)("div",{className:"sustain",children:h}),Object(E.jsxs)("div",{className:"progress-sustain",children:[Object(E.jsx)("span",{className:"bar",children:-1!=N?N:""}),Object(E.jsx)("span",{className:"beat",children:-1!=L?L:""})]}),Object(E.jsx)("div",{className:"progress-time",children:Object(E.jsxs)("span",{children:[C,"s"]})}),Object(E.jsx)("div",{className:"backing-script"+(0==I?" none":""),children:Object(E.jsxs)("span",{children:["notes: ",I]})})]});case l.Section:var _=e.noteElement.detail;return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{className:"name",children:Object(E.jsx)("span",{children:_.label})}),Object(E.jsx)("div",{className:"border"})]});case l.Modulation:e.noteElement.detail;return Object(E.jsx)(E.Fragment,{})}},g=(a(35),function(e){var t=Object(d.useContext)(ae),a=t.state,s=t.dispatch,c=(t.dispatcher,Object(d.useRef)({}));Object(d.useEffect)((function(){s(I.GET_ELEMENT_REFFER,{pos:e.index,reffer:c.current})}),[a.noteData.dataList]);var i=a.noteState.focusIndex,r=i==e.index,o=function(e,t,a){e.noteData.dataList[a].type!=l.Fixed&&t(I.SELECT_NOTE_ELEMENT,{index:a})},b=Object(E.jsx)(E.Fragment,{});return e.index==a.noteData.dataList.length-2&&(b=Object(E.jsx)("div",{className:"addition",onClick:function(){s(I.SELECT_NOTE_ELEMENT,{index:e.index}),s(I.ADD_CHORD,{index:e.index}),s(I.SELECT_NOTE_ELEMENT,{index:e.index+1}),s(I.FLOATWND_STATE,{state:n.CHORD_PALETTE}),s(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},a.noteState.chordPaletteState),{},{isAddition:!0,rootIndex:0,isFlat:!1,symbolKey:S[0].key,sustain:4})})},children:Object(E.jsx)("span",{children:"+"})})),Object(E.jsxs)("div",{className:"box",children:[Object(E.jsxs)("div",{className:"info-base",children:[Object(E.jsx)("div",{className:"header",children:function(){var t=[];return[l.Chord,l.Section,l.Modulation].includes(e.type)&&(l.Chord==e.type&&t.push(Object(E.jsx)("div",{className:"chord-no",children:Object(E.jsx)("span",{children:e.progress.no})},t.length)),t.push(Object(E.jsx)("div",{className:"del",children:Object(E.jsx)("span",{children:"\xd7"})},t.length))),Object(E.jsx)(E.Fragment,{children:t})}()}),Object(E.jsx)("div",{className:["note-element",function(){switch(e.type){case l.Fixed:return"detail-fixed";case l.Init:return"detail-init";case l.Chord:return"detail-chord";case l.Section:return"detail-section";case l.Modulation:return"detail-modulation"}}(),r?"active":"",[l.Init,l.Section,l.Chord].includes(e.type)?"selectable":"",function(){var t=a.noteData.dataList,n=[t.length],s=-1,c=-1;return t.forEach((function(e,t){e.type==l.Section&&s++,n[t]=s,i==t&&(c=s)})),n[e.index]==c&&e.type!=l.Fixed}()?"current":""].join(" "),onClick:function(){o(a,s,e.index),s(I.FLOATWND_STATE,{state:n.NONE})},onContextMenu:function(t){o(a,s,e.index),a.noteData.dataList[e.index].type!=l.Fixed&&(a.reffers.contextMneu.style.left=t.clientX+"px",a.reffers.contextMneu.style.top=t.clientY+"px",s(I.FLOATWND_STATE,{state:n.CONTEXT_MENU}))},ref:c,children:Object(E.jsx)(A,{noteElement:a.noteData.dataList[e.index],progress:e.progress})})]}),b]})}),k=function(e){var t=Object(d.useContext)(ae),a=t.state;t.dispatch;return Object(E.jsx)("div",{className:function(){var t=a.noteData.dataList,n=a.noteState.focusIndex,s=-1,c=-1;return t.forEach((function(e,t){e.type==l.Section&&s++,n==t&&(c=s)})),c==e.index}()?"active":"",children:Object(E.jsx)("span",{children:e.label})})},D=(a(36),function(e){return Object(E.jsxs)("div",{className:e.disable?"disable":"",onClick:function(){e.executer()},children:[Object(E.jsx)("span",{className:e.menuType,children:e.label}),Object(E.jsx)("span",{className:"key",children:"<".concat(e.keyName," key>")})]})}),R=function(){var e=Object(d.useContext)(ae),t=e.state,a=e.dispatch,s=e.dispatcher,c=function(){return a(I.FLOATWND_STATE,{state:n.NONE})},i=Object(d.useRef)({});Object(d.useEffect)((function(){a(I.GET_REFFER_CONTEXT,{reffer:i.current})}),[]);var r=[];if(t.noteState.floatwndState==n.CONTEXT_MENU){var o=t.noteData.dataList[t.noteState.focusIndex];switch(r.push({menuType:"order",label:"INSERT BLANK",keyName:"A",disable:!1,executer:function(){a(I.ADD_CHORD,{index:t.noteState.focusIndex}),c()}}),r.push({menuType:"call",label:"INSERT CHORD",keyName:"W",disable:!1,executer:function(){a(I.ADD_CHORD,{index:t.noteState.focusIndex}),a(I.SELECT_NOTE_ELEMENT,{index:t.noteState.focusIndex+1}),a(I.FLOATWND_STATE,{state:n.CHORD_PALETTE});var e=o.detail;a(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},t.noteState.chordPaletteState),{},{isAddition:!0,rootIndex:e.degreeIndex,isFlat:e.isFlat,symbolKey:e.symbolKey,sustain:e.sustain})})}}),r.push({menuType:"order",label:"INSERT SECTION",keyName:"S",disable:!1,executer:function(){a(I.ADD_SECTION,{index:t.noteState.focusIndex}),c()}}),r.push({menuType:"order",label:"INSERT MODULATION",keyName:"M",disable:!1,executer:function(){}}),o.type){case l.Chord:var b=o.detail;r.push({menuType:"order",label:"BLANK CHORD",keyName:"D",disable:-1==b.degreeIndex,executer:function(){a(I.SET_DEGREE_INDEX,{pos:t.noteState.focusIndex,degreeIndex:-1}),c()}}),r.push({menuType:"call",label:"EDIT CHORD",keyName:"C",disable:!1,executer:function(){a(I.FLOATWND_STATE,{state:n.CHORD_PALETTE}),a(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},t.noteState.chordPaletteState),{},{rootIndex:b.degreeIndex,isFlat:b.isFlat,symbolKey:b.symbolKey,sustain:b.sustain})})}}),r.push({menuType:"call",label:"EDIT BACKING",keyName:"B",disable:!1,executer:function(){s.score.callBackingEditor()}});break;case l.Section:r.push({menuType:"call",label:"EDIT SECTION",keyName:"C",disable:!1,executer:function(){}})}r.push({menuType:"order",label:"REMOVE",keyName:"DEL",disable:!0,executer:function(){}})}var u=[];return r.forEach((function(e,t){u.push(Object(E.jsx)(D,{menuType:e.menuType,label:e.label,keyName:e.keyName,disable:e.disable,executer:e.executer},t))})),Object(E.jsx)("div",{ref:i,id:"note-contextmenu",className:"floatwnd"+(t.noteState.floatwndState==n.CONTEXT_MENU?" active":""),onClick:function(){},children:u})},F=(a(37),function(){var e=Object(d.useContext)(ae),t=e.state,a=e.dispatch,c=e.dispatcher,i=Object(d.useRef)({});Object(d.useEffect)((function(){a(I.GET_REFFER_CHORD_PALETTE,{reffer:i.current})}),[]);var l=[],o=[],b=[],u=Object(E.jsx)(E.Fragment,{}),j=t.noteData.editMode==r.DIRECT,O=t.noteState.chordPaletteState;if(t.noteState.floatwndState==n.CHORD_PALETTE){var h=t.noteState.focusIndex;t.noteData.dataList[h].detail;T.forEach((function(e,n){var c=(0+n)%12,i=f[n],d=p[c],o=v[c],b=[1,3,6,8,10].includes(n),u=O.rootIndex==n,j=function(a){return t.noteData.editMode==r.SCALE?Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("span",{className:"degree",children:a?i:e}),Object(E.jsx)("span",{children:"\xa0("}),Object(E.jsx)("span",{className:"chord",children:a?o:d}),Object(E.jsx)("span",{children:")"})]}):Object(E.jsx)(E.Fragment,{children:Object(E.jsx)("span",{className:"degree",children:a?o:d})})};l.push(Object(E.jsx)("div",{children:b?Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{className:"half"+(u&&!O.isFlat?" active":""),onClick:function(){a(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},O),{},{selectedLine:s.Root,rootIndex:n,isFlat:!1})})},children:j(!1)}),Object(E.jsx)("div",{className:"half"+(u&&O.isFlat?" active":""),onClick:function(){a(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},O),{},{selectedLine:s.Root,rootIndex:n,isFlat:!0})})},children:j(!0)})]}):Object(E.jsx)("div",{className:u?"active":"",onClick:function(){a(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},O),{},{selectedLine:s.Root,rootIndex:n,isFlat:!1})})},children:j(!1)})},n))})),S.forEach((function(e,t){o.push(Object(E.jsx)("div",{className:e.key==O.symbolKey?"active":"",onClick:function(){a(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},O),{},{selectedLine:s.Symbol,symbolKey:e.key})})},children:Object(E.jsxs)("span",{children:["[",e.name,"]"]})},t))}));for(var N=function(e){b.push(Object(E.jsx)("div",{className:O.sustain>=e+1?"active":"",onClick:function(){a(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},O),{},{selectedLine:s.Sustain,sustain:e+1})})}},e))},m=0;m<8;m++)N(m);u=Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{onClick:function(){a(I.FLOATWND_STATE,{state:n.NONE})},children:Object(E.jsx)("span",{children:"Cancel"})}),Object(E.jsx)("div",{onClick:function(){c.chord.setCurChordParam()},children:Object(E.jsx)("span",{children:"Enter"})})]})}return Object(E.jsxs)("div",{ref:i,id:"total-palette",className:"floatwnd"+(t.noteState.floatwndState==n.CHORD_PALETTE?" active":""),onClick:function(){},children:[Object(E.jsx)(x,{groupName:"selector-tabs",tabElements:[{name:"Scale",disable:j,cont:Object(E.jsx)(E.Fragment,{})},{name:"Separate",disable:!1,cont:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{className:"chord-selector"+(O.selectedLine==s.Root?" active":""),children:l}),Object(E.jsx)("div",{className:"symbol-selector"+(O.selectedLine==s.Symbol?" active":""),children:o})]})},{name:"Fragment",disable:!1,cont:Object(E.jsx)(E.Fragment,{})}],activeNo:1}),Object(E.jsx)("div",{className:"beat-selector"+(O.selectedLine==s.Sustain?" active":""),children:b}),Object(E.jsx)("div",{className:"operation",children:u})]})});function P(e){var t=null;return S.forEach((function(a){a.key==e&&(t=a)})),t}a(38);var M=function(){var e=Object(d.useContext)(ae),t=e.state,a=(e.dispatch,t.noteState.focusIndex);if(-1==a)return Object(E.jsx)(E.Fragment,{});var n=t.noteData.dataList[a],s=Object(E.jsx)(E.Fragment,{});switch(n.type){case l.Chord:var c=n.detail,i="-";if(-1!=c.degreeIndex){var r=T[c.degreeIndex],o=p[c.degreeIndex];i="".concat(r," (").concat(o,")")}var b,u="-";if(null!=c.symbolKey)u="[".concat(null===(b=P(c.symbolKey))||void 0===b?void 0:b.name,"]");var j=[];j.push({title:"Tempo",value:"110",disable:!1}),j.push({title:"Rythm",value:"4/4",disable:!1}),j.push({title:"Key",value:"C",disable:!1}),j.push({title:"Scale",value:"major",disable:!1}),j.push({title:"Root",value:i,disable:"-"==i}),j.push({title:"Symbol",value:u,disable:"-"==u}),j.push({title:"Sustain",value:c.sustain+"",disable:!1});var O=[];j.forEach((function(e,t){O.push(Object(E.jsxs)("div",{className:"record"+(e.disable?" disable":""),children:[Object(E.jsx)("div",{className:"title",children:Object(E.jsxs)("span",{children:[e.title,":"]})}),Object(E.jsx)("div",{className:"value",children:Object(E.jsx)("span",{children:e.value})})]},t))}));var h=[];if(null!=c.symbolKey)for(var x=P(c.symbolKey),f=null===x||void 0===x?void 0:x.intervals,v=null===f||void 0===f?void 0:f.length,N=0;N<7;N++)if(N<v){var m=null===x||void 0===x?void 0:x.intervals[N],S=null===x||void 0===x?void 0:x.struct[N],L=p[(c.degreeIndex+m)%12];h.push(Object(E.jsxs)("div",{className:"record",children:[Object(E.jsx)("div",{className:"interval",children:Object(E.jsx)("span",{children:m})}),Object(E.jsx)("div",{className:"struct",children:Object(E.jsx)("span",{children:S})}),Object(E.jsx)("div",{className:"sound",children:Object(E.jsx)("span",{children:L})})]},N))}else h.push(Object(E.jsxs)("div",{className:"record disable",children:[Object(E.jsx)("div",{className:"interval"}),Object(E.jsx)("div",{className:"struct"}),Object(E.jsx)("div",{className:"sound"})]},N));s=Object(E.jsx)("div",{className:"chord",children:Object(E.jsxs)("div",{children:[Object(E.jsx)("div",{className:"title",children:Object(E.jsx)("span",{children:"Current State"})}),Object(E.jsx)("div",{className:"current-state",children:O}),Object(E.jsx)("div",{className:"title",children:Object(E.jsx)("span",{children:"Chord Struct"})}),Object(E.jsx)("div",{className:"symbol-struct",children:h})]})});break;case l.Section:s=Object(E.jsx)("div",{className:"section"})}return Object(E.jsx)("div",{id:"current-detail",children:s})},B=(a(39),function(e){var t=e.dispatcher,a=e.paletteState,n=a.sideIndex,s=a.layers[n],r=a.selectedLenIndex,l=s.lens[r],d=s.vels[r],o=function(e){var s=a.layers;s[n].lens[r]=e,t.initBackingPalette(Object(_.a)(Object(_.a)({},a),{},{layers:s}))},b=function(e){l.len=e,l.isHalf=!1,l.isDiv3=!1,o(l)},u=function(e){var s=a.layers,c=s[n].vels[r];s[n].vels[r]=c+e,t.initBackingPalette(Object(_.a)(Object(_.a)({},a),{},{layers:s}))},j=l.len,O=[{label:"16",isActive:j==i.LEN16,isDisable:!1,callback:function(){b(i.LEN16)}},{label:"8",isActive:j==i.LEN8,isDisable:!1,callback:function(){b(i.LEN8)}},{label:"4",isActive:j==i.LEN4,isDisable:!1,callback:function(){b(i.LEN4)}},{label:"2",isActive:j==i.LEN2,isDisable:!1,callback:function(){b(i.LEN2)}},{label:"1",isActive:j==i.LEN1,isDisable:!1,callback:function(){b(i.LEN1)}},{label:".",isActive:l.isHalf,isDisable:!t.backing.isAcceptHalf(),callback:function(){l.isHalf=!l.isHalf,l.isDiv3=!1,o(l)}},{label:"/ 3",isActive:l.isDiv3,isDisable:!t.backing.isAcceptDiv3(),callback:function(){l.isDiv3=!l.isDiv3,l.isHalf=!1,o(l)}},{label:"Add",isActive:!1,isDisable:!1,callback:function(){t.backing.addLen()}},{label:"Del",isActive:!1,isDisable:s.lens.length<=1,callback:function(){t.backing.delLen()}},{label:"vel-",isActive:!1,isDisable:d<=1,callback:function(){u(-1)}},{label:"vel+",isActive:!1,isDisable:d>=10,callback:function(){u(1)}},{label:"all clear",isActive:!1,isDisable:!1,callback:function(){var e={useChannels:[],sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,layers:[{lens:[{len:i.LEN1,isDiv3:!1,isHalf:!1}],side:c.LEFT,table:[],vels:[5]},{lens:[{len:i.LEN1,isDiv3:!1,isHalf:!1}],side:c.RIGHT,table:[],vels:[5]}]};t.initBackingPalette(e)}}],h=[];return O.forEach((function(e,t){h.push(Object(E.jsx)("button",{className:(e.isActive?"active":"")+(e.isDisable?" disable":""),onClick:function(){return e.callback()},children:Object(E.jsx)("span",{children:e.label})},t))})),Object(E.jsx)(E.Fragment,{children:h})}),w=function(e,t,a,n){var s=e[0==t?0:1],c=e[1==t?0:1],i="";if(s.table[a][n][0]){i="active";var r=G(s.lens,n);c.lens.forEach((function(e,t){var n=K(r,G(c.lens,t)),s=K(G(c.lens,t),r);c.table[a][t][0]&&(n||s)&&(i="overlap")}))}return i},K=function(e,t){return e.head+e.width>t.head&&e.head+e.width<=t.head+t.width||e.head<t.head+t.width&&e.head>=t.head},G=function(e,t){for(var a=0,n=0;n<t;n++){var s=e[n];a+=H(s)}return{head:a,width:H(e[t])}},H=function(e){var t=0;switch(e.len){case i.LEN1:t=16;break;case i.LEN2:t=8;break;case i.LEN4:t=4;break;case i.LEN8:t=2;break;case i.LEN16:t=1}return e.isHalf&&(t*=1.5),t},U=function(e){for(var t=e.paletteState,a=e.channelList,n=e.dispatcher,s=[],c=function(e){for(var c=[],r=t.layers[e],l=t.sideIndex==e,d=function(a){var s=[];r.lens.forEach((function(c,r){var l="";switch(c.len){case i.LEN4:l+="len4","4";break;case i.LEN8:l+="len8","8";break;case i.LEN16:l+="len16","16";break;case i.LEN2:l+="len2","2";break;case i.LEN1:l+="len1","1"}c.isHalf&&(l+=" half");for(var d=[],o=c.isDiv3?3:1,b=0;b<o;b++)d.push(Object(E.jsx)("div",{className:w(t.layers,e,a,r)+(c.isDiv3?" div3":""),onClick:function(){n.backing.toggleMatrix(a,r)}},b));s.push(Object(E.jsx)("div",{className:l,children:d},r))})),c.push(Object(E.jsx)("div",{className:"line",children:s},a))},o=a.length-1;o>=0;o--)d(o);s.push(Object(E.jsx)("div",{className:l?"cur":"back",children:c},e))},r=0;r<2;r++)c(r);return Object(E.jsx)("div",{className:"matrix",children:s})},X=function(e){var t=e.layer,a=[],n=1;t.lens.forEach((function(e,t){var a=0;switch(e.len){case i.LEN1:a=16;break;case i.LEN2:a=8;break;case i.LEN4:a=4;break;case i.LEN8:a=2;break;case i.LEN16:a=1}e.isHalf&&(a*=1.5),n+=a}));for(var s=function(e){var t=e==n-1;a.push(Object(E.jsx)("div",{className:(e%2==0?e%4==0?"mem4":"mem8":"mem16")+(t?" last":"")},e))},c=0;c<n;c++)s(c);return Object(E.jsx)("div",{className:"measure",children:a})},W=function(e){var t=e.paletteState,a=t.sideIndex,n=t.layers[a],s=e.dispatcher,c=e.channelList,r=e.testPlaySound,l=[];c.forEach((function(e,t){l.push(Object(E.jsx)("div",{className:"channel",onClick:function(){return r(e.soundFullName)},children:Object(E.jsx)("span",{children:e.soundFullName})},t))}));var d=[],o=[];return n.lens.forEach((function(e,a){var c=t.selectedLenIndex==a?"active ":"",r="";switch(e.len){case i.LEN4:c+="len4",r="4";break;case i.LEN8:c+="len8",r="8";break;case i.LEN16:c+="len16",r="16";break;case i.LEN2:c+="len2",r="2";break;case i.LEN1:c+="len1",r="1"}e.isHalf&&(r+=" .",c+=" half"),e.isDiv3&&(r+=" /"),d.push(Object(E.jsx)("div",{className:c,onClick:function(){s.initBackingPalette(Object(_.a)(Object(_.a)({},t),{},{selectedLenIndex:a}))},children:Object(E.jsx)("span",{children:r})},a));var l=n.vels[a];o.push(Object(E.jsx)("div",{className:c,children:Object(E.jsx)("div",{style:{height:10*l+"%"}})},a))})),Object(E.jsxs)("div",{className:"backing-table",children:[Object(E.jsx)("div",{className:"switch",children:Object(E.jsx)(B,{dispatcher:s,paletteState:t})}),Object(E.jsxs)("div",{className:"fixed",children:[Object(E.jsxs)("div",{className:"layer",children:[Object(E.jsx)("button",{className:1==t.sideIndex?"active":"",onClick:function(){s.backing.setLayerIndex(1)},children:Object(E.jsx)("span",{children:"RIGHT"})}),Object(E.jsx)("button",{className:0==t.sideIndex?"active":"",onClick:function(){s.backing.setLayerIndex(0)},children:Object(E.jsx)("span",{children:"LEFT"})})]}),Object(E.jsx)("div",{className:"matrix",children:l})]}),Object(E.jsxs)("div",{className:"main",children:[Object(E.jsx)("div",{className:"split",children:d}),Object(E.jsx)(X,{layer:n}),Object(E.jsx)(U,{paletteState:t,channelList:c,dispatcher:s}),Object(E.jsx)("div",{className:"volume",children:o})]})]})},Y=function(e){for(var t=[],a=function(a){var n=a<e.symbol.intervals.length,s=[];if(n){var c=e.structs[a],i=e.symbol.intervals[a],r=e.symbol.struct[a];s.push(Object(E.jsx)("div",{className:"label",children:Object(E.jsxs)("span",{children:[r,"[",i,"]: ",c]})},0));for(var l=function(t){var n=e.degreeIndex+e.symbol.intervals[a]+12*t,c=Math.floor(n/12),i=e.structs[a]+c,r=n<9||n>=97,l=!1;e.paletteState.useChannels.forEach((function(e){e.octave==t&&e.structIndex==a&&(l=!0)}));var d=e.paletteState.useChannels.length>=12&&!l;s.push(Object(E.jsx)("div",{className:"col"+(r||d?" disable":"")+(l?" active":""),onClick:function(){var n=e.paletteState.useChannels;if(l){var s=-1;n.forEach((function(e,n){e.octave==t&&e.structIndex==a&&(s=n)})),n.splice(s,1)}else n.push({octave:t,structIndex:a});n.sort((function(e,t){return 8*e.octave+e.structIndex-(8*t.octave+t.structIndex)})),e.paletteState.useChannels=n,e.setUseChannels(e.paletteState.useChannels)},onContextMenu:function(){e.testPlaySound(i)},children:Object(E.jsx)("span",{children:r?"-":i})},t+1))},d=0;d<8;d++)l(d)}else{s.push(Object(E.jsx)("div",{className:"label"},0));for(var o=0;o<7;o++)s.push(Object(E.jsx)("div",{className:"col"},o+1))}t.push(Object(E.jsx)("div",{className:"record"+(n?"":" disable"),children:s},a))},n=0;n<7;n++)a(n);return Object(E.jsx)("div",{className:"struct-table",children:t})},V=function(e,t,a,n){for(var s=[],c=function(c){for(var i=function(i){var r=t+a.intervals[c]+12*i,l=!1;e.forEach((function(e){e.octave==i&&e.structIndex==c&&(l=!0)}));var d=Math.floor(r/12),o=n[c]+d;l&&s.push({soundIndex:r,soundFullName:o})},r=0;r<8;r++)i(r)},i=0;i<a.intervals.length;i++)c(i);return s.sort((function(e,t){return t.soundIndex-e.soundIndex})),s},z=function(){var e=Object(d.useContext)(ae),t=e.state,a=e.dispatch,s=e.dispatcher,c=Object(d.useRef)({});if(Object(d.useEffect)((function(){a(I.GET_REFFER_BACKING_PALETTE,{reffer:c.current})}),[]),t.noteState.floatwndState!=n.BACKING_PALETTE)return Object(E.jsx)(E.Fragment,{});var i=t.noteState.backingPaletteState,r=i.sideIndex,l=(i.layers[r],i.selectedLenIndex,t.noteData.dataList[t.noteState.focusIndex].detail),o=P(l.symbolKey),b=p[l.degreeIndex]+o.name,u=[];o.intervals.forEach((function(e){u.push(p[(l.degreeIndex+e)%12])}));var j=V(i.useChannels,l.degreeIndex,o,u),O=function(e){t.sampler.triggerAttack(e,"+0",.15),setTimeout((function(){t.sampler.triggerRelease(e)}),1e3)},h=E.Fragment;return h=Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{onClick:function(){a(I.FLOATWND_STATE,{state:n.NONE})},children:Object(E.jsx)("span",{children:"Cancel"})}),Object(E.jsx)("div",{onClick:function(){s.backing.play()},children:Object(E.jsx)("span",{children:"Play"})}),Object(E.jsx)("div",{onClick:function(){s.backing.setCurBackingScript()},children:Object(E.jsx)("span",{children:"Update"})})]}),Object(E.jsxs)("div",{ref:c,id:"backing-palette",className:"floatwnd"+(t.noteState.floatwndState==n.BACKING_PALETTE?" active":""),onClick:function(){},children:[Object(E.jsxs)("div",{className:"base-info",children:[Object(E.jsxs)("div",{className:"record",children:[Object(E.jsx)("div",{className:"title",children:Object(E.jsx)("span",{children:"Chord:"})}),Object(E.jsx)("div",{className:"value",children:Object(E.jsx)("span",{children:b})})]}),Object(E.jsxs)("div",{className:"record",children:[Object(E.jsx)("div",{className:"title",children:Object(E.jsx)("span",{children:"Struct:"})}),Object(E.jsx)("div",{className:"value",children:Object(E.jsx)("span",{children:u.join(", ")})})]}),Object(E.jsxs)("div",{className:"record",children:[Object(E.jsx)("div",{className:"title",children:Object(E.jsx)("span",{children:"Sustain:"})}),Object(E.jsx)("div",{className:"value",children:Object(E.jsx)("span",{children:l.sustain})})]})]}),Object(E.jsx)(Y,{paletteState:i,structs:u,symbol:o,degreeIndex:l.degreeIndex,testPlaySound:O,setUseChannels:function(e){return s.setUseChannels(e)}}),Object(E.jsx)(W,{channelList:j,paletteState:i,dispatcher:s,testPlaySound:O}),Object(E.jsx)("div",{className:"operation",children:h})]})},J=function(){var e=Object(d.useContext)(ae),t=e.state,a=e.dispatch,s=t.noteData.dataList,c=0,i=[],r=[],o=1,b=0,u=0,j=-1;s.forEach((function(e,t){var a=Math.floor(b/4)+1,n={};if(n.no=o,n.barCount=j!=a?a:-1,n.remaindBeat=b%4>0?b%4:-1,n.headMSec=u,i.push(Object(E.jsx)(g,{index:t,type:e.type,progress:n},t)),e.type==l.Chord){j=a;var s=e.detail;b+=s.sustain;u+=6e4/99*4/4*s.sustain,o++}e.type==l.Section&&(r.push(Object(E.jsx)(k,{index:c,label:e.detail.label},t)),c++)}));var O=!(t.noteState.floatwndState==n.NONE||t.noteState.floatwndState==n.CONTEXT_MENU);return Object(E.jsxs)("div",{id:"scorecont-notetab-root",children:[Object(E.jsxs)("div",{className:"left-cont",children:[Object(E.jsxs)("div",{id:"score-note",children:[Object(E.jsxs)("div",{id:"operation-header",children:[Object(E.jsx)("button",{children:Object(E.jsx)("span",{children:"BACK"})}),Object(E.jsx)("button",{children:Object(E.jsx)("span",{children:"SAVE"})}),Object(E.jsx)("button",{children:Object(E.jsx)("span",{children:"RELOAD"})}),Object(E.jsx)("button",{children:Object(E.jsx)("span",{children:"OPTION"})})]}),Object(E.jsx)("div",{id:"section-list",children:r}),Object(E.jsx)("div",{id:"score-list-root",children:i}),Object(E.jsx)("div",{id:"modal-blind",className:O?"active":"",onClick:function(){a(I.FLOATWND_STATE,{state:n.NONE})}}),Object(E.jsx)(R,{}),Object(E.jsx)(F,{}),Object(E.jsx)(z,{})]}),Object(E.jsx)("div",{id:"score-footer"})]}),Object(E.jsx)("div",{className:"right-cont",children:Object(E.jsx)(M,{})})]})},q=(a(40),function(){var e=Object(d.useContext)(ae),t=e.state,a=e.dispatch;e.dispatcher;return Object(E.jsxs)("div",{id:"scorecont-listtab-root",children:[Object(E.jsxs)("div",{className:"left-cont",children:[Object(E.jsx)("button",{onClick:function(){a(I.SET_NOTE_DATA,{data:Object(_.a)(Object(_.a)({},t.noteData),{},{editMode:r.SCALE})}),a(I.INIT_DEFAULT_ELEMENTS,null),a(I.SELECT_NOTE_ELEMENT,{index:2}),a(I.SELECT_SCORETAB,{index:1})},children:Object(E.jsx)("span",{children:"SCALE"})}),Object(E.jsx)("button",{onClick:function(){a(I.SET_NOTE_DATA,{data:Object(_.a)(Object(_.a)({},t.noteData),{},{editMode:r.DIRECT})}),a(I.INIT_DEFAULT_ELEMENTS,null),a(I.SELECT_NOTE_ELEMENT,{index:2}),a(I.SELECT_SCORETAB,{index:1})},children:Object(E.jsx)("span",{children:"DIRECT"})})]}),Object(E.jsx)("div",{className:"right-cont"})]})}),Q=(a(41),function(){var e=Object(d.useContext)(ae);e.state,e.dispatch,e.dispatcher;return Object(E.jsx)(E.Fragment,{})}),Z=function(){var e=Object(d.useContext)(ae),t=e.state,a=e.dispatch;return Object(E.jsx)("div",{id:"scoretab-root",children:Object(E.jsx)(x,{groupName:"score-tabs",tabElements:[{name:"LIBLARY",disable:!1,cont:Object(E.jsx)(q,{})},{name:"Note",disable:!1,cont:Object(E.jsx)(J,{})},{name:"Backing",disable:!1,cont:Object(E.jsx)(Q,{})},{name:"Sheet Music",disable:!1,cont:Object(E.jsx)("div",{})},{name:"Source",disable:!1,cont:Object(E.jsx)("div",{})},{name:"Preview",disable:!1,cont:Object(E.jsx)("div",{})}],activeNo:t.scoreTabIndex,selectTabIndex:function(e){return a(I.SELECT_SCORETAB,{index:e})}})})},$=a(5),ee=a(0),te=function e(t,a){var s=this;Object(ee.a)(this,e),this.dispatchBase=void 0,this.dispatch=void 0,this.state=void 0,this.setNoteData=function(e){s.dispatchBase({type:I.SET_NOTE_DATA,payload:{data:e}})},this.initBackingPalette=function(e){s.dispatchBase({type:I.INIT_BACKING_PALETTE,payload:{backingPaletteState:e}})},this.setUseChannels=function(e){s.dispatchBase({type:I.SET_USE_CHANNELS,payload:{useChannels:e}})},this.score={getInitElement:function(){return s.state.noteData.dataList[0].detail},addChordElement:function(){var e=s.state.noteState.focusIndex,t=s.state.noteData.dataList.slice();t.splice(e+1,0,{type:l.Chord,detail:{degreeIndex:-1,isFlat:!1,symbolKey:null,sustain:4,backing:{useChannels:[],layers:[{lens:[{len:i.LEN1,isDiv3:!1,isHalf:!1}],side:c.LEFT,table:[],vels:[5]},{lens:[{len:i.LEN1,isDiv3:!1,isHalf:!1}],side:c.RIGHT,table:[],vels:[5]}]}}}),s.dispatch(I.SET_DATA_LIST,{dataList:t})},deleteCurElement:function(){var e=s.state.noteState.focusIndex;if(s.state.noteData.dataList[e].type==l.Chord){var t=[];s.state.noteData.dataList.forEach((function(a,n){e!=n&&t.push(Object(_.a)({},a))})),t.splice(e,1),s.state.noteState.focusIndex--,s.dispatch(I.SET_DATA_LIST,{dataList:t}),s.dispatch(I.SET_NOTE_STATE,{noteState:s.state.noteState})}},focusPreviousElement:function(){var e=s.state.noteState.focusIndex;s.state.noteData.dataList[e-1].type!=l.Fixed&&(s.state.noteState.focusIndex--,s.dispatch(I.SET_NOTE_STATE,{noteState:s.state.noteState}))},focusNextElement:function(){var e=s.state.noteState.focusIndex;s.state.noteData.dataList[e+1].type!=l.Fixed&&(s.state.noteState.focusIndex++,s.dispatch(I.SET_NOTE_STATE,{noteState:s.state.noteState}))},focusPreviousSection:function(){var e=s.state.noteData.dataList,t=s.state.noteState.focusIndex;do{if(e[--t].type==l.Section){s.state.noteState.focusIndex=t,s.dispatch(I.SET_NOTE_STATE,{noteState:s.state.noteState});break}}while(t>0)},focusNextSection:function(){var e=s.state.noteData.dataList,t=s.state.noteState.focusIndex;do{if(e[++t].type==l.Section||t==e.length-2){s.state.noteState.focusIndex=t,s.dispatch(I.SET_NOTE_STATE,{noteState:s.state.noteState});break}}while(t<e.length-1)},focusInitElement:function(){s.state.noteState.focusIndex=0,s.dispatch(I.SET_NOTE_STATE,{noteState:s.state.noteState})},callChordSelector:function(){var e=s.state.noteState.focusIndex,t=s.state.noteData.dataList[e].detail;s.dispatch(I.FLOATWND_STATE,{state:n.CHORD_PALETTE}),s.dispatch(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},s.state.noteState.chordPaletteState),{},{rootIndex:t.degreeIndex,isFlat:t.isFlat,symbolKey:t.symbolKey,sustain:t.sustain})})},callBackingEditor:function(){var e=s.state.noteState.focusIndex,t=s.state.noteData.dataList[e].detail;s.dispatch(I.FLOATWND_STATE,{state:n.BACKING_PALETTE});var a=t.backing,c={useChannels:a.useChannels,sideIndex:0,selectedLenIndex:0,selectedChannelIndex:-1,layers:a.layers};s.initBackingPalette(c)}},this.chord={setCurChordParam:function(){var e=s.state.noteState.focusIndex,t=s.state.noteData.dataList[e].detail,a=s.state.noteState.chordPaletteState;s.dispatch(I.DETAIL_PARAMS_SETTER,{pos:e,params:Object(_.a)(Object(_.a)({},t),{},{degreeIndex:a.rootIndex,isFlat:a.isFlat,symbolKey:a.symbolKey,sustain:a.sustain})}),s.dispatch(I.FLOATWND_STATE,{state:n.NONE});var c=s.state.noteData.dataList[e].reffer;c.style.backgroundColor="#ff0",setTimeout((function(){c.style.backgroundColor=""}),350)}},this.backing={toggleMatrix:function(e,t){var a=s.state.noteState.backingPaletteState.sideIndex,n=!s.state.noteState.backingPaletteState.layers[a].table[e][t][0];s.dispatchBase({type:I.BACKING_TOGGLE_MATRIX,payload:{sideIndex:a,channelIndex:e,lenIndex:t,isUse:n}})},addLen:function(){var e=s.state.noteState.backingPaletteState,t=e.layers,a=e.sideIndex,n=t[a],c=e.selectedLenIndex,r=n.table;n.lens=Object($.a)(n.lens),n.lens.splice(c+1,0,{len:i.LEN4,isHalf:!1,isDiv3:!1}),r.forEach((function(e){e.splice(c+1,0,[!1])})),n.vels.splice(e.selectedLenIndex+1,0,5),t[a]=n,s.dispatchBase({type:I.INIT_BACKING_PALETTE,payload:{backingPaletteState:e}})},delLen:function(){var e=s.state.noteState.backingPaletteState,t=e.layers,a=e.sideIndex,n=t[a],c=e.selectedLenIndex,i=n.table;n.lens=Object($.a)(n.lens),n.lens.splice(c,1),i.forEach((function(e){e.splice(c,1)})),n.vels.splice(c,1),t[a]=n,c>0&&e.selectedLenIndex--,s.dispatch(I.INIT_BACKING_PALETTE,{backingPaletteState:e})},updateLenIndex:function(e){var t=s.state.noteState.backingPaletteState;t.selectedLenIndex=e,s.initBackingPalette(t)},getCurLenIndex:function(){return s.state.noteState.backingPaletteState.selectedLenIndex},isFirstCurLen:function(){return 0==s.state.noteState.backingPaletteState.selectedLenIndex},isLastCurLen:function(){var e=s.state.noteState.backingPaletteState,t=e.layers[e.sideIndex];return e.selectedLenIndex==t.lens.length-1},getSideScript:function(){var e=s.state.noteState.backingPaletteState;return e.layers[e.sideIndex]},getCurLenBean:function(){var e=s.state.noteState.backingPaletteState;return e.layers[e.sideIndex].lens[e.selectedLenIndex]},setCurrentLenBean:function(e){var t=s.state.noteState.backingPaletteState,a=t.layers;a[t.sideIndex].lens[t.selectedLenIndex]=e,s.initBackingPalette(Object(_.a)(Object(_.a)({},t),{},{layers:a}))},setCurLen:function(e){var t=s.backing.getCurLenBean();t.len=e,t.isHalf=!1,t.isDiv3=!1,s.backing.setCurrentLenBean(t)},updateCurVolume:function(e){var t=s.state.noteState.backingPaletteState,a=t.layers;a[t.sideIndex].vels[t.selectedLenIndex]=e,s.initBackingPalette(Object(_.a)(Object(_.a)({},t),{},{layers:a}))},getCurVelocity:function(){var e=s.state.noteState.backingPaletteState;return e.layers[e.sideIndex].vels[e.selectedLenIndex]},isAcceptHalf:function(){return[i.LEN2,i.LEN4,i.LEN8].includes(s.backing.getCurLenBean().len)},isAcceptDiv3:function(){return[i.LEN4,i.LEN8].includes(s.backing.getCurLenBean().len)},setLayerIndex:function(e){var t=s.state.noteState.backingPaletteState;t.sideIndex=e,t.selectedLenIndex=0,s.initBackingPalette(t)},changeLayerIndex:function(){var e=s.state.noteState.backingPaletteState;e.sideIndex=0==e.sideIndex?1:0,e.selectedLenIndex=0,s.initBackingPalette(e)},setUseChannels:function(e){for(var t=s.state.noteState.backingPaletteState,a=t.layers,n=new Array(2),c=0;c<2;c++){for(var i=t.useChannels.length,r=a[c].lens.length,l=a[c].table,d=new Array(i),o=0;o<i;o++)if(o<l.length)d[o]=l[o];else{d[o]=new Array(r);for(var b=0;b<r;b++)d[o][b]=new Array(1),d[o][b][0]=!1}n[c]=Object(_.a)(Object(_.a)({},a[c]),{},{table:d})}},setCurBackingScript:function(){var e=s.state.noteState.focusIndex,t=s.state.noteData.dataList[e].detail,a=s.state.noteState.backingPaletteState,c={};c.useChannels=a.useChannels,c.layers=a.layers,s.dispatch(I.DETAIL_PARAMS_SETTER,{pos:e,params:Object(_.a)(Object(_.a)({},t),{},{backing:c})}),s.dispatch(I.FLOATWND_STATE,{state:n.NONE});var i=s.state.noteData.dataList[e].reffer;i.style.backgroundColor="#ff0",setTimeout((function(){i.style.backgroundColor=""}),350)},getNotesCount:function(e){var t=0;return e.layers.forEach((function(e){e.table.forEach((function(e){e.forEach((function(e){e[0]&&t++}))}))})),t},play:function(){var e=s.state.noteState.focusIndex,t=s.state.noteData.dataList[e].detail,a=P(t.symbolKey),n=null===a||void 0===a?void 0:a.intervals,c=s.state.noteState.backingPaletteState,i=6e4/130*4;setTimeout((function(){s.state.sampler.releaseAll()}),i);for(var r=function(e){var a=1,r=c.layers[e];r.lens.forEach((function(e,l){var d=Number(e.len.toString().replace("LEN","")),o=i/d;e.isHalf&&(o*=1.5),c.useChannels.forEach((function(e,c){if(r.table[c][l][0]){var i=t.degreeIndex+n[e.structIndex]+12*e.octave,d=Math.floor(i/12),o=p[i%12]+d,b=.7*r.vels[l]/10;setTimeout((function(){s.state.sampler.triggerAttack(o,"+0",b)}),a)}})),a+=o}))},l=0;l<2;l++)r(l)}},this.dispatchBase=a,this.state=t,this.dispatch=function(e,t){return a({type:e,payload:t})}},ae=Object(d.createContext)({}),ne=function(){var e=Object(d.useReducer)(y,C),t=Object(j.a)(e,2),a=t[0],s=t[1],c=function(e,t){return s({type:e,payload:t})},r=new te(a,s),o={state:a,dispatch:c,dispatcher:r};return Object(E.jsx)("div",{id:"main-frame",tabIndex:999,onKeyDown:function(e){return function(e,t,a,s){var c=t.noteState.focusIndex,r=t.noteData.dataList[c];switch(r.type){case l.Chord:var d=r.detail;switch(t.noteState.floatwndState){case n.NONE:switch(e.key){case"c":s.score.callChordSelector();break;case"b":s.score.callBackingEditor();break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":var o=N[Number(e.key)-1];a(I.SET_DEGREE_INDEX,{pos:c,degreeIndex:o.degreeIndex}),a(I.SET_SYMBOL_KEY,{pos:c,symbolKey:o.symbolKey})}break;case n.CHORD_PALETTE:switch(e.key){case"Escape":case"c":a(I.FLOATWND_STATE,{state:n.NONE});break;case"ArrowRight":a(I.SET_DEGREE_INDEX,{pos:c,degreeIndex:d.degreeIndex+1});break;case"ArrowLeft":case"1":a(I.SET_DEGREE_INDEX,{pos:c,degreeIndex:d.degreeIndex-1});break;case"Enter":s.chord.setCurChordParam()}break;case n.BACKING_PALETTE:switch(e.key){case"Escape":case"b":a(I.FLOATWND_STATE,{state:n.NONE});break;case"ArrowLeft":if(!s.backing.isFirstCurLen()){var b=s.backing.getCurLenIndex();s.backing.updateLenIndex(b-1)}break;case"ArrowRight":if(!s.backing.isLastCurLen()){var u=s.backing.getCurLenIndex();s.backing.updateLenIndex(u+1)}break;case"ArrowUp":var j=s.backing.getCurVelocity();j<10&&s.backing.updateCurVolume(j+1);break;case"ArrowDown":var E=s.backing.getCurVelocity();E>1&&s.backing.updateCurVolume(E-1);break;case"r":s.backing.changeLayerIndex();break;case"1":s.backing.setCurLen(i.LEN16);break;case"2":s.backing.setCurLen(i.LEN8);break;case"3":s.backing.setCurLen(i.LEN4);break;case"4":s.backing.setCurLen(i.LEN2);break;case"5":s.backing.setCurLen(i.LEN1);break;case".":if(s.backing.isAcceptHalf()){var O=s.backing.getCurLenBean();O.isHalf=!O.isHalf,O.isDiv3=!1,s.backing.setCurrentLenBean(O)}break;case"/":if(s.backing.isAcceptDiv3()){var h=s.backing.getCurLenBean();h.isDiv3=!h.isDiv3,h.isHalf=!1,s.backing.setCurrentLenBean(h)}break;case"a":s.backing.addLen();break;case"Delete":s.backing.getSideScript().lens.length>1&&s.backing.delLen();break;case" ":s.backing.play();break;case"Enter":s.backing.setCurBackingScript()}}}if(t.noteState.floatwndState==n.NONE&&[l.Chord,l.Section].includes(r.type))switch(e.key){case"ArrowLeft":s.score.focusPreviousElement();break;case"ArrowRight":s.score.focusNextElement();break;case"ArrowUp":s.score.focusPreviousSection();break;case"ArrowDown":s.score.focusNextSection();break;case"Delete":s.score.deleteCurElement();break;case"i":s.score.focusInitElement();break;case"a":s.score.addChordElement();break;case"s":a(I.ADD_SECTION,{index:c});break;case"w":var x=r.detail;a(I.FLOATWND_STATE,{state:n.CHORD_PALETTE}),a(I.CHORD_PALETTE_SETTER,{params:Object(_.a)(Object(_.a)({},t.noteState.chordPaletteState),{},{rootIndex:x.degreeIndex,isFlat:x.isFlat,symbolKey:x.symbolKey,sustain:x.sustain})})}}(e,a,c,r)},children:Object(E.jsx)(ae.Provider,{value:o,children:Object(E.jsx)(x,{groupName:"system-tabs",tabElements:[{name:"Account",disable:!1,cont:Object(E.jsx)("div",{})},{name:"Test",disable:!1,cont:Object(E.jsx)("div",{})},{name:"Score",disable:!1,cont:Object(E.jsx)(Z,{})},{name:"Backing",disable:!1,cont:Object(E.jsx)("div",{})},{name:"Symbol",disable:!1,cont:Object(E.jsx)("div",{})},{name:"Sampler",disable:!0,cont:Object(E.jsx)("div",{})},{name:"Setting",disable:!1,cont:Object(E.jsx)("div",{})}],activeNo:2})})})};var se=function(){return Object(d.useEffect)((function(){document.oncontextmenu=function(){return!1},window.addEventListener("keydown",(function(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}),!1)}),[]),Object(E.jsx)(ne,{})},ce=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,43)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,c=t.getLCP,i=t.getTTFB;a(e),n(e),s(e),c(e),i(e)}))};u.a.render(Object(E.jsx)(o.a.StrictMode,{children:Object(E.jsx)(se,{})}),document.getElementById("root")),ce()}},[[42,1,2]]]);
//# sourceMappingURL=main.10424bcc.chunk.js.map